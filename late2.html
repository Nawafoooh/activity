<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - توثيق التأخر الصباحي</title>
    <style>
        :root {
            --primary-color: #1a5490;
            --primary-dark: #0d3a66;
            --secondary-color: #2c7ab8;
            --accent-color: #e8a547;
            --success-color: #28a745;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --background: #f7fafc;
            --card-background: #ffffff;
            --border-color: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Tahoma', 'Droid Arabic Naskh', sans-serif;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            color: var(--text-primary);
            line-height: 1.8;
            direction: rtl;
            text-align: right;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 4px 20px var(--shadow);
            border-radius: 0 0 20px 20px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50%;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .logo-section {
            margin-bottom: 20px;
        }

        .school-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .school-logo svg {
            width: 45px;
            height: 45px;
            fill: var(--primary-color);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
        }

        .card {
            background: var(--card-background);
            border-radius: 16px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--card-background), #f8f9fa);
            padding: 25px;
            border-radius: 12px;
            border-right: 4px solid var(--primary-color);
            box-shadow: 0 2px 10px var(--shadow);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .export-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .export-btn.blue {
            background: #0d6efd;
        }

        .export-btn.gray {
            background: #6c757d;
        }

        .table-container {
            overflow-x: auto;
            background: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        th {
            padding: 18px 15px;
            text-align: right;
            font-weight: 700;
            font-size: 1.05rem;
        }

        td {
            padding: 16px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        #emptyState {
            text-align: center;
            padding: 60px 20px;
            display: none;
        }

        #emptyState svg {
            margin: 0 auto 20px;
        }

        #emptyState h3 {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        #emptyState p {
            color: var(--text-secondary);
        }

        .footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-secondary);
            margin-top: 50px;
            border-top: 2px solid var(--border-color);
        }

        .footer-content {
            background: var(--card-background);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .officials {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .official-info {
            padding: 15px;
            background: var(--background);
            border-radius: 10px;
        }

        .official-info strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 5px;
            font-size: 1.05rem;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: slideIn 0.6s ease;
        }

        /* تنسيقات الطباعة الاحترافية */
        @media print {
            body {
                background: white;
                margin: 0;
                padding: 0;
            }
            
            .header, .stats-grid, .export-btn, .dashboard-header, .footer, .action-btn {
                display: none !important;
            }

            .container {
                max-width: 100%;
                padding: 0;
            }

            .card {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
                page-break-inside: avoid;
            }

            .table-container {
                display: none;
            }

            #printContent {
                display: block !important;
            }

            .pledge-document {
                width: 210mm;
                min-height: 297mm;
                padding: 25mm;
                margin: 0 auto;
                background: white;
                page-break-after: always;
            }

            .doc-header {
                text-align: center;
                margin-bottom: 50px;
                border-bottom: 3px solid #1a5490;
                padding-bottom: 20px;
            }

            .doc-logo {
                width: 100px;
                height: 100px;
                margin: 0 auto 20px;
            }

            .doc-title {
                font-size: 28px;
                font-weight: bold;
                color: #1a5490;
                margin-bottom: 10px;
            }

            .doc-subtitle {
                font-size: 18px;
                color: #666;
            }

            .doc-body {
                margin: 50px 0;
                line-height: 2.8;
                font-size: 17px;
            }

            .pledge-text-print {
                background: #f0f7ff;
                padding: 40px;
                border: 2px solid #1a5490;
                border-radius: 10px;
                margin: 40px 0;
                text-align: justify;
                line-height: 2.8;
                font-size: 17px;
            }

            .signatures {
                display: flex;
                justify-content: space-between;
                margin-top: 100px;
                padding-top: 50px;
            }

            .signature-box {
                text-align: center;
                width: 45%;
            }

            .signature-line {
                border-top: 2px solid #000;
                margin-top: 70px;
                padding-top: 15px;
            }

            .signature-title {
                font-weight: bold;
                font-size: 17px;
                margin-bottom: 8px;
                color: #1a5490;
            }

            .signature-name {
                font-size: 15px;
                color: #666;
            }

            .doc-date {
                text-align: left;
                margin-top: 50px;
                font-size: 15px;
                color: #666;
            }
        }

        #printContent {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .card {
                padding: 25px;
            }
            
            .officials {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 12px 10px;
                font-size: 0.9rem;
            }

            .export-btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="school-logo">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 13H5V11H3V13ZM3 17H5V15H3V17ZM3 9H5V7H3V9ZM7 13H21V11H7V13ZM7 17H21V15H7V17ZM7 7V9H21V7H7Z"/>
                    </svg>
                </div>
            </div>
            <h1>لوحة التحكم - التأخر الصباحي</h1>
            <p class="subtitle">وكيل شؤون الطلاب: الأستاذ نواف الصبحي</p>
        </div>
    </header>

    <div class="container">
        <div class="stats-grid fade-in">
            <div class="stat-card">
                <div class="stat-value" id="totalPledges">0</div>
                <div class="stat-label">إجمالي التعهدات</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="todayPledges">0</div>
                <div class="stat-label">تعهدات اليوم</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalLates">0</div>
                <div class="stat-label">إجمالي حالات التأخر</div>
            </div>
        </div>

        <div class="card fade-in">
            <div class="dashboard-header">
                <h2 class="card-title">سجل التعهدات المستلمة</h2>
                <div>
                    <button class="export-btn" onclick="exportToExcel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 12V19H5V12H3V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V12H19ZM13 12.67L15.59 10.09L17 11.5L12 16.5L7 11.5L8.41 10.09L11 12.67V3H13V12.67Z"/>
                        </svg>
                        تصدير Excel
                    </button>
                    <button class="export-btn blue" onclick="exportToCSV()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 12V19H5V12H3V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V12H19ZM13 12.67L15.59 10.09L17 11.5L12 16.5L7 11.5L8.41 10.09L11 12.67V3H13V12.67Z"/>
                        </svg>
                        تصدير CSV
                    </button>
                    <button class="export-btn gray" onclick="printAllReport()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 8H5C3.34 8 2 9.34 2 11V17H6V21H18V17H22V11C22 9.34 20.66 8 19 8ZM16 19H8V14H16V19ZM19 12C18.45 12 18 11.55 18 11C18 10.45 18.45 10 19 10C19.55 10 20 10.45 20 11C20 11.55 19.55 12 19 12ZM18 3H6V7H18V3Z"/>
                        </svg>
                        طباعة الكل
                    </button>
                </div>
            </div>

            <div id="emptyState">
                <svg width="120" height="120" viewBox="0 0 24 24" fill="#cbd5e0">
                    <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM17 12H7V10H17V12ZM13 16H7V14H13V16ZM17 8H7V6H17V8Z"/>
                </svg>
                <h3>لا توجد تعهدات مسجلة حتى الآن</h3>
                <p>سيتم عرض التعهدات المستلمة من أولياء الأمور هنا</p>
            </div>

            <div class="table-container" id="tableContainer">
                <table id="pledgesTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>اسم الطالب</th>
                            <th>الصف</th>
                            <th>الشعبة</th>
                            <th>عدد التأخر</th>
                            <th>ولي الأمر</th>
                            <th>التاريخ</th>
                            <th>إجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="pledgesBody">
                    </tbody>
                </table>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="officials">
                    <div class="official-info">
                        <strong>وكيل شؤون الطلاب</strong>
                        <p>الأستاذ نواف الصبحي</p>
                    </div>
                    <div class="official-info">
                        <strong>قائد المدرسة</strong>
                        <p>الأستاذ خالد المطيري</p>
                    </div>
                </div>
                <p style="margin-top: 20px; color: var(--text-secondary); font-size: 0.95rem;">
                    © 2026 - وزارة التعليم - المملكة العربية السعودية
                </p>
            </div>
        </footer>
    </div>

    <!-- محتوى الطباعة -->
    <div id="printContent"></div>

    <script>
        function loadPledges() {
            const pledges = JSON.parse(localStorage.getItem('pledges') || '[]');
            const tbody = document.getElementById('pledgesBody');
            const emptyState = document.getElementById('emptyState');
            const tableContainer = document.getElementById('tableContainer');
            
            updateStatistics(pledges);
            
            if (pledges.length === 0) {
                emptyState.style.display = 'block';
                tableContainer.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            tableContainer.style.display = 'block';
            
            tbody.innerHTML = '';
            
            pledges.slice().reverse().forEach((pledge, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${pledges.length - index}</td>
                    <td><strong>${pledge.studentName}</strong></td>
                    <td>${pledge.grade}</td>
                    <td>${pledge.section}</td>
                    <td><span style="background: #fee; color: #c00; padding: 4px 12px; border-radius: 6px; font-weight: 600;">${pledge.lateCount}</span></td>
                    <td>${pledge.parentName}</td>
                    <td style="font-size: 0.9rem;">${new Date(pledge.timestamp).toLocaleDateString('ar-SA')}</td>
                    <td>
                        <button class="action-btn" onclick="printPledge(${pledges.length - index - 1})">
                            طباعة التعهد
                        </button>
                    </td>
                `;
            });
        }

        function updateStatistics(pledges) {
            const totalPledges = pledges.length;
            document.getElementById('totalPledges').textContent = totalPledges;
            
            const today = new Date().toLocaleDateString('ar-SA');
            const todayPledges = pledges.filter(p => p.timestamp.includes(today)).length;
            document.getElementById('todayPledges').textContent = todayPledges;
            
            const totalLates = pledges.reduce((sum, p) => sum + parseInt(p.lateCount), 0);
            document.getElementById('totalLates').textContent = totalLates;
        }

        function printPledge(index) {
            const pledges = JSON.parse(localStorage.getItem('pledges') || '[]');
            const pledge = pledges[index];
            
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = `
                <div class="pledge-document">
                    <div class="doc-header">
                        <div class="doc-logo">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%; fill: #1a5490;">
                                <path d="M12 3L1 9L5 11.18V17.18L12 21L19 17.18V11.18L21 10.09V17H23V9L12 3ZM18.82 9L12 12.72L5.18 9L12 5.28L18.82 9ZM17 15.99L12 18.72L7 15.99V12.27L12 15L17 12.27V15.99Z"/>
                            </svg>
                        </div>
                        <div class="doc-title">المملكة العربية السعودية</div>
                        <div class="doc-subtitle">وزارة التعليم</div>
                        <div class="doc-subtitle" style="margin-top: 10px; font-weight: bold;">تعهد ولي أمر بانضباط الطالب</div>
                    </div>

                    <div class="doc-body">
                        <div class="pledge-text-print">
                            أتعهد أنا ولي أمر الطالب <strong>${pledge.studentName}</strong> بالحرص على انضباط ابني وحضوره في الوقت المحدد نظاماً. وأقر بعلمي أن تكرار التأخر الصباحي يؤثر سلباً على مستواه التحصيلي، وقد يعرضه للإجراءات النظامية المعتمدة من وزارة التعليم. كما أتعهد بالتعاون الكامل مع إدارة المدرسة في متابعة انضباطه.
                        </div>

                        <div class="signatures">
                            <div class="signature-box">
                                <div class="signature-line">
                                    <div class="signature-title">ولي الأمر</div>
                                    <div class="signature-name">${pledge.parentName}</div>
                                </div>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line">
                                    <div class="signature-title">وكيل شؤون الطلاب</div>
                                    <div class="signature-name">الأستاذ نواف الصبحي</div>
                                </div>
                            </div>
                        </div>

                        <div class="doc-date">
                            <strong>التاريخ:</strong> ${pledge.timestamp}
                        </div>
                    </div>
                </div>
            `;
            
            window.print();
        }

        function printAllReport() {
            const pledges = JSON.parse(localStorage.getItem('pledges') || '[]');
            
            if (pledges.length === 0) {
                alert('لا توجد تعهدات للطباعة');
                return;
            }
            
            const printContent = document.getElementById('printContent');
            let allPledges = '';
            
            pledges.forEach((pledge, index) => {
                allPledges += `
                    <div class="pledge-document">
                        <div class="doc-header">
                            <div class="doc-logo">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%; fill: #1a5490;">
                                    <path d="M12 3L1 9L5 11.18V17.18L12 21L19 17.18V11.18L21 10.09V17H23V9L12 3ZM18.82 9L12 12.72L5.18 9L12 5.28L18.82 9ZM17 15.99L12 18.72L7 15.99V12.27L12 15L17 12.27V15.99Z"/>
                                </svg>
                            </div>
                            <div class="doc-title">المملكة العربية السعودية</div>
                            <div class="doc-subtitle">وزارة التعليم</div>
                            <div class="doc-subtitle" style="margin-top: 10px; font-weight: bold;">تعهد ولي أمر بانضباط الطالب</div>
                        </div>

                        <div class="doc-body">
                            <div class="pledge-text-print">
                                أتعهد أنا ولي أمر الطالب <strong>${pledge.studentName}</strong> بالحرص على انضباط ابني وحضوره في الوقت المحدد نظاماً. وأقر بعلمي أن تكرار التأخر الصباحي يؤثر سلباً على مستواه التحصيلي، وقد يعرضه للإجراءات النظامية المعتمدة من وزارة التعليم. كما أتعهد بالتعاون الكامل مع إدارة المدرسة في متابعة انضباطه.
                            </div>

                            <div class="signatures">
                                <div class="signature-box">
                                    <div class="signature-line">
                                        <div class="signature-title">ولي الأمر</div>
                                        <div class="signature-name">${pledge.parentName}</div>
                                    </div>
                                </div>
                                <div class="signature-box">
                                    <div class="signature-line">
                                        <div class="signature-title">وكيل شؤون الطلاب</div>
                                        <div class="signature-name">الأستاذ نواف الصبحي</div>
                                    </div>
                                </div>
                            </div>

                            <div class="doc-date">
                                <strong>التاريخ:</strong> ${pledge.timestamp}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            printContent.innerHTML = allPledges;
            window.print();
        }

        function exportToCSV() {
            const pledges = JSON.parse(localStorage.getItem('pledges') || '[]');
            
            if (pledges.length === 0) {
                alert('لا توجد بيانات للتصدير');
                return;
            }
            
            let csv = '\uFEFF';
            csv += 'الرقم,اسم الطالب,الصف,الشعبة,عدد مرات التأخر,سبب التأخر,اسم ولي الأمر,تاريخ ووقت الإرسال\n';
            
            pledges.forEach((pledge, index) => {
                csv += `${index + 1},"${pledge.studentName}","${pledge.grade}","${pledge.section}",${pledge.lateCount},"${pledge.reason}","${pledge.parentName}","${pledge.timestamp}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const date = new Date().toLocaleDateString('ar-SA').replace(/\//g, '-');
            link.setAttribute('href', url);
            link.setAttribute('download', `تقرير_التأخر_الصباحي_${date}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToExcel() {
            const pledges = JSON.parse(localStorage.getItem('pledges') || '[]');
            
            if (pledges.length === 0) {
                alert('لا توجد بيانات للتصدير');
                return;
            }
            
            let html = `
                <html xmlns:x="urn:schemas-microsoft-com:office:excel">
                <head>
                    <meta charset="UTF-8">
                    <style>
                        table { border-collapse: collapse; width: 100%; direction: rtl; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: right; }
                        th { background-color: #1a5490; color: white; font-weight: bold; }
                        .header { text-align: center; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>تقرير التأخر الصباحي</h2>
                        <p>وزارة التعليم - المملكة العربية السعودية</p>
                        <p>وكيل شؤون الطلاب: الأستاذ نواف الصبحي</p>
                        <p>قائد المدرسة: الأستاذ خالد المطيري</p>
                        <p>تاريخ التقرير: ${new Date().toLocaleDateString('ar-SA', { dateStyle: 'full' })}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم الطالب</th>
                                <th>الصف</th>
                                <th>الشعبة</th>
                                <th>عدد مرات التأخر</th>
                                <th>سبب التأخر</th>
                                <th>اسم ولي الأمر</th>
                                <th>تاريخ ووقت الإرسال</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            pledges.forEach((pledge, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${pledge.studentName}</td>
                        <td>${pledge.grade}</td>
                        <td>${pledge.section}</td>
                        <td>${pledge.lateCount}</td>
                        <td>${pledge.reason}</td>
                        <td>${pledge.parentName}</td>
                        <td>${pledge.timestamp}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    <div style="margin-top: 30px; page-break-before: always;">
                        <h3>الإحصائيات</h3>
                        <p>إجمالي التعهدات: ${pledges.length}</p>
                        <p>إجمالي حالات التأخر: ${pledges.reduce((sum, p) => sum + parseInt(p.lateCount), 0)}</p>
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob(['\ufeff', html], { type: 'application/vnd.ms-excel' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const date = new Date().toLocaleDateString('ar-SA').replace(/\//g, '-');
            link.setAttribute('href', url);
            link.setAttribute('download', `تقرير_التأخر_الصباحي_${date}.xls`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        setInterval(loadPledges, 10000);
        loadPledges();
    </script>
</body>
</html>
