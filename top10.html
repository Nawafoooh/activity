<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุตุฉ ุงูุณููู ุงูุทูุงุจู | ูุชูุณุทุฉ ุงูููุฐุฑ ุจู ุนูุฑู ุงูุฃูุตุงุฑู</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2980b9;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --warning-color: #f39c12;
            --light-bg: #f4f7f9;
            --white-bg: #ffffff;
            --border-color: #e2e8f0;
            --neutral-color: #7f8c8d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--light-bg);
            color: var(--secondary-color);
            line-height: 1.8;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: var(--white-bg);
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #3498db 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        .header h1 { font-size: 2em; margin-bottom: 5px; }
        .school-info {
            background-color: #ecf0f1;
            padding: 15px 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .info-item { font-size: 0.9em; }
        .info-item strong { color: var(--primary-color); }
        .nav {
            background: var(--white-bg);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            padding: 5px 0;
        }
        .nav button {
            background: transparent;
            border: none;
            color: var(--secondary-color);
            padding: 12px 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-family: 'Tajawal', sans-serif;
        }
        .nav button:hover { color: var(--primary-color); }
        .nav button.active {
            color: var(--primary-color);
            font-weight: 700;
            border-bottom-color: var(--primary-color);
        }
        .content { padding: 30px; }
        .section { display: none; animation: fadeIn 0.5s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .card {
            background: var(--white-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        .card h2 {
            font-size: 1.7em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        /* ูุธุงู ุงูุชูููุฒ ุงูุจุตุฑู */
        .card.motivational {
            border-right: 5px solid var(--success-color);
            background: linear-gradient(to left, rgba(39, 174, 96, 0.03), transparent);
        }
        .card.statutory-notice {
            border-right: 5px solid var(--neutral-color);
            background: linear-gradient(to left, rgba(127, 140, 141, 0.03), transparent);
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            background-color: #f8f9fa;
            font-family: 'Tajawal', sans-serif;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            outline: 2px solid var(--primary-color); 
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.05em;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Tajawal', sans-serif;
        }
        .btn-success { background-color: var(--success-color); }
        .btn-danger { background-color: var(--danger-color); }
        .btn-print { background-color: var(--warning-color); }
        .btn:hover { filter: brightness(110%); }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .stat-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-bottom: 4px solid;
        }
        .stat-card .value { font-size: 2.5em; font-weight: 800; }
        .stat-card .label { font-size: 1em; margin-top: 5px; }
        .stat-card.violations { border-color: var(--danger-color); } 
        .stat-card.violations .value { color: var(--danger-color); }
        .stat-card.positives { border-color: var(--success-color); } 
        .stat-card.positives .value { color: var(--success-color); }
        .stat-card.recoveries { border-color: var(--primary-color); } 
        .stat-card.recoveries .value { color: var(--primary-color); }
        .stat-card.commitment { border-color: var(--warning-color); } 
        .stat-card.commitment .value { color: var(--warning-color); }
        .alert { padding: 15px; border-radius: 8px; margin: 20px 0; border-right: 5px solid; }
        .alert-info { background-color: #eaf5fc; border-color: var(--primary-color); color: #084298; }
        .alert-success { background-color: #eafaf1; border-color: var(--success-color); color: #0f5132; }
        .alert-warning { background-color: #fff3cd; border-color: var(--warning-color); color: #856404; }
        .alert-neutral { background-color: #f8f9fa; border-color: var(--neutral-color); color: #495057; }
        #governance h3 { font-size: 1.4em; color: var(--primary-color); margin-top: 25px; margin-bottom: 10px; }
        #governance ul { padding-right: 25px; }
        #governance li { margin-bottom: 10px; }
        #reports-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #reports-table th, #reports-table td { padding: 12px; border: 1px solid var(--border-color); text-align: right; }
        #reports-table th { background-color: #f2f2f2; font-weight: 700; }
        #reports-table tr:nth-child(even) { background-color: #f8f9fa; }
        #reports-table tfoot { background-color: #e9ecef; font-weight: 600; }
        .points-positive { color: var(--success-color); font-weight: bold; }
        .points-negative { color: var(--danger-color); }
        .no-records { color: #777; }
        .report-controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px; }
        .success-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .points-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .category-icon {
            font-size: 1.2em;
            margin-left: 8px;
        }
        optgroup {
            font-weight: 700;
            font-size: 1.05em;
            padding: 8px;
            background: #f8f9fa;
        }
        option {
            padding: 10px;
            font-size: 0.95em;
        }
        #points-display {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            color: white;
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        #points-value {
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        /* ุตูุฏูู ุดุฑุญ ุงููุนุงุฏูุฉ */
        .formula-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .formula-box h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }
        .formula-box .formula {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 1.1em;
            text-align: center;
            direction: ltr;
        }
        .formula-box ul {
            list-style: none;
            padding: 0;
        }
        .formula-box li {
            padding: 8px 0;
            padding-right: 25px;
            position: relative;
        }
        .formula-box li:before {
            content: "โ";
            position: absolute;
            right: 0;
            color: rgba(255,255,255,0.7);
        }
        /* ุชูููุน ุงููุนุชูุฏ */
        .approver-signature {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-right: 3px solid var(--primary-color);
        }
        .approver-signature strong {
            color: var(--primary-color);
        }
        @media (max-width: 768px) { 
            .form-row { grid-template-columns: 1fr; } 
            .header h1 { font-size: 1.5em; }
        }
        @media print {
            body { background-color: var(--white-bg); }
            .nav, .btn, .form-group, .report-controls, .content > .card:not(#printable-area), .alert-warning { display: none; }
            .container { box-shadow: none; border: none; margin: 0; }
            .content { padding: 0; }
            #printable-area { display: block !important; border: none; box-shadow: none; }
            .section.active { display: block !important; }
            #reports-table th, #reports-table td { font-size: 10pt; }
            .approver-signature { display: block !important; page-break-inside: avoid; }
            .formula-box { background: #f8f9fa; color: #000; border: 2px solid #667eea; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ููุตุฉ ุงูุณููู ุงูุทูุงุจู ุงููุทูุฑุฉ</h1>
            <p>ูุชูุณุทุฉ ุงูููุฐุฑ ุจู ุนูุฑู ุงูุฃูุตุงุฑู - ุงููุฏููุฉ ุงููููุฑุฉ</p>
        </header>

        <div class="school-info">
            <div class="info-item"><strong>ูุฏูุฑ ุงููุฏุฑุณุฉ:</strong> ุงูุฃุณุชุงุฐ ุฎุงูุฏ ุงููุทูุฑู</div>
            <div class="info-item"><strong>ูููู ุดุคูู ุงูุทูุงุจ:</strong> <span id="display-approver-name">ุงูุฃุณุชุงุฐ ููุงู ุงูุตุจุญู</span></div>
            <div class="info-item"><strong>ุงูุนุงู ุงูุฏุฑุงุณู:</strong> 1447-1448 ูู</div>
        </div>

        <nav class="nav">
            <button class="active" onclick="showSection('dashboard')">ููุญุฉ ุงููุชุงุจุนุฉ</button>
            <button onclick="showSection('positive')">ุฑุตุฏ ุณููู ุฅูุฌุงุจู</button>
            <button onclick="showSection('violation')">ุฑุตุฏ ูุฎุงููุฉ</button>
            <button onclick="showSection('reports')">ุชูุงุฑูุฑ ุงูุฃุฏุงุก</button>
            <button onclick="showSection('governance')">ุงูุญูููุฉ ูุงูุดูุงููุฉ</button>
        </nav>

        <main class="content">
            <div class="alert alert-warning" id="loading-alert" style="display:none;">
                ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช ูู Firebase...
            </div>

            <!-- 1. ููุญุฉ ุงููุชุงุจุนุฉ ุงูุฐููุฉ -->
            <section id="dashboard" class="section active">
                <div class="card">
                    <h2>ููุญุฉ ุงููุชุงุจุนุฉ ุงูุฃุณุจูุนูุฉ ุงูุฐููุฉ</h2>
                    <div class="alert alert-info">
                        <strong>ูุจุฏุฃ ุงูุฑุตุฏ:</strong> ูุฐู ุงูููุญุฉ ุชุนุฑุถ "ุงูุงุณุชุซูุงุกุงุช" ุงููุณุฌูุฉ ููุท (ุงููุฎุงููุงุช ูุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ ุงููููุฒุฉ)ุ ููุง ุชุนุฑุถ ุจูุงูุงุช ุงูุทูุงุจ ุงูููุชุฒููู ุงูุชุฑุงุถููุง.
                    </div>
                    <div class="dashboard-grid" id="dashboard-grid"></div>
                </div>
            </section>

            <!-- 2. ุฑุตุฏ ุณููู ุฅูุฌุงุจู (ุงูุชุฑุชูุจ ุงูุฌุฏูุฏ) -->
            <section id="positive" class="section">
                <div class="card motivational">
                    <h2>๐ ุฑุตุฏ ุณููู ุฅูุฌุงุจู ูููุฒ (ุฅุฌุฑุงุก ุชุญููุฒู)</h2>
                    <div class="alert alert-success">
                        <strong>๐ ุทุจูุนุฉ ูุฐุง ุงูุฅุฌุฑุงุก:</strong> ูุฐุง ุฅุฌุฑุงุก ุชุญููุฒู ุฏุงุฎูู ููุฏู ูุชุดุฌูุน ุงูุทูุงุจ ูุชุนุฒูุฒ ุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ. ูุง ููุนุฏ ุฅุฌุฑุงุกู ูุธุงูููุง ุฑุณูููุง.
                    </div>
                    <div class="success-message" id="positive-success"></div>
                    <form id="positiveForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pos_student_name">ุงุณู ุงูุทุงูุจ *</label>
                                <input type="text" id="pos_student_name" required placeholder="ุงูุงุณู ุงูุซูุงุซู ููุทุงูุจ">
                            </div>
                            <div class="form-group">
                                <label for="pos_grade">ุงูุตู *</label>
                                <select id="pos_grade" required>
                                    <option value="" disabled selected>ุงุฎุชุฑ ุงูุตู</option>
                                    <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
                                    <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
                                    <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pos_category">ุชุตููู ุงูุณููู ุงููุชููุฒ *</label>
                            <select id="pos_category" required onchange="updatePointsDisplay()">
                                <option value="" disabled selected>ุงุฎุชุฑ ุชุตููู ุงูุณููู ุงููุชููุฒ</option>
                                <optgroup label="๐ ุงููุฆุฉ ุงูุฃููู (6 ุฏุฑุฌุงุช)">
                                    <option value="ุงููุฆุฉ ุงูุฃููู - ุงูุถุจุงุท ูุนุฏู ุบูุงุจ">ุงูุถุจุงุท ุงูุทุงูุจ ูุนุฏู ุบูุงุจู ุจุฏูู ุนุฐุฑ ุฎูุงู ุงููุตู</option>
                                </optgroup>
                                <optgroup label="๐ ุงููุฆุฉ ุงูุซุงููุฉ (6 ุฏุฑุฌุงุช ููู ูุดุงุฑูุฉ)">
                                    <option value="ุงููุฆุฉ ุงูุซุงููุฉ - ุฎุฏูุฉ ูุฌุชูุนูุฉ ุฎุงุฑุฌ ุงููุฏุฑุณุฉ">ุงููุดุงุฑูุฉ ูู ุงูุฎุฏูุฉ ุงููุฌุชูุนูุฉ ุฎุงุฑุฌ ุงููุฏุฑุณุฉ</option>
                                    <option value="ุงููุฆุฉ ุงูุซุงููุฉ - ูุนุงููุฉ ุญูุงุฑูุฉ">ุชูุฏูู ูุนุงููุฉ ุญูุงุฑูุฉ</option>
                                    <option value="ุงููุฆุฉ ุงูุซุงููุฉ - ุญููุฉ ุชูุนููุฉ">ุงููุดุงุฑูุฉ ูู ุญููุฉ ุชูุนููุฉ</option>
                                    <option value="ุงููุฆุฉ ุงูุซุงููุฉ - ุนุฑุถ ุชุฌุงุฑุจ ุดุฎุตูุฉ ูุงุฌุญุฉ">ุนุฑุถ ุชุฌุงุฑุจ ุดุฎุตูุฉ ูุงุฌุญุฉ</option>
                                    <option value="ุงููุฆุฉ ุงูุซุงููุฉ - ุงูุงูุชุญุงู ุจุจุฑูุงูุฌ ุฃู ุฏูุฑุฉ">ุงูุงูุชุญุงู ุจุจุฑูุงูุฌ ุฃู ุฏูุฑุฉ</option>
                                </optgroup>
                                <optgroup label="๐ผ ููุงุฑุงุช ุงูุฃูุดุทุฉ ุงููุฏุฑุณูุฉ (4 ุฏุฑุฌุงุช ููู ูุดุงุฑูุฉ)">
                                    <option value="ููุงุฑุงุช ุงูุงุชุตุงู (ุนูู ุฌูุงุนูุ ุชุนูู ุจุงูุฃูุฑุงู)">ููุงุฑุงุช ุงูุงุชุตุงู (ุงูุนูู ุงูุฌูุงุนูุ ุงูุชุนูู ุจุงูุฃูุฑุงู)</option>
                                    <option value="ููุงุฑุงุช ุงูููุงุฏุฉ ูุงููุณุคูููุฉ">ููุงุฑุงุช ุงูููุงุฏุฉ ูุงููุณุคูููุฉ (ุงูุชุฎุทูุทุ ุงูุชุญููุฒ)</option>
                                    <option value="ุงูููุงุฑุงุช ุงูุฑูููุฉ (ุนุฑูุถุ ุชุตููู ูุญุชูู)">ุงูููุงุฑุงุช ุงูุฑูููุฉ (ุฅุนุฏุงุฏ ุงูุนุฑูุถุ ุชุตููู ุงููุญุชูู ุงูุฅููุชุฑููู)</option>
                                    <option value="ููุงุฑุฉ ุฅุฏุงุฑุฉ ุงูููุช">ููุงุฑุฉ ุฅุฏุงุฑุฉ ุงูููุช</option>
                                </optgroup>
                                <optgroup label="๐ ุงููุดุงุฑูุฉ ุงููุฏุฑุณูุฉ (ุฏุฑุฌุชุงู ููู ูุดุงุฑูุฉ)">
                                    <option value="ูุชุงุจุฉ ุฑุณุงูุฉ ุดูุฑ">ูุชุงุจุฉ ุฑุณุงูุฉ ุดูุฑ (ูููุทูุ ุงูููุงุฏุฉุ ุงูุฃุณุฑุฉุ ุงููุนูู)</option>
                                    <option value="ุงููุดุงุฑูุฉ ูู ุงูุฅุฐุงุนุฉ">ุงููุดุงุฑูุฉ ูู ุงูุฅุฐุงุนุฉ ุงููุฏุฑุณูุฉ</option>
                                    <option value="ุชูุฏูู ููุชุฑุญ ูุตุงูุญ ุงููุฌุชูุน ุงููุฏุฑุณู">ุชูุฏูู ููุชุฑุญ ูุตุงูุญ ุงููุฌุชูุน ุงููุฏุฑุณู</option>
                                    <option value="ุงูุชุนุงูู ูุน ุงูุฒููุงุก ูุงููุนูููู">ุงูุชุนุงูู ูุน ุงูุฒููุงุก ูุงููุนูููู ูุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</option>
                                </optgroup>
                                <optgroup label="โจ ุฃุฎุฑู">
                                    <option value="ุณููู ูุชููุฒ ุขุฎุฑ (ุจุชูุฏูุฑ ุงููุฌูุฉ)">ุณููู ูุชููุฒ ุขุฎุฑ (ุจุชูุฏูุฑ ูุฌูุฉ ุงูุชูุฌูู ุงูุทูุงุจู - ุญุชู 6 ุฏุฑุฌุงุช)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div id="points-display" class="alert alert-info" style="display:none; margin-bottom: 15px;">
                            <strong>๐ฏ ุงูููุงุท ุงูููุชุณุจุฉ:</strong> <span id="points-value" style="font-size: 1.3em; font-weight: bold;"></span> ุฏุฑุฌุฉ
                        </div>
                        <div id="custom-points-group" class="form-group" style="display:none;">
                            <label for="custom_points">ุญุฏุฏ ุนุฏุฏ ุงูููุงุท (ุจุชูุฏูุฑ ุงููุฌูุฉ - ุญุชู 6 ุฏุฑุฌุงุช) *</label>
                            <input type="number" id="custom_points" min="1" max="6" placeholder="ุฃุฏุฎู ุนุฏุฏ ุงูููุงุท">
                        </div>
                        <div class="alert alert-warning" style="margin-bottom: 15px;">
                            <strong>๐ ุชูุจูู ุงูุชูุซูู:</strong> ูุฌุจ ุฅุฑูุงู ูุง ูุซุจุช ูุดุงุฑูุฉ ุงูุทุงูุจ ูู ุฌูุงุช ูุนุชูุฏุฉ ุฏุงุฎู ุงููุฏุฑุณุฉ ุฃู ุฎุงุฑุฌูุง.
                        </div>
                        <div class="form-group">
                            <label for="pos_impact">ูุตู ุงูุญุฏุซ ูุฃุซุฑู (ุงูุชูุซูู) *</label>
                            <textarea id="pos_impact" rows="3" required placeholder="ูุซุงู: ุจุงุฏุฑ ุงูุทุงูุจ ุจุชูุธูู ุงูููุชุจุฉ ุจุนุฏ ุงููุณุญุฉุ ููุง ุณูู ุนูู ุฒููุงุฆู ุฅูุฌุงุฏ ุงููุชุจ."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pos_nominator">ูู ุฑุดูุญ ุงูุทุงูุจุ *</label>
                            <input type="text" id="pos_nominator" required placeholder="ุงุณู ุงููุนูู ุฃู ุงูููุธู">
                        </div>
                        <button type="submit" class="btn btn-success" id="positive-submit-btn">ุชูุซูู ุงูุณููู ุงูุฅูุฌุงุจู</button>
                    </form>
                </div>
                
                <!-- ุชูุจูู ุงูุฅุฌุฑุงุก ุงููุธุงูู -->
                <div class="card statutory-notice">
                    <h3 style="color: var(--neutral-color); margin-bottom: 10px;">โน๏ธ ููุงุญุธุฉ ุญูู ุงูุฅุฌุฑุงุกุงุช ุงููุธุงููุฉ</h3>
                    <div class="alert alert-neutral">
                        ุงูุฅุฌุฑุงุกุงุช ุงููุธุงููุฉ (ูุซู ุงุณุชุฏุนุงุก ููู ุงูุฃูุฑุ ุงูุชุนูุฏุงุชุ ุงูุนููุจุงุช ุงูุฑุณููุฉ) ุชูุทุจู ููู ูุงุฆุญุฉ ุงูุณููู ูุงูููุงุธุจุฉ ุงูุตุงุฏุฑุฉ ุนู ูุฒุงุฑุฉ ุงูุชุนูููุ ูุชุชู ุฎุงุฑุฌ ูุทุงู ูุฐู ุงูููุตุฉ ุงูุชุญููุฒูุฉ.
                    </div>
                </div>
            </section>

            <!-- 3. ุฑุตุฏ ูุฎุงููุฉ -->
            <section id="violation" class="section">
                <div class="card motivational">
                    <h2>โ๏ธ ุฑุตุฏ ูุฎุงููุฉ ุณููููุฉ (ุฅุฌุฑุงุก ุชุญููุฒู)</h2>
                    <div class="alert alert-info">
                        <strong>๐ ุทุจูุนุฉ ูุฐุง ุงูุฅุฌุฑุงุก:</strong> ูุฐุง ุฅุฌุฑุงุก ุชูุซููู ุฏุงุฎูู ูุฃุบุฑุงุถ ุงููุชุงุจุนุฉ ูุงูุชุญุณูู. ูุง ููุนุฏ ุฅุฌุฑุงุกู ูุธุงูููุง ุฑุณูููุง ูุง ูู ูุชุทูุจ ุงูุฃูุฑ ุฐูู ููู ุงููุงุฆุญุฉ.
                    </div>
                    <div class="success-message" id="violation-success"></div>
                    <form id="violationForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vio_student_name">ุงุณู ุงูุทุงูุจ *</label>
                                <input type="text" id="vio_student_name" required placeholder="ุงูุงุณู ุงูุซูุงุซู ููุทุงูุจ">
                            </div>
                            <div class="form-group">
                                <label for="vio_grade">ุงูุตู *</label>
                                <select id="vio_grade" required>
                                    <option value="" disabled selected>ุงุฎุชุฑ ุงูุตู</option>
                                    <option value="ุฃูู ูุชูุณุท">ุฃูู ูุชูุณุท</option>
                                    <option value="ุซุงูู ูุชูุณุท">ุซุงูู ูุชูุณุท</option>
                                    <option value="ุซุงูุซ ูุชูุณุท">ุซุงูุซ ูุชูุณุท</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vio_type">ููุน ุงููุฎุงููุฉ (ุงูุงุณุชุซูุงุก) *</label>
                            <select id="vio_type" required>
                                <option value="" disabled selected>ุงุฎุชุฑ ููุน ุงููุฎุงููุฉ</option>
                                <option value="ุชุฃุฎุฑ ุตุจุงุญู">ุชุฃุฎุฑ ุตุจุงุญู</option>
                                <option value="ูุฎุงููุฉ ุฒู ูุฏุฑุณู">ูุฎุงููุฉ ุฒู ูุฏุฑุณู</option>
                                <option value="ุฅุฎูุงู ุจูุธุงู ุงูุญุตุฉ">ุฅุฎูุงู ุจูุธุงู ุงูุญุตุฉ</option>
                                <option value="ุฅููุงู ุงููุงุฌุจุงุช">ุฅููุงู ุงููุงุฌุจุงุช ุงููุฏุฑุณูุฉ</option>
                                <option value="ุฃุฎุฑู">ุฃุฎุฑู (ุชุชุทูุจ ุชูุถูุญ)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger" id="violation-submit-btn">ุชุณุฌูู ุงููุฎุงููุฉ</button>
                    </form>
                </div>
                
                <!-- ุชูุจูู ุงูุฅุฌุฑุงุก ุงููุธุงูู -->
                <div class="card statutory-notice">
                    <h3 style="color: var(--neutral-color); margin-bottom: 10px;">โน๏ธ ููุงุญุธุฉ ุญูู ุงูุฅุฌุฑุงุกุงุช ุงููุธุงููุฉ</h3>
                    <div class="alert alert-neutral">
                        ุงูุฅุฌุฑุงุกุงุช ุงููุธุงููุฉ (ูุซู ุงุณุชุฏุนุงุก ููู ุงูุฃูุฑุ ุงูุชุนูุฏุงุชุ ุงูุนููุจุงุช ุงูุฑุณููุฉ) ุชูุทุจู ููู ูุงุฆุญุฉ ุงูุณููู ูุงูููุงุธุจุฉ ุงูุตุงุฏุฑุฉ ุนู ูุฒุงุฑุฉ ุงูุชุนูููุ ูุชุชู ุฎุงุฑุฌ ูุทุงู ูุฐู ุงูููุตุฉ ุงูุชุญููุฒูุฉ.
                    </div>
                </div>
            </section>

            <!-- 4. ุชูุงุฑูุฑ ุงูุฃุฏุงุก -->
            <section id="reports" class="section">
                <div class="card" id="printable-area">
                    <h2>ุชูุงุฑูุฑ ุงูุฃุฏุงุก ุงูุดูุฑู (ูุณุงุนุฏ ุฑุตุฏ ุฏุฑุฌุงุช ูุธุงู ููุฑ)</h2>
                    <div class="report-controls">
                        <label for="month-selector">ุงุฎุชุฑ ุงูุดูุฑ ูุนุฑุถ ุงูุชูุฑูุฑ:</label>
                        <select id="month-selector"></select>
                        <button class="btn btn-print" onclick="window.print()">ุทุจุงุนุฉ ุงูุชูุฑูุฑ</button>
                        <button class="btn btn-danger" id="delete-all-btn">ุญุฐู ุฌููุน ุงูุณุฌูุงุช</button>
                    </div>

                    <!-- ุตูุฏูู ุดุฑุญ ุขููุฉ ุงูุงุญุชุณุงุจ -->
                    <div class="formula-box">
                        <h3>๐ ููููุฉ ุงุญุชุณุงุจ ุฏุฑุฌุฉ ุงูุณููู ุงูููุชุฑุญุฉ ููุธุงู ููุฑ</h3>
                        <p><strong>ุชูุจูู ููู:</strong> ุงูุฏุฑุฌุงุช ุงููุนุฑูุถุฉ ููุง ูู <u>ุงูุชุฑุงุญุงุช</u> ููุณุงุนุฏุฉ ูููู ุดุคูู ุงูุทูุงุจ ูู ุชูููู ุฃุฏุงุก ุงูุทูุงุจ. ูุง ูุชู ุชุนุฏูู ุฏุฑุฌุงุช ููุฑ ุชููุงุฆููุง ูู ูุฐู ุงูููุตุฉ.</p>
                        
                        <div class="formula">
                            ูุคุดุฑ ุงูุชููุฒ = (ููุงุท ุงูุณููู ุงูุฅูุฌุงุจู ร 2) + ุนุฏุฏ ุงูุงุณุชุฑุฏุงุฏุงุช - ุงููุฎุงููุงุช ุบูุฑ ุงููุณุชุฑุฏุฉ
                        </div>

                        <ul>
                            <li><strong>ุงูุณููู ุงูุฅูุฌุงุจู:</strong> ูู ุณููู ุฅูุฌุงุจู ูููุฒ ูููุญ ููุงุทูุง (2-6 ููุงุท ุญุณุจ ุงูุชุตููู)</li>
                            <li><strong>ุงููุฎุงููุงุช:</strong> ุชูุฎุตู ููุงุท ุนูุฏ ุฑุตุฏ ุงููุฎุงููุฉ</li>
                            <li><strong>ุงูุงุณุชุฑุฏุงุฏ:</strong> ุฅุฐุง ูู ููุฑุฑ ุงูุทุงูุจ ููุณ ุงููุฎุงููุฉ ููุฏุฉ ุฃุณุจูุนุ ุชูุณุชุฑุฏ ุงูุฏุฑุฌุฉ ุชููุงุฆููุง</li>
                            <li><strong>ูุคุดุฑ ุงูุชููุฒ:</strong> ููุญุณุจ ูุชุฑุชูุจ ุงูุทูุงุจ ูุชุญุฏูุฏ ุงูุฏุฑุฌุฉ ุงูููุชุฑุญุฉ</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>ุงูุทุงูุจ ุงูููุชุฒู (ุจุฏูู ุณุฌูุงุช):</strong> ูุญุตู ุนูู ุฏุฑุฌุฉ ุงูุชุฑุงุถูุฉ (15 ูู 20) ูุฃู ุบูุงุจ ุงูุณุฌู ูุนูู ุงูุชุฒุงููุง ุชุงููุง ุจุงูุณููู ุงููุชููุน. ุงูุฏุฑุฌุงุช ุงูุฃุนูู (16-20) ุชูููุญ ูููุชููุฒูู ุจูุจุงุฏุฑุงุช ุฅูุฌุงุจูุฉ ููุซูุฉ.</p>
                    </div>

                    <table id="reports-table">
                        <thead>
                            <tr>
                                <th>ุงูุชุฑุชูุจ</th>
                                <th>ุงุณู ุงูุทุงูุจ</th>
                                <th>ุงูุตู</th>
                                <th>ูุคุดุฑ ุงูุชููุฒ</th>
                                <th>ุชูุงุตูู ุงููุคุดุฑ</th>
                                <th>ุฏุฑุฌุฉ ููุฑ ุงูููุชุฑุญุฉ (ูู 20)</th>
                            </tr>
                        </thead>
                        <tbody id="reports-tbody"></tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 15px;">
                                    <em>ููุงุญุธุฉ: ุงูุทูุงุจ ุบูุฑ ุงููุฏุฑุฌูู ูู ูุฐุง ุงูุชูุฑูุฑ ููุนุชุจุฑูู ููุชุฒููู ุงูุชุฑุงุถููุง ููุญุตููู ุนูู ุงูุฏุฑุฌุฉ ุงููุงููุฉ ููุงูุชุฒุงู (15 ูู 20)</em>
                                </td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- ุชูููุน ุงููุนุชูุฏ -->
                    <div class="approver-signature">
                        <p><strong>ูุนุชูุฏ ุงูุชูุฑูุฑ:</strong> <span id="report-approver-name">ุงูุฃุณุชุงุฐ ููุงู ุงูุตุจุญู</span></p>
                        <p><strong>ุงูุฏูุฑ:</strong> ูููู ุดุคูู ุงูุทูุงุจ</p>
                        <p><strong>ุชุงุฑูุฎ ุงูุงุนุชูุงุฏ:</strong> <span id="approval-date"></span></p>
                    </div>
                </div>
            </section>

            <!-- 5. ุงูุญูููุฉ ูุงูุดูุงููุฉ -->
            <section id="governance" class="section">
                <div class="card">
                    <h2>ููุณูุฉ ูุญูููุฉ ูุธุงู ุงูุณููู ุงูุทูุงุจู</h2>
                    <div class="alert alert-info">
                        <strong>ูููุดุฑู ุงูุชุฑุจูู ูููู ุงูุฃูุฑ:</strong> ูุฐู ุงูุตูุญุฉ ุชูุถุญ ุงููุจุงุฏุฆ ุงูุชู ูููู ุนูููุง ุงููุธุงู ูุถูุงู ุงูุนุฏุงูุฉ ูุงูุดูุงููุฉ ูุชูููู ุงูุนุจุก ุงูุฅุฏุงุฑู.
                    </div>

                    <h3>1. ููุณูุฉ ุงููุธุงู: ุฑุตุฏ ุงูุงุณุชุซูุงุกุงุช</h3>
                    <p>ูููู ุงููุธุงู ุนูู ูุจุฏุฃ "ุงูุซูุฉ ูุงูุงูุชุฒุงู ุงูุงูุชุฑุงุถู". ูุญู ููุชุฑุถ ุฃู ุฌููุน ุทูุงุจูุง ููุชุฒููู ูููุถุจุทููุ ููุฐุง ูู ุงูุฃุตู. ูุฐููุ ูุง ูุชู ุฅุฏุฎุงู ุฃุณูุงุก ุฌููุน ุงูุทูุงุจ ูููููุงุ ุจู ูุชู ุฑุตุฏ ูุชูุซูู "ุงูุงุณุชุซูุงุกุงุช" ููุทุ ุณูุงุก ูุงูุช ูุฎุงููุงุช ุณููููุฉ ุฃู ุณููููุงุช ุฅูุฌุงุจูุฉ ูููุฒุฉ.</p>
                    <ul>
                        <li><strong>ููุงุฐุง ูุง ูุชู ุฅุฏุฎุงู ุฌููุน ุงูุฃุณูุงุกุ</strong> ูุชูููู ุงูุนุจุก ุงูุฅุฏุงุฑูุ ูุชุฑููุฒ ุฌููุฏ ูููู ุดุคูู ุงูุทูุงุจ ุนูู ุงููุชุงุจุนุฉ ุงูุชุฑุจููุฉ ููุญุงูุงุช ุงูุชู ุชุชุทูุจ ุฐููุ ุจุฏูุงู ูู ุฅุถุงุนุฉ ุงูููุช ูู ุฅุฏุฎุงู ุจูุงูุงุช ุฑูุชูููุฉ.</li>
                        <li><strong>ุงูุทุงูุจ ุบูุฑ ุงููุณุฌู:</strong> ุฃู ุทุงูุจ ูุง ููุฌุฏ ูู ุณุฌู ูุฎุงููุฉ ูู ุงููุธุงูุ ูุนุชุจุฑ ุชููุงุฆููุง ุญุงุตูุงู ุนูู ุงูุฏุฑุฌุฉ ุงููุงููุฉ ูู ุจููุฏ ุงูุงูุชุฒุงู ูุงูุงูุถุจุงุท.</li>
                    </ul>

                    <h3>2. ุขููุฉ ุงุญุชุณุงุจ ุงูุฏุฑุฌุงุช</h3>
                    <p>ุงูุฏุฑุฌุงุช ูู ุฃุฏุงุฉ ุชุญููุฒูุฉ ูููุณุช ุนูุงุจูุฉ. ูุชู ููุญูุง ุฃู ุฎุตููุง ุจูุงุกู ุนูู ุฃุญุฏุงุซ ููุซูุฉ.</p>
                    <ul>
                        <li><strong>ุงูุงูุชุฒุงู ูุงูุงูุถุจุงุท:</strong> ุฏุฑุฌุฉ ูุงููุฉ ููุฌููุน ุงูุชุฑุงุถููุง. ููุฎุตู ูููุง ููุท ุนูุฏ ุชุณุฌูู ูุฎุงููุฉ (ูุซู ุชุฃุฎุฑ ุฃู ูุฎุงููุฉ ุฒู).</li>
                        <li><strong>ุงูุณููู ุงูุฅูุฌุงุจู ุงููููุฒ (ุงูุญุฏุซู):</strong> ูู ุฏุฑุฌุงุช ุฅุถุงููุฉ ุชูููุญ ููุฃุนูุงู ุงูุงุณุชุซูุงุฆูุฉ ูุงููุจุงุฏุฑุงุช ุงูุชู ุชุชุฌุงูุฒ ุงูุณููู ุงููููู ุงููุชููุน. ููุง ุณูู ุฃุนูู (10 ุฏุฑุฌุงุช ุดูุฑููุง) ูููุน ุงูุชุถุฎูุ ูุชุชุทูุจ ุชูุซูููุง ูุงุถุญูุง ููุญุฏุซ ูุฃุซุฑู.</li>
                    </ul>

                    <h3>3. ุขููุฉ ุงุณุชุฑุฏุงุฏ ุงูุฏุฑุฌุงุช (ุงูุชุนููุถ ุงูุฃุณุจูุนู)</h3>
                    <p>ุฅููุงููุง ุจุงูุฌุงูุจ ุงูุฅุตูุงุญูุ ูููู ููุทุงูุจ ุงุณุชุฑุฏุงุฏ ุฏุฑุฌุฉ ุงููุฎุงููุฉ. ุขููุฉ ุงูุงุณุชุฑุฏุงุฏ ุชุฌูุจ ุนูู ุณุคุงู "ูู ุชุญุณู ุณููู ุงูุทุงูุจุ".</p>
                    <ul>
                        <li>ุนูุฏ ุชุณุฌูู ูุฎุงููุฉุ ูุชู ุฎุตู ุงูุฏุฑุฌุฉ ูุชุตุจุญ ุญุงูุชูุง <strong>"ูุฎุตููุฉ"</strong>.</li>
                        <li>ุฅุฐุง ูุฑ ุฃุณุจูุน ูุงูู ุฏูู ุฃู ููุฑุฑ ุงูุทุงูุจ ููุณ ุงููุฎุงููุฉุ ูุชู ุงุณุชุฑุฏุงุฏ ุงูุฏุฑุฌุฉ ุชููุงุฆููุง ูุชุตุจุญ ุญุงูุชูุง <strong>"ูุณุชุฑุฏุฉ"</strong>.</li>
                        <li>ูุฐุง ุงูููุทู ูุทุจู ุชููุงุฆููุง ุนุจุฑ ุงููุธุงูุ ููุง ูุนุฒุฒ ูุฑุตุฉ ุงูุทุงูุจ ููุชุญุณู ุฏูู ุงูุญุงุฌุฉ ูุฅุฌุฑุงุก ุฅุฏุงุฑู ุฅุถุงูู.</li>
                    </ul>

                    <h3>4. ุงููุฑู ุจูู ุงูุฅุฌุฑุงุก ุงููุธุงูู ูุงูุชุญููุฒู</h3>
                    <ul>
                        <li><strong>ุงูุฅุฌุฑุงุก ุงูุชุญููุฒู (ูุฐุง ุงููุธุงู):</strong> ูู ูุธุงู ุฏุฑุฌุงุช ุฏุงุฎูู ููุฏู ููุชุดุฌูุน ูุงูุฅุตูุงุญ. ูุชุงุฆุฌู ุชุธูุฑ ูู ุดูู ุดูุงุฏุงุช ุดูุฑุ ุชูุฑููุ ูุฃููููุฉ ูู ุงูุฃูุดุทุฉ.</li>
                        <li><strong>ุงูุฅุฌุฑุงุก ุงููุธุงูู (ูุงุฆุญุฉ ุงููุฒุงุฑุฉ):</strong> ูู ุงูุฅุฌุฑุงุกุงุช ุงูุฑุณููุฉ ุงููุชุจุนุฉ ูู ุงููุฎุงููุงุช ุงูุฌุณููุฉ (ูุซู ุงุณุชุฏุนุงุก ููู ุงูุฃูุฑุ ุงูุชุนูุฏุ ...ุฅูุฎ) ูุชูุทุจู ุจุดูู ูุณุชูู ุนู ูุฐุง ุงููุธุงู ุงูุชุญููุฒู.</li>
                    </ul>

                    <h3>5. ุขููุฉ ุงูุงุนุชูุงุฏ ูุงูุดูุงููุฉ</h3>
                    <p>ูุถูุงู ุงูููุซูููุฉ ุฃูุงู ุงูุฅุดุฑุงู ุงููุฏุฑุณู ูุฃูููุงุก ุงูุฃููุฑุ ูู ุนูููุฉ ุฑุตุฏ ูู ุงููุธุงู ุชุฌูุจ ุนูู ุงูุฃุณุฆูุฉ ุงูุชุงููุฉ:</p>
                    <ul>
                        <li><strong>ูุงุฐุง ุญุฏุซุ</strong> (ููุน ุงููุฎุงููุฉ ุฃู ุงูุณููู ุงูุฅูุฌุงุจู)</li>
                        <li><strong>ูุชู ุญุฏุซุ</strong> (ุชุงุฑูุฎ ูููุช ุงูุชุณุฌูู)</li>
                        <li><strong>ูู ุงูุทุงูุจุ</strong> (ุงูุงุณู ูุงูุตู)</li>
                        <li><strong>ุนูู ุฃู ุฃุณุงุณ ุชู ุงูุชุณุฌููุ</strong> (ุชูุซูู ุงูุญุฏุซ ูุฃุซุฑูุ ููู ุฑุดุญ ุงูุทุงูุจ)</li>
                        <li><strong>ูู ุงุนุชูุฏ ุงูุชุณุฌููุ</strong> (ุงุณู ุงูููุธู ุงููุณุคููุ ููู ูููู ุดุคูู ุงูุทูุงุจ)</li>
                    </ul>

                    <h3>6. ุชูุซูู ูููุฉ ุงููุณุฌูู (Audit Trail)</h3>
                    <p>ุฌููุน ุงูุณุฌูุงุช ูู ุงููุธุงู ุชูุนุชูุฏ ุชููุงุฆููุง ูู ูุจู:</p>
                    <ul>
                        <li><strong>ุงูุฏูุฑ:</strong> ูููู ุดุคูู ุงูุทูุงุจ</li>
                        <li><strong>ุงูุงุณู:</strong> <span id="governance-approver-name">ุงูุฃุณุชุงุฐ ููุงู ุงูุตุจุญู</span></li>
                        <li><strong>ุงูุทุงุจุน ุงูุฒููู:</strong> ูุชู ุญูุธ ุชุงุฑูุฎ ูููุช ูู ุนูููุฉ ุชุณุฌูู ุชููุงุฆููุง</li>
                    </ul>
                    <p>ุชู ุชุตููู ุงููุธุงู ููููู ูุงุจูุงู ููุชูุณุน ูุณุชูุจูุงู ูุฅุถุงูุฉ ุชุณุฌูู ุฏุฎูู ูุชุนุฏุฏ ุงููุณุชุฎุฏููู ุฏูู ุงูุญุงุฌุฉ ูุฅุนุงุฏุฉ ููููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช.</p>
                </div>
            </section>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB7mn5gg8LDOwnYsqmxd2UwdiDWNRPuoAQ",
            authDomain: "top10-a6e0e.firebaseapp.com",
            projectId: "top10-a6e0e",
            storageBucket: "top10-a6e0e.firebasestorage.app",
            messagingSenderId: "985038639156",
            appId: "1:985038639156:web:af5c4031f50ddfc85b3a61",
            measurementId: "G-LXG3X6WXEE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู (ูุงุจูุฉ ููุชุนุฏูู ูุณุชูุจูุงู ูู ูุงุฌูุฉ ุงูุฅุนุฏุงุฏุงุช)
        const CURRENT_USER = {
            role: 'ูููู ุดุคูู ุงูุทูุงุจ',
            name: 'ุงูุฃุณุชุงุฐ ููุงู ุงูุตุจุญู',
            id: 'user_001' // ููุฌุงูุฒูุฉ ุงููุณุชูุจููุฉ
        };

        const POSITIVE_BEHAVIOR_POINTS = { 
            'ุงููุฆุฉ ุงูุฃููู - ุงูุถุจุงุท ูุนุฏู ุบูุงุจ': 6,
            'ุงููุฆุฉ ุงูุซุงููุฉ - ุฎุฏูุฉ ูุฌุชูุนูุฉ ุฎุงุฑุฌ ุงููุฏุฑุณุฉ': 6,
            'ุงููุฆุฉ ุงูุซุงููุฉ - ูุนุงููุฉ ุญูุงุฑูุฉ': 6,
            'ุงููุฆุฉ ุงูุซุงููุฉ - ุญููุฉ ุชูุนููุฉ': 6,
            'ุงููุฆุฉ ุงูุซุงููุฉ - ุนุฑุถ ุชุฌุงุฑุจ ุดุฎุตูุฉ ูุงุฌุญุฉ': 6,
            'ุงููุฆุฉ ุงูุซุงููุฉ - ุงูุงูุชุญุงู ุจุจุฑูุงูุฌ ุฃู ุฏูุฑุฉ': 6,
            'ููุงุฑุงุช ุงูุงุชุตุงู (ุนูู ุฌูุงุนูุ ุชุนูู ุจุงูุฃูุฑุงู)': 4,
            'ููุงุฑุงุช ุงูููุงุฏุฉ ูุงููุณุคูููุฉ': 4,
            'ุงูููุงุฑุงุช ุงูุฑูููุฉ (ุนุฑูุถุ ุชุตููู ูุญุชูู)': 4,
            'ููุงุฑุฉ ุฅุฏุงุฑุฉ ุงูููุช': 4,
            'ูุชุงุจุฉ ุฑุณุงูุฉ ุดูุฑ': 2,
            'ุงููุดุงุฑูุฉ ูู ุงูุฅุฐุงุนุฉ': 2,
            'ุชูุฏูู ููุชุฑุญ ูุตุงูุญ ุงููุฌุชูุน ุงููุฏุฑุณู': 2,
            'ุงูุชุนุงูู ูุน ุงูุฒููุงุก ูุงููุนูููู': 2,
            'ุณููู ูุชููุฒ ุขุฎุฑ (ุจุชูุฏูุฑ ุงููุฌูุฉ)': 0
        };
        const VIOLATION_POINTS = { 
            'ุชุฃุฎุฑ ุตุจุงุญู': -2, 
            'ูุฎุงููุฉ ุฒู ูุฏุฑุณู': -1, 
            'ุฅุฎูุงู ุจูุธุงู ุงูุญุตุฉ': -3, 
            'ุฅููุงู ุงููุงุฌุจุงุช': -1, 
            'ุฃุฎุฑู': -2 
        };
        const RECOVERY_PERIOD_DAYS = 7;

        const sections = document.querySelectorAll('.section');
        const navButtons = document.querySelectorAll('.nav button');
        const dashboardGrid = document.getElementById('dashboard-grid');
        const violationForm = document.getElementById('violationForm');
        const positiveForm = document.getElementById('positiveForm');
        const monthSelector = document.getElementById('month-selector');
        const reportsTbody = document.getElementById('reports-tbody');
        const loadingAlert = document.getElementById('loading-alert');

        let allRecords = [];

        // ุชุญุฏูุซ ุงุณู ุงููุนุชูุฏ ูู ุฌููุน ุฃูุญุงุก ุงูุตูุญุฉ
        function updateApproverName() {
            document.getElementById('display-approver-name').textContent = CURRENT_USER.name;
            document.getElementById('report-approver-name').textContent = CURRENT_USER.name;
            document.getElementById('governance-approver-name').textContent = CURRENT_USER.name;
            document.getElementById('approval-date').textContent = new Date().toLocaleDateString('ar-SA');
        }

        async function loadDataFromFirebase() {
            try {
                loadingAlert.style.display = 'block';
                const q = query(collection(db, 'behavior_records'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                allRecords = [];
                querySnapshot.forEach((doc) => {
                    allRecords.push({ id: doc.id, ...doc.data() });
                });
                
                loadingAlert.style.display = 'none';
                return allRecords;
            } catch (error) {
                console.error("ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช:", error);
                loadingAlert.style.display = 'none';
                alert('ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช ูู Firebase. ุชุฃูุฏ ูู ุฅูุดุงุก ูุงุนุฏุฉ Firestore ูู Firebase Console.');
                return [];
            }
        }

        async function saveToFirebase(record) {
            try {
                // ุฅุถุงูุฉ ูุนูููุงุช ุงููุนุชูุฏ ุชููุงุฆูุงู (Audit Trail)
                const recordWithAudit = {
                    ...record,
                    approvedBy: {
                        userId: CURRENT_USER.id,
                        name: CURRENT_USER.name,
                        role: CURRENT_USER.role
                    },
                    createdAt: new Date().toISOString()
                };

                const docRef = await addDoc(collection(db, 'behavior_records'), recordWithAudit);
                console.log("ุชู ุญูุธ ุงูุณุฌู ุจูุฌุงุญ:", docRef.id);
                return true;
            } catch (error) {
                console.error("ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช:", error);
                alert('ุญุฏุซ ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช: ' + error.message);
                return false;
            }
        }

        async function deleteAllRecords() {
            if (!confirm('โ๏ธ ุชุญุฐูุฑ: ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุณุฌูุงุชุ ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!')) {
                return;
            }
            
            if (!confirm('โ๏ธ ุชุฃููุฏ ููุงุฆู: ุณูุชู ุญุฐู ุฌููุน ุงููุฎุงููุงุช ูุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ ููุงุฆููุง. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ')) {
                return;
            }

            try {
                const deleteBtn = document.getElementById('delete-all-btn');
                deleteBtn.disabled = true;
                deleteBtn.innerHTML = '<span class="loading"></span> ุฌุงุฑู ุงูุญุฐู...';
                
                const querySnapshot = await getDocs(collection(db, 'behavior_records'));
                
                let deleteCount = 0;
                const deletePromises = [];
                
                querySnapshot.forEach((document) => {
                    deletePromises.push(deleteDoc(doc(db, 'behavior_records', document.id)));
                    deleteCount++;
                });
                
                await Promise.all(deletePromises);
                
                allRecords = [];
                updateDashboard();
                generateReport();
                
                alert(`โ ุชู ุญุฐู ${deleteCount} ุณุฌู ุจูุฌุงุญ`);
                
                deleteBtn.disabled = false;
                deleteBtn.textContent = 'ุญุฐู ุฌููุน ุงูุณุฌูุงุช';
            } catch (error) {
                console.error("ุฎุทุฃ ูู ุญุฐู ุงูุจูุงูุงุช:", error);
                alert('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงูุจูุงูุงุช: ' + error.message);
                
                const deleteBtn = document.getElementById('delete-all-btn');
                deleteBtn.disabled = false;
                deleteBtn.textContent = 'ุญุฐู ุฌููุน ุงูุณุฌูุงุช';
            }
        }

        function setupRealtimeListener() {
            const q = query(collection(db, 'behavior_records'), orderBy('timestamp', 'desc'));
            onSnapshot(q, (snapshot) => {
                allRecords = [];
                snapshot.forEach((doc) => {
                    allRecords.push({ id: doc.id, ...doc.data() });
                });
                updateDashboard();
            }, (error) => {
                console.error("ุฎุทุฃ ูู ุงูุงุณุชูุงุน ููุชุญุฏูุซุงุช:", error);
            });
        }

        function showSection(sectionId) {
            sections.forEach(section => section.classList.remove('active'));
            navButtons.forEach(btn => btn.classList.remove('active'));
            
            const el = document.getElementById(sectionId);
            if (el) el.classList.add('active');
            
            const btnEl = document.querySelector(`.nav button[onclick="showSection('${sectionId}')"]`);
            if (btnEl) btnEl.classList.add('active');

            if (sectionId === 'dashboard') updateDashboard();
            if (sectionId === 'reports') generateReport();
        }
        window.showSection = showSection;

        function processRecoveries() {
            const now = Date.now();
            const recoveryMillis = RECOVERY_PERIOD_DAYS * 24 * 60 * 60 * 1000;

            allRecords.forEach(record => {
                if (record.type === 'violation' && record.status === 'makhsouma') {
                    if (now - record.timestamp > recoveryMillis) {
                        const hasRepeated = allRecords.some(r => 
                            r.type === 'violation' &&
                            r.studentName === record.studentName &&
                            r.violationType === record.violationType &&
                            r.timestamp > record.timestamp &&
                            r.timestamp <= now
                        );
                        if (!hasRepeated) {
                            record.status = 'mustaradda';
                        }
                    }
                }
            });
            return allRecords;
        }

        function updateDashboard() {
            const data = processRecoveries();
            const now = new Date();
            const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
            startOfWeek.setHours(0, 0, 0, 0);

            const weeklyData = data.filter(r => r.timestamp >= startOfWeek.getTime());
            const weeklyViolations = weeklyData.filter(r => r.type === 'violation');
            const weeklyPositives = weeklyData.filter(r => r.type === 'positive');
            const weeklyRecoveries = data.filter(r => r.status === 'mustaradda' && new Date(r.timestamp) >= startOfWeek).length;

            const violationTypes = {};
            weeklyViolations.forEach(v => { 
                violationTypes[v.violationType] = (violationTypes[v.violationType] || 0) + 1; 
            });
            const mostCommonViolation = Object.keys(violationTypes).length > 0 ? 
                Object.keys(violationTypes).reduce((a, b) => violationTypes[a] > violationTypes[b] ? a : b) : 'ูุง ููุฌุฏ';

            const positiveCategories = {};
            weeklyPositives.forEach(p => { 
                positiveCategories[p.category] = (positiveCategories[p.category] || 0) + 1; 
            });
            const mostCommonPositive = Object.keys(positiveCategories).length > 0 ? 
                Object.keys(positiveCategories).reduce((a, b) => positiveCategories[a] > positiveCategories[b] ? a : b) : 'ูุง ููุฌุฏ';

            dashboardGrid.innerHTML = `
                <div class="stat-card violations">
                    <div class="value">${weeklyViolations.length}</div>
                    <div class="label">ูุฎุงููุฉ ูุณุฌูุฉ ูุฐุง ุงูุฃุณุจูุน</div>
                </div>
                <div class="stat-card positives">
                    <div class="value">${weeklyPositives.length}</div>
                    <div class="label">ุณููู ุฅูุฌุงุจู ูููุฒ ูุฐุง ุงูุฃุณุจูุน</div>
                </div>
                <div class="stat-card recoveries">
                    <div class="value">${weeklyRecoveries}</div>
                    <div class="label">ุญุงูุฉ ุงุณุชุฑุฏุงุฏ ุฏุฑุฌุงุช ูุฐุง ุงูุฃุณุจูุน</div>
                </div>
                <div class="stat-card commitment">
                    <div class="value">${mostCommonViolation}</div>
                    <div class="label">ุฃูุซุฑ ุงููุฎุงููุงุช ุชูุฑุงุฑูุง</div>
                </div>
                <div class="stat-card commitment" style="border-color: var(--success-color);">
                    <div class="value" style="color: var(--success-color);">${mostCommonPositive}</div>
                    <div class="label">ุฃูุซุฑ ุงูุณููููุงุช ุงูุฅูุฌุงุจูุฉ ุธููุฑูุง</div>
                </div>
            `;
        }

        function populateMonthSelector() {
            const months = new Set();
            allRecords.forEach(r => {
                const date = new Date(r.timestamp);
                months.add(`${date.getFullYear()}-${date.getMonth()}`);
            });

            monthSelector.innerHTML = '';
            const monthNames = ["ููุงูุฑ", "ูุจุฑุงูุฑ", "ูุงุฑุณ", "ุฃุจุฑูู", "ูุงูู", "ููููู", "ููููู", "ุฃุบุณุทุณ", "ุณุจุชูุจุฑ", "ุฃูุชูุจุฑ", "ููููุจุฑ", "ุฏูุณูุจุฑ"];
            
            if (months.size === 0) {
                const now = new Date();
                months.add(`${now.getFullYear()}-${now.getMonth()}`);
            }

            Array.from(months).sort().reverse().forEach(monthKey => {
                const [year, month] = monthKey.split('-');
                const option = document.createElement('option');
                option.value = monthKey;
                option.textContent = `${monthNames[parseInt(month)]} ${year}`;
                monthSelector.appendChild(option);
            });
        }

        function generateReport() {
            populateMonthSelector();
            const selectedMonthKey = monthSelector.value;
            if (!selectedMonthKey) {
                reportsTbody.innerHTML = `<tr><td colspan="6" style="text-align:center;">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง.</td></tr>`;
                return;
            }

            const [year, month] = selectedMonthKey.split('-').map(Number);
            const data = processRecoveries();
            const monthlyData = data.filter(r => {
                const date = new Date(r.timestamp);
                return date.getFullYear() === year && date.getMonth() === month;
            });

            const studentScores = {};
            monthlyData.forEach(r => {
                if (!studentScores[r.studentName]) {
                    studentScores[r.studentName] = { 
                        name: r.studentName, 
                        grade: r.grade, 
                        positivePoints: 0, 
                        violationCount: 0, 
                        recoveredCount: 0 
                    };
                }
                const student = studentScores[r.studentName];
                if (r.type === 'positive') {
                    student.positivePoints += r.points;
                } else if (r.type === 'violation') {
                    student.violationCount++;
                    if (r.status === 'mustaradda') student.recoveredCount++;
                }
            });

            const rankedStudents = Object.values(studentScores).map(student => {
                const unrecoveredViolations = student.violationCount - student.recoveredCount;
                student.excellenceIndex = (student.positivePoints * 2) + student.recoveredCount - unrecoveredViolations;
                return student;
            }).sort((a, b) => b.excellenceIndex - a.excellenceIndex);

            renderReportTable(rankedStudents);
            updateApproverName();
        }

        function renderReportTable(rankedStudents) {
            if (rankedStudents.length === 0) {
                reportsTbody.innerHTML = `<tr><td colspan="6" style="text-align:center;">ูุง ุชูุฌุฏ ุณุฌูุงุช ููุฐุง ุงูุดูุฑ. ุฌููุน ุงูุทูุงุจ ููุชุฒููู ุงูุชุฑุงุถููุง.</td></tr>`;
                return;
            }
            reportsTbody.innerHTML = rankedStudents.map((student, index) => {
                const unrecoveredViolations = student.violationCount - student.recoveredCount;
                const details = `<span class="points-positive">+${student.positivePoints} ุฅูุฌุงุจู</span>, <span class="no-records">${student.recoveredCount} ุงุณุชุฑุฏุงุฏ</span>, <span class="points-negative">${unrecoveredViolations} ูุฎุงููุงุช</span>`;
                
                let noorGrade = 15;
                if (student.excellenceIndex > 10) noorGrade = 20;
                else if (student.excellenceIndex > 5) noorGrade = 18;
                else if (student.excellenceIndex > 0) noorGrade = 16;
                else if (student.excellenceIndex <= 0 && student.violationCount === 0) noorGrade = 15;
                else noorGrade = 10;

                return `<tr>
                    <td>${index + 1}</td>
                    <td><strong>${student.name}</strong></td>
                    <td>${student.grade}</td>
                    <td>${student.excellenceIndex}</td>
                    <td>${details}</td>
                    <td><strong>${noorGrade}</strong></td>
                </tr>`;
            }).join('');
        }

        violationForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('violation-submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> ุฌุงุฑู ุงูุญูุธ...';
            
            const newViolation = {
                type: 'violation',
                studentName: document.getElementById('vio_student_name').value.trim(),
                grade: document.getElementById('vio_grade').value,
                violationType: document.getElementById('vio_type').value,
                points: VIOLATION_POINTS[document.getElementById('vio_type').value] || -2,
                timestamp: Date.now(),
                status: 'makhsouma'
            };
            
            const success = await saveToFirebase(newViolation);
            
            if (success) {
                const successMsg = document.getElementById('violation-success');
                successMsg.textContent = `โ ุชู ุชุณุฌูู ุงููุฎุงููุฉ ููุทุงูุจ: ${newViolation.studentName} ุจูุฌุงุญ | ุงููุนุชูุฏ: ${CURRENT_USER.name}`;
                successMsg.style.display = 'block';
                
                violationForm.reset();
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 5000);
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'ุชุณุฌูู ุงููุฎุงููุฉ';
        });

        positiveForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('positive-submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> ุฌุงุฑู ุงูุญูุธ...';
            
            const category = document.getElementById('pos_category').value;
            let points = POSITIVE_BEHAVIOR_POINTS[category];
            
            // ุฅุฐุง ูุงู ุงูุณููู ูุฎุตุตุ ุงุณุชุฎุฏู ุงูููุงุท ุงููุฏุฎูุฉ
            if (category === 'ุณููู ูุชููุฒ ุขุฎุฑ (ุจุชูุฏูุฑ ุงููุฌูุฉ)') {
                const customPoints = parseInt(document.getElementById('custom_points').value);
                if (!customPoints || customPoints < 1 || customPoints > 6) {
                    alert('โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ุนุฏุฏ ููุงุท ุตุญูุญ ุจูู 1 ู 6');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ุชูุซูู ุงูุณููู ุงูุฅูุฌุงุจู';
                    return;
                }
                points = customPoints;
            }
            
            const newPositive = {
                type: 'positive',
                studentName: document.getElementById('pos_student_name').value.trim(),
                grade: document.getElementById('pos_grade').value,
                category: category,
                impact: document.getElementById('pos_impact').value.trim(),
                nominator: document.getElementById('pos_nominator').value.trim(),
                points: points,
                timestamp: Date.now()
            };
            
            const success = await saveToFirebase(newPositive);
            
            if (success) {
                const successMsg = document.getElementById('positive-success');
                successMsg.textContent = `โ ุชู ุชูุซูู ุงูุณููู ุงูุฅูุฌุงุจู ููุทุงูุจ: ${newPositive.studentName} ุจูุฌุงุญ | ุงููุนุชูุฏ: ${CURRENT_USER.name}`;
                successMsg.style.display = 'block';
                
                positiveForm.reset();
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 5000);
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'ุชูุซูู ุงูุณููู ุงูุฅูุฌุงุจู';
        });

        monthSelector.addEventListener('change', generateReport);

        const deleteAllBtn = document.getElementById('delete-all-btn');
        deleteAllBtn.addEventListener('click', deleteAllRecords);

        // ูุธููุฉ ุนุฑุถ ุงูููุงุท ุนูุฏ ุงูุงุฎุชูุงุฑ
        window.updatePointsDisplay = function() {
            const categorySelect = document.getElementById('pos_category');
            const pointsDisplay = document.getElementById('points-display');
            const pointsValue = document.getElementById('points-value');
            const customPointsGroup = document.getElementById('custom-points-group');
            
            const selectedCategory = categorySelect.value;
            
            if (selectedCategory) {
                const points = POSITIVE_BEHAVIOR_POINTS[selectedCategory];
                
                if (selectedCategory === 'ุณููู ูุชููุฒ ุขุฎุฑ (ุจุชูุฏูุฑ ุงููุฌูุฉ)') {
                    pointsDisplay.style.display = 'none';
                    customPointsGroup.style.display = 'block';
                    document.getElementById('custom_points').required = true;
                } else {
                    pointsDisplay.style.display = 'block';
                    pointsValue.textContent = points;
                    customPointsGroup.style.display = 'none';
                    document.getElementById('custom_points').required = false;
                }
            } else {
                pointsDisplay.style.display = 'none';
                customPointsGroup.style.display = 'none';
            }
        };

        async function initialize() {
            updateApproverName();
            await loadDataFromFirebase();
            setupRealtimeListener();
            updateDashboard();
        }

        initialize();
    </script>
</body>
</html>
