<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿπŸÑŸÖ - ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑÿ≠ÿ±ŸàŸÅ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            color: #2c3e50;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #7f8c8d;
            font-size: 18px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-section {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: #2980b9;
            background: rgba(52, 152, 219, 0.05);
        }

        .upload-section.dragover {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #7f8c8d;
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: linear-gradient(45deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #229954, #27ae60);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .btn-warning:hover {
            background: linear-gradient(45deg, #e67e22, #d35400);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .status-success {
            background: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }

        .questions-preview {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            background: #f8f9fa;
        }

        .question-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 4px solid #3498db;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .question-subject {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .question-text {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .question-answer {
            color: #27ae60;
            font-size: 14px;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .sample-format {
            background: #e8f4f8;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .sample-format h4 {
            color: #0c5460;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .sample-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sample-table th,
        .sample-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }

        .sample-table th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }

        .sample-table tr:last-child td {
            border-bottom: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéõÔ∏è ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿπŸÑŸÖ</h1>
            <p>ÿ•ÿØÿßÿ±ÿ© ÿ®ŸÜŸÉ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑÿ´ŸÇÿßŸÅŸäÿ©</p>
        </div>

        <div class="dashboard-grid">
            <!-- ŸÇÿ≥ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© -->
            <div class="panel">
                <h2>üì§ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ®ŸÜŸÉ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</h2>
                
                <div class="upload-section" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">ÿßŸÜŸÇÿ± ŸáŸÜÿß ÿ£Ÿà ÿßÿ≥ÿ≠ÿ® ŸÖŸÑŸÅ Excel/CSV</div>
                    <div class="upload-hint">ŸäÿØÿπŸÖ ŸÖŸÑŸÅÿßÿ™ .xlsx, .xls, .csv</div>
                    <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" multiple>
                </div>

                <div class="loading-spinner" id="loadingSpinner"></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div class="status-message" id="statusMessage"></div>

                <div class="control-buttons">
                    <button class="btn btn-success" onclick="loadSampleQuestions()">
                        üìö ÿ™ÿ≠ŸÖŸäŸÑ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©
                    </button>
                    <button class="btn btn-warning" onclick="downloadTemplate()">
                        üìù ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßŸÑÿ® Excel
                    </button>
                    <button class="btn btn-danger" onclick="clearQuestions()">
                        üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
                    </button>
                </div>
            </div>

            <!-- ŸÇÿ≥ŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ -->
            <div class="panel">
                <h2>üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ®ŸÜŸÉ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mathQuestions">0</div>
                        <div class="stat-label">ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="scienceQuestions">0</div>
                        <div class="stat-label">ÿ£ÿ≥ÿ¶ŸÑÿ© ÿπŸÑŸàŸÖ</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="readingQuestions">0</div>
                        <div class="stat-label">ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÇÿ±ÿßÿ°ÿ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="validQuestions">0</div>
                        <div class="stat-label">ÿ£ÿ≥ÿ¶ŸÑÿ© ÿµÿßŸÑÿ≠ÿ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="invalidQuestions">0</div>
                        <div class="stat-label">ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿπÿ∑Ÿàÿ®ÿ©</div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn" onclick="startGame()">
                        üéÆ ÿ®ÿØÿ° ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©
                    </button>
                    <button class="btn btn-success" onclick="exportQuestions()">
                        üíæ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
                    </button>
                </div>
            </div>
        </div>

        <!-- ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© -->
        <div class="panel">
            <h2>üëÄ ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖÿ≠ŸÖŸÑÿ©</h2>
            <div class="questions-preview" id="questionsPreview">
                <p style="text-align: center; color: #7f8c8d; padding: 20px;">
                    ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ£Ÿä ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ÿπÿØ. ŸÇŸÖ ÿ®ÿ±ŸÅÿπ ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV ÿ£Ÿà ÿ≠ŸÖŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©.
                </p>
            </div>
        </div>

        <!-- ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® -->
        <div class="panel">
            <div class="sample-format">
                <h4>üìã ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</h4>
                <p style="margin-bottom: 15px; color: #495057;">Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ≠ÿ™ŸàŸä ŸÖŸÑŸÅ Excel/CSV ÿπŸÑŸâ ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©:</p>
                
                <table class="sample-table">
                    <thead>
                        <tr>
                            <th>ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑÿ≥ÿ§ÿßŸÑ</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©</th>
                            <th>ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™</td>
                            <td>ŸÖÿß ŸáŸà ŸÜÿßÿ™ÿ¨ 25 √ó 4ÿü</td>
                            <td>100</td>
                            <td>ŸÖÿ™Ÿàÿ≥ÿ∑</td>
                        </tr>
                        <tr>
                            <td>ÿπŸÑŸàŸÖ</td>
                            <td>ŸÖÿß ŸáŸà ÿ£ŸÉÿ®ÿ± ŸÉŸàŸÉÿ® ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿü</td>
                            <td>ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä</td>
                            <td>ÿ≥ŸáŸÑ</td>
                        </tr>
                        <tr>
                            <td>ŸÇÿ±ÿßÿ°ÿ©</td>
                            <td>ŸÖŸÜ ŸáŸà ŸÖÿ§ŸÑŸÅ ÿ±ŸàÿßŸäÿ© ŸÖÿØŸÜ ÿßŸÑŸÖŸÑÿ≠ÿü</td>
                            <td>ÿπÿ®ÿØ ÿßŸÑÿ±ÿ≠ŸÖŸÜ ŸÖŸÜŸäŸÅ</td>
                            <td>ÿµÿπÿ®</td>
                        </tr>
                    </tbody>
                </table>
                
                <p style="margin-top: 15px; color: #6c757d; font-size: 14px;">
                    üí° <strong>ŸÖŸÑÿßÿ≠ÿ∏ÿ©:</strong> ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ£ÿ≥ŸÖÿßÿ° ÿ£ÿÆÿ±Ÿâ ŸÑŸÑÿ£ÿπŸÖÿØÿ© ŸÖÿ´ŸÑ "ŸÖŸàÿ∂Ÿàÿπ" ÿ£Ÿà "ÿ≥ÿ§ÿßŸÑ" ÿ£Ÿà "ÿ¨Ÿàÿßÿ®"
                </p>
            </div>
        </div>
    </div>

    <script>
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿπÿßŸÖÿ©
        let questionBank = {
            ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™: [],
            ÿπŸÑŸàŸÖ: [],
            ŸÇÿ±ÿßÿ°ÿ©: []
        };

        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿµŸÅÿ≠ÿ©
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateStats();
        });

        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadSection = document.querySelector('.upload-section');

            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™
            fileInput.addEventListener('change', handleFileSelect);

            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™
            uploadSection.addEventListener('dragover', handleDragOver);
            uploadSection.addEventListener('dragleave', handleDragLeave);
            uploadSection.addEventListener('drop', handleDrop);
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                processFiles(files);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFiles(files);
            }
        }

        async function processFiles(files) {
            showLoading(true);
            showStatus('ÿ¨ÿßÿ±Ÿä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖŸÑŸÅÿßÿ™...', 'info');
            
            try {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    updateProgress((i / files.length) * 100);
                    
                    if (file.name.endsWith('.csv')) {
                        await processCsvFile(file);
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        await processExcelFile(file);
                    } else {
                        showStatus(`ŸÜŸàÿπ ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ: ${file.name}`, 'error');
                        continue;
                    }
                }
                
                updateProgress(100);
                showStatus('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
                updateStats();
                updateQuestionsPreview();
                
            } catch (error) {
                showStatus('ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖŸÑŸÅÿßÿ™: ' + error.message, 'error');
            } finally {
                showLoading(false);
                setTimeout(() => updateProgress(0), 2000);
            }
        }

        async function processCsvFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        
                        for (let i = 1; i < lines.length; i++) {
                            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                            if (values.length >= 3) {
                                addQuestionFromRow(headers, values);
                            }
                        }
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsText(file);
            });
        }

        async function processExcelFile(file) {
            // ŸÖÿ≠ÿßŸÉÿßÿ© ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖŸÑŸÅ Excel - ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ŸÇŸäŸÇŸä ÿ≥ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖŸÉÿ™ÿ®ÿ© ŸÖÿ´ŸÑ SheetJS
            return new Promise((resolve) => {
                setTimeout(() => {
                    // ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿπÿ∂ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ© ŸÉŸÖÿ´ÿßŸÑ
                    const sampleQuestions = [
                        ['ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™', 'ŸÖÿß ŸáŸà ŸÜÿßÿ™ÿ¨ 15 + 25ÿü', '40', 'ÿ≥ŸáŸÑ'],
                        ['ÿπŸÑŸàŸÖ', 'ŸÖÿß ŸáŸà ÿ±ŸÖÿ≤ ÿßŸÑŸÖÿßÿ° ÿßŸÑŸÉŸäŸÖŸäÿßÿ¶Ÿäÿü', 'H2O', 'ŸÖÿ™Ÿàÿ≥ÿ∑'],
                        ['ŸÇÿ±ÿßÿ°ÿ©', 'ŸÖÿß ŸáŸà ÿ¨ŸÖÿπ ŸÉŸÑŸÖÿ© ÿ®Ÿäÿ™ÿü', 'ÿ®ŸäŸàÿ™', 'ÿ≥ŸáŸÑ']
                    ];
                    
                    sampleQuestions.forEach(row => {
                        addQuestionFromRow(['ÿßŸÑŸÖÿßÿØÿ©', 'ÿßŸÑÿ≥ÿ§ÿßŸÑ', 'ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©', 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ'], row);
                    });
                    
                    resolve();
                }, 1000);
            });
        }

        function addQuestionFromRow(headers, values) {
            // ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿ§ÿ¥ÿ±ÿßÿ™ ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
            const subjectIndex = findColumnIndex(headers, ['ÿßŸÑŸÖÿßÿØÿ©', 'ŸÖŸàÿ∂Ÿàÿπ', 'subject']);
            const questionIndex = findColumnIndex(headers, ['ÿßŸÑÿ≥ÿ§ÿßŸÑ', 'ÿ≥ÿ§ÿßŸÑ', 'question']);
            const answerIndex = findColumnIndex(headers, ['ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©', 'ÿ¨Ÿàÿßÿ®', 'answer', 'ÿßŸÑÿ¨Ÿàÿßÿ®']);
            
            if (subjectIndex >= 0 && questionIndex >= 0 && answerIndex >= 0) {
                const subject = normalizeSubject(values[subjectIndex]);
                const question = values[questionIndex];
                const answer = values[answerIndex];
                
                if (subject && question && answer) {
                    if (!questionBank[subject]) {
                        questionBank[subject] = [];
                    }
                    
                    questionBank[subject].push({
                        q: question,
                        a: answer,
                        level: values[3] || 'ŸÖÿ™Ÿàÿ≥ÿ∑'
                    });
                }
            }
        }

        function findColumnIndex(headers, possibleNames) {
            for (let name of possibleNames) {
                const index = headers.findIndex(h => h.toLowerCase().includes(name.toLowerCase()));
                if (index >= 0) return index;
            }
            return -1;
        }

        function normalizeSubject(subject) {
            if (!subject) return null;
            
            const s = subject.toLowerCase().trim();
            if (s.includes('ÿ±Ÿäÿßÿ∂') || s.includes('math')) return 'ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™';
            if (s.includes('ÿπŸÑŸàŸÖ') || s.includes('science')) return 'ÿπŸÑŸàŸÖ';
            if (s.includes('ŸÇÿ±ÿßÿ°') || s.includes('ÿπÿ±ÿ®') || s.includes('read')) return 'ŸÇÿ±ÿßÿ°ÿ©';
            
            return null;
        }

        function loadSampleQuestions() {
            showLoading(true);
            showStatus('ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©...', 'info');
            
            setTimeout(() => {
                // ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖŸÜ ŸÖŸÜÿßŸáÿ¨ ŸÜÿßŸÅÿ≥ ŸàÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ©
                questionBank = {
                    ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™: [
                        { q: "ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ≥ + 5 = 12ÿå ŸÅŸÖÿß ŸÇŸäŸÖÿ© ÿ≥ÿü", a: "7", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÖÿß ŸáŸà ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿ∑ŸäŸÑ ÿßŸÑÿ∞Ÿä ÿ∑ŸàŸÑŸá 8 ÿ≥ŸÖ Ÿàÿπÿ±ÿ∂Ÿá 5 ÿ≥ŸÖÿü", a: "40 ÿ≥ŸÖ¬≤", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸà ŸÜÿßÿ™ÿ¨ (3¬≤ + 4¬≤)ÿü", a: "25", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ≠Ÿäÿ∑ ÿßŸÑŸÖÿ±ÿ®ÿπ 20 ÿ≥ŸÖÿå ŸÅŸÖÿß ÿ∑ŸàŸÑ ÿ∂ŸÑÿπŸáÿü", a: "5 ÿ≥ŸÖ", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÖÿß ŸáŸà ŸÜÿßÿ™ÿ¨ 15% ŸÖŸÜ 200ÿü", a: "30", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿπÿØÿØ ÿßŸÑÿ™ŸÑÿßŸÖŸäÿ∞ ŸÅŸä ÿßŸÑŸÅÿµŸÑ 24ÿå ŸàŸÉÿßŸÜ ÿ´ŸÑÿ´ŸáŸÖ ÿ®ŸÜÿßÿ™ÿå ŸÅŸÉŸÖ ÿπÿØÿØ ÿßŸÑÿ®ŸÜŸäŸÜÿü", a: "16", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸà ÿßŸÑÿ¨ÿ∞ÿ± ÿßŸÑÿ™ÿ±ÿ®ŸäÿπŸä ŸÑŸÑÿπÿØÿØ 144ÿü", a: "12", level: "ÿ≥ŸáŸÑ" },
                        { q: "ÿ•ÿ∞ÿß ÿßÿ¥ÿ™ÿ±Ÿâ ÿ£ÿ≠ŸÖÿØ 3 ŸÉÿ™ÿ® ÿ®ŸÄ 45 ÿ±ŸäÿßŸÑÿå ŸÅŸÖÿß ÿ´ŸÖŸÜ ÿßŸÑŸÉÿ™ÿßÿ® ÿßŸÑŸàÿßÿ≠ÿØÿü", a: "15 ÿ±ŸäÿßŸÑ", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÖÿß ŸáŸà ŸÜÿßÿ™ÿ¨ 2¬≥ √ó 3¬≤ÿü", a: "72", level: "ÿµÿπÿ®" },
                        { q: "ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠ ŸÅŸä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± 80%ÿå ŸàÿπÿØÿØ ÿßŸÑŸÜÿßÿ¨ÿ≠ŸäŸÜ 32ÿå ŸÅŸÖÿß ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÉŸÑŸäÿü", a: "40", level: "ÿµÿπÿ®" }
                    ],
                    ÿπŸÑŸàŸÖ: [
                        { q: "ŸÖÿß ŸáŸà ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÉŸäŸÖŸäÿßÿ¶Ÿä ÿßŸÑÿ£ŸÉÿ´ÿ± ŸàŸÅÿ±ÿ© ŸÅŸä ÿßŸÑÿ∫ŸÑÿßŸÅ ÿßŸÑÿ¨ŸàŸäÿü", a: "ÿßŸÑŸÜŸäÿ™ÿ±Ÿàÿ¨ŸäŸÜ", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÉŸÖ ÿπÿØÿØ ÿπÿ∏ÿßŸÖ ÿ¨ÿ≥ŸÖ ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜ ÿßŸÑÿ®ÿßŸÑÿ∫ÿü", a: "206", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸà ÿ£ÿ≥ÿ±ÿπ ÿßŸÑÿ≠ŸäŸàÿßŸÜÿßÿ™ ÿßŸÑÿ®ÿ±Ÿäÿ©ÿü", a: "ÿßŸÑŸÅŸáÿØ", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÅŸä ÿ£Ÿä ÿ∑ÿ®ŸÇÿ© ŸÖŸÜ ÿ∑ÿ®ŸÇÿßÿ™ ÿßŸÑÿ∫ŸÑÿßŸÅ ÿßŸÑÿ¨ŸàŸä ÿ™Ÿàÿ¨ÿØ ÿ∑ÿ®ŸÇÿ© ÿßŸÑÿ£Ÿàÿ≤ŸàŸÜÿü", a: "ÿßŸÑÿ≥ÿ™ÿ±ÿßÿ™Ÿàÿ≥ŸÅŸäÿ±", level: "ÿµÿπÿ®" },
                        { q: "ŸÖÿß ŸáŸà ÿßŸÑÿ≠ŸäŸàÿßŸÜ ÿßŸÑÿ∞Ÿä ŸäŸÖŸÉŸÜŸá ÿ™ÿ∫ŸäŸäÿ± ŸÑŸàŸÜŸáÿü", a: "ÿßŸÑÿ≠ÿ±ÿ®ÿßÿ°", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÉŸÖ ÿπÿØÿØ ÿ≠ÿ¨ÿ±ÿßÿ™ ÿßŸÑŸÇŸÑÿ® ŸÅŸä ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜÿü", a: "ÿ£ÿ±ÿ®ÿπ ÿ≠ÿ¨ÿ±ÿßÿ™", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÖÿß ŸáŸà ÿßŸÑŸÖÿπÿØŸÜ ÿßŸÑÿ∞Ÿä Ÿäÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿµŸÜÿßÿπÿ© ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿßÿ™ÿü", a: "ÿßŸÑÿ£ŸÑŸàŸÖŸÜŸäŸàŸÖ", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ÿ£ŸäŸÜ Ÿäÿ≠ÿØÿ´ ÿßŸÑŸáÿ∂ŸÖ ÿßŸÑŸÉŸäŸÖŸäÿßÿ¶Ÿä ŸÅŸä ÿ¨ÿ≥ŸÖ ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜÿü", a: "ÿßŸÑŸÖÿπÿØÿ© ŸàÿßŸÑÿ£ŸÖÿπÿßÿ° ÿßŸÑÿØŸÇŸäŸÇÿ©", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸà ÿßŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∞Ÿä ÿ™ÿ≠ÿ™ÿßÿ¨Ÿá ÿßŸÑŸÜÿ®ÿßÿ™ÿßÿ™ ŸÑŸÑŸÇŸäÿßŸÖ ÿ®ÿßŸÑÿ®ŸÜÿßÿ° ÿßŸÑÿ∂Ÿàÿ¶Ÿäÿü", a: "ÿ´ÿßŸÜŸä ÿ£ŸÉÿ≥ŸäÿØ ÿßŸÑŸÉÿ±ÿ®ŸàŸÜ", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸä ÿ£ÿµÿ∫ÿ± Ÿàÿ≠ÿØÿ© ŸÅŸä ÿßŸÑŸÖÿßÿØÿ©ÿü", a: "ÿßŸÑÿ∞ÿ±ÿ©", level: "ÿ≥ŸáŸÑ" }
                    ],
                    ŸÇÿ±ÿßÿ°ÿ©: [
                        { q: "ŸÖŸÜ ŸáŸà ÿßŸÑÿ¥ÿßÿπÿ± ÿßŸÑÿ∞Ÿä ŸÑŸèŸÇÿ® ÿ®ŸÄ 'ÿ£ŸÖŸäÿ± ÿßŸÑÿ¥ÿπÿ±ÿßÿ°'ÿü", a: "ÿ£ÿ≠ŸÖÿØ ÿ¥ŸàŸÇŸä", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸà ÿ¨ŸÖÿπ ŸÉŸÑŸÖÿ© 'ÿßŸÖÿ±ÿ£ÿ©'ÿü", a: "ŸÜÿ≥ÿßÿ°", level: "ÿ≥ŸáŸÑ" },
                        { q: "ŸÖŸÜ ŸáŸà ŸÖÿ§ŸÑŸÅ ÿ±ŸàÿßŸäÿ© 'ÿßŸÑÿ£ÿ≥ŸàÿØ ŸäŸÑŸäŸÇ ÿ®ŸÉ'ÿü", a: "ÿ£ÿ≠ŸÑÿßŸÖ ŸÖÿ≥ÿ™ÿ∫ÿßŸÜŸÖŸä", level: "ÿµÿπÿ®" },
                        { q: "ŸÖÿß ŸáŸà ŸÖÿ±ÿßÿØŸÅ ŸÉŸÑŸÖÿ© 'ÿßŸÑÿ¥ŸÅŸÇ'ÿü", a: "ÿßŸÑŸÖÿ∫ÿ±ÿ® ÿ£Ÿà ÿßŸÑÿ∫ÿ±Ÿàÿ®", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖŸÜ ŸáŸà ÿµÿßÿ≠ÿ® ŸÖÿπŸÑŸÇÿ© 'ÿπŸÑŸÇŸáÿß ÿ®ÿ£ÿπŸÑŸâ ÿßŸÑŸÉÿπÿ®ÿ©'ÿü", a: "ŸÑÿ®ŸäÿØ ÿ®ŸÜ ÿ±ÿ®Ÿäÿπÿ©", level: "ÿµÿπÿ®" },
                        { q: "ŸÖÿß ŸáŸà ÿ∂ÿØ ŸÉŸÑŸÖÿ© 'ÿßŸÑÿ¥ÿ¨ÿßÿπÿ©'ÿü", a: "ÿßŸÑÿ¨ÿ®ŸÜ", level: "ÿ≥ŸáŸÑ" },
                        { q: "ÿ£ŸÉŸÖŸÑ ÿßŸÑÿ®Ÿäÿ™: 'ÿ•ÿ∞ÿß ÿßŸÑŸÖÿ±ÿ° ŸÑŸÖ ŸäÿØŸÜÿ≥ ŸÖŸÜ ÿßŸÑŸÑÿ§ŸÖ ÿπÿ±ÿ∂Ÿá...'", a: "ŸÅŸÉŸÑ ÿ±ÿØÿßÿ° Ÿäÿ±ÿ™ÿØŸäŸá ÿ¨ŸÖŸäŸÑ", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖÿß ŸáŸà ÿßÿ≥ŸÖ ÿßŸÑŸÅÿßÿπŸÑ ŸÖŸÜ ÿßŸÑŸÅÿπŸÑ 'ÿßÿ≥ÿ™ÿÆÿ±ÿ¨'ÿü", a: "ŸÖÿ≥ÿ™ÿÆÿ±Ÿêÿ¨", level: "ŸÖÿ™Ÿàÿ≥ÿ∑" },
                        { q: "ŸÖŸÜ ŸáŸà ÿßŸÑÿ¥ÿßÿπÿ± ÿµÿßÿ≠ÿ® ÿØŸäŸàÿßŸÜ 'ÿ£Ÿàÿ±ÿßŸÇ ÿßŸÑŸàÿ±ÿØ'ÿü", a: "ÿ•ŸäŸÑŸäÿß ÿ£ÿ®Ÿà ŸÖÿßÿ∂Ÿä", level: "ÿµÿπÿ®" },
                        { q: "ŸÖÿß ŸáŸà ŸÖÿπŸÜŸâ ŸÉŸÑŸÖÿ© 'ÿßŸÑŸÖŸÜÿßÿ±ÿ©'ÿü", a: "ÿßŸÑÿ®ÿ±ÿ¨ ÿßŸÑŸÖÿ∂Ÿäÿ°", level: "ÿ≥ŸáŸÑ" }
                    ]
                };

                updateStats();
                updateQuestionsPreview();
                showStatus('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ 30 ÿ≥ÿ§ÿßŸÑ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä ŸÖŸÜ ŸÖŸÜÿßŸáÿ¨ ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© ŸàŸÜÿßŸÅÿ≥!', 'success');
                showLoading(false);
            }, 1500);
        }

        function clearQuestions() {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©ÿü')) {
                questionBank = {
                    ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™: [],
                    ÿπŸÑŸàŸÖ: [],
                    ŸÇÿ±ÿßÿ°ÿ©: []
                };
                updateStats();
                updateQuestionsPreview();
                showStatus('ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©.', 'info');
            }
        }

        function updateStats() {
            const mathCount = questionBank.ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™.length;
            const scienceCount = questionBank.ÿπŸÑŸàŸÖ.length;
            const readingCount = questionBank.ŸÇÿ±ÿßÿ°ÿ©.length;
            const totalCount = mathCount + scienceCount + readingCount;

            document.getElementById('totalQuestions').textContent = totalCount;
            document.getElementById('mathQuestions').textContent = mathCount;
            document.getElementById('scienceQuestions').textContent = scienceCount;
            document.getElementById('readingQuestions').textContent = readingCount;
            document.getElementById('validQuestions').textContent = totalCount;
            document.getElementById('invalidQuestions').textContent = '0';
        }

        function updateQuestionsPreview() {
            const preview = document.getElementById('questionsPreview');
            
            if (!hasQuestions()) {
                preview.innerHTML = `
                    <p style="text-align: center; color: #7f8c8d; padding: 20px;">
                        ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ£Ÿä ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ÿπÿØ. ŸÇŸÖ ÿ®ÿ±ŸÅÿπ ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV ÿ£Ÿà ÿ≠ŸÖŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©.
                    </p>
                `;
                return;
            }

            let html = '';
            
            Object.keys(questionBank).forEach(subject => {
                if (questionBank[subject].length > 0) {
                    html += `<h4 style="color: #2c3e50; margin: 20px 0 10px 0; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üìö ${subject} (${questionBank[subject].length} ÿ£ÿ≥ÿ¶ŸÑÿ©)</h4>`;
                    
                    questionBank[subject].slice(0, 5).forEach(question => {
                        html += `
                            <div class="question-item">
                                <div class="question-subject">${subject}</div>
                                <div class="question-text">${question.q}</div>
                                <div class="question-answer">‚úì ${question.a}</div>
                            </div>
                        `;
                    });
                    
                    if (questionBank[subject].length > 5) {
                        html += `<p style="text-align: center; color: #7f8c8d; margin: 10px 0;">... Ÿà ${questionBank[subject].length - 5} ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ£ÿÆÿ±Ÿâ</p>`;
                    }
                }
            });

            preview.innerHTML = html;
        }

        function hasQuestions() {
            return Object.values(questionBank).some(questions => questions.length > 0);
        }

        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = show ? 'block' : 'none';
        }

        function updateProgress(percent) {
            const fill = document.getElementById('progressFill');
            fill.style.width = percent + '%';
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status-message status-${type}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';

            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        function downloadTemplate() {
            const csvContent = `ÿßŸÑŸÖÿßÿØÿ©,ÿßŸÑÿ≥ÿ§ÿßŸÑ,ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©,ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ
ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™,ŸÖÿß ŸáŸà ŸÜÿßÿ™ÿ¨ 5 + 7ÿü,12,ÿ≥ŸáŸÑ
ÿπŸÑŸàŸÖ,ŸÖÿß ŸáŸà ÿ±ŸÖÿ≤ ÿßŸÑÿ£ŸÉÿ≥ÿ¨ŸäŸÜÿü,O2,ŸÖÿ™Ÿàÿ≥ÿ∑
ŸÇÿ±ÿßÿ°ÿ©,ŸÖÿß ŸáŸà ÿ¨ŸÖÿπ ŸÉŸÑŸÖÿ© ŸÉÿ™ÿßÿ®ÿü,ŸÉÿ™ÿ®,ÿ≥ŸáŸÑ
ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™,ŸÉŸÖ Ÿäÿ≥ÿßŸàŸä ŸÖÿ≠Ÿäÿ∑ ÿßŸÑŸÖÿ±ÿ®ÿπ ÿßŸÑÿ∞Ÿä ÿ∂ŸÑÿπŸá 4 ÿ≥ŸÖÿü,16 ÿ≥ŸÖ,ŸÖÿ™Ÿàÿ≥ÿ∑
ÿπŸÑŸàŸÖ,ŸÅŸä ÿ£Ÿä ÿ∑ÿ®ŸÇÿ© ŸÖŸÜ ÿßŸÑÿ∫ŸÑÿßŸÅ ÿßŸÑÿ¨ŸàŸä ŸÜÿπŸäÿ¥ÿü,ÿßŸÑÿ™ÿ±Ÿàÿ®Ÿàÿ≥ŸÅŸäÿ±,ÿµÿπÿ®`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'ŸÇÿßŸÑÿ®_ÿ£ÿ≥ÿ¶ŸÑÿ©_ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            showStatus('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßŸÑÿ® ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©!', 'success');
        }

        function exportQuestions() {
            if (!hasQuestions()) {
                showStatus('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÑŸÑÿ™ÿµÿØŸäÿ±!', 'error');
                return;
            }

            let csvContent = 'ÿßŸÑŸÖÿßÿØÿ©,ÿßŸÑÿ≥ÿ§ÿßŸÑ,ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©,ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ\n';
            
            Object.keys(questionBank).forEach(subject => {
                questionBank[subject].forEach(question => {
                    csvContent += `${subject},"${question.q}","${question.a}",${question.level || 'ŸÖÿ™Ÿàÿ≥ÿ∑'}\n`;
                });
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `ÿ®ŸÜŸÉ_ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©_${new Date().toLocaleDateString('ar-SA')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            showStatus('ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
        }

        function startGame() {
            if (!hasQuestions()) {
                showStatus('Ÿäÿ¨ÿ® ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ£ŸàŸÑÿßŸã ŸÇÿ®ŸÑ ÿ®ÿØÿ° ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©!', 'error');
                return;
            }

            // ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸÅŸä localStorage ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸáÿß ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©
            localStorage.setItem('competitionQuestions', JSON.stringify(questionBank));
            
            showStatus('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©! ÿ≥Ÿäÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿ¨ÿØŸäÿØÿ©...', 'success');
            
            setTimeout(() => {
                // ŸÅÿ™ÿ≠ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿ¨ÿØŸäÿØÿ©
                const gameWindow = window.open('', '_blank');
                
                // ŸáŸÜÿß ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàÿØ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ÿ£Ÿà ÿ±ÿßÿ®ÿ∑ ÿ•ŸÑŸäŸáÿß
                gameWindow.document.write(`
                    <html>
                        <head>
                            <title>ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑÿ´ŸÇÿßŸÅŸäÿ©</title>
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    text-align: center;
                                    padding: 50px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                }
                                .message {
                                    background: rgba(255,255,255,0.1);
                                    padding: 30px;
                                    border-radius: 15px;
                                    margin: 20px auto;
                                    max-width: 600px;
                                }
                                .btn {
                                    background: #3498db;
                                    color: white;
                                    padding: 15px 30px;
                                    border: none;
                                    border-radius: 25px;
                                    font-size: 18px;
                                    cursor: pointer;
                                    margin: 10px;
                                }
                            </style>
                        </head>
                        <body>
                            <h1>üéØ ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑÿ´ŸÇÿßŸÅŸäÿ©</h1>
                            <div class="message">
                                <h2>ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${Object.values(questionBank).reduce((total, questions) => total + questions.length, 0)} ÿ≥ÿ§ÿßŸÑ!</h2>
                                <p>ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©</p>
                                <button class="btn" onclick="window.close()">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                            </div>
                        </body>
                    </html>
                `);
            }, 1000);
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿπÿßŸÖ
        window.addEventListener('error', function(e) {
            console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:', e.error);
            showStatus('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.', 'error');
        });

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
        window.addEventListener('load', function() {
            const savedQuestions = localStorage.getItem('competitionQuestions');
            if (savedQuestions) {
                try {
                    const parsedQuestions = JSON.parse(savedQuestions);
                    if (parsedQuestions && typeof parsedQuestions === 'object') {
                        questionBank = parsedQuestions;
                        updateStats();
                        updateQuestionsPreview();
                        showStatus('ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã.', 'info');
                    }
                } catch (error) {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©:', error);
                }
            }
        });
    </script>
</body>
</html>
