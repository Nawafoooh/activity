<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù… - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø±ÙˆÙ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            color: #2c3e50;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #7f8c8d;
            font-size: 18px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-section {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: #2980b9;
            background: rgba(52, 152, 219, 0.05);
        }

        .upload-section.dragover {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #7f8c8d;
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: linear-gradient(45deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #229954, #27ae60);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .btn-warning:hover {
            background: linear-gradient(45deg, #e67e22, #d35400);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .status-success {
            background: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }

        .questions-preview {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            background: #f8f9fa;
        }

        .question-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 4px solid #3498db;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .question-subject {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .question-text {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .question-answer {
            color: #27ae60;
            font-size: 14px;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .sample-format {
            background: #e8f4f8;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .sample-format h4 {
            color: #0c5460;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .sample-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sample-table th,
        .sample-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }

        .sample-table th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }

        .sample-table tr:last-child td {
            border-bottom: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ©</p>
        </div>

        <div class="dashboard-grid">
            <!-- Ù‚Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
            <div class="panel">
                <h2>ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
                
                <div class="upload-section" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Excel/CSV</div>
                    <div class="upload-hint">ÙŠØ¯Ø¹Ù… Ù…Ù„ÙØ§Øª .xlsx, .xls, .csv</div>
                    <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" multiple>
                </div>

                <div class="loading-spinner" id="loadingSpinner"></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div class="status-message" id="statusMessage"></div>

                <div class="control-buttons">
                    <button class="btn btn-success" onclick="loadSampleQuestions()">
                        ğŸ“š ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ø¦Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    </button>
                    <button class="btn btn-warning" onclick="downloadTemplate()">
                        ğŸ“ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Excel
                    </button>
                    <button class="btn btn-danger" onclick="clearQuestions()">
                        ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                    </button>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="panel">
                <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mathQuestions">0</div>
                        <div class="stat-label">Ø£Ø³Ø¦Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="scienceQuestions">0</div>
                        <div class="stat-label">Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„ÙˆÙ…</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="readingQuestions">0</div>
                        <div class="stat-label">Ø£Ø³Ø¦Ù„Ø© Ù‚Ø±Ø§Ø¡Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="validQuestions">0</div>
                        <div class="stat-label">Ø£Ø³Ø¦Ù„Ø© ØµØ§Ù„Ø­Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="invalidQuestions">0</div>
                        <div class="stat-label">Ø£Ø³Ø¦Ù„Ø© Ù…Ø¹Ø·ÙˆØ¨Ø©</div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn" onclick="startGame()">
                        ğŸ® Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
                    </button>
                    <button class="btn btn-success" onclick="exportQuestions()">
                        ğŸ’¾ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                    </button>
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
        <div class="panel">
            <h2>ğŸ‘€ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ù…Ù„Ø©</h2>
            <div class="questions-preview" id="questionsPreview">
                <p style="text-align: center; color: #7f8c8d; padding: 20px;">
                    Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯. Ù‚Ù… Ø¨Ø±ÙØ¹ Ù…Ù„Ù Excel Ø£Ùˆ CSV Ø£Ùˆ Ø­Ù…Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©.
                </p>
            </div>
        </div>

        <!-- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ -->
        <div class="panel">
            <div class="sample-format">
                <h4>ğŸ“‹ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h4>
                <p style="margin-bottom: 15px; color: #495057;">ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ù…Ù„Ù Excel/CSV Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
                
                <table class="sample-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„Ø³Ø¤Ø§Ù„</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</th>
                            <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td>
                            <td>Ù…Ø§ Ù‡Ùˆ Ù†Ø§ØªØ¬ 25 Ã— 4ØŸ</td>
                            <td>100</td>
                            <td>Ù…ØªÙˆØ³Ø·</td>
                        </tr>
                        <tr>
                            <td>Ø¹Ù„ÙˆÙ…</td>
                            <td>Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ù…Ø³ÙŠØŸ</td>
                            <td>Ø§Ù„Ù…Ø´ØªØ±ÙŠ</td>
                            <td>Ø³Ù‡Ù„</td>
                        </tr>
                        <tr>
                            <td>Ù‚Ø±Ø§Ø¡Ø©</td>
                            <td>Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ù„Ù Ø±ÙˆØ§ÙŠØ© Ù…Ø¯Ù† Ø§Ù„Ù…Ù„Ø­ØŸ</td>
                            <td>Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ù…Ù†ÙŠÙ</td>
                            <td>ØµØ¹Ø¨</td>
                        </tr>
                    </tbody>
                </table>
                
                <p style="margin-top: 15px; color: #6c757d; font-size: 14px;">
                    ğŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø³Ù…Ø§Ø¡ Ø£Ø®Ø±Ù‰ Ù„Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…Ø«Ù„ "Ù…ÙˆØ¶ÙˆØ¹" Ø£Ùˆ "Ø³Ø¤Ø§Ù„" Ø£Ùˆ "Ø¬ÙˆØ§Ø¨"
                </p>
            </div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let questionBank = {
            Ø±ÙŠØ§Ø¶ÙŠØ§Øª: [],
            Ø¹Ù„ÙˆÙ…: [],
            Ù‚Ø±Ø§Ø¡Ø©: []
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateStats();
        });

        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadSection = document.querySelector('.upload-section');

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            fileInput.addEventListener('change', handleFileSelect);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
            uploadSection.addEventListener('dragover', handleDragOver);
            uploadSection.addEventListener('dragleave', handleDragLeave);
            uploadSection.addEventListener('drop', handleDrop);
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                processFiles(files);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFiles(files);
            }
        }

        async function processFiles(files) {
            showLoading(true);
            showStatus('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª...', 'info');
            
            try {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    updateProgress((i / files.length) * 100);
                    
                    if (file.name.endsWith('.csv')) {
                        await processCsvFile(file);
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        await processExcelFile(file);
                    } else {
                        showStatus(`Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…: ${file.name}`, 'error');
                        continue;
                    }
                }
                
                updateProgress(100);
                showStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                updateStats();
                updateQuestionsPreview();
                
            } catch (error) {
                showStatus('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª: ' + error.message, 'error');
            } finally {
                showLoading(false);
                setTimeout(() => updateProgress(0), 2000);
            }
        }

        async function processCsvFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        
                        for (let i = 1; i < lines.length; i++) {
                            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                            if (values.length >= 3) {
                                addQuestionFromRow(headers, values);
                            }
                        }
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsText(file);
            });
        }

        async function processExcelFile(file) {
            // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Excel - ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ØªØ­ØªØ§Ø¬ Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ SheetJS
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙƒÙ…Ø«Ø§Ù„
                    const sampleQuestions = [
                        ['Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ù…Ø§ Ù‡Ùˆ Ù†Ø§ØªØ¬ 15 + 25ØŸ', '40', 'Ø³Ù‡Ù„'],
                        ['Ø¹Ù„ÙˆÙ…', 'Ù…Ø§ Ù‡Ùˆ Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØŸ', 'H2O', 'Ù…ØªÙˆØ³Ø·'],
                        ['Ù‚Ø±Ø§Ø¡Ø©', 'Ù…Ø§ Ù‡Ùˆ Ø¬Ù…Ø¹ ÙƒÙ„Ù…Ø© Ø¨ÙŠØªØŸ', 'Ø¨ÙŠÙˆØª', 'Ø³Ù‡Ù„']
                    ];
                    
                    sampleQuestions.forEach(row => {
                        addQuestionFromRow(['Ø§Ù„Ù…Ø§Ø¯Ø©', 'Ø§Ù„Ø³Ø¤Ø§Ù„', 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©', 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰'], row);
                    });
                    
                    resolve();
                }, 1000);
            });
        }

        function addQuestionFromRow(headers, values) {
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const subjectIndex = findColumnIndex(headers, ['Ø§Ù„Ù…Ø§Ø¯Ø©', 'Ù…ÙˆØ¶ÙˆØ¹', 'subject']);
            const questionIndex = findColumnIndex(headers, ['Ø§Ù„Ø³Ø¤Ø§Ù„', 'Ø³Ø¤Ø§Ù„', 'question']);
            const answerIndex = findColumnIndex(headers, ['Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©', 'Ø¬ÙˆØ§Ø¨', 'answer', 'Ø§Ù„Ø¬ÙˆØ§Ø¨']);
            
            if (subjectIndex >= 0 && questionIndex >= 0 && answerIndex >= 0) {
                const subject = normalizeSubject(values[subjectIndex]);
                const question = values[questionIndex];
                const answer = values[answerIndex];
                
                if (subject && question && answer) {
                    if (!questionBank[subject]) {
                        questionBank[subject] = [];
                    }
                    
                    questionBank[subject].push({
                        q: question,
                        a: answer,
                        level: values[3] || 'Ù…ØªÙˆØ³Ø·'
                    });
                }
            }
        }

        function findColumnIndex(headers, possibleNames) {
            for (let name of possibleNames) {
                const index = headers.findIndex(h => h.toLowerCase().includes(name.toLowerCase()));
                if (index >= 0) return index;
            }
            return -1;
        }

        function normalizeSubject(subject) {
            if (!subject) return null;
            
            const s = subject.toLowerCase().trim();
            if (s.includes('Ø±ÙŠØ§Ø¶') || s.includes('math')) return 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª';
            if (s.includes('Ø¹Ù„ÙˆÙ…') || s.includes('science')) return 'Ø¹Ù„ÙˆÙ…';
            if (s.includes('Ù‚Ø±Ø§Ø¡') || s.includes('Ø¹Ø±Ø¨') || s.includes('read')) return 'Ù‚Ø±Ø§Ø¡Ø©';
            
            return null;
        }

        function loadSampleQuestions() {
            showLoading(true);
            showStatus('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'info');
            
            setTimeout(() => {
                // Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù†Ø§Ù‡Ø¬ Ù†Ø§ÙØ³ ÙˆØ§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©
                questionBank = {
                    Ø±ÙŠØ§Ø¶ÙŠØ§Øª: [
                        { q: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø³ + 5 = 12ØŒ ÙÙ…Ø§ Ù‚ÙŠÙ…Ø© Ø³ØŸ", a: "7", level: "Ø³Ù‡Ù„" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø°ÙŠ Ø·ÙˆÙ„Ù‡ 8 Ø³Ù… ÙˆØ¹Ø±Ø¶Ù‡ 5 Ø³Ù…ØŸ", a: "40 Ø³Ù…Â²", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ù†Ø§ØªØ¬ (3Â² + 4Â²)ØŸ", a: "25", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø­ÙŠØ· Ø§Ù„Ù…Ø±Ø¨Ø¹ 20 Ø³Ù…ØŒ ÙÙ…Ø§ Ø·ÙˆÙ„ Ø¶Ù„Ø¹Ù‡ØŸ", a: "5 Ø³Ù…", level: "Ø³Ù‡Ù„" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ù†Ø§ØªØ¬ 15% Ù…Ù† 200ØŸ", a: "30", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° ÙÙŠ Ø§Ù„ÙØµÙ„ 24ØŒ ÙˆÙƒØ§Ù† Ø«Ù„Ø«Ù‡Ù… Ø¨Ù†Ø§ØªØŒ ÙÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙŠÙ†ØŸ", a: "16", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ø°Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø¹Ø¯Ø¯ 144ØŸ", a: "12", level: "Ø³Ù‡Ù„" },
                        { q: "Ø¥Ø°Ø§ Ø§Ø´ØªØ±Ù‰ Ø£Ø­Ù…Ø¯ 3 ÙƒØªØ¨ Ø¨Ù€ 45 Ø±ÙŠØ§Ù„ØŒ ÙÙ…Ø§ Ø«Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ØŸ", a: "15 Ø±ÙŠØ§Ù„", level: "Ø³Ù‡Ù„" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ù†Ø§ØªØ¬ 2Â³ Ã— 3Â²ØŸ", a: "72", level: "ØµØ¹Ø¨" },
                        { q: "Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 80%ØŒ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù†Ø§Ø¬Ø­ÙŠÙ† 32ØŒ ÙÙ…Ø§ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ÙƒÙ„ÙŠØŸ", a: "40", level: "ØµØ¹Ø¨" }
                    ],
                    Ø¹Ù„ÙˆÙ…: [
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ Ø§Ù„Ø£ÙƒØ«Ø± ÙˆÙØ±Ø© ÙÙŠ Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø¬ÙˆÙŠØŸ", a: "Ø§Ù„Ù†ÙŠØªØ±ÙˆØ¬ÙŠÙ†", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø¹Ø¸Ø§Ù… Ø¬Ø³Ù… Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø§Ù„Ø¨Ø§Ù„ØºØŸ", a: "206", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø£Ø³Ø±Ø¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ©ØŸ", a: "Ø§Ù„ÙÙ‡Ø¯", level: "Ø³Ù‡Ù„" },
                        { q: "ÙÙŠ Ø£ÙŠ Ø·Ø¨Ù‚Ø© Ù…Ù† Ø·Ø¨Ù‚Ø§Øª Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø¬ÙˆÙŠ ØªÙˆØ¬Ø¯ Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£ÙˆØ²ÙˆÙ†ØŸ", a: "Ø§Ù„Ø³ØªØ±Ø§ØªÙˆØ³ÙÙŠØ±", level: "ØµØ¹Ø¨" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± Ù„ÙˆÙ†Ù‡ØŸ", a: "Ø§Ù„Ø­Ø±Ø¨Ø§Ø¡", level: "Ø³Ù‡Ù„" },
                        { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø­Ø¬Ø±Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ ÙÙŠ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ØŸ", a: "Ø£Ø±Ø¨Ø¹ Ø­Ø¬Ø±Ø§Øª", level: "Ø³Ù‡Ù„" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø¹Ø¯Ù† Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø§ØªØŸ", a: "Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ø£ÙŠÙ† ÙŠØ­Ø¯Ø« Ø§Ù„Ù‡Ø¶Ù… Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ ÙÙŠ Ø¬Ø³Ù… Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ØŸ", a: "Ø§Ù„Ù…Ø¹Ø¯Ø© ÙˆØ§Ù„Ø£Ù…Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØºØ§Ø² Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¶ÙˆØ¦ÙŠØŸ", a: "Ø«Ø§Ù†ÙŠ Ø£ÙƒØ³ÙŠØ¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡ÙŠ Ø£ØµØºØ± ÙˆØ­Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ", a: "Ø§Ù„Ø°Ø±Ø©", level: "Ø³Ù‡Ù„" }
                    ],
                    Ù‚Ø±Ø§Ø¡Ø©: [
                        { q: "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø´Ø§Ø¹Ø± Ø§Ù„Ø°ÙŠ Ù„ÙÙ‚Ø¨ Ø¨Ù€ 'Ø£Ù…ÙŠØ± Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡'ØŸ", a: "Ø£Ø­Ù…Ø¯ Ø´ÙˆÙ‚ÙŠ", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø¬Ù…Ø¹ ÙƒÙ„Ù…Ø© 'Ø§Ù…Ø±Ø£Ø©'ØŸ", a: "Ù†Ø³Ø§Ø¡", level: "Ø³Ù‡Ù„" },
                        { q: "Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ù„Ù Ø±ÙˆØ§ÙŠØ© 'Ø§Ù„Ø£Ø³ÙˆØ¯ ÙŠÙ„ÙŠÙ‚ Ø¨Ùƒ'ØŸ", a: "Ø£Ø­Ù„Ø§Ù… Ù…Ø³ØªØºØ§Ù†Ù…ÙŠ", level: "ØµØ¹Ø¨" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ù…Ø±Ø§Ø¯Ù ÙƒÙ„Ù…Ø© 'Ø§Ù„Ø´ÙÙ‚'ØŸ", a: "Ø§Ù„Ù…ØºØ±Ø¨ Ø£Ùˆ Ø§Ù„ØºØ±ÙˆØ¨", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ù† Ù‡Ùˆ ØµØ§Ø­Ø¨ Ù…Ø¹Ù„Ù‚Ø© 'Ø¹Ù„Ù‚Ù‡Ø§ Ø¨Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ¹Ø¨Ø©'ØŸ", a: "Ù„Ø¨ÙŠØ¯ Ø¨Ù† Ø±Ø¨ÙŠØ¹Ø©", level: "ØµØ¹Ø¨" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø¶Ø¯ ÙƒÙ„Ù…Ø© 'Ø§Ù„Ø´Ø¬Ø§Ø¹Ø©'ØŸ", a: "Ø§Ù„Ø¬Ø¨Ù†", level: "Ø³Ù‡Ù„" },
                        { q: "Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØª: 'Ø¥Ø°Ø§ Ø§Ù„Ù…Ø±Ø¡ Ù„Ù… ÙŠØ¯Ù†Ø³ Ù…Ù† Ø§Ù„Ù„Ø¤Ù… Ø¹Ø±Ø¶Ù‡...'", a: "ÙÙƒÙ„ Ø±Ø¯Ø§Ø¡ ÙŠØ±ØªØ¯ÙŠÙ‡ Ø¬Ù…ÙŠÙ„", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¹Ù„ Ù…Ù† Ø§Ù„ÙØ¹Ù„ 'Ø§Ø³ØªØ®Ø±Ø¬'ØŸ", a: "Ù…Ø³ØªØ®Ø±ÙØ¬", level: "Ù…ØªÙˆØ³Ø·" },
                        { q: "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø´Ø§Ø¹Ø± ØµØ§Ø­Ø¨ Ø¯ÙŠÙˆØ§Ù† 'Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„ÙˆØ±Ø¯'ØŸ", a: "Ø¥ÙŠÙ„ÙŠØ§ Ø£Ø¨Ùˆ Ù…Ø§Ø¶ÙŠ", level: "ØµØ¹Ø¨" },
                        { q: "Ù…Ø§ Ù‡Ùˆ Ù…Ø¹Ù†Ù‰ ÙƒÙ„Ù…Ø© 'Ø§Ù„Ù…Ù†Ø§Ø±Ø©'ØŸ", a: "Ø§Ù„Ø¨Ø±Ø¬ Ø§Ù„Ù…Ø¶ÙŠØ¡", level: "Ø³Ù‡Ù„" }
                    ]
                };

                updateStats();
                updateQuestionsPreview();
                showStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ 30 Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† Ù…Ù†Ø§Ù‡Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© ÙˆÙ†Ø§ÙØ³!', 'success');
                showLoading(false);
            }, 1500);
        }

        function clearQuestions() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŸ')) {
                questionBank = {
                    Ø±ÙŠØ§Ø¶ÙŠØ§Øª: [],
                    Ø¹Ù„ÙˆÙ…: [],
                    Ù‚Ø±Ø§Ø¡Ø©: []
                };
                updateStats();
                updateQuestionsPreview();
                showStatus('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.', 'info');
            }
        }

        function updateStats() {
            const mathCount = questionBank.Ø±ÙŠØ§Ø¶ÙŠØ§Øª.length;
            const scienceCount = questionBank.Ø¹Ù„ÙˆÙ….length;
            const readingCount = questionBank.Ù‚Ø±Ø§Ø¡Ø©.length;
            const totalCount = mathCount + scienceCount + readingCount;

            document.getElementById('totalQuestions').textContent = totalCount;
            document.getElementById('mathQuestions').textContent = mathCount;
            document.getElementById('scienceQuestions').textContent = scienceCount;
            document.getElementById('readingQuestions').textContent = readingCount;
            document.getElementById('validQuestions').textContent = totalCount;
            document.getElementById('invalidQuestions').textContent = '0';
        }

        function updateQuestionsPreview() {
            const preview = document.getElementById('questionsPreview');
            
            if (!hasQuestions()) {
                preview.innerHTML = `
                    <p style="text-align: center; color: #7f8c8d; padding: 20px;">
                        Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯. Ù‚Ù… Ø¨Ø±ÙØ¹ Ù…Ù„Ù Excel Ø£Ùˆ CSV Ø£Ùˆ Ø­Ù…Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©.
                    </p>
                `;
                return;
            }

            let html = '';
            
            Object.keys(questionBank).forEach(subject => {
                if (questionBank[subject].length > 0) {
                    html += `<h4 style="color: #2c3e50; margin: 20px 0 10px 0; border-bottom: 2px solid #3498db; padding-bottom: 5px;">ğŸ“š ${subject} (${questionBank[subject].length} Ø£Ø³Ø¦Ù„Ø©)</h4>`;
                    
                    questionBank[subject].slice(0, 5).forEach(question => {
                        html += `
                            <div class="question-item">
                                <div class="question-subject">${subject}</div>
                                <div class="question-text">${question.q}</div>
                                <div class="question-answer">âœ“ ${question.a}</div>
                            </div>
                        `;
                    });
                    
                    if (questionBank[subject].length > 5) {
                        html += `<p style="text-align: center; color: #7f8c8d; margin: 10px 0;">... Ùˆ ${questionBank[subject].length - 5} Ø£Ø³Ø¦Ù„Ø© Ø£Ø®Ø±Ù‰</p>`;
                    }
                }
            });

            preview.innerHTML = html;
        }

        function hasQuestions() {
            return Object.values(questionBank).some(questions => questions.length > 0);
        }

        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = show ? 'block' : 'none';
        }

        function updateProgress(percent) {
            const fill = document.getElementById('progressFill');
            fill.style.width = percent + '%';
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status-message status-${type}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';

            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        function downloadTemplate() {
            const csvContent = `Ø§Ù„Ù…Ø§Ø¯Ø©,Ø§Ù„Ø³Ø¤Ø§Ù„,Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©,Ø§Ù„Ù…Ø³ØªÙˆÙ‰
Ø±ÙŠØ§Ø¶ÙŠØ§Øª,Ù…Ø§ Ù‡Ùˆ Ù†Ø§ØªØ¬ 5 + 7ØŸ,12,Ø³Ù‡Ù„
Ø¹Ù„ÙˆÙ…,Ù…Ø§ Ù‡Ùˆ Ø±Ù…Ø² Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†ØŸ,O2,Ù…ØªÙˆØ³Ø·
Ù‚Ø±Ø§Ø¡Ø©,Ù…Ø§ Ù‡Ùˆ Ø¬Ù…Ø¹ ÙƒÙ„Ù…Ø© ÙƒØªØ§Ø¨ØŸ,ÙƒØªØ¨,Ø³Ù‡Ù„
Ø±ÙŠØ§Ø¶ÙŠØ§Øª,ÙƒÙ… ÙŠØ³Ø§ÙˆÙŠ Ù…Ø­ÙŠØ· Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø°ÙŠ Ø¶Ù„Ø¹Ù‡ 4 Ø³Ù…ØŸ,16 Ø³Ù…,Ù…ØªÙˆØ³Ø·
Ø¹Ù„ÙˆÙ…,ÙÙŠ Ø£ÙŠ Ø·Ø¨Ù‚Ø© Ù…Ù† Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø¬ÙˆÙŠ Ù†Ø¹ÙŠØ´ØŸ,Ø§Ù„ØªØ±ÙˆØ¨ÙˆØ³ÙÙŠØ±,ØµØ¹Ø¨`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'Ù‚Ø§Ù„Ø¨_Ø£Ø³Ø¦Ù„Ø©_Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            showStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©!', 'success');
        }

        function exportQuestions() {
            if (!hasQuestions()) {
                showStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„ØªØµØ¯ÙŠØ±!', 'error');
                return;
            }

            let csvContent = 'Ø§Ù„Ù…Ø§Ø¯Ø©,Ø§Ù„Ø³Ø¤Ø§Ù„,Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©,Ø§Ù„Ù…Ø³ØªÙˆÙ‰\n';
            
            Object.keys(questionBank).forEach(subject => {
                questionBank[subject].forEach(question => {
                    csvContent += `${subject},"${question.q}","${question.a}",${question.level || 'Ù…ØªÙˆØ³Ø·'}\n`;
                });
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `Ø¨Ù†Ùƒ_Ø§Ù„Ø£Ø³Ø¦Ù„Ø©_${new Date().toLocaleDateString('ar-SA')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            showStatus('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        function startGame() {
            if (!hasQuestions()) {
                showStatus('ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!', 'error');
                return;
            }

            // Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ localStorage Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            localStorage.setItem('competitionQuestions', JSON.stringify(questionBank));
            
            showStatus('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©! Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©...', 'success');
            
            setTimeout(() => {
                // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                const gameWindow = window.open('', '_blank');
                
                // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ ØµÙØ­Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø¥Ù„ÙŠÙ‡Ø§
                gameWindow.document.write(`
                    <html>
                        <head>
                            <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ©</title>
                            <style>
                                body {
                                    font-family: Arial, sans-serif;
                                    text-align: center;
                                    padding: 50px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                }
                                .message {
                                    background: rgba(255,255,255,0.1);
                                    padding: 30px;
                                    border-radius: 15px;
                                    margin: 20px auto;
                                    max-width: 600px;
                                }
                                .btn {
                                    background: #3498db;
                                    color: white;
                                    padding: 15px 30px;
                                    border: none;
                                    border-radius: 25px;
                                    font-size: 18px;
                                    cursor: pointer;
                                    margin: 10px;
                                }
                            </style>
                        </head>
                        <body>
                            <h1>ğŸ¯ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ©</h1>
                            <div class="message">
                                <h2>ØªÙ… ØªØ­Ù…ÙŠÙ„ ${Object.values(questionBank).reduce((total, questions) => total + questions.length, 0)} Ø³Ø¤Ø§Ù„!</h2>
                                <p>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</p>
                                <button class="btn" onclick="window.close()">Ø¥ØºÙ„Ø§Ù‚</button>
                            </div>
                        </body>
                    </html>
                `);
            }, 1000);
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
        window.addEventListener('error', function(e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', e.error);
            showStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        window.addEventListener('load', function() {
            const savedQuestions = localStorage.getItem('competitionQuestions');
            if (savedQuestions) {
                try {
                    const parsedQuestions = JSON.parse(savedQuestions);
                    if (parsedQuestions && typeof parsedQuestions === 'object') {
                        questionBank = parsedQuestions;
                        updateStats();
                        updateQuestionsPreview();
                        showStatus('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹.', 'info');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:', error);
                }
            }
        });
    </script>
</body>
</html>
