<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            padding: 15px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a5568;
        }

        .header h1 {
            color: #2d3748;
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .alert {
            background: #fff5f5;
            border-right: 4px solid #fc8181;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 5px;
            color: #742a2a;
            font-weight: bold;
        }

        .alert.success {
            background: #f0fff4;
            border-right-color: #68d391;
            color: #22543d;
        }

        .alert.warning {
            background: #fffaf0;
            border-right-color: #f6ad55;
            color: #7c2d12;
        }

        .alert.info {
            background: #ebf8ff;
            border-right-color: #63b3ed;
            color: #2c5282;
        }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¯Ù…Ø¬ */
        .waiting-management {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid #eee;
        }

        .waiting-stats {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .equity-indicator {
            font-weight: bold;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 1.1em;
        }

        .equity-green { background: #e8f5e9; color: #2e7d32; border: 1px solid #2e7d32; }
        .equity-yellow { background: #fff3e0; color: #ef6c00; border: 1px solid #ef6c00; }
        .equity-red { background: #ffebee; color: #c62828; border: 1px solid #c62828; }

        .progress-container {
            width: 100%;
            background-color: #eee;
            border-radius: 10px;
            height: 12px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-bar { height: 100%; transition: width 0.4s ease; }
        .status-low { background-color: #27ae60; }
        .status-mid { background-color: #f39c12; }
        .status-high { background-color: #e74c3c; }

        .waiting-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #fff;
            border: 1px dashed #ccc;
            border-radius: 8px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #4a5568;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border: 2px solid #cbd5e0;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
            background: white;
            min-height: 42px;
            cursor: pointer;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4299e1;
        }

        .schedule-wrapper {
            overflow-x: auto;
            margin-top: 20px;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            min-width: 1200px;
        }

        .schedule-table th,
        .schedule-table td {
            border: 1px solid #cbd5e0;
            padding: 6px 4px;
            text-align: center;
        }

        .schedule-table th {
            background: #2d3748;
            color: white;
            font-weight: bold;
            padding: 10px 5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .teacher-name {
            background: #edf2f7;
            font-weight: bold;
            text-align: right;
            padding-right: 10px !important;
            width: 140px;
            min-width: 140px;
            position: sticky;
            right: 0;
            z-index: 5;
        }

        .class-count {
            background: #e6fffa;
            font-weight: bold;
            text-align: center;
            color: #234e52;
            font-size: 13px;
            width: 60px;
            min-width: 60px;
        }

        .period-header {
            background: #4299e1 !important;
            font-size: 10px;
        }

        .row-even {
            background-color: #f7fafc;
        }

        .row-odd {
            background-color: #ffffff;
        }

        .day-border {
            border-right: 4px solid #2d3748 !important;
        }

        .day-sun { background-color: #fef5e7; }
        .day-mon { background-color: #ebf8ff; }
        .day-tue { background-color: #f0fff4; }
        .day-wed { background-color: #fef5ff; }
        .day-thu { background-color: #fff5f5; }

        .conflict {
            background-color: #fed7d7 !important;
            border: 2px solid #fc8181 !important;
        }

        .lab-conflict {
            background-color: #fed7aa !important;
            border: 2px solid #f97316 !important;
            animation: pulse-orange 1.5s infinite;
        }

        @keyframes pulse-orange {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 8px rgba(249, 115, 22, 0);
            }
        }

        select {
            width: 100%;
            border: 1px solid #cbd5e0;
            background: white;
            text-align: center;
            font-size: 11px;
            padding: 4px 2px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            color: #2d3748;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        select:focus {
            outline: 2px solid #4299e1;
            background: #fff;
        }

        .dummy-cell {
            background: repeating-linear-gradient(
                45deg,
                #fed7d7,
                #fed7d7 10px,
                #feebc8 10px,
                #feebc8 20px
            ) !important;
            font-weight: bold;
            color: #742a2a;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
        }

        .waiting-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .waiting-table th,
        .waiting-table td {
            border: 1px solid #cbd5e0;
            padding: 12px;
            text-align: center;
        }

        .waiting-table th {
            background: #4a5568;
            color: white;
            font-weight: bold;
        }

        .waiting-table tr:nth-child(even) {
            background: #f7fafc;
        }

        .waiting-assigned {
            background: #c6f6d5 !important;
            font-weight: bold;
        }

        .waiting-unassigned {
            background: #fed7d7 !important;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 3px solid #e2e8f0;
        }

        .tab {
            padding: 12px 30px;
            background: #edf2f7;
            border: none;
            border-radius: 8px 8px 0 0;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }

        .tab:hover {
            background: #e2e8f0;
        }

        .tab.active {
            background: #4299e1;
            color: white;
            transform: translateY(3px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 8px;
            display: none;
            z-index: 9999;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-weight: bold;
        }

        @media print {
            body {
                background: white;
                padding: 5px;
            }

            .container {
                box-shadow: none;
                padding: 5px;
            }

            .buttons, .alert, .tabs, .waiting-management {
                display: none;
            }

            .schedule-table {
                font-size: 8px;
                min-width: 100%;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 3px 2px;
            }

            .teacher-name {
                width: 100px;
                min-width: 100px;
            }

            .header h1 {
                font-size: 1.3em;
            }

            @page {
                size: A4 landscape;
                margin: 10mm;
            }
        }
    </style>
</head>
<body>
    <div id="alert" class="alert-box"></div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“š Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h1>
            <p style="color: #718096; margin-top: 5px;">Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 1447 Ù‡Ù€ - Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</p>
        </div>

        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¯Ù…Ø¬ -->
        <div class="waiting-management">
            <h2>ğŸ“‹ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± - Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©</h2>
            
            <div class="waiting-stats">
                <div>Ù…Ø¤Ø´Ø± Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…: <span id="equityLabel" class="equity-indicator">--</span></div>
                <div>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ: <b id="avgConsumption">0%</b></div>
                <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©: <b id="totalClasses">0</b></div>
                <div>Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø³Ù†Ø¯Ø©: <b id="totalWaiting">0</b></div>
            </div>

            <div class="waiting-form">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label>
                    <input type="text" id="teacherName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù†ØµØ§Ø¨ (Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ)</label>
                    <input type="number" id="teacherLoad" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±</label>
                    <input type="number" id="maxWaiting" placeholder="ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" readonly>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="addTeacherToSchedule()">Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-warning" onclick="autoAssignWaiting()">âš¡ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</button>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† -->
            <div id="teachersTable"></div>
        </div>

        <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('main')">ğŸ“‹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
            <button class="tab" onclick="switchTab('teacher')">ğŸ‘¨â€ğŸ« Ø¬Ø¯ÙˆÙ„ Ù…Ø¹Ù„Ù…</button>
            <button class="tab" onclick="switchTab('class')">ğŸ“š Ø¬Ø¯ÙˆÙ„ ÙØµÙ„</button>
            <button class="tab" onclick="switchTab('manage')">ğŸ”§ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div id="mainTab" class="tab-content active">
            <div id="alertBox"></div>

            <div class="schedule-wrapper">
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th rowspan="2" style="background: #1a202c;">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                            <th rowspan="2" style="background: #2c7a7b; width: 60px;">Ø¹Ø¯Ø¯<br>Ø§Ù„Ø­ØµØµ</th>
                            <th colspan="7" style="background: #d69e2e;">Ø§Ù„Ø£Ø­Ø¯</th>
                            <th colspan="7" style="background: #3182ce;" class="day-border">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</th>
                            <th colspan="7" style="background: #38a169;" class="day-border">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</th>
                            <th colspan="7" style="background: #805ad5;" class="day-border">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</th>
                            <th colspan="7" style="background: #e53e3e;" class="day-border">Ø§Ù„Ø®Ù…ÙŠØ³</th>
                        </tr>
                        <tr id="periodHeaders"></tr>
                    </thead>
                    <tbody id="scheduleBody"></tbody>
                </table>
            </div>

            <div class="buttons">
                <button class="btn btn-success" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button class="btn btn-primary" onclick="exportSchedule()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                <button class="btn btn-warning">
                    ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    <input type="file" id="importFile" accept=".json" onchange="importSchedule(event)" style="display: none;">
                </button>
                <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                <button class="btn btn-danger" onclick="clearSchedule()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… -->
        <div id="teacherTab" class="tab-content">
            <div class="form-group">
                <label>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù… Ù„Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„Ù‡:</label>
                <select id="teacherSelect" onchange="showTeacherSchedule()">
                    <option value="">-- Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù… --</option>
                </select>
            </div>
            <div id="teacherScheduleView"></div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØµÙ„ -->
        <div id="classTab" class="tab-content">
            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label>Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
                    <select id="gradeSelect" onchange="updateClassList()">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>
                        <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option>
                        <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option>
                        <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„:</label>
                    <select id="classNumberSelect" onchange="showClassSchedule()">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„ --</option>
                    </select>
                </div>
            </div>
            <div id="classScheduleView"></div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
        <div id="manageTab" class="tab-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="form-group">
                    <h3>ğŸ—‘ï¸ Ù…Ø³Ø­ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
                    <p>Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                    <button class="btn btn-warning" onclick="clearWaitingClasses()">Ù…Ø³Ø­ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
                </div>
                <div class="form-group">
                    <h3>ğŸš« Ù…Ø³Ø­ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©</h3>
                    <p>Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
                    <button class="btn btn-danger" onclick="clearDummyClasses()">Ù…Ø³Ø­ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©</button>
                </div>
                <div class="form-group">
                    <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„</h3>
                    <p>Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                    <button class="btn btn-primary" onclick="showScheduleStats()">Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                </div>
                <div class="form-group">
                    <h3>ğŸ’» Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨</h3>
                    <p>ÙƒØ´Ù ØªØ¹Ø§Ø±Ø¶ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                    <input type="text" id="labTeacher1" placeholder="Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„" style="margin-bottom: 10px;">
                    <input type="text" id="labTeacher2" placeholder="Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ">
                </div>
            </div>
            <div id="statsResult" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let teachers = [];
        let schedule = {};
        let teacherLoad = {};
        const days = ['sun', 'mon', 'tue', 'wed', 'thu'];
        const dayNames = {
            'sun': 'Ø§Ù„Ø£Ø­Ø¯',
            'mon': 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†',
            'tue': 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡',
            'wed': 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡',
            'thu': 'Ø§Ù„Ø®Ù…ÙŠØ³'
        };

        const classOptions = [
            { value: '', label: '---', group: '' },
            { value: '1-1', label: '1-1', group: 'first' },
            { value: '1-2', label: '1-2', group: 'first' },
            { value: '1-3', label: '1-3', group: 'first' },
            { value: '1-4', label: '1-4', group: 'first' },
            { value: '1-5', label: '1-5', group: 'first' },
            { value: '1-6', label: '1-6', group: 'first' },
            { value: '2-1', label: '2-1', group: 'second' },
            { value: '2-2', label: '2-2', group: 'second' },
            { value: '2-3', label: '2-3', group: 'second' },
            { value: '2-4', label: '2-4', group: 'second' },
            { value: '2-5', label: '2-5', group: 'second' },
            { value: '2-6', label: '2-6', group: 'second' },
            { value: '3-1', label: '3-1', group: 'third' },
            { value: '3-2', label: '3-2', group: 'third' },
            { value: '3-3', label: '3-3', group: 'third' },
            { value: '3-4', label: '3-4', group: 'third' },
            { value: '3-5', label: '3-5', group: 'third' },
            { value: '3-6', label: '3-6', group: 'third' },
            { value: 'Ø§Ù†ØªØ¸Ø§Ø±1', label: 'Ø§Ù†ØªØ¸Ø§Ø±1', group: 'waiting' },
            { value: 'Ø§Ù†ØªØ¸Ø§Ø±2', label: 'Ø§Ù†ØªØ¸Ø§Ø±2', group: 'waiting' },
            { value: 'Ø§Ù†ØªØ¸Ø§Ø±3', label: 'Ø§Ù†ØªØ¸Ø§Ø±3', group: 'waiting' },
            { value: 'Ø§Ù†ØªØ¸Ø§Ø±4', label: 'Ø§Ù†ØªØ¸Ø§Ø±4', group: 'waiting' },
            { value: 'Ø§Ù†ØªØ¸Ø§Ø±5', label: 'Ø§Ù†ØªØ¸Ø§Ø±5', group: 'waiting' },
            { value: 'ÙˆÙ‡Ù…ÙŠ', label: 'ğŸš« ÙˆÙ‡Ù…ÙŠ (Ù…Ù…Ù†ÙˆØ¹)', group: 'dummy' }
        ];

        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±
        function getAutoLimit(n) {
            if (n >= 24) return 0;
            if (n >= 20) return 0;
            if (n >= 18) return 2;
            if (n >= 16) return 4;
            if (n >= 15) return 5;
            if (n <= 10) return 10;
            if (n < 15) return 8;
            return 0;
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        function showAlert(msg, type = 'danger') {
            const alertBox = document.getElementById('alertBox');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'}`;
            alertDiv.innerHTML = msg;
            alertBox.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 5000);
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù… Ø¬Ø¯ÙŠØ¯
        function addTeacherToSchedule() {
            const name = document.getElementById('teacherName').value.trim();
            const lessons = parseInt(document.getElementById('teacherLoad').value);
            
            if (!name || isNaN(lessons)) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }

            const maxWaiting = getAutoLimit(lessons);
            
            teachers.push({
                id: 'T' + Date.now(),
                name: name,
                lessons: lessons,
                maxWaiting: maxWaiting,
                assignedWaiting: 0
            });

            teacherLoad[name] = lessons;
            
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherLoad').value = '';
            document.getElementById('maxWaiting').value = '';
            
            updateTeachersTable();
            updateScheduleTable();
            showAlert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ù„Ù… ${name} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        document.getElementById('teacherLoad').addEventListener('input', function() {
            const lessons = parseInt(this.value);
            if (!isNaN(lessons)) {
                document.getElementById('maxWaiting').value = getAutoLimit(lessons);
            }
        });

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
        function updateTeachersTable() {
            let html = `
                <table class="waiting-table">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                            <th>Ø§Ù„Ù†ØµØ§Ø¨</th>
                            <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±</th>
                            <th>Ø§Ù„Ù…Ø³Ù†Ø¯ (ÙØ¹Ù„ÙŠ)</th>
                            <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø§Ù„Ø±ØµÙŠØ¯)</th>
                            <th style="width: 25%;">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            teachers.forEach(teacher => {
                const ratio = teacher.maxWaiting > 0 ? (teacher.assignedWaiting / teacher.maxWaiting) * 100 : 0;
                const barColor = ratio <= 40 ? 'status-low' : (ratio <= 70 ? 'status-mid' : 'status-high');
                const remaining = teacher.maxWaiting - teacher.assignedWaiting;
                
                html += `
                    <tr>
                        <td><b>${teacher.name}</b></td>
                        <td>${teacher.lessons}</td>
                        <td>${teacher.maxWaiting}</td>
                        <td>${teacher.assignedWaiting}</td>
                        <td style="color:${remaining <= 1 ? 'red' : 'green'}; font-weight:bold">${remaining}</td>
                        <td>
                            <small>${ratio.toFixed(1)}%</small>
                            <div class="progress-container">
                                <div class="progress-bar ${barColor}" style="width:${Math.min(ratio, 100)}%"></div>
                            </div>
                        </td>
                        <td>
                            <button class="btn btn-danger" onclick="removeTeacher('${teacher.id}')" style="padding: 5px 10px; font-size: 12px;">Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('teachersTable').innerHTML = html;
            updateEquityIndicator();
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù…Ø¹Ù„Ù…
        function removeTeacher(teacherId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…ØŸ')) return;
            
            teachers = teachers.filter(t => t.id !== teacherId);
            updateTeachersTable();
            updateScheduleTable();
            showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©
        function updateEquityIndicator() {
            const activeTeachers = teachers.filter(t => t.maxWaiting > 0);
            if (activeTeachers.length === 0) return;

            const ratios = activeTeachers.map(t => (t.assignedWaiting / t.maxWaiting) * 100);
            const avg = ratios.reduce((a, b) => a + b, 0) / ratios.length;
            const diff = Math.max(...ratios) - Math.min(...ratios);

            const lbl = document.getElementById('equityLabel');
            const avgConsumption = document.getElementById('avgConsumption');
            
            avgConsumption.textContent = avg.toFixed(1) + '%';

            if (diff <= 15) {
                lbl.textContent = 'ğŸŸ¢ Ø¹Ø§Ø¯Ù„ Ø¬Ø¯Ø§Ù‹';
                lbl.className = 'equity-indicator equity-green';
            } else if (diff <= 30) {
                lbl.textContent = 'ğŸŸ¡ Ù…Ù‚Ø¨ÙˆÙ„';
                lbl.className = 'equity-indicator equity-yellow';
            } else {
                lbl.textContent = 'ğŸ”´ ØºÙŠØ± Ø¹Ø§Ø¯Ù„';
                lbl.className = 'equity-indicator equity-red';
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ
        function createScheduleTable() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø­ØµØµ
            let periodHeaders = '';
            days.forEach(day => {
                for (let period = 1; period <= 7; period++) {
                    periodHeaders += `<th class="period-header ${period === 1 && day !== 'sun' ? 'day-border' : ''}">${period}</th>`;
                }
            });
            document.getElementById('periodHeaders').innerHTML = periodHeaders;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø³Ù…
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const row = document.createElement('tr');
                row.className = i % 2 === 0 ? 'row-even' : 'row-odd';

                // Ø®Ù„ÙŠØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…
                const nameCell = document.createElement('td');
                nameCell.className = 'teacher-name';
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'form-group input';
                nameInput.placeholder = `Ù…Ø¹Ù„Ù… ${i + 1}`;
                nameInput.id = `teacher_${i}`;
                nameInput.addEventListener('change', () => {
                    saveData();
                    updateTeachersTable();
                });
                nameCell.appendChild(nameInput);
                row.appendChild(nameCell);

                // Ø®Ù„ÙŠØ© Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ
                const countCell = document.createElement('td');
                countCell.className = 'class-count';
                countCell.id = `count_${i}`;
                countCell.textContent = '0';
                row.appendChild(countCell);

                // Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø­ØµØµ
                days.forEach((day, dayIndex) => {
                    for (let period = 1; period <= 7; period++) {
                        const cell = document.createElement('td');
                        cell.className = `day-${day}`;
                        
                        if (period === 1 && dayIndex > 0) {
                            cell.classList.add('day-border');
                        }

                        const select = document.createElement('select');
                        select.id = `cell_${i}_${day}_${period}`;
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                        let currentGroup = '';
                        classOptions.forEach(option => {
                            if (option.group && option.group !== currentGroup) {
                                if (currentGroup !== '') {
                                    const separator = document.createElement('option');
                                    separator.disabled = true;
                                    separator.textContent = 'â”€â”€â”€â”€â”€â”€â”€';
                                    select.appendChild(separator);
                                }
                                
                                const groupHeader = document.createElement('option');
                                groupHeader.disabled = true;
                                groupHeader.style.fontWeight = 'bold';
                                groupHeader.style.background = '#edf2f7';
                                if (option.group === 'first') groupHeader.textContent = 'â–¼ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„';
                                else if (option.group === 'second') groupHeader.textContent = 'â–¼ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ';
                                else if (option.group === 'third') groupHeader.textContent = 'â–¼ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«';
                                else if (option.group === 'waiting') groupHeader.textContent = 'â–¼ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                                else if (option.group === 'dummy') groupHeader.textContent = 'â–¼ Ø­ØµØµ Ø®Ø§ØµØ©';
                                select.appendChild(groupHeader);
                                
                                currentGroup = option.group;
                            }
                            
                            const opt = document.createElement('option');
                            opt.value = option.value;
                            opt.textContent = option.label;
                            if (option.group) {
                                opt.style.paddingRight = '15px';
                            }
                            select.appendChild(opt);
                        });

                        select.addEventListener('change', () => {
                            if (select.value === 'ÙˆÙ‡Ù…ÙŠ') {
                                cell.classList.add('dummy-cell');
                            } else {
                                cell.classList.remove('dummy-cell');
                            }
                            
                            updateClassCounts();
                            checkConflicts();
                            saveData();
                        });
                        
                        cell.appendChild(select);
                        row.appendChild(cell);
                    }
                });

                tbody.appendChild(row);
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­ØµØµ
        function updateClassCounts() {
            let totalClasses = 0;
            let totalWaiting = 0;

            for (let i = 0; i < 42; i++) {
                let classCount = 0;
                let waitingCount = 0;
                
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value) {
                            if (select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±')) {
                                waitingCount++;
                            } else if (select.value !== 'ÙˆÙ‡Ù…ÙŠ') {
                                classCount++;
                            }
                        }
                    }
                });
                
                const countCell = document.getElementById(`count_${i}`);
                if (countCell) {
                    countCell.textContent = classCount;
                    
                    // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙŠØ© Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ
                    if (classCount === 0) {
                        countCell.style.background = '#fed7d7';
                        countCell.style.color = '#742a2a';
                    } else if (classCount < 10) {
                        countCell.style.background = '#fefcbf';
                        countCell.style.color = '#744210';
                    } else {
                        countCell.style.background = '#c6f6d5';
                        countCell.style.color = '#22543d';
                    }
                }

                // ØªØ­Ø¯ÙŠØ« Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù…Ø¹Ù„Ù…
                const teacherName = document.getElementById(`teacher_${i}`).value;
                const teacher = teachers.find(t => t.name === teacherName);
                if (teacher) {
                    teacher.assignedWaiting = waitingCount;
                }

                totalClasses += classCount;
                totalWaiting += waitingCount;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            document.getElementById('totalClasses').textContent = totalClasses;
            document.getElementById('totalWaiting').textContent = totalWaiting;

            updateTeachersTable();
        }

        // Ø¯Ø§Ù„Ø© ÙØ­Øµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª
        function checkConflicts() {
            const conflicts = [];
            const labConflicts = [];
            const schedule = {};

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø­Ø§Ø³Ø¨
            const labTeacher1Name = document.getElementById('labTeacher1')?.value.trim() || 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù‚Ø±Ù†ÙŠ';
            const labTeacher2Name = document.getElementById('labTeacher2')?.value.trim() || 'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ';

            // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø±ÙŠØ·Ø© Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
            const teacherIndexMap = {};
            for (let i = 0; i < 42; i++) {
                const teacherInput = document.getElementById(`teacher_${i}`);
                if (teacherInput && teacherInput.value.trim()) {
                    teacherIndexMap[i] = teacherInput.value.trim();
                }
            }

            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¤Ø´Ø±Ø§Øª Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø­Ø§Ø³Ø¨
            const labTeacher1Index = Object.keys(teacherIndexMap).find(key => teacherIndexMap[key] === labTeacher1Name);
            const labTeacher2Index = Object.keys(teacherIndexMap).find(key => teacherIndexMap[key] === labTeacher2Name);

            // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©
            for (let i = 0; i < 42; i++) {
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value && !select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±') && select.value !== 'ÙˆÙ‡Ù…ÙŠ') {
                            const key = `${day}_${period}_${select.value}`;
                            if (!schedule[key]) {
                                schedule[key] = [];
                            }
                            schedule[key].push({ teacher: i, day, period, select });
                        }
                    }
                });
            }

            // ÙØ­Øµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            Object.keys(schedule).forEach(key => {
                if (schedule[key].length > 1) {
                    conflicts.push(...schedule[key]);
                }
            });

            // ÙØ­Øµ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨
            if (labTeacher1Index && labTeacher2Index) {
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const teacher1Select = document.getElementById(`cell_${labTeacher1Index}_${day}_${period}`);
                        const teacher2Select = document.getElementById(`cell_${labTeacher2Index}_${day}_${period}`);
                        
                        if (teacher1Select && teacher2Select && 
                            teacher1Select.value && teacher2Select.value &&
                            !teacher1Select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±') && 
                            !teacher2Select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±') &&
                            teacher1Select.value !== 'ÙˆÙ‡Ù…ÙŠ' &&
                            teacher2Select.value !== 'ÙˆÙ‡Ù…ÙŠ') {
                            
                            labConflicts.push({
                                teacher: labTeacher1Index,
                                day,
                                period,
                                select: teacher1Select
                            });
                            labConflicts.push({
                                teacher: labTeacher2Index,
                                day,
                                period,
                                select: teacher2Select
                            });
                        }
                    }
                });
            }

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø§Ø¨Ù‚
            document.querySelectorAll('.conflict').forEach(el => {
                el.classList.remove('conflict');
            });
            document.querySelectorAll('.lab-conflict').forEach(el => {
                el.classList.remove('lab-conflict');
            });

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…ØªØ¹Ø§Ø±Ø¶Ø©
            conflicts.forEach(item => {
                item.select.parentElement.classList.add('conflict');
            });

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù„Ù‰ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„
            labConflicts.forEach(item => {
                item.select.parentElement.classList.add('lab-conflict');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            if (labConflicts.length > 0) {
                const uniqueLabConflicts = new Set();
                labConflicts.forEach(c => {
                    uniqueLabConflicts.add(`${dayNames[c.day]} - Ø§Ù„Ø­ØµØ© ${c.period}`);
                });
                
                showAlert(`ğŸŸ  ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨: ÙŠÙˆØ¬Ø¯ ${labConflicts.length / 2} ØªØ¹Ø§Ø±Ø¶ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨!<br><strong>Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª:</strong> ${Array.from(uniqueLabConflicts).join(' | ')}<br><small>ğŸ’» ${labTeacher1Name} Ùˆ ${labTeacher2Name} Ù„Ø¯ÙŠÙ‡Ù…Ø§ Ø­ØµØµ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª</small>`, 'warning');
            }

            if (conflicts.length > 0) {
                showAlert(`âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: ÙŠÙˆØ¬Ø¯ ${conflicts.length / 2} ØªØ¹Ø§Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„! ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø¸Ù„Ù„Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±.`, 'warning');
            }

            return conflicts.length === 0 && labConflicts.length === 0;
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±
        function autoAssignWaiting() {
            if (!confirm('Ø³ÙŠØªÙ… ØªÙˆØ²ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠØ©.\nØ³ÙŠØªÙ… Ø¶Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø¥Ù„Ù‰ 20 Ø­ØµØ© Ø¨Ø§Ù„Ø¶Ø¨Ø·.\nØ§Ù„ØªÙˆØ²ÙŠØ¹ Ø³ÙŠØ±Ø§Ø¹ÙŠ Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) {
                return;
            }

            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ù„ÙƒÙ„ Ù…Ø¹Ù„Ù…
            const teacherClassCounts = {};
            for (let i = 0; i < 42; i++) {
                const teacherName = document.getElementById(`teacher_${i}`)?.value;
                if (!teacherName || !teacherName.trim()) continue;

                teacherClassCounts[i] = 0;
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value && !select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±') && select.value !== 'ÙˆÙ‡Ù…ÙŠ') {
                            teacherClassCounts[i]++;
                        }
                    }
                });
            }

            // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            for (let i = 0; i < 42; i++) {
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value && select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±')) {
                            select.value = '';
                        }
                    }
                });
            }

            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const teacherWaitingNeeded = {};
            for (let i = 0; i < 42; i++) {
                const teacherName = document.getElementById(`teacher_${i}`)?.value;
                if (!teacherName || !teacherName.trim()) continue;

                const classCount = teacherClassCounts[i] || 0;
                teacherWaitingNeeded[i] = Math.max(0, 20 - classCount);
            }

            // Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ
            const waitingTypes = ['Ø§Ù†ØªØ¸Ø§Ø±1', 'Ø§Ù†ØªØ¸Ø§Ø±2', 'Ø§Ù†ØªØ¸Ø§Ø±3', 'Ø§Ù†ØªØ¸Ø§Ø±4', 'Ø§Ù†ØªØ¸Ø§Ø±5'];
            let waitingIndex = 0;

            days.forEach(day => {
                for (let period = 1; period <= 7; period++) {
                    if (day === 'thu' && period === 7) continue;

                    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ†
                    const eligibleTeachers = [];
                    for (let i = 0; i < 42; i++) {
                        const teacherName = document.getElementById(`teacher_${i}`)?.value;
                        if (!teacherName || !teacherName.trim()) continue;

                        if (teacherWaitingNeeded[i] <= 0) continue;

                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (!select || select.value) continue;

                        eligibleTeachers.push({
                            index: i,
                            name: teacherName,
                            classCount: teacherClassCounts[i] || 0
                        });
                    }

                    // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ (Ø§Ù„Ø£Ù‚Ù„ Ø£ÙˆÙ„Ø§Ù‹)
                    eligibleTeachers.sort((a, b) => a.classCount - b.classCount);

                    // Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø­ØµØ©
                    for (const teacher of eligibleTeachers) {
                        const select = document.getElementById(`cell_${teacher.index}_${day}_${period}`);
                        if (select) {
                            select.value = waitingTypes[waitingIndex % 5];
                            teacherWaitingNeeded[teacher.index]--;
                            waitingIndex++;
                            break;
                        }
                    }
                }
            });

            updateClassCounts();
            checkConflicts();
            showAlert('âœ… ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            if (tabName === 'main') {
                document.getElementById('mainTab').classList.add('active');
                document.querySelectorAll('.tab')[0].classList.add('active');
            } else if (tabName === 'teacher') {
                document.getElementById('teacherTab').classList.add('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
                updateTeacherSelect();
            } else if (tabName === 'class') {
                document.getElementById('classTab').classList.add('active');
                document.querySelectorAll('.tab')[2].classList.add('active');
            } else if (tabName === 'manage') {
                document.getElementById('manageTab').classList.add('active');
                document.querySelectorAll('.tab')[3].classList.add('active');
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø­ÙØ¸ ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function saveData() {
            const data = {
                teachers: teachers,
                schedule: {},
                lastUpdate: new Date().toISOString()
            };

            // Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            for (let i = 0; i < 42; i++) {
                const teacherName = document.getElementById(`teacher_${i}`).value;
                if (teacherName) {
                    data.schedule[`teacher_${i}`] = teacherName;
                }
                
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select) {
                            data.schedule[`cell_${i}_${day}_${period}`] = select.value;
                        }
                    }
                });
            }

            localStorage.setItem('schoolSchedule', JSON.stringify(data));
            return data;
        }

        function loadData() {
            const saved = localStorage.getItem('schoolSchedule');
            if (saved) {
                const data = JSON.parse(saved);
                teachers = data.teachers || [];
                
                // ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
                for (let i = 0; i < 42; i++) {
                    const teacherName = data.schedule?.[`teacher_${i}`];
                    if (teacherName) {
                        document.getElementById(`teacher_${i}`).value = teacherName;
                    }
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    days.forEach(day => {
                        for (let period = 1; period <= 7; period++) {
                            const value = data.schedule?.[`cell_${i}_${day}_${period}`];
                            if (value) {
                                const select = document.getElementById(`cell_${i}_${day}_${period}`);
                                if (select) {
                                    select.value = value;
                                    if (value === 'ÙˆÙ‡Ù…ÙŠ') {
                                        select.parentElement.classList.add('dummy-cell');
                                    }
                                }
                            }
                        }
                    });
                }
                
                updateTeachersTable();
                updateClassCounts();
                checkConflicts();
            }
        }

        function exportSchedule() {
            const data = saveData();
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ø¬Ø¯ÙˆÙ„_Ù…Ø¯Ø±Ø³ÙŠ_ÙƒØ§Ù…Ù„_${new Date().toLocaleDateString('ar-SA').replace(/\//g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        function importSchedule(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ')) {
                        teachers = data.teachers || [];
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        for (let i = 0; i < 42; i++) {
                            const teacherName = data.schedule?.[`teacher_${i}`];
                            if (teacherName) {
                                document.getElementById(`teacher_${i}`).value = teacherName;
                            } else {
                                document.getElementById(`teacher_${i}`).value = '';
                            }
                            
                            days.forEach(day => {
                                for (let period = 1; period <= 7; period++) {
                                    const value = data.schedule?.[`cell_${i}_${day}_${period}`];
                                    const select = document.getElementById(`cell_${i}_${day}_${period}`);
                                    if (select) {
                                        select.value = value || '';
                                        if (value === 'ÙˆÙ‡Ù…ÙŠ') {
                                            select.parentElement.classList.add('dummy-cell');
                                        } else {
                                            select.parentElement.classList.remove('dummy-cell');
                                        }
                                    }
                                }
                            });
                        }
                        
                        updateTeachersTable();
                        updateClassCounts();
                        checkConflicts();
                        showAlert('âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    }
                } catch (error) {
                    showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù!', 'danger');
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearSchedule() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
                localStorage.removeItem('schoolSchedule');
                location.reload();
            }
        }

        function clearWaitingClasses() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŸ')) return;

            let removedCount = 0;
            for (let i = 0; i < 42; i++) {
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value && select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±')) {
                            select.value = '';
                            removedCount++;
                        }
                    }
                });
            }

            updateClassCounts();
            showAlert(`âœ… ØªÙ… Ù…Ø³Ø­ ${removedCount} Ø­ØµØ© Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        }

        function clearDummyClasses() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŸ')) return;

            let removedCount = 0;
            for (let i = 0; i < 42; i++) {
                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value === 'ÙˆÙ‡Ù…ÙŠ') {
                            select.value = '';
                            select.parentElement.classList.remove('dummy-cell');
                            removedCount++;
                        }
                    }
                });
            }

            updateClassCounts();
            showAlert(`âœ… ØªÙ… Ù…Ø³Ø­ ${removedCount} Ø­ØµØ© ÙˆÙ‡Ù…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        }

        function showScheduleStats() {
            let totalTeachers = 0;
            let totalClasses = 0;
            let totalWaiting = 0;
            let totalDummy = 0;

            for (let i = 0; i < 42; i++) {
                const teacherName = document.getElementById(`teacher_${i}`)?.value;
                if (!teacherName || !teacherName.trim()) continue;

                totalTeachers++;
                let classes = 0;
                let waiting = 0;
                let dummy = 0;

                days.forEach(day => {
                    for (let period = 1; period <= 7; period++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value) {
                            if (select.value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±')) {
                                waiting++;
                            } else if (select.value === 'ÙˆÙ‡Ù…ÙŠ') {
                                dummy++;
                            } else {
                                classes++;
                            }
                        }
                    }
                });

                totalClasses += classes;
                totalWaiting += waiting;
                totalDummy += dummy;
            }

            const html = `
                <div class="alert info">
                    <h4>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ:</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                        <div>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: <strong>${totalTeachers}</strong></div>
                        <div>ğŸ“š Ø­ØµØµ Ø¯Ø±Ø§Ø³ÙŠØ©: <strong>${totalClasses}</strong></div>
                        <div>â³ Ø­ØµØµ Ø§Ù†ØªØ¸Ø§Ø±: <strong>${totalWaiting}</strong></div>
                        <div>ğŸš« Ø­ØµØµ ÙˆÙ‡Ù…ÙŠØ©: <strong>${totalDummy}</strong></div>
                        <div>ğŸ“ˆ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <strong>${totalClasses + totalWaiting + totalDummy}</strong></div>
                    </div>
                </div>
            `;

            document.getElementById('statsResult').innerHTML = html;
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ§Ù„ÙØµÙˆÙ„
        function updateTeacherSelect() {
            const select = document.getElementById('teacherSelect');
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù… --</option>';
            
            for (let i = 0; i < 42; i++) {
                const teacherName = document.getElementById(`teacher_${i}`).value;
                if (teacherName.trim()) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = teacherName;
                    select.appendChild(option);
                }
            }
        }

        function showTeacherSchedule() {
            const teacherIndex = document.getElementById('teacherSelect').value;
            const viewDiv = document.getElementById('teacherScheduleView');
            
            if (!teacherIndex) {
                viewDiv.innerHTML = '';
                return;
            }

            const teacherName = document.getElementById(`teacher_${teacherIndex}`).value;
            
            let html = `
                <div class="teacher-schedule-table">
                    <h3 style="text-align: center; margin-bottom: 15px;">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…: ${teacherName}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="day-header">Ø§Ù„ÙŠÙˆÙ… / Ø§Ù„Ø­ØµØ©</th>
                                <th class="period-header">1</th>
                                <th class="period-header">2</th>
                                <th class="period-header">3</th>
                                <th class="period-header">4</th>
                                <th class="period-header">5</th>
                                <th class="period-header">6</th>
                                <th class="period-header">7</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            let totalClasses = 0;
            let totalWaiting = 0;

            days.forEach(day => {
                html += `<tr><td class="day-header">${dayNames[day]}</td>`;
                
                for (let period = 1; period <= 7; period++) {
                    const select = document.getElementById(`cell_${teacherIndex}_${day}_${period}`);
                    const value = select ? select.value : '';
                    
                    let displayValue = value || '-';
                    let cellStyle = '';
                    
                    if (value === 'ÙˆÙ‡Ù…ÙŠ') {
                        displayValue = '-';
                        cellStyle = 'background: #f7fafc; color: #a0aec0;';
                    } else if (value && value.startsWith('Ø§Ù†ØªØ¸Ø§Ø±')) {
                        cellStyle = 'background: #fef5e7; color: #b7791f; font-weight: bold;';
                        totalWaiting++;
                    } else if (value) {
                        cellStyle = 'background: #e6fffa; color: #234e52; font-weight: bold;';
                        totalClasses++;
                    }
                    
                    html += `<td style="${cellStyle}">${displayValue}</td>`;
                }
                
                html += '</tr>';
            });

            html += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="8" style="text-align: center; background: #f7fafc; font-weight: bold; padding: 10px;">
                                    ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©: ${totalClasses} | 
                                    â³ Ø¹Ø¯Ø¯ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${totalWaiting} | 
                                    ğŸ“ˆ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalClasses + totalWaiting}
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;

            viewDiv.innerHTML = html;
        }

        function updateClassList() {
            const grade = document.getElementById('gradeSelect').value;
            const classSelect = document.getElementById('classNumberSelect');
            
            classSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„ --</option>';
            
            if (grade) {
                for (let i = 1; i <= 6; i++) {
                    const option = document.createElement('option');
                    option.value = `${grade}-${i}`;
                    option.textContent = `Ø§Ù„ÙØµÙ„ ${i}`;
                    classSelect.appendChild(option);
                }
            }
            
            document.getElementById('classScheduleView').innerHTML = '';
        }

        function showClassSchedule() {
            const classValue = document.getElementById('classNumberSelect').value;
            const viewDiv = document.getElementById('classScheduleView');
            
            if (!classValue) {
                viewDiv.innerHTML = '';
                return;
            }

            const [grade, classNum] = classValue.split('-');
            const gradeNames = {
                '1': 'Ø§Ù„Ø£ÙˆÙ„',
                '2': 'Ø§Ù„Ø«Ø§Ù†ÙŠ',
                '3': 'Ø§Ù„Ø«Ø§Ù„Ø«'
            };
            
            const className = `Ø§Ù„ØµÙ ${gradeNames[grade]} Ù…ØªÙˆØ³Ø· - Ø§Ù„ÙØµÙ„ ${classNum}`;
            
            let html = `
                <div class="teacher-schedule-table">
                    <h3 style="text-align: center; margin-bottom: 15px;">Ø¬Ø¯ÙˆÙ„ ${className}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="day-header">Ø§Ù„ÙŠÙˆÙ… / Ø§Ù„Ø­ØµØ©</th>
                                <th class="period-header">1</th>
                                <th class="period-header">2</th>
                                <th class="period-header">3</th>
                                <th class="period-header">4</th>
                                <th class="period-header">5</th>
                                <th class="period-header">6</th>
                                <th class="period-header">7</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            let totalClasses = 0;

            days.forEach(day => {
                html += `<tr><td class="day-header">${dayNames[day]}</td>`;
                
                for (let period = 1; period <= 7; period++) {
                    let teacherName = '-';
                    let cellStyle = '';
                    
                    for (let i = 0; i < 42; i++) {
                        const select = document.getElementById(`cell_${i}_${day}_${period}`);
                        if (select && select.value === classValue) {
                            const teacherInput = document.getElementById(`teacher_${i}`);
                            teacherName = teacherInput ? teacherInput.value : `Ù…Ø¹Ù„Ù… ${i + 1}`;
                            cellStyle = 'background: #e6fffa; color: #234e52; font-weight: bold;';
                            totalClasses++;
                            break;
                        }
                    }
                    
                    html += `<td style="${cellStyle}">${teacherName}</td>`;
                }
                
                html += '</tr>';
            });

            html += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="8" style="text-align: center; background: #f7fafc; font-weight: bold; padding: 10px;">
                                    ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ: ${totalClasses} Ø­ØµØ©
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;

            viewDiv.innerHTML = html;
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function updateScheduleTable() {
            // ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
            updateClassCounts();
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        function init() {
            createScheduleTable();
            loadData();
            updateClassCounts();
            checkConflicts();
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        init();
    </script>
</body>
</html>
