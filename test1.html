<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø¯ÙˆÙ„ Ù…Ø¯Ø±Ø³ÙŠ ÙƒØ§Ù…Ù„ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; padding: 15px; }
        .container { max-width: 100%; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #4a5568; }
        .schedule-wrapper { overflow-x: auto; margin-top: 20px; }
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 11px; min-width: 1200px; }
        .schedule-table th, .schedule-table td { border: 1px solid #cbd5e0; padding: 6px 4px; text-align: center; }
        .schedule-table th { background: #2d3748; color: white; position: sticky; top: 0; z-index: 10; }
        .teacher-name { background: #edf2f7; font-weight: bold; text-align: right; padding-right: 10px !important; width: 140px; position: sticky; right: 0; z-index: 5; }
        .class-count { background: #e6fffa; font-weight: bold; color: #234e52; width: 60px; }
        .period-header { background: #4299e1 !important; color: white; }
        .day-border { border-right: 4px solid #2d3748 !important; }
        
        /* Ø£Ø²Ø±Ø§Ø± ÙˆÙ‚ÙˆØ§Ø¦Ù… */
        .buttons { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .btn { padding: 10px 25px; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn-save { background: #4299e1; color: white; }
        .btn-distribute { background: #ed8936; color: white; padding: 12px 30px; }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */
        .waiting-section { margin-top: 40px; padding: 25px; background: #f7fafc; border-radius: 10px; border: 2px solid #cbd5e0; }
        .waiting-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; background: white; padding: 20px; border-radius: 8px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 5px; color: #4a5568; }
        .form-group select, .form-group input { padding: 10px; border: 2px solid #cbd5e0; border-radius: 5px; }
        .waiting-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        .waiting-table th, .waiting-table td { border: 1px solid #cbd5e0; padding: 12px; text-align: center; }
        .waiting-table th { background: #4a5568; color: white; }
        .waiting-assigned { background: #c6f6d5 !important; font-weight: bold; }
        
        /* ØªÙ†ÙŠØ³Ù‚Ø§Øª Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 3px solid #e2e8f0; }
        .tab { padding: 12px 30px; background: #edf2f7; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: bold; }
        .tab.active { background: #4299e1; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</h1>
            <p>ØªÙˆØ²ÙŠØ¹ Ø¢Ù„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØµØ§Ø¨ (Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ø£Ù‚Ù„ Ø­ØµØµØ§Ù‹ - Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ù†ØµØ§Ø¨ 24)</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('main')">ğŸ“‹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
            <button class="tab" onclick="switchTab('waiting')">âš–ï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
        </div>

        <div id="mainTab" class="tab-content active">
            <div class="schedule-wrapper">
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th rowspan="2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                            <th rowspan="2">Ø§Ù„current<br>Ù†ØµØ§Ø¨</th>
                            <th colspan="7">Ø§Ù„Ø£Ø­Ø¯</th>
                            <th colspan="7" class="day-border">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</th>
                            </tr>
                        <tr>
                            <script>
                                for(let d=0; d<2; d++) {
                                    for(let p=1; p<=7; p++) document.write(`<th class="period-header ${p===1 && d>0?'day-border':''}">${p}</th>`);
                                }
                            </script>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody">
                        </tbody>
                </table>
            </div>
            <div class="buttons">
                <button class="btn btn-save" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>

        <div id="waitingTab" class="tab-content">
            <div class="waiting-section">
                <h2>ğŸ“‹ ØªÙˆØ²ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <div class="waiting-form">
                    <div class="form-group">
                        <label>Ø§Ù„ÙŠÙˆÙ…</label>
                        <select id="absenceDay">
                            <option value="sun">Ø§Ù„Ø£Ø­Ø¯</option>
                            <option value="mon">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
                            <option value="tue">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                            <option value="wed">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                            <option value="thu">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„ØºØ§Ø¦Ø¨</label>
                        <select id="absentTeacher1">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…...</option>
                        </select>
                    </div>
                    <div class="form-group" style="align-self: end;">
                        <button class="btn btn-distribute" onclick="distributeWaiting()">âš¡ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¢Ù†</button>
                    </div>
                </div>
                <div id="waitingResult"></div>
            </div>
        </div>
    </div>

    <script>
        const days = ['sun', 'mon', 'tue', 'wed', 'thu'];
        const teacherCount = 10; // Ù…Ø«Ø§Ù„ Ù„Ù€ 10 Ù…Ø¹Ù„Ù…ÙŠÙ† Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function initTable() {
            const tbody = document.getElementById('scheduleBody');
            for (let i = 0; i < teacherCount; i++) {
                let row = `<tr>
                    <td class="teacher-name"><input type="text" id="teacher_${i}" value="Ù…Ø¹Ù„Ù… ${i+1}" onchange="updateAbsentList()"></td>
                    <td class="class-count" id="count_${i}">20</td>`;
                
                days.forEach(day => {
                    for (let p = 1; p <= 7; p++) {
                        row += `<td class="${p===1?'day-border':''}">
                            <select id="cell_${i}_${day}_${p}" onchange="updateNisab(${i})">
                                <option value=""></option>
                                <option value="Ø­ØµØ©">Ø­ØµØ©</option>
                            </select>
                        </td>`;
                    }
                });
                row += `</tr>`;
                tbody.innerHTML += row;
            }
            updateAbsentList();
        }

        function updateNisab(idx) {
            let count = 0;
            days.forEach(day => {
                for (let p = 1; p <= 7; p++) {
                    if (document.getElementById(`cell_${idx}_${day}_${p}`).value !== "") count++;
                }
            });
            document.getElementById(`count_${idx}`).innerText = count;
        }

        function updateAbsentList() {
            const select = document.getElementById('absentTeacher1');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…...</option>';
            for (let i = 0; i < teacherCount; i++) {
                const name = document.getElementById(`teacher_${i}`).value;
                if (name) select.innerHTML += `<option value="${name}">${name}</option>`;
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ
        function distributeWaiting() {
            const day = document.getElementById('absenceDay').value;
            const absentName = document.getElementById('absentTeacher1').value;
            
            if (!absentName) return alert("Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„ØºØ§Ø¦Ø¨");

            // 1. Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
            let teachersData = [];
            for (let i = 0; i < teacherCount; i++) {
                const name = document.getElementById(`teacher_${i}`).value;
                const nisab = parseInt(document.getElementById(`count_${i}`).innerText);
                teachersData.push({ id: i, name: name, nisab: nisab });
            }

            // 2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø´Ø±ÙˆØ·:
            // - Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ù†ØµØ§Ø¨ 24
            // - ØªØ±ØªÙŠØ¨ ØªØµØ§Ø¹Ø¯ÙŠ (Ø§Ù„Ø£Ù‚Ù„ Ù†ØµØ§Ø¨Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ØŒ ÙˆØ§Ù„Ù€ 20 ÙŠØµØ¨Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¢Ø®Ø±)
            let pool = teachersData
                .filter(t => t.nisab < 24 && t.name !== absentName)
                .sort((a, b) => a.nisab - b.nisab);

            const absentIdx = teachersData.find(t => t.name === absentName).id;
            let resultsHtml = `<table class="waiting-table"><tr><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø³Ù†Ø¯</th><th>Ù†ØµØ§Ø¨Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠ</th></tr>`;

            for (let p = 1; p <= 7; p++) {
                const isBusy = document.getElementById(`cell_${absentIdx}_${day}_${p}`).value !== "";
                if (isBusy) {
                    let assigned = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ§Ø­";
                    let n = "-";
                    
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ù„Ù… ÙØ§Ø¶ÙŠ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­ØµØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø©
                    for (let j = 0; j < pool.length; j++) {
                        const t = pool[j];
                        const tBusy = document.getElementById(`cell_${t.id}_${day}_${p}`).value !== "";
                        if (!tBusy) {
                            assigned = t.name;
                            n = t.nisab;
                            t.nisab += 1; // Ø²ÙŠØ§Ø¯Ø© ÙˆÙ‡Ù…ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø­ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                            pool.sort((a, b) => a.nisab - b.nisab); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨
                            break;
                        }
                    }
                    resultsHtml += `<tr><td>${p}</td><td class="waiting-assigned">${assigned}</td><td>${n}</td></tr>`;
                }
            }
            resultsHtml += `</table>`;
            document.getElementById('waitingResult').innerHTML = resultsHtml;
        }

        window.onload = initTable;
    </script>
</body>
</html>
