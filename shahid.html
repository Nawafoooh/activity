<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .hidden {
            display: none;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Teachers List
        const teachersList = [
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø·Ø± Ø¨Ù† Ù…ØµÙ„Ø­ Ø§Ù„Ø¹Ù…Ø±ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù…Ø§Ø±ÙŠ Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ',
            'Ù…ÙˆÙÙ‚ Ù…Ø±Ø²ÙˆÙ‚ Ø³ÙˆÙŠØ±Ø­ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙˆØ§Ø² Ø²Ø§ÙŠØ¯ Ù„Ø§ÙÙŠ Ø§Ù„Ù…Ù‡ÙŠÙ…Ø²ÙŠ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ',
            'ÙÙŠØµÙ„ Ø¹Ø·Ø§Ù„Ù„Ù‡ Ø­ÙˆÙŠÙ…Ø¯ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ',
            'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹ÙŠØ§Ø¯ Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ù…ÙˆØ¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø³Ø§ÙŠØ± ÙÙŠØµÙ„ Ø³Ø¹Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¶ÙŠÙ„Ù‡ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ù†Ø§ÙØ¹ Ø´Ø¹ÙˆÙŠ Ù†Ø§ÙØ¹ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ø§Ø³Ø§Ù…Ù‡ Ù…Ù†ÙˆØ± Ù…Ø´Ø¹Ù„ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¹ÙŠØ§Ø¯ Ø¹Ù„ÙŠØ«Ù‡ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙØ®Ø±ÙŠ Ø§Ù„ØªØ±ÙƒÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø­Ø§Ù…Ø¯ Ù‡Ù„Ø§Ù„ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ù…ÙŠØ§Ù† Ø¹Ù„ÙŠ Ù†Ù…ÙŠØ§Ù† Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ØµÙ„Ø§Ø­ ØµØ§Ù„Ø­ Ø§Ù„Ø±Ø­ÙŠÙ„Ù‰',
            'Ù…Ø´Ø¹Ù„ Ø¨Ù† Ù‡Ù„ÙŠÙ„ Ø¨Ù† ØºØ§Ù„Ø¨ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ù„ÙŠ Ù…ØªØ¹Ø¨ Ù†Ø§ØµØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø³ÙŠÙ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù†Ø¹Ù… Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø¹Ø§Ø±Ø¶ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø°Ø¹Ø§Ø± Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'ÙØ¤Ø§Ø¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ù…Ø§Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ',
            'Ø­Ù…Ø²Ø© ØµØ¯Ù‚Ø© Ø­Ù…Ø²Ø© Ø§Ø³Ù„Ø§Ù…',
            'Ø³Ù„Ù…Ø§Ù† ØµØ§Ù„Ø­ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ',
            'Ø¹Ø¨ÙŠØ¯ Ø¨Ù† Ø¯Ø®ÙŠÙ„ Ø¨Ù† Ø¯ÙˆÙŠÙ‡ÙŠØ³ Ø§Ù„Ø¹ÙŠØ§Ø¶ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…ÙÙ„Ø­ Ù†ÙˆÙŠØ¹Ù… Ø§Ù„Ø±ÙˆÙŠØ«ÙŠ',
            'ÙÙŠØµÙ„ Ø¹ÙˆØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ Ø³Ù„Ù…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„ Ø¨Ø­Ø±Ø§Ù† Ø§Ù„Ù‚Ø±Ù†ÙŠ',
            'ÙƒØ§ØªØ¨ Ù…ÙÙ„Ø­ Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯Ù‰',
            'Ø­Ø¨ÙŠØ¨ Ø¹Ù„ÙŠ Ù†Ø¹ÙŠØ³ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø§ÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
            'Ø³Ù„Ø·Ø§Ù† Ø¹ÙˆÙŠØ¶ Ù…Ø¹ÙŠØ¶ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ù…Ø¹ÙŠØ¶ Ù…Ø¹Ù„Ø§ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† ØºÙ„Ø§Ø¨ Ø§Ù„Ù…Ø®Ù„ÙÙŠ',
            'Ø³Ø¹Ø¯ Ø·Ø§Ù„Ø¹ Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ø§Ù‡Ø± Ù…Ø´Ø¹Ù„ Ø¹ÙˆÙŠØ¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ù…ÙˆØ³Ù‰ ØºØ§Ø²ÙŠ Ø³ÙØ± Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù…ÙˆØ³Ù‰ Ù…Ø³Ø¹ÙˆØ¯ Ø¹Ø§ÙŠØ¶ Ø§Ù„Ø­ÙŠØ³ÙˆÙ†ÙŠ',
            'Ù†ÙˆØ§Ù Ù…Ù†ØµÙˆØ± Ø¹ÙˆØ§Ø¯ Ø§Ù„ØµØ¨Ø­ÙŠ',
            'Ø¨Ø¯Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø´Ø§Ø¦Ø¯ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙ‡Ø¯ Ø¹ÙˆÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø§ÙŠØ¯ Ø®Ø¶Ø±Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ',
            'Ø£Ø­Ù…Ø¯ Ù…Ø·Ø± Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ'
        ];

        // Application State
        let state = {
            currentUser: { 
                role: 'teacher', 
                name: teachersList[0],
                id: 1
            },
            violations: [
                {
                    id: 1,
                    studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
                    section: '1',
                    violationType: 'first',
                    violationDetails: 'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
                    teacherName: teachersList[0],
                    teacherId: 1,
                    date: '2025-10-13',
                    time: '08:30',
                    documentation: 'ØªØ£Ø®Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù† Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                    status: 'active',
                    createdAt: '2025-10-13T08:30:00'
                },
                {
                    id: 2,
                    studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
                    section: '1',
                    violationType: 'first',
                    violationDetails: 'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
                    teacherName: teachersList[1],
                    teacherId: 2,
                    date: '2025-10-14',
                    time: '10:15',
                    documentation: 'Ù†Ø§Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©',
                    status: 'active',
                    createdAt: '2025-10-14T10:15:00'
                },
                {
                    id: 3,
                    studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
                    section: '1',
                    violationType: 'second',
                    violationDetails: 'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
                    teacherName: teachersList[2],
                    teacherId: 3,
                    date: '2025-10-14',
                    time: '11:30',
                    documentation: 'ØºØ§Ø¨ Ø¹Ù† Ø­ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±',
                    status: 'active',
                    createdAt: '2025-10-14T11:30:00'
                },
                {
                    id: 4,
                    studentName: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯',
                    grade: 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·',
                    section: '3',
                    violationType: 'first',
                    violationDetails: 'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©',
                    teacherName: teachersList[3],
                    teacherId: 1,
                    date: '2025-10-14',
                    time: '09:00',
                    documentation: 'ØªØ­Ø¯Ø« Ù…Ø¹ Ø²Ù…ÙŠÙ„Ù‡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø­',
                    status: 'active',
                    createdAt: '2025-10-14T09:00:00'
                },
                {
                    id: 5,
                    studentName: 'Ù…Ø­Ù…Ø¯ Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
                    grade: 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·',
                    section: '2',
                    violationType: 'third',
                    violationDetails: 'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
                    teacherName: teachersList[4],
                    teacherId: 4,
                    date: '2025-10-12',
                    time: '07:45',
                    documentation: 'Ø­Ø¶Ø± Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ',
                    status: 'resolved',
                    resolvedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
                    resolutionReason: 'Ø§Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„',
                    resolvedAt: '2025-10-13T12:00:00',
                    createdAt: '2025-10-12T07:45:00'
                }
            ],
            filters: {
                selectedTab: 'all',
                searchStudent: '',
                filterGrade: '',
                filterSection: '',
                dateFrom: '',
                dateTo: ''
            },
            modals: {
                showAddForm: false,
                showDetailsModal: false,
                selectedViolation: null
            },
            newViolation: {
                studentName: '',
                grade: '',
                section: '',
                violationType: 'first',
                violationDetails: '',
                documentation: '',
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5)
            }
        };

        // Configuration
        const config = {
            schoolInfo: {
                name: 'Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ',
                principal: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
                assistant: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
                counselor: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
                type: 'Ø¨Ù†ÙŠÙ†'
            },
            grades: ['Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·'],
            sections: ['1', '2', '3', '4', '5', '6'],
            violationTypes: {
                first: {
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)',
                    items: [
                        'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
                        'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© (ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø£Ø·Ø¹Ù…Ø© ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª)',
                        'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ - Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©',
                        'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
                        'ØªÙƒØ±Ø§Ø± Ø®Ø±ÙˆØ¬ ÙˆØ¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ù‚Ø¨Ù„ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù',
                        'Ø§Ù„ØªØ¬Ù‡Ø² Ø£Ù…Ø§Ù… Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'
                    ]
                },
                second: {
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø¯Ø±Ø¬ØªÙŠÙ†)',
                    items: [
                        'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
                        'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ÙØµÙ„ Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
                        'Ø¯Ø®ÙˆÙ„ ÙØµÙ„ Ø¢Ø®Ø± Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
                        'Ø¥Ø«Ø§Ø±Ø© Ø§Ù„ÙÙˆØ¶Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ'
                    ]
                },
                third: {
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)',
                    items: [
                        'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
                        'Ø¥Ù„Ø­Ø§Ù‚ Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ù…ØªØ¹Ù…Ø¯ Ø¨Ù…Ù…ØªÙ„ÙƒØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª',
                        'Ø§Ù„Ø¹Ø¨Ø« Ø¨ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø§Ù„Ù…Ø¹Ù…Ù„ - Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø§Ø³Ø¨)',
                        'Ø§Ù…ØªÙ‡Ø§Ù† Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©'
                    ]
                }
            }
        };

        // Helper Functions
        function getStudentViolationCount(studentName, status = 'active') {
            return state.violations.filter(v => 
                v.studentName === studentName && 
                (status === 'all' || v.status === status)
            ).length;
        }

        function getStudentsByViolationCount() {
            const studentMap = {};
            state.violations.filter(v => v.status === 'active').forEach(v => {
                if (!studentMap[v.studentName]) {
                    studentMap[v.studentName] = {
                        name: v.studentName,
                        grade: v.grade,
                        section: v.section,
                        count: 0,
                        violations: []
                    };
                }
                studentMap[v.studentName].count++;
                studentMap[v.studentName].violations.push(v);
            });
            return Object.values(studentMap).sort((a, b) => b.count - a.count);
        }

        function getDegreeLabel(type) {
            const labels = {
                first: 'Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„Ù‰',
                second: 'Ø¯Ø±Ø¬Ø© Ø«Ø§Ù†ÙŠØ©',
                third: 'Ø¯Ø±Ø¬Ø© Ø«Ø§Ù„Ø«Ø©'
            };
            return labels[type] || type;
        }

        function getDegreeColor(type) {
            const colors = {
                first: 'bg-green-100 text-green-800 border-green-200',
                second: 'bg-yellow-100 text-yellow-800 border-yellow-200',
                third: 'bg-red-100 text-red-800 border-red-200'
            };
            return colors[type] || 'bg-gray-100 text-gray-800';
        }

        function getRoleLabel(role) {
            const labels = {
                teacher: 'Ø§Ù„Ù…Ø¹Ù„Ù…',
                assistant: 'Ø§Ù„ÙˆÙƒÙŠÙ„',
                counselor: 'Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ',
                principal: 'Ø§Ù„Ù…Ø¯ÙŠØ±'
            };
            return labels[role];
        }

        function getFilteredViolations() {
            let filtered = [...state.violations];

            // Role-based filtering
            if (state.currentUser.role === 'assistant' || state.currentUser.role === 'counselor') {
                const studentsWithThreePlus = getStudentsByViolationCount()
                    .filter(s => s.count >= 3)
                    .map(s => s.name);
                
                filtered = filtered.filter(v => studentsWithThreePlus.includes(v.studentName));
            }

            // Status filter
            if (state.filters.selectedTab === 'active') {
                filtered = filtered.filter(v => v.status === 'active');
            } else if (state.filters.selectedTab === 'resolved') {
                filtered = filtered.filter(v => v.status === 'resolved');
            }

            // Search and filters
            if (state.filters.searchStudent.trim()) {
                filtered = filtered.filter(v => 
                    v.studentName.includes(state.filters.searchStudent.trim())
                );
            }

            if (state.filters.filterGrade) {
                filtered = filtered.filter(v => v.grade === state.filters.filterGrade);
            }

            if (state.filters.filterSection) {
                filtered = filtered.filter(v => v.section === state.filters.filterSection);
            }

            if (state.filters.dateFrom) {
                filtered = filtered.filter(v => v.date >= state.filters.dateFrom);
            }

            if (state.filters.dateTo) {
                filtered = filtered.filter(v => v.date <= state.filters.dateTo);
            }

            return filtered;
        }

        function getStats() {
            const active = state.violations.filter(v => v.status === 'active').length;
            const resolved = state.violations.filter(v => v.status === 'resolved').length;
            const studentsUnderWatch = getStudentsByViolationCount()
                .filter(s => s.count >= 3).length;
            const today = state.violations.filter(v => 
                v.date === new Date().toISOString().split('T')[0]
            ).length;

            return { active, resolved, studentsUnderWatch, today };
        }

        function canResolveViolation(violation) {
            if (state.currentUser.role === 'principal') return true;
            if (state.currentUser.role === 'assistant' || state.currentUser.role === 'counselor') {
                return getStudentViolationCount(violation.studentName) >= 3;
            }
            if (state.currentUser.role === 'teacher') {
                return violation.teacherId === state.currentUser.id;
            }
            return false;
        }

        // Actions
        function setCurrentUser(role, name, id) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹Ù„Ù…ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„ Ù…Ø¹Ù„Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            if (role === 'teacher' && !name) {
                name = teachersList[0];
            }
            state.currentUser = { role, name, id };
            render();
        }

        function setFilter(key, value) {
            state.filters[key] = value;
            render();
        }

        function clearFilters() {
            state.filters = {
                selectedTab: state.filters.selectedTab,
                searchStudent: '',
                filterGrade: '',
                filterSection: '',
                filterTeacher: '',
                dateFrom: '',
                dateTo: ''
            };
            render();
        }

        function openAddForm() {
            state.modals.showAddForm = true;
            render();
        }

        function closeAddForm() {
            state.modals.showAddForm = false;
            state.newViolation = {
                studentName: '',
                grade: '',
                section: '',
                violationType: 'first',
                violationDetails: '',
                documentation: '',
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5)
            };
            render();
        }

        function updateNewViolation(key, value) {
            state.newViolation[key] = value;
            // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ render Ù‡Ù†Ø§ Ù„Ø£Ù† oninput ÙŠØ­Ø¯Ø« Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±
            // ÙÙ‚Ø· Ù†Ø­Ø¯Ø« Ø§Ù„Ø­Ø§Ù„Ø©
        }

        function addViolation() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const studentName = state.newViolation.studentName.trim();
            const grade = state.newViolation.grade;
            const section = state.newViolation.section;
            const violationDetails = state.newViolation.violationDetails;
            
            if (!studentName || !grade || !section || !violationDetails) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\n- Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨\n- Ø§Ù„ØµÙ\n- Ø§Ù„Ø´Ø¹Ø¨Ø©\n- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©');
                return;
            }
            
            const violation = {
                id: Math.max(...state.violations.map(v => v.id), 0) + 1,
                studentName: studentName,
                grade: grade,
                section: section,
                violationType: state.newViolation.violationType,
                violationDetails: violationDetails,
                documentation: state.newViolation.documentation,
                date: state.newViolation.date,
                time: state.newViolation.time,
                teacherName: state.currentUser.name,
                teacherId: state.currentUser.id,
                status: 'active',
                createdAt: new Date().toISOString()
            };
            
            state.violations = [violation, ...state.violations];
            closeAddForm();
        }

        function resolveViolation(violationId) {
            const reason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨):');
            
            if (reason && reason.trim()) {
                state.violations = state.violations.map(v => 
                    v.id === violationId ? {
                        ...v,
                        status: 'resolved',
                        resolutionReason: reason.trim(),
                        resolvedBy: state.currentUser.name,
                        resolvedAt: new Date().toISOString()
                    } : v
                );
                render();
            }
        }

        function openDetailsModal(violation) {
            state.modals.selectedViolation = violation;
            state.modals.showDetailsModal = true;
            render();
        }

        function closeDetailsModal() {
            state.modals.showDetailsModal = false;
            state.modals.selectedViolation = null;
            render();
        }

        function exportToCSV() {
            const filtered = getFilteredViolations();
            const headers = ['#', 'Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø´Ø¹Ø¨Ø©', 'Ø§Ù„Ø¯Ø±Ø¬Ø©', 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', 'Ø§Ù„Ù…Ø¹Ù„Ù…', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ø­Ø§Ù„Ø©'];
            const rows = filtered.map((v, i) => [
                i + 1,
                v.studentName,
                v.grade,
                v.section,
                getDegreeLabel(v.violationType),
                v.violationDetails,
                v.teacherName,
                v.date,
                v.time,
                v.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ø­Ù„ÙˆÙ„'
            ]);

            const csvContent = [headers, ...rows]
                .map(row => row.join(','))
                .join('\n');

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Ù…Ø®Ø§Ù„ÙØ§Øª_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Render Functions
        function render() {
            const app = document.getElementById('app');
            app.innerHTML = `
                ${renderHeader()}
                ${renderUserTabs()}
                ${renderMainContent()}
                ${state.modals.showAddForm ? renderAddModal() : ''}
                ${state.modals.showDetailsModal ? renderDetailsModal() : ''}
            `;
            attachEventListeners();
        }

        function renderHeader() {
            return `
                <div class="bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white shadow-2xl">
                    <div class="max-w-7xl mx-auto px-6 py-8">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h1 class="text-4xl font-bold mb-2">ğŸ“š ${config.schoolInfo.name}</h1>
                                <p class="text-blue-100 text-lg">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© - ${config.schoolInfo.type}</p>
                            </div>
                            <div class="text-left bg-blue-800 bg-opacity-50 rounded-lg p-4 backdrop-blur-sm">
                                <p class="text-sm text-blue-100 mb-1">ğŸ‘¤ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ${config.schoolInfo.principal}</p>
                                <p class="text-sm text-blue-100 mb-1">ğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${config.schoolInfo.assistant}</p>
                                <p class="text-sm text-blue-100">ğŸ‘¤ Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ: ${config.schoolInfo.counselor}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderUserTabs() {
            const isActive = (role) => state.currentUser.role === role;
            const btnClass = (role) => `flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-200 ${
                isActive(role) 
                    ? 'bg-blue-600 text-white shadow-lg transform scale-105' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
            }`;

            return `
                <div class="bg-white border-b shadow-sm sticky top-0 z-40">
                    <div class="max-w-7xl mx-auto px-6 py-4">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex gap-2 flex-wrap items-center">
                                ${state.currentUser.role === 'teacher' ? `
                                    <select onchange="setCurrentUser('teacher', this.value, 1)" 
                                            class="px-4 py-3 border-2 border-blue-600 rounded-lg focus:ring-2 focus:ring-blue-500 font-medium text-blue-900 bg-blue-50">
                                        ${teachersList.map(teacher => `
                                            <option value="${teacher}" ${state.currentUser.name === teacher ? 'selected' : ''}>
                                                ğŸ‘¨â€ğŸ« ${teacher}
                                            </option>
                                        `).join('')}
                                    </select>
                                ` : `
                                    <button onclick="setCurrentUser('teacher', '${teachersList[0]}', 1)" class="${btnClass('teacher')}">
                                        ğŸ‘¨â€ğŸ« ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
                                    </button>
                                `}
                                
                                <button onclick="setCurrentUser('assistant', '${config.schoolInfo.assistant}', 2)" class="${btnClass('assistant')}">
                                    ğŸ“‹ ØµÙØ­Ø© Ø§Ù„ÙˆÙƒÙŠÙ„
                                </button>
                                <button onclick="setCurrentUser('counselor', '${config.schoolInfo.counselor}', 3)" class="${btnClass('counselor')}">
                                    ğŸ”” Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ
                                </button>
                                <button onclick="setCurrentUser('principal', '${config.schoolInfo.principal}', 4)" class="${btnClass('principal')}">
                                    ğŸ›ï¸ ØµÙØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±
                                </button>
                            </div>
                            <div class="bg-blue-50 px-4 py-2 rounded-lg border border-blue-200">
                                <p class="text-sm text-blue-900">
                                    <span class="font-bold">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</span> ${state.currentUser.name} - ${getRoleLabel(state.currentUser.role)}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMainContent() {
            const stats = getStats();
            const filtered = getFilteredViolations();

            return `
                <div class="max-w-7xl mx-auto px-6 py-6">
                    ${renderStats(stats)}
                    ${renderViolationsSection(filtered)}
                    ${renderStudentsUnderWatch()}
                </div>
            `;
        }

        function renderStats(stats) {
            return `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-blue-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">âš ï¸</span>
                            <div class="text-3xl font-bold text-blue-600">${stats.active}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-green-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">âœ…</span>
                            <div class="text-3xl font-bold text-green-600">${stats.resolved}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-orange-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">ğŸ‘ï¸</span>
                            <div class="text-3xl font-bold text-orange-600">${stats.studentsUnderWatch}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-purple-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">ğŸ“…</span>
                            <div class="text-3xl font-bold text-purple-600">${stats.today}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                </div>
            `;
        }

        function renderViolationsSection(filtered) {
            const stats = getStats();
            const tabClass = (tab) => `px-5 py-2.5 rounded-lg font-medium transition-all duration-200 ${
                state.filters.selectedTab === tab 
                    ? 'bg-blue-600 text-white shadow-md' 
                    : 'text-gray-600 hover:bg-gray-100'
            }`;

            return `
                <div class="bg-white rounded-xl shadow-lg mb-6">
                    <div class="border-b px-6 py-4">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex gap-3">
                                <button onclick="setFilter('selectedTab', 'all')" class="${tabClass('all')}">
                                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª (${state.violations.length})
                                </button>
                                <button onclick="setFilter('selectedTab', 'active')" class="${tabClass('active')}">
                                    Ø§Ù„Ù†Ø´Ø·Ø© (${stats.active})
                                </button>
                                <button onclick="setFilter('selectedTab', 'resolved')" class="${tabClass('resolved')}">
                                    Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø© (${stats.resolved})
                                </button>
                            </div>
                            
                            <div class="flex gap-3">
                                <button onclick="exportToCSV()" class="flex items-center gap-2 px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md">
                                    ğŸ“¥ ØªØµØ¯ÙŠØ± Excel
                                </button>
                                ${state.currentUser.role === 'teacher' ? `
                                    <button onclick="openAddForm()" class="flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md">
                                        â• Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    ${renderFilters()}
                    ${renderViolationsList(filtered)}
                </div>
            `;
        }

        function renderFilters() {
            const hasFilters = state.filters.searchStudent || state.filters.filterGrade || 
                              state.filters.filterSection || 
                              state.filters.dateFrom || state.filters.dateTo;

            return `
                <div class="p-6 bg-gray-50 border-b">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</label>
                            <input type="text" value="${state.filters.searchStudent}" 
                                   onchange="setFilter('searchStudent', this.value)"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨...">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“Š Ø§Ù„ØµÙ</label>
                            <select onchange="setFilter('filterGrade', this.value)" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Ø§Ù„ÙƒÙ„</option>
                                ${config.grades.map(g => `<option value="${g}" ${state.filters.filterGrade === g ? 'selected' : ''}>${g}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ø¹Ø¨Ø©</label>
                            <select onchange="setFilter('filterSection', this.value)"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Ø§Ù„ÙƒÙ„</option>
                                ${config.sections.map(s => `<option value="${s}" ${state.filters.filterSection === s ? 'selected' : ''}>${s}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" value="${state.filters.dateFrom}"
                                   onchange="setFilter('dateFrom', this.value)"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" value="${state.filters.dateTo}"
                                   onchange="setFilter('dateTo', this.value)"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    ${hasFilters ? `
                        <button onclick="clearFilters()" class="mt-4 text-sm text-blue-600 hover:text-blue-800 font-medium">
                            Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±
                        </button>
                    ` : ''}
                </div>
            `;
        }

        function renderViolationsList(filtered) {
            if (filtered.length === 0) {
                return `
                    <div class="p-16 text-center">
                        <div class="text-6xl mb-4">âš ï¸</div>
                        <p class="text-xl text-gray-500 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ù„Ù„Ø¹Ø±Ø¶</p>
                        <p class="text-sm text-gray-400">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</p>
                    </div>
                `;
            }

            return `
                <div class="divide-y">
                    ${filtered.map(v => renderViolationItem(v)).join('')}
                </div>
                <div class="p-4 bg-gray-50 border-t text-center text-sm text-gray-600">
                    Ø¹Ø±Ø¶ ${filtered.length} Ù…Ù† Ø£ØµÙ„ ${state.violations.length} Ù…Ø®Ø§Ù„ÙØ©
                </div>
            `;
        }

        function renderViolationItem(v) {
            const violationCount = getStudentViolationCount(v.studentName);
            const isHighPriority = violationCount >= 3;
            
            return `
                <div class="p-6 hover:bg-gray-50 transition-all duration-200 ${
                    isHighPriority && v.status === 'active' ? 'bg-red-50 border-r-4 border-red-500' : ''
                }">
                    <div class="flex justify-between items-start gap-6">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3 flex-wrap">
                                <h3 class="text-xl font-bold text-gray-900">${v.studentName}</h3>
                                
                                <span class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">
                                    ${v.grade}
                                </span>
                                
                                <span class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">
                                    Ø§Ù„Ø´Ø¹Ø¨Ø© ${v.section}
                                </span>
                                
                                <span class="px-3 py-1 rounded-full text-xs font-bold border-2 ${getDegreeColor(v.violationType)}">
                                    ${getDegreeLabel(v.violationType)}
                                </span>
                                
                                ${isHighPriority && v.status === 'active' ? `
                                    <span class="flex items-center gap-1 bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-md animate-pulse">
                                        âš ï¸ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (${violationCount} Ù…Ø®Ø§Ù„ÙØ§Øª)
                                    </span>
                                ` : ''}
                                
                                ${v.status === 'resolved' ? `
                                    <span class="flex items-center gap-1 bg-green-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                                        âœ… ØªÙ… Ø§Ù„Ø­Ù„
                                    </span>
                                ` : ''}
                            </div>

                            <div class="bg-white border border-gray-200 rounded-lg p-4 mb-3">
                                <p class="text-gray-800 mb-2 font-semibold text-lg">
                                    ${v.violationDetails}
                                </p>
                                
                                ${v.documentation ? `
                                    <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                        <p class="text-sm text-blue-900">
                                            <span class="font-bold">ğŸ“ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</span>
                                            <br>
                                            ${v.documentation}
                                        </p>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                                <span>ğŸ‘¤ <strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> ${v.teacherName}</span>
                                <span>ğŸ“… <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${v.date}</span>
                                <span>ğŸ• <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${v.time}</span>
                            </div>

                            ${v.status === 'resolved' && v.resolutionReason ? `
                                <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="flex items-start gap-2 mb-2">
                                        <span class="text-2xl">ğŸ†</span>
                                        <div class="flex-1">
                                            <p class="text-sm font-bold text-green-900 mb-1">
                                                Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ):
                                            </p>
                                            <p class="text-sm text-green-800 mb-2">
                                                ${v.resolutionReason}
                                            </p>
                                            <div class="flex gap-4 text-xs text-green-700">
                                                <span>ØªÙ… Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©: ${v.resolvedBy}</span>
                                                <span>ÙÙŠ: ${new Date(v.resolvedAt).toLocaleString('ar-SA')}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <div class="flex flex-col gap-2">
                            <button onclick='openDetailsModal(${JSON.stringify(v).replace(/'/g, "\\'")})'
                                    class="flex items-center gap-2 bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors whitespace-nowrap">
                                ğŸ‘ï¸ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                            
                            ${v.status === 'active' && canResolveViolation(v) ? `
                                <button onclick="resolveViolation(${v.id})"
                                        class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-md whitespace-nowrap">
                                    ğŸ† Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStudentsUnderWatch() {
            if (state.currentUser.role !== 'assistant' && 
                state.currentUser.role !== 'counselor' && 
                state.currentUser.role !== 'principal') {
                return '';
            }

            const studentsUnderWatch = getStudentsByViolationCount().filter(s => s.count >= 3);

            return `
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 text-red-700">
                        âš ï¸ Ø§Ù„Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (3 Ù…Ø®Ø§Ù„ÙØ§Øª ÙØ£ÙƒØ«Ø±)
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${studentsUnderWatch.length > 0 ? studentsUnderWatch.map((student, index) => `
                            <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-bold text-gray-900">${student.name}</h3>
                                    <span class="bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                                        ${student.count} Ù…Ø®Ø§Ù„ÙØ§Øª
                                    </span>
                                </div>
                                <div class="text-sm text-gray-600 mb-2">
                                    ${student.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${student.section}
                                </div>
                                <div class="text-xs text-gray-500">
                                    Ø¢Ø®Ø± Ù…Ø®Ø§Ù„ÙØ©: ${student.violations[student.violations.length - 1].date}
                                </div>
                            </div>
                        `).join('') : `
                            <div class="col-span-full text-center py-8 text-gray-500">
                                <div class="text-5xl mb-2">âœ…</div>
                                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAddModal() {
            const studentName = state.newViolation.studentName.trim();
            const isDisabled = !studentName || 
                              !state.newViolation.grade || 
                              !state.newViolation.section || 
                              !state.newViolation.violationDetails;

            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50" onclick="if(event.target === this) closeAddForm()">
                    <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                â• Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø³Ù„ÙˆÙƒÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                            </h2>
                            <p class="text-blue-100 text-sm mt-1">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                        </div>
                        
                        <form onsubmit="event.preventDefault(); addViolation();" class="p-6 space-y-5">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ <span class="text-red-500">*</span>
                                </label>
                                <input type="text" 
                                       id="studentNameInput"
                                       value="${state.newViolation.studentName}" 
                                       oninput="state.newViolation.studentName = this.value; render();"
                                       class="w-full px-4 py-3 border-2 ${studentName ? 'border-green-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„"
                                       required
                                       autocomplete="off">
                                ${studentName ? '<p class="text-xs text-green-600 mt-1">âœ“ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…</p>' : ''}
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">
                                        Ø§Ù„ØµÙ <span class="text-red-500">*</span>
                                    </label>
                                    <select onchange="state.newViolation.grade = this.value; render();"
                                            required
                                            class="w-full px-4 py-3 border-2 ${state.newViolation.grade ? 'border-green-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                        ${config.grades.map(g => `
                                            <option value="${g}" ${state.newViolation.grade === g ? 'selected' : ''}>${g}</option>
                                        `).join('')}
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">
                                        Ø§Ù„Ø´Ø¹Ø¨Ø© <span class="text-red-500">*</span>
                                    </label>
                                    <select onchange="state.newViolation.section = this.value; render();"
                                            required
                                            class="w-full px-4 py-3 border-2 ${state.newViolation.section ? 'border-green-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
                                        ${config.sections.map(s => `
                                            <option value="${s}" ${state.newViolation.section === s ? 'selected' : ''}>${s}</option>
                                        `).join('')}
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© <span class="text-red-500">*</span>
                                </label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button type="button" 
                                            onclick="state.newViolation.violationType = 'first'; state.newViolation.violationDetails = ''; render();"
                                            class="p-4 border-2 rounded-lg font-medium transition-all ${
                                                state.newViolation.violationType === 'first'
                                                    ? 'border-green-500 bg-green-50 text-green-800'
                                                    : 'border-gray-300 hover:border-green-300'
                                            }">
                                        <div class="text-lg mb-1">Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„Ù‰</div>
                                        <div class="text-xs text-gray-600">(Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)</div>
                                    </button>
                                    
                                    <button type="button"
                                            onclick="state.newViolation.violationType = 'second'; state.newViolation.violationDetails = ''; render();"
                                            class="p-4 border-2 rounded-lg font-medium transition-all ${
                                                state.newViolation.violationType === 'second'
                                                    ? 'border-yellow-500 bg-yellow-50 text-yellow-800'
                                                    : 'border-gray-300 hover:border-yellow-300'
                                            }">
                                        <div class="text-lg mb-1">Ø¯Ø±Ø¬Ø© Ø«Ø§Ù†ÙŠØ©</div>
                                        <div class="text-xs text-gray-600">(Ø¯Ø±Ø¬ØªÙŠÙ†)</div>
                                    </button>
                                    
                                    <button type="button"
                                            onclick="state.newViolation.violationType = 'third'; state.newViolation.violationDetails = ''; render();"
                                            class="p-4 border-2 rounded-lg font-medium transition-all ${
                                                state.newViolation.violationType === 'third'
                                                    ? 'border-red-500 bg-red-50 text-red-800'
                                                    : 'border-gray-300 hover:border-red-300'
                                            }">
                                        <div class="text-lg mb-1">Ø¯Ø±Ø¬Ø© Ø«Ø§Ù„Ø«Ø©</div>
                                        <div class="text-xs text-gray-600">(Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)</div>
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© <span class="text-red-500">*</span>
                                </label>
                                <select onchange="state.newViolation.violationDetails = this.value; render();"
                                        required
                                        class="w-full px-4 py-3 border-2 ${state.newViolation.violationDetails ? 'border-green-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</option>
                                    ${config.violationTypes[state.newViolation.violationType].items.map(item => `
                                        <option value="${item}" ${state.newViolation.violationDetails === item ? 'selected' : ''}>${item}</option>
                                    `).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">
                                    ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                                </label>
                                <textarea oninput="state.newViolation.documentation = this.value;"
                                          class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"
                                          rows="4"
                                          placeholder="Ø£Ø¶Ù ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©ØŒ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ù…Ø­ÙŠØ·Ø©ØŒ Ø£Ùˆ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©...">${state.newViolation.documentation}</textarea>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" value="${state.newViolation.date}"
                                           onchange="state.newViolation.date = this.value;"
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙˆÙ‚Øª</label>
                                    <input type="time" value="${state.newViolation.time}"
                                           onchange="state.newViolation.time = this.value;"
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </form>

                        <div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl flex gap-3 justify-end">
                            <button type="button"
                                    onclick="closeAddForm()"
                                    class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium">
                                Ø¥Ù„ØºØ§Ø¡
                            </button>
                            <button type="button"
                                    onclick="addViolation()"
                                    ${isDisabled ? 'disabled title="ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"' : ''}
                                    class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg ${
                                        isDisabled ? 'opacity-50 cursor-not-allowed' : ''
                                    }">
                                ${isDisabled ? 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' : 'âœ“ Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetailsModal() {
            const v = state.modals.selectedViolation;
            if (!v) return '';

            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                            </h2>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="font-bold text-lg text-gray-900 mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                                <div class="grid grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„Ø§Ø³Ù…:</span>
                                        <span class="font-bold mr-2">${v.studentName}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„ØµÙ:</span>
                                        <span class="font-bold mr-2">${v.grade}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„Ø´Ø¹Ø¨Ø©:</span>
                                        <span class="font-bold mr-2">${v.section}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª:</span>
                                        <span class="font-bold mr-2">${getStudentViolationCount(v.studentName)}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="font-bold text-lg text-gray-900 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-center gap-2">
                                        <span class="px-3 py-1 rounded-full text-xs font-bold ${getDegreeColor(v.violationType)}">
                                            ${getDegreeLabel(v.violationType)}
                                        </span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</span>
                                        <p class="font-bold mt-1">${v.violationDetails}</p>
                                    </div>
                                    ${v.documentation ? `
                                        <div>
                                            <span class="text-gray-600">Ø§Ù„ØªÙˆØ«ÙŠÙ‚:</span>
                                            <p class="mt-1 text-gray-800">${v.documentation}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h3 class="font-bold text-lg text-gray-900 mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
                                <div class="grid grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„Ù…Ø¹Ù„Ù…:</span>
                                        <span class="font-bold mr-2">${v.teacherName}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                                        <span class="font-bold mr-2">${v.date}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„ÙˆÙ‚Øª:</span>
                                        <span class="font-bold mr-2">${v.time}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                                        <span class="font-bold mr-2 ${v.status === 'active' ? 'text-orange-600' : 'text-green-600'}">
                                            ${v.status === 'active' ? 'Ù†Ø´Ø·Ø©' : 'Ù…Ø­Ù„ÙˆÙ„Ø©'}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            ${v.status === 'resolved' && v.resolutionReason ? `
                                <div class="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                                    <h3 class="font-bold text-lg text-green-900 mb-3 flex items-center gap-2">
                                        ğŸ† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ù„
                                    </h3>
                                    <div class="space-y-2 text-sm">
                                        <div>
                                            <span class="text-green-700">Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ:</span>
                                            <p class="font-bold mt-1 text-green-900">${v.resolutionReason}</p>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3 mt-3">
                                            <div>
                                                <span class="text-green-700">ØªÙ… Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©:</span>
                                                <span class="font-bold mr-2 text-green-900">${v.resolvedBy}</span>
                                            </div>
                                            <div>
                                                <span class="text-green-700">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ù„:</span>
                                                <span class="font-bold mr-2 text-green-900">
                                                    ${new Date(v.resolvedAt).toLocaleDateString('ar-SA')}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl">
                            <button onclick="closeDetailsModal()"
                                    class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function attachEventListeners() {
            // Event listeners are handled through inline onclick attributes
        }

        // Initial render
        render();
    </script>
</body>
</html>
