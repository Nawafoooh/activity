<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام معايير التقويم والاعتماد المدرسي - متوسطة المنذر بن عمرو الأنصاري</title>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Color Variables */
            --primary-green: #00A651;
            --light-green: #228B22;
            --dark-green: #1a5f3f;
            --primary-blue: #3498db;
            --primary-purple: #9b59b6;
            --primary-orange: #f39c12;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
            --text-dark: #2c3e50;
            --text-muted: #7f8c8d;
            --background-light: #f8f9fa;
            --border-light: #e9ecef;
            
            /* Shadow Variables */
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --shadow-heavy: rgba(0, 0, 0, 0.25);
            
            /* Transition & Border Radius */
            --transition-fast: 0.3s ease;
            --border-radius-medium: 15px;
            --border-radius-large: 20px;
            --border-radius-xlarge: 25px;
        }

        /* ===== BODY & LAYOUT ===== */
        body {
            font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b7dd8 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== HEADER STYLES ===== */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius-xlarge);
            padding: 40px;
            text-align: center;
            box-shadow: 0 25px 50px var(--shadow-medium);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-green), #FFFFFF, var(--primary-green));
        }

        .school-info {
            background: linear-gradient(135deg, var(--dark-green), var(--light-green));
            color: white;
            padding: 20px;
            border-radius: var(--border-radius-medium);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: var(--dark-green);
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(26, 95, 63, 0.1);
            padding: 15px 20px;
            border-radius: var(--border-radius-medium);
            font-size: 0.9em;
            border: 2px solid rgba(26, 95, 63, 0.3);
            font-weight: 600;
        }

        /* ===== TAB NAVIGATION ===== */
        .tabs {
            display: flex;
            background: white;
            border-radius: var(--border-radius-large);
            overflow: hidden;
            box-shadow: 0 15px 35px var(--shadow-light);
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            font-size: 1.1em;
            font-weight: 700;
            min-width: 200px;
            background: var(--background-light);
        }

        .tab:hover {
            background: var(--border-light);
            transform: translateY(-2px);
        }

        .tab.active {
            color: white;
            transform: translateY(-3px);
        }

        /* Domain-specific tab colors */
        .tab.domain-1.active { 
            background: linear-gradient(135deg, var(--primary-blue), #2980b9); 
        }
        .tab.domain-2.active { 
            background: linear-gradient(135deg, var(--success-color), #229954); 
        }
        .tab.domain-3.active { 
            background: linear-gradient(135deg, var(--warning-color), #e67e22); 
        }
        .tab.domain-4.active { 
            background: linear-gradient(135deg, var(--primary-purple), #8e44ad); 
        }

        /* ===== FORM CONTAINER ===== */
        .form-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--border-radius-large);
            padding: 40px;
            box-shadow: 0 25px 50px var(--shadow-medium);
            backdrop-filter: blur(15px);
            display: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .form-container.active {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        /* Domain color mapping */
        .form-container[data-domain="1"] {
            --domain-color: #3498db;
            --domain-color-light: #5dade2;
            --domain-color-rgb: 52, 152, 219;
        }

        .form-container[data-domain="2"] {
            --domain-color: #27ae60;
            --domain-color-light: #58d68d;
            --domain-color-rgb: 39, 174, 96;
        }

        .form-container[data-domain="3"] {
            --domain-color: #f39c12;
            --domain-color-light: #f7dc6f;
            --domain-color-rgb: 243, 156, 18;
        }

        .form-container[data-domain="4"] {
            --domain-color: #9b59b6;
            --domain-color-light: #bb8fce;
            --domain-color-rgb: 155, 89, 182;
        }

        /* ===== DOMAIN STYLES ===== */
        .domain-title {
            font-size: 2.2em;
            color: var(--text-dark);
            margin-bottom: 30px;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 4px solid var(--domain-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            font-weight: 800;
        }

        .domain-icon {
            font-size: 1.8em;
            color: var(--domain-color);
        }

        /* ===== PROGRESS INDICATOR ===== */
        .progress-indicator {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: var(--border-radius-medium);
            margin-bottom: 30px;
            box-shadow: 0 10px 25px var(--shadow-light);
            border-right: 6px solid var(--domain-color);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--border-light);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px var(--shadow-light);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--domain-color), var(--domain-color-light));
            border-radius: 6px;
            transition: width 1s ease;
            position: relative;
            width: 0%;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .progress-text {
            text-align: center;
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1.1em;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* ===== INDICATOR SECTION ===== */
        .indicator-section {
            margin-bottom: 40px;
            background: linear-gradient(135deg, var(--background-light), #ffffff);
            border-radius: var(--border-radius-large);
            padding: 30px;
            border-right: 6px solid var(--domain-color);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .indicator-header {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--domain-color);
        }

        .indicator-code {
            background: var(--domain-color);
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 0.8em;
            font-weight: 600;
            flex-shrink: 0;
            box-shadow: 0 3px 10px var(--shadow-light);
        }

        .indicator-description {
            font-size: 1em;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            border-right: 3px solid var(--domain-color);
        }

        /* ===== EVIDENCE STYLES ===== */
        .evidence-list {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        .evidence-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius-medium);
            border: 2px solid var(--border-light);
            transition: all var(--transition-fast);
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .evidence-item:hover {
            border-color: var(--domain-color);
            box-shadow: 0 8px 25px var(--shadow-light);
            transform: translateY(-2px);
        }

        .evidence-text {
            flex: 1;
            font-weight: 600;
            color: var(--text-dark);
            line-height: 1.5;
        }

        .evidence-status {
            display: flex;
            gap: 12px;
            flex-shrink: 0;
        }

        /* ===== STATUS BUTTONS ===== */
        .status-btn {
            padding: 12px 20px;
            border: 2px solid;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 700;
            transition: all var(--transition-fast);
            background: white;
            min-width: 100px;
            text-align: center;
        }

        .status-btn.available {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .status-btn.available.selected {
            background: var(--success-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .status-btn.not-available {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .status-btn.not-available.selected {
            background: var(--danger-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        /* ===== NOTES SECTION ===== */
        .notes-section {
            margin-top: 25px;
        }

        .notes-section label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1.1em;
        }

        .notes-textarea {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-medium);
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: all var(--transition-fast);
            background: rgba(255, 255, 255, 0.8);
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--domain-color);
            box-shadow: 0 0 15px rgba(var(--domain-color-rgb), 0.3);
            background: white;
        }

        /* ===== FORM ACTIONS ===== */
        .form-actions {
            display: flex;
            gap: 20px;
            margin-top: 40px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 700;
            transition: all var(--transition-fast);
            box-shadow: 0 8px 20px var(--shadow-medium);
            min-width: 160px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px var(--shadow-heavy);
        }

        .btn-save { 
            background: linear-gradient(145deg, var(--success-color), #229954); 
            color: white; 
        }

        .btn-preview { 
            background: linear-gradient(145deg, var(--primary-blue), #2980b9); 
            color: white; 
        }

        .btn-back { 
            background: linear-gradient(145deg, #95a5a6, #7f8c8d); 
            color: white; 
        }

        /* ===== ALERT STYLES ===== */
        .alert {
            padding: 20px;
            border-radius: var(--border-radius-medium);
            margin-bottom: 25px;
            border-right: 4px solid;
            animation: slideInRight 0.6s ease;
            font-weight: 600;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-right-color: var(--success-color);
            color: #155724;
        }

        .alert-info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            border-right-color: var(--info-color);
            color: #0c5460;
        }

        .alert-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-right-color: var(--danger-color);
            color: #721c24;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes slideInRight {
            from { 
                transform: translateX(100%); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0); 
                opacity: 1; 
            }
        }

        @keyframes slideOutRight {
            from { 
                transform: translateX(0); 
                opacity: 1; 
            }
            to { 
                transform: translateX(100%); 
                opacity: 0; 
            }
        }

        @keyframes shimmer {
            0% { 
                transform: translateX(-100%); 
            }
            100% { 
                transform: translateX(100%); 
            }
        }

        @keyframes fadeInOut {
            0% { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(0); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-20px); 
            }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container { 
                padding: 10px; 
            }
            
            .header { 
                padding: 25px 20px; 
            }
            
            .header h1 { 
                font-size: 1.8em; 
            }
            
            .user-info { 
                position: static; 
                margin-bottom: 20px; 
                text-align: center; 
            }
            
            .tabs { 
                flex-direction: column; 
            }
            
            .tab { 
                min-width: auto; 
            }
            
            .domain-title { 
                font-size: 1.6em; 
                flex-direction: column; 
                gap: 15px; 
            }
            
            .indicator-header { 
                flex-direction: column; 
                align-items: flex-start; 
            }
            
            .evidence-item { 
                flex-direction: column; 
                gap: 15px; 
                align-items: stretch; 
            }
            
            .evidence-status { 
                justify-content: center; 
            }
            
            .form-actions { 
                flex-direction: column; 
            }
        }

        @media (max-width: 480px) {
            body { 
                padding: 10px; 
            }
            
            .form-container { 
                padding: 20px; 
            }
            
            .progress-stats { 
                flex-direction: column; 
                gap: 10px; 
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <div class="school-info">
                <h2>المملكة العربية السعودية - وزارة التعليم</h2>
                <p>قطاع أحد والعوالي - متوسطة المنذر بن عمرو الأنصاري</p>
                <p>مدير المدرسة: الأستاذ خالد المطيري</p>
            </div>
            
            <div class="user-info">
                <strong>المعلمون:</strong> <span id="teacher-name"> فريق التميز</span><br>
                <strong>التخصص:</strong> <span id="teacher-subject">الرياضيات ، العلوم , القراءة</span><br>
                <small>آخر دخول: <span id="last-login">2024-12-28 | 10:30 ص</span></small>
            </div>
            
            <h1>نظام معايير التقويم والاعتماد المدرسي</h1>
            <p>إدخال البيانات والشواهد للمجالات الأربعة الرئيسية</p>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab domain-1 active" onclick="TabManager.switchTab(1)">
                🏛️ الإدارة المدرسية
            </button>
            <button class="tab domain-2" onclick="TabManager.switchTab(2)">
                📚 التعليم والتعلم
            </button>
            <button class="tab domain-3" onclick="TabManager.switchTab(3)">
                🎯 نواتج التعلم
            </button>
            <button class="tab domain-4" onclick="TabManager.switchTab(4)">
                🏫 البيئة المدرسية
            </button>
        </nav>

        <!-- Domain 1: الإدارة المدرسية -->
        <main id="domain1" class="form-container active" data-domain="1">
            <div class="domain-title">
                <span class="domain-icon">🏛️</span>
                الإدارة المدرسية
            </div>

            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="domain1-progress"></div>
                </div>
                <div class="progress-text" id="domain1-text">0% مكتمل</div>
                <div class="progress-stats">
                    <span>المؤشرات المكتملة: <strong id="domain1-completed">0</strong></span>
                    <span>إجمالي المؤشرات: <strong>2</strong></span>
                </div>
            </div>

            <!-- Indicator 1-1 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>تضع المدرسة خطة تشغيلية مكتملة العناصر، وفق أهداف تطويرية محددة</span>
                    <span class="indicator-code">1-1-1-1</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة وضع خطة تشغيلية مرنة تتضمن أهداف تطويرية طموحة وبرامج وأنشطة متنوعة ومبادرات نوعية ومؤشرات أداء ومهام ومسؤوليات مزمنة وواضحة ترتبط بأهدافها التطويرية ويشارك في إعدادها أعضاء الكادر التعليمي.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">توجد خطة تشغيلية</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 0)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 0)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تتضمن الخطة أهداف تطويرية</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 1)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 1)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تتضمن الخطة برامج ومبادرات وفق جدول زمني</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 2)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 2)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد بالخطة أدوار ومسؤوليات محددة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 3)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 3)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد بالخطة مؤشرات أداء لتحقق الأهداف</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 4)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 4)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes1-1">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes1-1" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(1, 0, this.value)"></textarea>
                </div>
            </section>

            <!-- Indicator 1-2 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>تتابع المدرسة تنفيذ خطتها وتطورها بما يضمن تحقيق أهدافها</span>
                    <span class="indicator-code">2-1-1-1</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة تنفيذ الأنشطة والبرامج وفق خطتها ومتابعة تنفيذها وتقويمها بانتظام وبأساليب متنوعة وفق مؤشرات أداء محددة وواضحة وتطويرها بما يضمن تحقيق أهدافها.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">تتابع المدرسة تنفيذ الأنشطة والبرامج وفق الخطة الزمنية</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 5)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 5)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تقوم المدرسة مدى تنفيذ الخطة التشغيلية وفق أهدافها</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 6)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 6)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تطور المدرسة خطتها بما يضمن تحقيق أهدافها</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 1, 7)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 1, 7)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes1-2">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes1-2" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(1, 1, this.value)"></textarea>
                </div>
            </section>

            <div class="form-actions">
                <button class="btn btn-save" onclick="DataManager.saveDomain(1)">حفظ البيانات</button>
                <button class="btn btn-preview" onclick="DataManager.previewData(1)">معاينة</button>
                <button class="btn btn-back" onclick="Navigation.goToDashboard()">العودة للوحة المدير</button>
            </div>
        </main>

        <!-- Domain 2: التعليم والتعلم -->
        <main id="domain2" class="form-container" data-domain="2">
            <div class="domain-title">
                <span class="domain-icon">📚</span>
                التعليم والتعلم
            </div>

            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="domain2-progress"></div>
                </div>
                <div class="progress-text" id="domain2-text">0% مكتمل</div>
                <div class="progress-stats">
                    <span>المؤشرات المكتملة: <strong id="domain2-completed">0</strong></span>
                    <span>إجمالي المؤشرات: <strong>2</strong></span>
                </div>
            </div>

            <!-- Indicator 2-1 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>تدعم المدرسة تنفيذ المناهج لتحقيق نواتج التعلم المستهدفة وفق الخطة الدراسية</span>
                    <span class="indicator-code">2-1-1-2</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة توفير أنشطة ومصادر متنوعة تدعم تعلم جميع موضوعات المحتوى وتركز على المعارف والمهارات النوعية واكتساب القيم الوطنية المستهدفة في محتوى المناهج وتتابع تنفيذها لتحقيق التوقعات العالية لنواتج التعلم وفق الخطة الدراسية.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">توجد مصادر متنوعة تدعم تعلم جميع موضوعات ومحتوى المنهج</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 0)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 0)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد أنشطة تعلم تركز على المعارف المستهدفة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 1)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 1)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد أنشطة تعلم تركز على المهارات النوعية المستهدفة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 2)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 2)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد أنشطة تعلم تركز على القيم الوطنية المستهدفة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 3)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 3)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes2-1">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes2-1" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(2, 0, this.value)"></textarea>
                </div>
            </section>

            <!-- Indicator 2-2 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>تقوم المدرسة أداء المتعلمين باستخدام أساليب وأدوات تقويم متنوعة وفاعلة</span>
                    <span class="indicator-code">1-1-2-2</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة تطبيق أساليب وأدوات تقويم فاعلة ومتنوعة تشخيصية وتكوينية وختامية لدعم التعلم وتظهر التمايز في مستويات أداء المتعلمين وتشجعهم على المشاركة في تقويم أدائهم وتحسينه بطرق متنوعة.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">توجد أساليب وأدوات تقويم متنوعة (تشخيصي، تكويني، ختامي)</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 4)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 4)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تطبق المدرسة أدوات تقويم متنوعة (تقويم ذاتي، تقويم الأقران، مهام مفتوحة النهاية، مشروعات، مهام أدائية)</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 5)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 5)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تقدم المدرسة أساليب وأدوات تقويم تحقق التمايز في مستويات أداء المتعلمين</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 2, 6)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 2, 6)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes2-2">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes2-2" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(2, 1, this.value)"></textarea>
                </div>
            </section>

            <div class="form-actions">
                <button class="btn btn-save" onclick="DataManager.saveDomain(2)">حفظ البيانات</button>
                <button class="btn btn-preview" onclick="DataManager.previewData(2)">معاينة</button>
                <button class="btn btn-back" onclick="Navigation.goToDashboard()">العودة للوحة المدير</button>
            </div>
        </main>

        <!-- Domain 3: نواتج التعلم -->
        <main id="domain3" class="form-container" data-domain="3">
            <div class="domain-title">
                <span class="domain-icon">🎯</span>
                نواتج التعلم
            </div>

            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="domain3-progress"></div>
                </div>
                <div class="progress-text" id="domain3-text">0% مكتمل</div>
                <div class="progress-stats">
                    <span>المؤشرات المكتملة: <strong id="domain3-completed">0</strong></span>
                    <span>إجمالي المؤشرات: <strong>2</strong></span>
                </div>
            </div>

            <!-- Indicator 3-1 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>يشارك المتعلمون في الأنشطة المجتمعية والأعمال التطوعية</span>
                    <span class="indicator-code">4-1-2-3</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة تصميم برامج وأنشطة نوعية تحفز المتعلمين على المشاركة في الأعمال التطوعية لخدمة المجتمع ودعم مشاركتهم فيها بإيجابية وتوظيف ما تعلموه في إيجاد حلول مبتكرة تعزز الشعور بالمسؤولية.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">تنفذ المدرسة برامج وأنشطة توضح أهمية المشاركة في أعمال التطوع وتأثيرها الإيجابي على المجتمع</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 3, 0)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 3, 0)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">تقدم المدرسة فرصاً تطوعية مناسبة للمتعلمين</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 3, 1)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 3, 1)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">يشارك 90% فأكثر من المتعلمين في الأعمال المجتمعية والتطوعية داخل المدرسة وخارجها</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 3, 2)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 3, 2)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes3-1">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes3-1" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(3, 0, this.value)"></textarea>
                </div>
            </section>

            <!-- Indicator 3-2 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>يلتزم المتعلمون بقواعد السلوك والانضباط المدرسي</span>
                    <span class="indicator-code">5-1-2-3</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة متابعة التزام المتعلمين بقواعد السلوك والانضباط المدرسي من خلال تطوير برامج وأنشطة متنوعة وإعداد الأدلة والمنشورات التي تسهم في التوجيه النوعي؛ لاكتساب الانضباط الذاتي وتجسيد قواعد السلوك المسؤول لديهم.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">نسبة المتعلمين الملتزمين بقواعد السلوك 90% فأعلى</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 3, 3)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 3, 3)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">نسبة المتعلمين الملتزمين المنتظمين في الحضور 90% فأعلى</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 3, 4)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 3, 4)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes3-2">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes3-2" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(3, 1, this.value)"></textarea>
                </div>
            </section>

            <div class="form-actions">
                <button class="btn btn-save" onclick="DataManager.saveDomain(3)">حفظ البيانات</button>
                <button class="btn btn-preview" onclick="DataManager.previewData(3)">معاينة</button>
                <button class="btn btn-back" onclick="Navigation.goToDashboard()">العودة للوحة المدير</button>
            </div>
        </main>

        <!-- Domain 4: البيئة المدرسية -->
        <main id="domain4" class="form-container" data-domain="4">
            <div class="domain-title">
                <span class="domain-icon">🏫</span>
                البيئة المدرسية
            </div>

            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="domain4-progress"></div>
                </div>
                <div class="progress-text" id="domain4-text">0% مكتمل</div>
                <div class="progress-stats">
                    <span>المؤشرات المكتملة: <strong id="domain4-completed">0</strong></span>
                    <span>إجمالي المؤشرات: <strong>2</strong></span>
                </div>
            </div>

            <!-- Indicator 4-1 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>تتوافر في فصول المدرسة ومعاملها وجميع مرافقها متطلبات الأمن والسلامة</span>
                    <span class="indicator-code">1-1-2-4</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة توفير متطلبات الأمن والسلامة في مبنى المدرسة والفصول وجميع مرافقها وتتابعها بانتظام وتعزيز ثقافة الأمن والسلامة والتوعية بالمخاطر المحتملة ومتابعة سلامة المتعلمين في مرافق المدرسة وأثناء الدخول والخروج منها.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">يوجد تقرير الأمن والسلامة من إدارة التعليم ساري العمل به أو شهادة الأمن والسلامة من الدفاع المدني</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 4, 0)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 4, 0)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">يوجد متطلبات الأمن والسلامة مناسبة لاحتياجات جميع المتعلمين بمن فيهم ذوي الإعاقة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 4, 1)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 4, 1)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد لوحات إرشادية توضح تعليمات الأمن والسلامة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 4, 2)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 4, 2)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes4-1">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes4-1" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(4, 0, this.value)"></textarea>
                </div>
            </section>

            <!-- Indicator 4-2 -->
            <section class="indicator-section">
                <div class="indicator-header">
                    <span>تعمل المدرسة على صيانة جميع مرافق المبنى وتجهيزاته بانتظام</span>
                    <span class="indicator-code">2-1-2-4</span>
                </div>
                
                <div class="indicator-description">
                    يتوقع من المدرسة العمل على متابعة الصيانة لجميع المرافق والتجهيزات بانتظام بما يضمن استدامة كفاءة المبنى المدرسي وفاعليته في تلبية متطلبات العملية التعليمية وتحقيق الرفاه فيها.
                </div>
                
                <div class="evidence-list">
                    <div class="evidence-item">
                        <div class="evidence-text">توجد صيانة (وقائية وعلاجية) مستمرة لمرافق مبنى المدرسة وتجهيزاته</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 4, 3)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 4, 3)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد صيانة (وقائية وعلاجية) شاملة تغطي جميع المرافق والتجهيزات في المدرسة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 4, 4)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 4, 4)">غير متوفر</button>
                        </div>
                    </div>
                    
                    <div class="evidence-item">
                        <div class="evidence-text">توجد إجراءات محددة للمحافظة على سلامة المرافق والمعدات داخل المدرسة</div>
                        <div class="evidence-status">
                            <button class="status-btn available" onclick="EvidenceManager.toggleStatus(this, 4, 5)">متوفر</button>
                            <button class="status-btn not-available" onclick="EvidenceManager.toggleStatus(this, 4, 5)">غير متوفر</button>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <label for="notes4-2">ملاحظات إضافية:</label>
                    <textarea class="notes-textarea" id="notes4-2" 
                              placeholder="أضف أي ملاحظات أو تفاصيل إضافية حول هذا المؤشر..."
                              onchange="DataManager.updateNotes(4, 1, this.value)"></textarea>
                </div>
            </section>

            <div class="form-actions">
                <button class="btn btn-save" onclick="DataManager.saveDomain(4)">حفظ البيانات</button>
                <button class="btn btn-preview" onclick="DataManager.previewData(4)">معاينة</button>
                <button class="btn btn-back" onclick="Navigation.goToDashboard()">العودة للوحة المدير</button>
            </div>
        </main>
    </div>

    <script>
        'use strict';

        // ===== CONFIGURATION & CONSTANTS =====
        const CONFIG = {
            DOMAIN_NAMES: {
                1: 'الإدارة المدرسية',
                2: 'التعليم والتعلم', 
                3: 'نواتج التعلم',
                4: 'البيئة المدرسية'
            },
            STORAGE_KEYS: {
                EVIDENCE_DATA: 'teacherEvidenceData',
                DASHBOARD_UPDATES: 'dashboardUpdates',
                TEACHER_HEARTBEAT: 'teacherHeartbeat'
            },
            AUTO_SAVE_INTERVAL: 180000,
            HEARTBEAT_INTERVAL: 60000,
            MAX_UPDATES_HISTORY: 100
        };

        const DOMAIN_STRUCTURE = {
            1: { totalIndicators: 2, totalEvidences: 8 },
            2: { totalIndicators: 2, totalEvidences: 7 },
            3: { totalIndicators: 2, totalEvidences: 5 },
            4: { totalIndicators: 2, totalEvidences: 6 }
        };

        // ===== GLOBAL STATE MANAGEMENT =====
        const AppState = {
            currentDomain: 1,
            domainData: {},
            isLoading: false,
            lastAutoSave: null,

            init() {
                for (let domainId = 1; domainId <= 4; domainId++) {
                    this.domainData[domainId] = {
                        evidences: {},
                        notes: {},
                        lastModified: null
                    };
                }
                this.loadSavedData();
            },

            loadSavedData() {
                try {
                    const savedData = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.EVIDENCE_DATA) || '{}');
                    Object.keys(savedData).forEach(domainId => {
                        if (this.domainData[domainId]) {
                            Object.assign(this.domainData[domainId], savedData[domainId]);
                        }
                    });
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            },

            saveData(domainId = null) {
                try {
                    const dataToSave = domainId ? 
                        { [domainId]: this.domainData[domainId] } : 
                        this.domainData;
                    
                    const existingData = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.EVIDENCE_DATA) || '{}');
                    Object.assign(existingData, dataToSave);
                    
                    localStorage.setItem(CONFIG.STORAGE_KEYS.EVIDENCE_DATA, JSON.stringify(existingData));
                    this.lastAutoSave = new Date();
                    
                    return true;
                } catch (error) {
                    console.error('Error saving data:', error);
                    return false;
                }
            }
        };

        // ===== UTILITIES =====
        const NotificationManager = {
            showSuccess(message) {
                this.showNotification(message, 'success');
            },

            showError(message) {
                this.showNotification(message, 'error');
            },

            showInfo(message) {
                this.showNotification(message, 'info');
            },

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `alert alert-${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    max-width: 450px;
                    z-index: 1000;
                    animation: slideInRight 0.5s ease;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                `;
                notification.innerHTML = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.5s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 500);
                }, 5000);
            }
        };

        // ===== TAB MANAGEMENT =====
        const TabManager = {
            switchTab(domainId) {
                if (AppState.isLoading) return;
                
                // Update current domain
                AppState.currentDomain = domainId;
                
                // Hide all form containers
                document.querySelectorAll('.form-container').forEach(container => {
                    container.classList.remove('active');
                });
                
                // Show target form container
                const targetContainer = document.getElementById(`domain${domainId}`);
                if (targetContainer) {
                    targetContainer.classList.add('active');
                }
                
                // Update tab states
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelector(`.tab.domain-${domainId}`).classList.add('active');
                
                // Update progress for current domain
                ProgressManager.updateProgress(domainId);
                
                // Load saved data for current domain
                this.loadDomainData(domainId);
            },

            loadDomainData(domainId) {
                const domainData = AppState.domainData[domainId];
                if (!domainData) return;

                // Load evidence states
                Object.keys(domainData.evidences).forEach(evidenceIndex => {
                    const isAvailable = domainData.evidences[evidenceIndex];
                    const evidenceItems = document.querySelectorAll(`#domain${domainId} .evidence-item`);
                    
                    if (evidenceItems[evidenceIndex]) {
                        const buttons = evidenceItems[evidenceIndex].querySelectorAll('.status-btn');
                        buttons.forEach(btn => btn.classList.remove('selected'));
                        
                        if (isAvailable !== undefined) {
                            const targetBtn = isAvailable ? 
                                evidenceItems[evidenceIndex].querySelector('.status-btn.available') :
                                evidenceItems[evidenceIndex].querySelector('.status-btn.not-available');
                            
                            if (targetBtn) {
                                targetBtn.classList.add('selected');
                            }
                        }
                    }
                });

                // Load notes
                Object.keys(domainData.notes).forEach(indicatorIndex => {
                    const noteTextarea = document.getElementById(`notes${domainId}-${parseInt(indicatorIndex) + 1}`);
                    if (noteTextarea) {
                        noteTextarea.value = domainData.notes[indicatorIndex] || '';
                    }
                });
            }
        };

        // ===== EVIDENCE MANAGEMENT =====
        const EvidenceManager = {
            toggleStatus(button, domainId, evidenceIndex) {
                const evidenceItem = button.closest('.evidence-item');
                const buttons = evidenceItem.querySelectorAll('.status-btn');
                
                // Remove selection from all buttons in this evidence item
                buttons.forEach(btn => btn.classList.remove('selected'));
                
                // Add selection to clicked button
                button.classList.add('selected');
                
                // Determine the status
                const isAvailable = button.classList.contains('available');
                
                // Update app state
                if (!AppState.domainData[domainId]) {
                    AppState.domainData[domainId] = { evidences: {}, notes: {} };
                }
                
                AppState.domainData[domainId].evidences[evidenceIndex] = isAvailable;
                AppState.domainData[domainId].lastModified = new Date().toISOString();
                
                // Update progress
                ProgressManager.updateProgress(domainId);
                
                // Auto-save
                AppState.saveData(domainId);
                
                // Show feedback
                const statusText = isAvailable ? 'متوفر' : 'غير متوفر';
                NotificationManager.showInfo(`تم تحديث حالة الشاهد إلى: ${statusText}`);
            }
        };

        // ===== PROGRESS MANAGEMENT =====
        const ProgressManager = {
            updateProgress(domainId) {
                const domainStructure = DOMAIN_STRUCTURE[domainId];
                if (!domainStructure) return;

                const domainData = AppState.domainData[domainId];
                const evidenceCount = Object.keys(domainData?.evidences || {}).length;
                const completedIndicators = this.calculateCompletedIndicators(domainId);
                
                const progressPercentage = (evidenceCount / domainStructure.totalEvidences) * 100;
                
                // Update progress bar
                const progressFill = document.getElementById(`domain${domainId}-progress`);
                const progressText = document.getElementById(`domain${domainId}-text`);
                const completedSpan = document.getElementById(`domain${domainId}-completed`);
                
                if (progressFill) {
                    progressFill.style.width = `${progressPercentage}%`;
                }
                
                if (progressText) {
                    progressText.textContent = `${Math.round(progressPercentage)}% مكتمل`;
                }
                
                if (completedSpan) {
                    completedSpan.textContent = completedIndicators;
                }
            },

            calculateCompletedIndicators(domainId) {
                const domainData = AppState.domainData[domainId];
                if (!domainData || !domainData.evidences) return 0;

                const evidencesByIndicator = this.groupEvidencesByIndicator(domainId);
                let completedIndicators = 0;

                Object.keys(evidencesByIndicator).forEach(indicatorIndex => {
                    const indicatorEvidences = evidencesByIndicator[indicatorIndex];
                    const hasAllEvidences = indicatorEvidences.every(evidenceIndex => 
                        domainData.evidences.hasOwnProperty(evidenceIndex)
                    );
                    
                    if (hasAllEvidences) {
                        completedIndicators++;
                    }
                });

                return completedIndicators;
            },

            groupEvidencesByIndicator(domainId) {
                // Define evidence groupings by domain and indicator
                const groupings = {
                    1: { 0: [0, 1, 2, 3, 4], 1: [5, 6, 7] },
                    2: { 0: [0, 1, 2, 3], 1: [4, 5, 6] },
                    3: { 0: [0, 1, 2], 1: [3, 4] },
                    4: { 0: [0, 1, 2], 1: [3, 4, 5] }
                };

                return groupings[domainId] || {};
            }
        };

        // ===== DATA MANAGEMENT =====
        const DataManager = {
            updateNotes(domainId, indicatorIndex, value) {
                if (!AppState.domainData[domainId]) {
                    AppState.domainData[domainId] = { evidences: {}, notes: {} };
                }
                
                AppState.domainData[domainId].notes[indicatorIndex] = value;
                AppState.domainData[domainId].lastModified = new Date().toISOString();
                
                // Auto-save after note update
                AppState.saveData(domainId);
            },

            saveDomain(domainId) {
                AppState.isLoading = true;
                
                try {
                    const success = AppState.saveData(domainId);
                    
                    if (success) {
                        NotificationManager.showSuccess(`تم حفظ بيانات ${CONFIG.DOMAIN_NAMES[domainId]} بنجاح`);
                        this.updateDashboard(domainId);
                    } else {
                        NotificationManager.showError('حدث خطأ أثناء حفظ البيانات');
                    }
                } catch (error) {
                    console.error('Save error:', error);
                    NotificationManager.showError('حدث خطأ غير متوقع أثناء الحفظ');
                } finally {
                    AppState.isLoading = false;
                }
            },

            previewData(domainId) {
                const domainData = AppState.domainData[domainId];
                const domainName = CONFIG.DOMAIN_NAMES[domainId];
                
                let previewContent = `=== معاينة بيانات ${domainName} ===\n\n`;
                
                // Evidence summary
                const evidenceCount = Object.keys(domainData?.evidences || {}).length;
                const totalEvidences = DOMAIN_STRUCTURE[domainId].totalEvidences;
                
                previewContent += `الشواهد المكتملة: ${evidenceCount}/${totalEvidences}\n`;
                previewContent += `نسبة الإكمال: ${Math.round((evidenceCount / totalEvidences) * 100)}%\n\n`;
                
                // Evidence details
                if (domainData?.evidences) {
                    previewContent += "تفاصيل الشواهد:\n";
                    Object.entries(domainData.evidences).forEach(([index, status]) => {
                        const statusText = status ? '✅ متوفر' : '❌ غير متوفر';
                        previewContent += `- الشاهد ${parseInt(index) + 1}: ${statusText}\n`;
                    });
                }
                
                // Notes
                if (domainData?.notes) {
                    previewContent += "\nالملاحظات:\n";
                    Object.entries(domainData.notes).forEach(([index, note]) => {
                        if (note && note.trim()) {
                            previewContent += `- المؤشر ${parseInt(index) + 1}: ${note}\n`;
                        }
                    });
                }
                
                alert(previewContent);
            },

            updateDashboard(domainId) {
                try {
                    const updates = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.DASHBOARD_UPDATES) || '[]');
                    
                    const update = {
                        domainId,
                        domainName: CONFIG.DOMAIN_NAMES[domainId],
                        timestamp: new Date().toISOString(),
                        evidenceCount: Object.keys(AppState.domainData[domainId]?.evidences || {}).length,
                        totalEvidences: DOMAIN_STRUCTURE[domainId].totalEvidences,
                        teacherName: document.getElementById('teacher-name')?.textContent || 'غير محدد'
                    };
                    
                    updates.unshift(update);
                    
                    // Keep only recent updates
                    if (updates.length > CONFIG.MAX_UPDATES_HISTORY) {
                        updates.splice(CONFIG.MAX_UPDATES_HISTORY);
                    }
                    
                    localStorage.setItem(CONFIG.STORAGE_KEYS.DASHBOARD_UPDATES, JSON.stringify(updates));
                } catch (error) {
                    console.error('Dashboard update error:', error);
                }
            }
        };

        // ===== NAVIGATION =====
        const Navigation = {
            goToDashboard() {
                if (confirm('هل تريد العودة إلى لوحة المدير؟ سيتم حفظ جميع التغييرات.')) {
                    // Save all data before leaving
                    AppState.saveData();
                    
                    // In a real application, this would navigate to the dashboard
                    NotificationManager.showInfo('سيتم توجيهك إلى لوحة المدير...');
                    
                    // Simulate navigation delay
                    setTimeout(() => {
                        window.location.href = '#dashboard'; // Replace with actual dashboard URL
                    }, 1500);
                }
            }
        };

        // ===== HEARTBEAT SYSTEM =====
        const HeartbeatManager = {
            start() {
                setInterval(() => {
                    const heartbeat = {
                        timestamp: new Date().toISOString(),
                        currentDomain: AppState.currentDomain,
                        teacherName: document.getElementById('teacher-name')?.textContent || 'غير محدد'
                    };
                    
                    localStorage.setItem(CONFIG.STORAGE_KEYS.TEACHER_HEARTBEAT, JSON.stringify(heartbeat));
                }, CONFIG.HEARTBEAT_INTERVAL);
            }
        };

        // ===== AUTO-SAVE SYSTEM =====
        const AutoSaveManager = {
            start() {
                setInterval(() => {
                    if (AppState.lastAutoSave === null || 
                        (new Date() - AppState.lastAutoSave) > CONFIG.AUTO_SAVE_INTERVAL) {
                        
                        AppState.saveData();
                        console.log('Auto-save completed at:', new Date().toISOString());
                    }
                }, CONFIG.AUTO_SAVE_INTERVAL);
            }
        };

        // ===== APPLICATION INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Initialize app state
                AppState.init();
                
                // Load initial data for domain 1
                TabManager.loadDomainData(1);
                
                // Update initial progress
                for (let i = 1; i <= 4; i++) {
                    ProgressManager.updateProgress(i);
                }
                
                // Start background services
                HeartbeatManager.start();
                AutoSaveManager.start();
                
                // Update login time
                const loginElement = document.getElementById('last-login');
                if (loginElement) {
                    const now = new Date();
                    const timeString = now.toLocaleDateString('ar-SA') + ' | ' + 
                                     now.toLocaleTimeString('ar-SA', { 
                                         hour: '2-digit', 
                                         minute: '2-digit',
                                         hour12: true 
                                     });
                    loginElement.textContent = timeString;
                }
                
                // Show welcome message
                NotificationManager.showInfo('مرحباً بك في نظام معايير التقويم والاعتماد المدرسي');
                
                console.log('School Evaluation System initialized successfully');
                
            } catch (error) {
                console.error('Initialization error:', error);
                NotificationManager.showError('حدث خطأ أثناء تحميل النظام');
            }
        });

        // ===== ERROR HANDLING =====
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            NotificationManager.showError('حدث خطأ غير متوقع في النظام');
        });

        // ===== PREVENT DATA LOSS =====
        window.addEventListener('beforeunload', function(event) {
            // Save data before page unload
            AppState.saveData();
        });

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', function(event) {
            // Ctrl+S to save current domain
            if (event.ctrlKey && event.key === 's') {
                event.preventDefault();
                DataManager.saveDomain(AppState.currentDomain);
            }
            
            // Ctrl+1,2,3,4 to switch domains
            if (event.ctrlKey && event.key >= '1' && event.key <= '4') {
                event.preventDefault();
                const domainId = parseInt(event.key);
                TabManager.switchTab(domainId);
            }
        });

        // ===== UTILITY FUNCTIONS =====
        function formatDate(dateString) {
            if (!dateString) return 'غير محدد';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ar-SA') + ' ' + 
                       date.toLocaleTimeString('ar-SA', { 
                           hour: '2-digit', 
                           minute: '2-digit' 
                       });
            } catch (error) {
                return 'غير صحيح';
            }
        }

        function validateDomainData(domainId, domainData) {
            if (!domainData) return false;
            
            const requiredEvidences = DOMAIN_STRUCTURE[domainId]?.totalEvidences || 0;
            const availableEvidences = Object.keys(domainData.evidences || {}).length;
            
            return availableEvidences >= requiredEvidences * 0.8; // 80% completion threshold
        }

        function exportDomainData(domainId) {
            const domainData = AppState.domainData[domainId];
            const exportData = {
                domainId,
                domainName: CONFIG.DOMAIN_NAMES[domainId],
                exportDate: new Date().toISOString(),
                data: domainData
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                type: 'application/json' 
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `domain_${domainId}_data.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ===== PUBLIC API =====
        window.SchoolEvaluationSystem = {
            TabManager,
            EvidenceManager,
            DataManager,
            Navigation,
            ProgressManager,
            AppState,
            CONFIG,
            exportDomainData,
            validateDomainData
        };

    </script>
</body>
</html>
             
