<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-TileColor" content="#2563eb">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-152x152.png">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨ - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ">
    <meta name="keywords" content="Ù…Ø®Ø§Ù„ÙØ§ØªØŒ Ø³Ù„ÙˆÙƒÙŠØ©ØŒ Ù…Ø¯Ø±Ø³Ø©ØŒ Ø·Ù„Ø§Ø¨ØŒ Ø¥Ø¯Ø§Ø±Ø©">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f9fafb;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* PWA Install Button Animation */
        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .install-button {
            animation: slideInUp 0.5s ease-out;
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .bounce-animation {
            animation: bounce 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay" style="display: none;">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-white text-lg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app"></div>

    <!-- Firebase SDK v9 (Modular) -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, updateDoc, doc, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB5pU4C0OamFsZ_bSo649zhKV36Wycpn_g",
            authDomain: "shahid-b3b9d.firebaseapp.com",
            projectId: "shahid-b3b9d",
            storageBucket: "shahid-b3b9d.firebasestorage.app",
            messagingSenderId: "28532023353",
            appId: "1:28532023353:web:37e380f875a4482cf3ede8",
            measurementId: "G-32145C7GYW"
        };

        // Initialize Firebase
        let app;
        let db;
        let isFirebaseInitialized = false;

        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            isFirebaseInitialized = true;
            console.log('âœ… Firebase initialized successfully');
            window.db = db;
            window.isFirebaseInitialized = true;
            window.firestoreModules = { collection, getDocs, addDoc, updateDoc, doc, orderBy, query };
        } catch (error) {
            console.error('âŒ Firebase initialization error:', error);
            window.isFirebaseInitialized = false;
        }
    </script>

    <script>
        'use strict';

        // ==========================================
        // Firebase Configuration (loaded from module script)
        // ==========================================
        let db;
        let isFirebaseInitialized = false;
        
        // Wait for Firebase to initialize
        setTimeout(() => {
            if (window.isFirebaseInitialized) {
                db = window.db;
                isFirebaseInitialized = true;
                initApp();
            } else {
                console.error('Firebase failed to initialize');
                initApp(); // Continue without Firebase
            }
        }, 1000);

        // ==========================================
        // Constants & Configuration
        // ==========================================
        const COLLECTIONS = {
            violations: 'violations',
            studentActions: 'studentActions',
            notificationsSent: 'notificationsSent'
        };

        const teachersList = [
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø·Ø± Ø¨Ù† Ù…ØµÙ„Ø­ Ø§Ù„Ø¹Ù…Ø±ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù…Ø§Ø±ÙŠ Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ',
            'Ù…ÙˆÙÙ‚ Ù…Ø±Ø²ÙˆÙ‚ Ø³ÙˆÙŠØ±Ø­ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙˆØ§Ø² Ø²Ø§ÙŠØ¯ Ù„Ø§ÙÙŠ Ø§Ù„Ù…Ù‡ÙŠÙ…Ø²ÙŠ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ',
            'ÙÙŠØµÙ„ Ø¹Ø·Ø§Ù„Ù„Ù‡ Ø­ÙˆÙŠÙ…Ø¯ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ',
            'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹ÙŠØ§Ø¯ Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ù…ÙˆØ¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø³Ø§ÙŠØ± ÙÙŠØµÙ„ Ø³Ø¹Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¶ÙŠÙ„Ù‡ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ù†Ø§ÙØ¹ Ø´Ø¹ÙˆÙŠ Ù†Ø§ÙØ¹ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ø§Ø³Ø§Ù…Ù‡ Ù…Ù†ÙˆØ± Ù…Ø´Ø¹Ù„ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¹ÙŠØ§Ø¯ Ø¹Ù„ÙŠØ«Ù‡ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙØ®Ø±ÙŠ Ø§Ù„ØªØ±ÙƒÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø­Ø§Ù…Ø¯ Ù‡Ù„Ø§Ù„ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ù…ÙŠØ§Ù† Ø¹Ù„ÙŠ Ù†Ù…ÙŠØ§Ù† Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ØµÙ„Ø§Ø­ ØµØ§Ù„Ø­ Ø§Ù„Ø±Ø­ÙŠÙ„Ù‰',
            'Ù…Ø´Ø¹Ù„ Ø¨Ù† Ù‡Ù„ÙŠÙ„ Ø¨Ù† ØºØ§Ù„Ø¨ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ù„ÙŠ Ù…ØªØ¹Ø¨ Ù†Ø§ØµØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø³ÙŠÙ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù†Ø¹Ù… Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø¹Ø§Ø±Ø¶ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø°Ø¹Ø§Ø± Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'ÙØ¤Ø§Ø¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ù…Ø§Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ',
            'Ø­Ù…Ø²Ø© ØµØ¯Ù‚Ø© Ø­Ù…Ø²Ø© Ø§Ø³Ù„Ø§Ù…',
            'Ø³Ù„Ù…Ø§Ù† ØµØ§Ù„Ø­ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ',
            'Ø¹Ø¨ÙŠØ¯ Ø¨Ù† Ø¯Ø®ÙŠÙ„ Ø¨Ù† Ø¯ÙˆÙŠÙ‡ÙŠØ³ Ø§Ù„Ø¹ÙŠØ§Ø¶ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…ÙÙ„Ø­ Ù†ÙˆÙŠØ¹Ù… Ø§Ù„Ø±ÙˆÙŠØ«ÙŠ',
            'ÙÙŠØµÙ„ Ø¹ÙˆØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ Ø³Ù„Ù…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„ Ø¨Ø­Ø±Ø§Ù† Ø§Ù„Ù‚Ø±Ù†ÙŠ',
            'ÙƒØ§ØªØ¨ Ù…ÙÙ„Ø­ Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯Ù‰',
            'Ø­Ø¨ÙŠØ¨ Ø¹Ù„ÙŠ Ù†Ø¹ÙŠØ³ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø§ÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
            'Ø³Ù„Ø·Ø§Ù† Ø¹ÙˆÙŠØ¶ Ù…Ø¹ÙŠØ¶ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ù…Ø¹ÙŠØ¶ Ù…Ø¹Ù„Ø§ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† ØºÙ„Ø§Ø¨ Ø§Ù„Ù…Ø®Ù„ÙÙŠ',
            'Ø³Ø¹Ø¯ Ø·Ø§Ù„Ø¹ Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ø§Ù‡Ø± Ù…Ø´Ø¹Ù„ Ø¹ÙˆÙŠØ¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ù…ÙˆØ³Ù‰ ØºØ§Ø²ÙŠ Ø³ÙØ± Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù…ÙˆØ³Ù‰ Ù…Ø³Ø¹ÙˆØ¯ Ø¹Ø§ÙŠØ¶ Ø§Ù„Ø­ÙŠØ³ÙˆÙ†ÙŠ',
            'Ù†ÙˆØ§Ù Ù…Ù†ØµÙˆØ± Ø¹ÙˆØ§Ø¯ Ø§Ù„ØµØ¨Ø­ÙŠ',
            'Ø¨Ø¯Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø´Ø§Ø¦Ø¯ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙ‡Ø¯ Ø¹ÙˆÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø§ÙŠØ¯ Ø®Ø¶Ø±Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ',
            'Ø£Ø­Ù…Ø¯ Ù…Ø·Ø± Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ'
        ];

        const config = {
            passwords: {
                principal: 'A2030',
                assistant: 'B2030',
                counselor: 'C2030',
                admin_assistant: 'D2030'
            },
            schoolInfo: {
                name: 'Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ',
                principal: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
                assistant: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
                counselor: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
                adminAssistant: 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ',
                type: 'Ø¨Ù†ÙŠÙ†'
            },
            grades: ['Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·'],
            sections: ['1', '2', '3', '4', '5', '6'],
            violationTypes: {
                first: {
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)',
                    items: [
                        'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
                        'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©',
                        'Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆÙ…Ù†Ù‡Ø§ Ø§Ù„Ø£ÙƒÙ„ ÙˆØ§Ù„Ø´Ø±Ø¨ ÙˆØ§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ',
                        'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
                        'ØªÙƒØ±Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©',
                        'Ø§Ù„ØªØ¬Ù…Ù‡Ø± Ø£Ù…Ø§Ù… Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'
                    ]
                },
                second: {
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø¯Ø±Ø¬ØªÙŠÙ†)',
                    items: [
                        'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
                        'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ÙØµÙ„ Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
                        'Ø¯Ø®ÙˆÙ„ ÙØµÙ„ Ø¢Ø®Ø± Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
                        'Ø¥Ø«Ø§Ø±Ø© Ø§Ù„ÙÙˆØ¶Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ'
                    ]
                },
                third: {
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)',
                    items: [
                        'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
                        'Ø¥Ù„Ø­Ø§Ù‚ Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ù…ØªØ¹Ù…Ø¯ Ø¨Ù…Ù…ØªÙ„ÙƒØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨',
                        'Ø§Ù„Ø¹Ø¨Ø« Ø¨ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø©',
                        'Ø§Ù…ØªÙ‡Ø§Ù† Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©'
                    ]
                }
            }
        };

        // ==========================================
        // Application State
        // ==========================================
        let state = {
            currentUser: { 
                role: 'teacher', 
                name: teachersList[0],
                id: 1
            },
            authenticated: {
                principal: false,
                assistant: false,
                counselor: false,
                admin_assistant: false
            },
            violations: [],
            studentActions: [],
            notificationsSent: [],
            filters: {
                selectedTab: 'all',
                searchStudent: '',
                filterGrade: '',
                filterSection: '',
                dateFrom: '',
                dateTo: ''
            },
            modals: {
                showAddForm: false,
                showDetailsModal: false,
                selectedViolation: null,
                showActionModal: false,
                selectedStudent: null
            },
            newViolation: {
                studentName: '',
                grade: '',
                section: '',
                violationType: 'first',
                violationDetails: '',
                documentation: '',
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5)
            }
        };

        // ==========================================
        // Utility Functions
        // ==========================================
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function sanitizeForJson(obj) {
            return JSON.parse(JSON.stringify(obj));
        }

        // [Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ - Ø³Ø£Ø¶ÙŠÙ ÙÙ‚Ø· ÙƒÙˆØ¯ PWA ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©]
        // ... (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† getStudentViolationCount Ø­ØªÙ‰ initApp)
        
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø­ØªÙØ¸ Ø¨ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ ÙƒÙ…Ø§ Ù‡ÙˆØŒ ÙˆØ£Ø¶Ù Ø§Ù„ØªØ§Ù„ÙŠ Ù‚Ø¨Ù„ </script>
    </script>
    
    <!-- ==========================================
         PWA Service Worker Registration
         ========================================== -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification();
                                }
                            });
                        });
                        
                        // Request notification permission
                        if ('Notification' in window && Notification.permission === 'default') {
                            setTimeout(() => {
                                Notification.requestPermission().then((permission) => {
                                    if (permission === 'granted') {
                                        console.log('âœ… Notifications enabled');
                                    }
                                });
                            }, 5000);
                        }
                    })
                    .catch((error) => {
                        console.error('âŒ Service Worker registration failed:', error);
                    });
            });
        }

        // Install button
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        function showInstallButton() {
            if (document.getElementById('pwa-install-btn')) return;
            
            const btn = document.createElement('button');
            btn.id = 'pwa-install-btn';
            btn.className = 'install-button fixed bottom-6 left-6 bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-full shadow-2xl hover:shadow-3xl hover:scale-105 transition-all duration-300 z-50 font-bold text-base flex items-center gap-2';
            btn.innerHTML = `
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                </svg>
                ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            `;
            
            btn.onclick = async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    btn.style.opacity = '0';
                    setTimeout(() => btn.remove(), 300);
                }
                deferredPrompt = null;
            };
            
            document.body.appendChild(btn);
        }

        window.addEventListener('appinstalled', () => {
            const btn = document.getElementById('pwa-install-btn');
            if (btn) {
                btn.style.opacity = '0';
                setTimeout(() => btn.remove(), 300);
            }
            showSuccessMessage('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
        });

        // Network status
        window.addEventListener('online', () => {
            showNetworkStatus('Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª âœ“', 'success');
        });

        window.addEventListener('offline', () => {
            showNetworkStatus('ØºÙŠØ± Ù…ØªØµÙ„ - ÙˆØ¶Ø¹ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„', 'warning');
        });

        function showNetworkStatus(message, type) {
            const div = document.createElement('div');
            div.className = `fixed top-24 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-xl z-50 font-bold ${
                type === 'success' ? 'bg-green-600 text-white' : 'bg-orange-600 text-white'
            }`;
            div.textContent = message;
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.style.opacity = '0';
                div.style.transition = 'opacity 0.3s';
                setTimeout(() => div.remove(), 300);
            }, 3000);
        }

        function showSuccessMessage(message) {
            const div = document.createElement('div');
            div.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-8 py-6 rounded-xl shadow-2xl z-[60] text-center';
            div.innerHTML = `<div class="text-6xl mb-4">âœ…</div><div class="text-xl font-bold text-gray-900">${message}</div>`;
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.style.opacity = '0';
                div.style.transition = 'opacity 0.3s';
                setTimeout(() => div.remove(), 300);
            }, 2500);
        }

        function showUpdateNotification() {
            const div = document.createElement('div');
            div.className = 'fixed bottom-24 left-6 bg-blue-600 text-white px-6 py-4 rounded-lg shadow-2xl z-50 max-w-sm';
            div.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="text-2xl">ğŸ”„</div>
                    <div class="flex-1">
                        <div class="font-bold mb-1">ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­!</div>
                        <div class="text-sm text-blue-100 mb-3">ÙŠÙˆØ¬Ø¯ Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
                        <button onclick="window.location.reload()" class="bg-white text-blue-600 px-4 py-2 rounded font-bold text-sm hover:bg-blue-50">
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.style.opacity = '0';
                div.style.transition = 'opacity 0.3s';
                setTimeout(() => div.remove(), 300);
            }, 10000);
        }
    </script>
</body>
</html>
