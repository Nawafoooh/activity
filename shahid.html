<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .modal-backdrop { backdrop-filter: blur(4px); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #f59e0b; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>
    <script>
        /* ========== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ========== */
        const teachersList = [
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø·Ø± Ø¨Ù† Ù…ØµÙ„Ø­ Ø§Ù„Ø¹Ù…Ø±ÙŠ','Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù…Ø§Ø±ÙŠ Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ','Ù…ÙˆÙÙ‚ Ù…Ø±Ø²ÙˆÙ‚ Ø³ÙˆÙŠØ±Ø­ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙˆØ§Ø² Ø²Ø§ÙŠØ¯ Ù„Ø§ÙÙŠ Ø§Ù„Ù…Ù‡ÙŠÙ…Ø²ÙŠ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ','ÙÙŠØµÙ„ Ø¹Ø·Ø§Ù„Ù„Ù‡ Ø­ÙˆÙŠÙ…Ø¯ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ','Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹ÙŠØ§Ø¯ Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ù…ÙˆØ¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ø³Ø§ÙŠØ± ÙÙŠØµÙ„ Ø³Ø¹Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¶ÙŠÙ„Ù‡ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ','Ù†Ø§ÙØ¹ Ø´Ø¹ÙˆÙŠ Ù†Ø§ÙØ¹ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ø§Ø³Ø§Ù…Ù‡ Ù…Ù†ÙˆØ± Ù…Ø´Ø¹Ù„ Ø§Ù„Ø¹ÙˆÙÙŠ','Ù…Ø­Ù…Ø¯ Ø¹ÙŠØ§Ø¯ Ø¹Ù„ÙŠØ«Ù‡ Ø§Ù„Ø¹ÙˆÙÙŠ','Ø£Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙØ®Ø±ÙŠ Ø§Ù„ØªØ±ÙƒÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø­Ø§Ù…Ø¯ Ù‡Ù„Ø§Ù„ Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ù†Ù…ÙŠØ§Ù† Ø¹Ù„ÙŠ Ù†Ù…ÙŠØ§Ù† Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ØµÙ„Ø§Ø­ ØµØ§Ù„Ø­ Ø§Ù„Ø±Ø­ÙŠÙ„Ù‰',
            'Ù…Ø´Ø¹Ù„ Ø¨Ù† Ù‡Ù„ÙŠÙ„ Ø¨Ù† ØºØ§Ù„Ø¨ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ø¹Ù„ÙŠ Ù…ØªØ¹Ø¨ Ù†Ø§ØµØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ø³ÙŠÙ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù†Ø¹Ù… Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø¹Ø§Ø±Ø¶ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø°Ø¹Ø§Ø± Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø¹ÙˆÙÙŠ','ÙØ¤Ø§Ø¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ù…Ø§Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ','Ø­Ù…Ø²Ø© ØµØ¯Ù‚Ø© Ø­Ù…Ø²Ø© Ø§Ø³Ù„Ø§Ù…',
            'Ø³Ù„Ù…Ø§Ù† ØµØ§Ù„Ø­ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ','Ø¹Ø¨ÙŠØ¯ Ø¨Ù† Ø¯Ø®ÙŠÙ„ Ø¨Ù† Ø¯ÙˆÙŠÙ‡ÙŠØ³ Ø§Ù„Ø¹ÙŠØ§Ø¶ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…ÙÙ„Ø­ Ù†ÙˆÙŠØ¹Ù… Ø§Ù„Ø±ÙˆÙŠØ«ÙŠ',
            'ÙÙŠØµÙ„ Ø¹ÙˆØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ Ø³Ù„Ù…ÙŠ','Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„ Ø¨Ø­Ø±Ø§Ù† Ø§Ù„Ù‚Ø±Ù†ÙŠ','ÙƒØ§ØªØ¨ Ù…ÙÙ„Ø­ Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯Ù‰',
            'Ø­Ø¨ÙŠØ¨ Ø¹Ù„ÙŠ Ù†Ø¹ÙŠØ³ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø§ÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ','Ø³Ù„Ø·Ø§Ù† Ø¹ÙˆÙŠØ¶ Ù…Ø¹ÙŠØ¶ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ù…Ø¹ÙŠØ¶ Ù…Ø¹Ù„Ø§ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ','Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† ØºÙ„Ø§Ø¨ Ø§Ù„Ù…Ø®Ù„ÙÙŠ','Ø³Ø¹Ø¯ Ø·Ø§Ù„Ø¹ Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ø§Ù‡Ø± Ù…Ø´Ø¹Ù„ Ø¹ÙˆÙŠØ¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ','Ù…ÙˆØ³Ù‰ ØºØ§Ø²ÙŠ Ø³ÙØ± Ø§Ù„Ø­Ø±Ø¨ÙŠ','Ù…ÙˆØ³Ù‰ Ù…Ø³Ø¹ÙˆØ¯ Ø¹Ø§ÙŠØ¶ Ø§Ù„Ø­ÙŠØ³ÙˆÙ†ÙŠ',
            'Ù†ÙˆØ§Ù Ù…Ù†ØµÙˆØ± Ø¹ÙˆØ§Ø¯ Ø§Ù„ØµØ¨Ø­ÙŠ','Ø¨Ø¯Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø´Ø§Ø¦Ø¯ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ','ÙÙ‡Ø¯ Ø¹ÙˆÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø§ÙŠØ¯ Ø®Ø¶Ø±Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ','Ø£Ø­Ù…Ø¯ Ù…Ø·Ø± Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ'
        ];

        /* ========== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ========== */
        const config = {
            passwords: { 
                principal: 'A2030', 
                assistant: 'B2030', 
                counselor: 'C2030' 
            },
            schoolInfo: { 
                name: 'Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ', 
                principal: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ', 
                assistant: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ', 
                counselor: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', 
                type: 'Ø¨Ù†ÙŠÙ†' 
            },
            grades: ['Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·'],
            sections: ['1', '2', '3', '4', '5', '6'],
            violationTypes: {
                first: { 
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)', 
                    items: [
                        'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
                        'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© (ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø£Ø·Ø¹Ù…Ø© ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª)',
                        'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ - Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©',
                        'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
                        'ØªÙƒØ±Ø§Ø± Ø®Ø±ÙˆØ¬ ÙˆØ¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ù‚Ø¨Ù„ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù',
                        'Ø§Ù„ØªØ¬Ù‡Ø² Ø£Ù…Ø§Ù… Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'
                    ] 
                },
                second: { 
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø¯Ø±Ø¬ØªÙŠÙ†)', 
                    items: [
                        'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
                        'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ÙØµÙ„ Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
                        'Ø¯Ø®ÙˆÙ„ ÙØµÙ„ Ø¢Ø®Ø± Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
                        'Ø¥Ø«Ø§Ø±Ø© Ø§Ù„ÙÙˆØ¶Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ'
                    ] 
                },
                third: { 
                    label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)', 
                    items: [
                        'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
                        'Ø¥Ù„Ø­Ø§Ù‚ Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ù…ØªØ¹Ù…Ø¯ Ø¨Ù…Ù…ØªÙ„ÙƒØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª',
                        'Ø§Ù„Ø¹Ø¨Ø« Ø¨ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø§Ù„Ù…Ø¹Ù…Ù„ - Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø§Ø³Ø¨)',
                        'Ø§Ù…ØªÙ‡Ø§Ù† Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©'
                    ] 
                }
            }
        };
        /* ========== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ========== */
        let state = {
            currentUser: { role: 'teacher', name: teachersList[0], id: 1 },
            authenticated: { principal: false, assistant: false, counselor: false },
            violations: [
                {
                    id: 1, 
                    studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', 
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 
                    section: '1', 
                    violationType: 'first',
                    violationDetails: 'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
                    teacherName: teachersList[0], 
                    teacherId: 1, 
                    date: '2025-10-13', 
                    time: '08:30',
                    documentation: 'ØªØ£Ø®Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù† Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                    status: 'active',
                    createdAt: '2025-10-13T08:30:00'
                },
                {
                    id: 2,
                    studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
                    section: '1',
                    violationType: 'first',
                    violationDetails: 'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
                    teacherName: teachersList[1],
                    teacherId: 2,
                    date: '2025-10-14',
                    time: '10:15',
                    documentation: 'Ù†Ø§Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©',
                    status: 'active',
                    createdAt: '2025-10-14T10:15:00'
                },
                {
                    id: 3,
                    studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
                    section: '1',
                    violationType: 'second',
                    violationDetails: 'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
                    teacherName: teachersList[2],
                    teacherId: 3,
                    date: '2025-10-14',
                    time: '11:30',
                    documentation: 'ØºØ§Ø¨ Ø¹Ù† Ø­ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±',
                    status: 'active',
                    createdAt: '2025-10-14T11:30:00'
                },
                {
                    id: 4,
                    studentName: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯',
                    grade: 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·',
                    section: '3',
                    violationType: 'first',
                    violationDetails: 'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©',
                    teacherName: teachersList[3],
                    teacherId: 1,
                    date: '2025-10-14',
                    time: '09:00',
                    documentation: 'ØªØ­Ø¯Ø« Ù…Ø¹ Ø²Ù…ÙŠÙ„Ù‡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø­',
                    status: 'active',
                    createdAt: '2025-10-14T09:00:00'
                },
                {
                    id: 5,
                    studentName: 'Ù…Ø­Ù…Ø¯ Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
                    grade: 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·',
                    section: '2',
                    violationType: 'third',
                    violationDetails: 'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
                    teacherName: teachersList[4],
                    teacherId: 4,
                    date: '2025-10-12',
                    time: '07:45',
                    documentation: 'Ø­Ø¶Ø± Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ',
                    status: 'resolved',
                    resolvedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
                    resolutionReason: 'Ø§Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„',
                    resolvedAt: '2025-10-13T12:00:00',
                    createdAt: '2025-10-12T07:45:00'
                }
            ],
            studentActions: [],
            filters: { 
                selectedTab: 'all', 
                searchStudent: '', 
                filterGrade: '', 
                filterSection: '', 
                dateFrom: '', 
                dateTo: '' 
            },
            modals: { 
                showAddForm: false, 
                showDetailsModal: false, 
                selectedViolation: null, 
                showActionModal: false, 
                selectedStudent: null 
            },
            newViolation: { 
                studentName: '', 
                grade: '', 
                section: '', 
                violationType: 'first', 
                violationDetails: '', 
                documentation: '', 
                date: new Date().toISOString().split('T')[0], 
                time: new Date().toTimeString().slice(0, 5) 
            }
        };

        /* ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ ========== */
        let absenceRecords = [];
        
        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ Ù…Ù† ØµÙØ­Ø© absent.html
        window.addEventListener('message', e => {
            if (e.data && e.data.type === 'absenceData') {
                absenceRecords = e.data.payload || [];
                if (state.currentUser.role === 'assistant') render();
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function loadSampleAbsenceData() {
            const today = new Date().toISOString().split('T')[0];
            absenceRecords = [
                {
                    id: 1,
                    grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
                    section: '1',
                    period: '1',
                    date: today,
                    absentCount: 3,
                    absentStudents: ['Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯', 'ÙÙŠØµÙ„ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø­Ø±Ø¨ÙŠ'],
                    totalStudents: 30,
                    teacherName: teachersList[0],
                    recordedAt: new Date().toISOString()
                },
                {
                    id: 2,
                    grade: 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·',
                    section: '3',
                    period: '1',
                    date: today,
                    absentCount: 2,
                    absentStudents: ['Ù…Ø­Ù…Ø¯ Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', 'Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø´Ù…Ø±ÙŠ'],
                    totalStudents: 27,
                    teacherName: teachersList[1],
                    recordedAt: new Date().toISOString()
                },
                {
                    id: 3,
                    grade: 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·',
                    section: '2',
                    period: '1',
                    date: today,
                    absentCount: 4,
                    absentStudents: ['Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', 'Ù…Ø§Ø¬Ø¯ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', 'Ø·Ø§Ø±Ù‚ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ', 'Ù†Ø§ØµØ± Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ'],
                    totalStudents: 29,
                    teacherName: teachersList[2],
                    recordedAt: new Date().toISOString()
                }
            ];
        }
        
        loadSampleAbsenceData();

        /* ========== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ========== */
        function getStudentViolationCount(studentName, teacherId = null, status = 'active') {
            return state.violations.filter(v => 
                v.studentName === studentName && 
                (teacherId === null || v.teacherId === teacherId) && 
                (status === 'all' || v.status === status)
            ).length;
        }

        function getStudentsByViolationCount() {
            const map = {};
            state.violations.filter(v => v.status === 'active').forEach(v => {
                const key = `${v.studentName}_${v.teacherId}`;
                if (!map[key]) {
                    map[key] = { 
                        name: v.studentName, 
                        grade: v.grade, 
                        section: v.section, 
                        teacherId: v.teacherId, 
                        teacherName: v.teacherName, 
                        count: 0, 
                        violations: [] 
                    };
                }
                map[key].count++;
                map[key].violations.push(v);
            });
            return Object.values(map).filter(s => s.count >= 3).sort((a, b) => b.count - a.count);
        }

        function getDegreeLabel(type) {
            const map = {
                first: 'Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„Ù‰',
                second: 'Ø¯Ø±Ø¬Ø© Ø«Ø§Ù†ÙŠØ©',
                third: 'Ø¯Ø±Ø¬Ø© Ø«Ø§Ù„Ø«Ø©'
            };
            return map[type] || type;
        }

        function getDegreeColor(type) {
            const map = {
                first: 'bg-green-100 text-green-800 border-green-200',
                second: 'bg-yellow-100 text-yellow-800 border-yellow-200',
                third: 'bg-red-100 text-red-800 border-red-200'
            };
            return map[type] || 'bg-gray-100 text-gray-800';
        }

        function getRoleLabel(role) {
            const map = {
                teacher: 'Ø§Ù„Ù…Ø¹Ù„Ù…',
                assistant: 'Ø§Ù„ÙˆÙƒÙŠÙ„',
                counselor: 'Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ',
                principal: 'Ø§Ù„Ù…Ø¯ÙŠØ±'
            };
            return map[role];
        }

        function getFilteredViolations() {
            let filtered = [...state.violations];
            
            // ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (state.currentUser.role === 'teacher') {
                filtered = filtered.filter(v => v.teacherId === state.currentUser.id);
            } else if (state.currentUser.role === 'assistant' || state.currentUser.role === 'counselor') {
                const studentsWatch = getStudentsByViolationCount();
                const studentTeacherPairs = studentsWatch.map(s => `${s.name}_${s.teacherId}`);
                filtered = filtered.filter(v => studentTeacherPairs.includes(`${v.studentName}_${v.teacherId}`));
            }
            
            // ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (state.filters.selectedTab === 'active') {
                filtered = filtered.filter(v => v.status === 'active');
            }
            if (state.filters.selectedTab === 'resolved') {
                filtered = filtered.filter(v => v.status === 'resolved');
            }
            
            // ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø«
            if (state.filters.searchStudent.trim()) {
                filtered = filtered.filter(v => v.studentName.includes(state.filters.searchStudent.trim()));
            }
            if (state.filters.filterGrade) {
                filtered = filtered.filter(v => v.grade === state.filters.filterGrade);
            }
            if (state.filters.filterSection) {
                filtered = filtered.filter(v => v.section === state.filters.filterSection);
            }
            if (state.filters.dateFrom) {
                filtered = filtered.filter(v => v.date >= state.filters.dateFrom);
            }
            if (state.filters.dateTo) {
                filtered = filtered.filter(v => v.date <= state.filters.dateTo);
            }
            
            return filtered;
        }

        function getStats() {
            let violations = [...state.violations];
            
            if (state.currentUser.role === 'teacher') {
                violations = violations.filter(v => v.teacherId === state.currentUser.id);
            } else if (state.currentUser.role === 'assistant' || state.currentUser.role === 'counselor') {
                const studentsWatch = getStudentsByViolationCount();
                const studentTeacherPairs = studentsWatch.map(s => `${s.name}_${s.teacherId}`);
                violations = violations.filter(v => studentTeacherPairs.includes(`${v.studentName}_${v.teacherId}`));
            }
            
            const active = violations.filter(v => v.status === 'active').length;
            const resolved = violations.filter(v => v.status === 'resolved').length;
            const today = violations.filter(v => v.date === new Date().toISOString().split('T')[0]).length;
            
            let studentsUnderWatch = 0;
            if (state.currentUser.role === 'teacher') {
                studentsUnderWatch = getMyStudentsUnderWatch().length;
            } else {
                studentsUnderWatch = getStudentsByViolationCount().length;
            }
            
            return { active, resolved, studentsUnderWatch, today };
        }

        function getMyStudentsUnderWatch() {
            const map = {};
            state.violations
                .filter(v => v.status === 'active' && v.teacherId === state.currentUser.id)
                .forEach(v => {
                    if (!map[v.studentName]) {
                        map[v.studentName] = {
                            name: v.studentName,
                            grade: v.grade,
                            section: v.section,
                            count: 0,
                            violations: []
                        };
                    }
                    map[v.studentName].count++;
                    map[v.studentName].violations.push(v);
                });
            return Object.values(map).filter(s => s.count >= 3).sort((a, b) => b.count - a.count);
        }

        function canResolveViolation(violation) {
            if (state.currentUser.role === 'principal') return true;
            if (state.currentUser.role === 'assistant' || state.currentUser.role === 'counselor') {
                return getStudentViolationCount(violation.studentName, violation.teacherId) >= 3;
            }
            if (state.currentUser.role === 'teacher') {
                return violation.teacherId === state.currentUser.id;
            }
            return false;
        }

        /* ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ========== */
        function setCurrentUser(role, name, id) {
            if (role === 'principal' || role === 'assistant' || role === 'counselor') {
                if (!state.authenticated[role]) {
                    const password = prompt(`ğŸ”’ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„ØµÙØ­Ø© ${getRoleLabel(role)}:`);
                    if (password !== config.passwords[role]) {
                        alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
                        return;
                    }
                    state.authenticated[role] = true;
                    alert(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ ØµÙØ­Ø© ${getRoleLabel(role)}`);
                }
            }
            if (role === 'teacher' && !name) name = teachersList[0];
            state.currentUser = { role, name, id };
            render();
        }

        function setFilter(key, value) {
            state.filters[key] = value;
            render();
        }

        function clearFilters() {
            state.filters = {
                selectedTab: state.filters.selectedTab,
                searchStudent: '',
                filterGrade: '',
                filterSection: '',
                dateFrom: '',
                dateTo: ''
            };
            render();
        }

        function openAddForm() {
            state.modals.showAddForm = true;
            render();
        }

        function closeAddForm() {
            state.modals.showAddForm = false;
            state.newViolation = {
                studentName: '',
                grade: '',
                section: '',
                violationType: 'first',
                violationDetails: '',
                documentation: '',
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5)
            };
            render();
        }

        function addViolation() {
            const { studentName, grade, section, violationType, violationDetails, documentation, date, time } = state.newViolation;
            
            if (!studentName.trim() || !grade || !section || !violationDetails || !documentation.trim()) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return false;
            }
            
            const newId = Math.max(0, ...state.violations.map(v => v.id)) + 1;
            state.violations.unshift({
                id: newId,
                studentName: studentName.trim(),
                grade,
                section,
                violationType,
                violationDetails,
                documentation: documentation.trim(),
                date,
                time,
                teacherName: state.currentUser.name,
                teacherId: state.currentUser.id,
                status: 'active',
                createdAt: new Date().toISOString()
            });
            
            const count = getStudentViolationCount(studentName.trim(), state.currentUser.id);
            alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø¨Ù†Ø¬Ø§Ø­!\nğŸ‘¤ Ø§Ù„Ø·Ø§Ù„Ø¨: ${studentName}\nğŸ“š Ø§Ù„ØµÙ: ${grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${section}\nâš ï¸ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©: ${violationDetails}\nğŸ“ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ø¹: ${documentation}${count >= 3 ? `\n\nğŸš¨ ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ø¯ÙŠÙ‡ ${count} Ù…Ø®Ø§Ù„ÙØ§Øª Ù…Ù†Ùƒ!\nØ³ÙŠØªÙ… Ø¥Ø­Ø§Ù„ØªÙ‡ Ù„Ù„ÙˆÙƒÙŠÙ„/Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.` : ''}`);
            
            closeAddForm();
            return true;
        }

        function resolveViolation(violationId) {
            const reason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨):');
            if (reason && reason.trim()) {
                state.violations = state.violations.map(v =>
                    v.id === violationId
                        ? {
                            ...v,
                            status: 'resolved',
                            resolutionReason: reason.trim(),
                            resolvedBy: state.currentUser.name,
                            resolvedAt: new Date().toISOString()
                        }
                        : v
                );
                render();
            }
        }

        function openDetailsModal(violation) {
            state.modals.selectedViolation = violation;
            state.modals.showDetailsModal = true;
            render();
        }

        function closeDetailsModal() {
            state.modals.showDetailsModal = false;
            state.modals.selectedViolation = null;
            render();
        }

        function openActionModal(studentData) {
            state.modals.showActionModal = true;
            state.modals.selectedStudent = studentData;
            render();
        }

        function closeActionModal() {
            state.modals.showActionModal = false;
            state.modals.selectedStudent = null;
            render();
        }

        function saveStudentAction() {
            const details = document.getElementById('actionDetailsInput')?.value.trim();
            if (!details) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø°');
                return;
            }
            
            const student = state.modals.selectedStudent;
            const existingActionIndex = state.studentActions.findIndex(
                a => a.studentName === student.name && a.actionBy === state.currentUser.role
            );
            
            if (existingActionIndex !== -1) {
                state.studentActions[existingActionIndex] = {
                    ...state.studentActions[existingActionIndex],
                    actionDetails: details,
                    actionDate: new Date().toISOString()
                };
            } else {
                state.studentActions.push({
                    id: Math.max(0, ...state.studentActions.map(a => a.id || 0)) + 1,
                    studentName: student.name,
                    actionBy: state.currentUser.role,
                    actionByName: state.currentUser.name,
                    actionDate: new Date().toISOString(),
                    actionDetails: details,
                    violationsIncluded: student.violations.map(v => v.id)
                });
            }
            
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!');
            closeActionModal();
        }

        /* ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ========== */
        function printStudentReport(studentData) {
            const student = studentData;
            const action = state.studentActions.find(
                a => a.studentName === student.name && a.actionBy === state.currentUser.role
            );
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± Ù…Ø®Ø§Ù„ÙØ§Øª - ${student.name}</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
                        body { font-family: 'Cairo', sans-serif; padding: 40px; direction: rtl; }
                        .header { text-align: center; border-bottom: 3px solid #2563eb; padding-bottom: 20px; margin-bottom: 30px; }
                        .header h1 { color: #1e40af; margin: 10px 0; }
                        .info-box { background: #f3f4f6; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
                        .info-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
                        .violation-item { border: 2px solid #e5e7eb; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
                        .action-box { background: #dbeafe; border: 2px solid #2563eb; padding: 20px; border-radius: 8px; margin-top: 30px; }
                        .signature-area { margin-top: 50px; display: flex; justify-content: space-between; }
                        .signature-box { text-align: center; width: 200px; }
                        .signature-line { border-top: 2px solid #000; margin-top: 60px; padding-top: 10px; }
                        @media print { body { padding: 20px; } .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“š ${config.schoolInfo.name}</h1>
                        <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©</h2>
                        <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}</p>
                    </div>
                    
                    <div class="info-box">
                        <h3 style="color:#1e40af;margin-bottom:15px">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                        <div class="info-row"><strong>Ø§Ù„Ø§Ø³Ù…:</strong><span>${student.name}</span></div>
                        <div class="info-row"><strong>Ø§Ù„ØµÙ:</strong><span>${student.grade}</span></div>
                        <div class="info-row"><strong>Ø§Ù„Ø´Ø¹Ø¨Ø©:</strong><span>${student.section}</span></div>
                        <div class="info-row"><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª:</strong><span style="color:#dc2626;font-weight:bold">${student.count} Ù…Ø®Ø§Ù„ÙØ§Øª</span></div>
                    </div>
                    
                    <h3 style="color:#1e40af;margin-top:30px;margin-bottom:15px">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª:</h3>
                    ${student.violations.map((v, i) => `
                        <div class="violation-item">
                            <div style="font-weight:bold;margin-bottom:10px">
                                ${i + 1}. ${v.violationDetails}
                                <span style="background:${v.violationType === 'first' ? '#dcfce7' : v.violationType === 'second' ? '#fef3c7' : '#fee2e2'};padding:4px 12px;border-radius:20px;font-size:12px;margin-right:10px">
                                    ${getDegreeLabel(v.violationType)}
                                </span>
                            </div>
                            <div style="color:#6b7280;font-size:14px">
                                <div>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${v.date} | ğŸ• Ø§Ù„ÙˆÙ‚Øª: ${v.time}</div>
                                <div>ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${v.teacherName}</div>
                                ${v.documentation ? `<div style="margin-top:8px">ğŸ“ ${v.documentation}</div>` : ''}
                            </div>
                        </div>
                    `).join('')}
                    
                    ${action ? `
                        <div class="action-box">
                            <h3 style="color:#1e40af;margin-bottom:15px">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø° Ù…Ù† Ù‚Ø¨Ù„ ${getRoleLabel(action.actionBy)}</h3>
                            <div style="margin-bottom:10px"><strong>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong> ${action.actionByName}</div>
                            <div style="margin-bottom:10px"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(action.actionDate).toLocaleString('ar-SA')}</div>
                            <div style="margin-top:15px;padding:15px;background:white;border-radius:4px">
                                <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</strong>
                                <p style="margin-top:10px;line-height:1.8">${action.actionDetails}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="signature-area">
                        <div class="signature-box">
                            <div class="signature-line">${state.currentUser.role === 'assistant' ? 'Ø§Ù„ÙˆÙƒÙŠÙ„' : 'Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ'}</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line">ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
                        </div>
                    </div>
                    
                    <div class="no-print" style="text-align:center;margin-top:30px">
                        <button onclick="window.print()" style="background:#2563eb;color:white;padding:12px 30px;border:none;border-radius:8px;font-size:16px;cursor:pointer;font-family:'Cairo',sans-serif">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button onclick="window.close()" style="background:#6b7280;color:white;padding:12px 30px;border:none;border-radius:8px;font-size:16px;cursor:pointer;margin-right:10px;font-family:'Cairo',sans-serif">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function printClassAbsence(record) {
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºÙŠØ§Ø¨ - ${record.grade} - ${record.section}</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Cairo', sans-serif; padding: 40px; background: white; color: #000; }
                        .header { text-align: center; border-bottom: 4px solid #059669; padding-bottom: 20px; margin-bottom: 30px; }
                        .header h1 { color: #059669; font-size: 28px; margin-bottom: 10px; }
                        .header .date { color: #666; font-size: 16px; }
                        .info-box { background: #f3f4f6; border: 2px solid #d1d5db; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
                        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #d1d5db; }
                        .info-row:last-child { border-bottom: none; }
                        .info-label { font-weight: bold; color: #374151; }
                        .info-value { color: #059669; font-weight: bold; }
                        .students-section { margin: 30px 0; }
                        .students-section h2 { color: #dc2626; border-bottom: 3px solid #dc2626; padding-bottom: 10px; margin-bottom: 20px; }
                        .student-item { background: #fef3c7; border: 2px solid #fbbf24; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
                        .student-number { background: #f59e0b; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; }
                        .student-name { flex: 1; font-size: 18px; font-weight: bold; color: #000; }
                        .signature-section { display: flex; justify-content: space-between; margin-top: 60px; page-break-inside: avoid; }
                        .signature-box { text-align: center; width: 200px; }
                        .signature-line { border-top: 2px solid #000; margin-top: 60px; padding-top: 10px; font-weight: bold; }
                        @media print {
                            body { padding: 20px; }
                            .no-print { display: none; }
                            @page { margin: 2cm; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ« ${config.schoolInfo.name}</h1>
                        <p class="date">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
                        <p class="date">${new Date().toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>

                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">ğŸ“š Ø§Ù„ØµÙ:</span>
                            <span class="info-value">${record.grade}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ğŸ”¢ Ø§Ù„Ø´Ø¹Ø¨Ø©:</span>
                            <span class="info-value">${record.section}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨:</span>
                            <span class="info-value">${record.totalStudents} Ø·Ø§Ù„Ø¨</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">âš ï¸ Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨:</span>
                            <span class="info-value" style="color: #dc2626;">${record.absentCount} Ø·Ø§Ù„Ø¨</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">âœ… Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±:</span>
                            <span class="info-value">${((record.totalStudents - record.absentCount) / record.totalStudents * 100).toFixed(1)}%</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…:</span>
                            <span class="info-value" style="color: #000;">${record.teacherName}</span>
                        </div>
                    </div>

                    ${record.absentCount > 0 ? `
                        <div class="students-section">
                            <h2>âš ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† (${record.absentCount})</h2>
                            ${record.absentStudents.map((student, i) => `
                                <div class="student-item">
                                    <div class="student-number">${i + 1}</div>
                                    <div class="student-name">${student}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 40px; background: #d1fae5; border: 2px solid #059669; border-radius: 8px;">
                            <div style="font-size: 60px; margin-bottom: 20px;">âœ…</div>
                            <h2 style="color: #059669; font-size: 24px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØµÙ„</h2>
                            <p style="color: #047857; margin-top: 10px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø§Ø¶Ø±ÙˆÙ†</p>
                        </div>
                    `}

                    <div class="signature-section">
                        <div class="signature-box">
                            <div class="signature-line">ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
                        </div>
                    </div>

                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                            }, 500);
                        };
                    </script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function printDailyAbsenceReport() {
            const today = new Date().toISOString().split('T')[0];
            const todayAbsence = absenceRecords.filter(a => a.date === today && a.period === '1');
            
            if (todayAbsence.length === 0) {
                alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨ Ù…Ø³Ø¬Ù„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
                return;
            }

            const totalAbsent = todayAbsence.reduce((sum, a) => sum + a.absentCount, 0);
            const totalStudents = todayAbsence.reduce((sum, a) => sum + a.totalStudents, 0);
            const attendanceRate = ((totalStudents - totalAbsent) / totalStudents * 100).toFixed(1);

            const printWindow = window.open('', '_blank', 'width=900,height=700');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„ØºÙŠØ§Ø¨</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Cairo', sans-serif; padding: 30px; background: white; color: #000; }
                        .header { text-align: center; background: linear-gradient(135deg, #059669, #047857); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
                        .header h1 { font-size: 32px; margin-bottom: 10px; }
                        .header .subtitle { font-size: 18px; opacity: 0.9; }
                        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
                        .stat-card { background: #f3f4f6; border: 2px solid #d1d5db; border-radius: 8px; padding: 20px; text-align: center; }
                        .stat-card .value { font-size: 32px; font-weight: bold; color: #059669; margin: 10px 0; }
                        .stat-card .label { color: #666; font-size: 14px; }
                        .class-section { background: #fff; border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; margin-bottom: 20px; page-break-inside: avoid; }
                        .class-header { background: #059669; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
                        .class-title { font-size: 20px; font-weight: bold; }
                        .class-stats { font-size: 14px; }
                        .students-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
                        .student-item { background: #fef3c7; border: 1px solid #fbbf24; border-radius: 6px; padding: 10px; display: flex; align-items: center; gap: 10px; }
                        .student-number { background: #f59e0b; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; flex-shrink: 0; }
                        .student-name { font-size: 14px; font-weight: bold; }
                        .no-absence { text-align: center; padding: 20px; background: #d1fae5; border: 2px solid #059669; border-radius: 8px; color: #047857; }
                        .teacher-info { margin-top: 10px; padding-top: 10px; border-top: 1px solid #d1d5db; font-size: 12px; color: #666; }
                        .signature-section { display: flex; justify-content: space-around; margin-top: 50px; page-break-inside: avoid; }
                        .signature-box { text-align: center; width: 200px; }
                        .signature-line { border-top: 2px solid #000; margin-top: 50px; padding-top: 10px; font-weight: bold; }
                        @media print {
                            body { padding: 15px; }
                            .no-print { display: none; }
                            @page { margin: 1.5cm; size: A4; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ« ${config.schoolInfo.name}</h1>
                        <p class="subtitle">ğŸ“‹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„ØºÙŠØ§Ø¨ - Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
                        <p class="subtitle">${new Date().toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØµÙˆÙ„</div>
                            <div class="value">${todayAbsence.length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                            <div class="value">${totalStudents}</div>
                        </div>
                        <div class="stat-card" style="border-color: #dc2626;">
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºÙŠØ§Ø¨</div>
                            <div class="value" style="color: #dc2626;">${totalAbsent}</div>
                        </div>
                        <div class="stat-card" style="border-color: #059669;">
                            <div class="label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                            <div class="value" style="color: #059669;">${attendanceRate}%</div>
                        </div>
                    </div>

                    ${todayAbsence.map((record, index) => {
                        const classAttendanceRate = ((record.totalStudents - record.absentCount) / record.totalStudents * 100).toFixed(1);
                        return `
                            <div class="class-section">
                                <div class="class-header">
                                    <div class="class-title">${record.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${record.section}</div>
                                    <div class="class-stats">
                                        Ø§Ù„Ø­Ø¶ÙˆØ±: ${record.totalStudents - record.absentCount}/${record.totalStudents} 
                                        (${classAttendanceRate}%)
                                    </div>
                                </div>
                                
                                ${record.absentCount > 0 ? `
                                    <h3 style="color: #dc2626; margin-bottom: 15px; font-size: 16px;">
                                        âš ï¸ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ† (${record.absentCount})
                                    </h3>
                                    <div class="students-grid">
                                        ${record.absentStudents.map((student, i) => `
                                            <div class="student-item">
                                                <div class="student-number">${i + 1}</div>
                                                <div class="student-name">${student}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <div class="no-absence">
                                        <strong>âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø§Ø¶Ø±ÙˆÙ†</strong>
                                    </div>
                                `}
                                
                                <div class="teacher-info">
                                    <strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> ${record.teacherName} | 
                                    <strong>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${new Date(record.recordedAt).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                            </div>
                        `;
                    }).join('')}

                    <div class="signature-section">
                        <div class="signature-box">
                            <div class="signature-line">Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ<br>${config.schoolInfo.counselor}</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line">ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©<br>${config.schoolInfo.assistant}</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©<br>${config.schoolInfo.principal}</div>
                        </div>
                    </div>

                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                            }, 500);
                        };
                    </script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function exportToCSV() {
            const filtered = getFilteredViolations();
            const headers = ['#', 'Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø´Ø¹Ø¨Ø©', 'Ø§Ù„Ø¯Ø±Ø¬Ø©', 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', 'Ø§Ù„Ù…Ø¹Ù„Ù…', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ø­Ø§Ù„Ø©'];
            const rows = filtered.map((v, i) => [
                i + 1,
                v.studentName,
                v.grade,
                v.section,
                getDegreeLabel(v.violationType),
                v.violationDetails,
                v.teacherName,
                v.date,
                v.time,
                v.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ø­Ù„ÙˆÙ„'
            ]);
            const csvContent = [headers, ...rows].map(r => r.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Ù…Ø®Ø§Ù„ÙØ§Øª_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

/* ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ========== */
        function render() {
            const stats = getStats();
            const filtered = getFilteredViolations();
            document.getElementById('app').innerHTML = `
                ${renderHeader()}
                ${renderUserTabs()}
                ${renderMainContent(stats, filtered)}
                ${state.modals.showAddForm ? renderAddModal() : ''}
                ${state.modals.showDetailsModal ? renderDetailsModal() : ''}
                ${state.modals.showActionModal ? renderActionModal() : ''}
            `;
        }

        function renderHeader() {
            return `
                <div class="bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white shadow-2xl">
                    <div class="max-w-7xl mx-auto px-6 py-8">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h1 class="text-4xl font-bold mb-2">ğŸ“š ${config.schoolInfo.name}</h1>
                                <p class="text-blue-100 text-lg">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© - ${config.schoolInfo.type}</p>
                            </div>
                            <div class="text-left bg-blue-800 bg-opacity-50 rounded-lg p-4 backdrop-blur-sm">
                                <p class="text-sm text-blue-100 mb-1">ğŸ‘¤ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ${config.schoolInfo.principal}</p>
                                <p class="text-sm text-blue-100 mb-1">ğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${config.schoolInfo.assistant}</p>
                                <p class="text-sm text-blue-100">ğŸ‘¤ Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ: ${config.schoolInfo.counselor}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderUserTabs() {
            const isActive = role => state.currentUser.role === role;
            const btn = (role, icon, label) => `
                <button onclick="setCurrentUser('${role}', '${config.schoolInfo[role] || ''}', ${role === 'teacher' ? 1 : role === 'assistant' ? 2 : role === 'counselor' ? 3 : 4})" 
                    class="flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${isActive(role) ? 'bg-blue-600 text-white shadow-lg scale-105' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}">
                    ${icon} ${label}
                </button>
            `;

            return `
                <div class="bg-white border-b shadow-sm sticky top-0 z-40">
                    <div class="max-w-7xl mx-auto px-6 py-4">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex gap-2 flex-wrap items-center">
                                ${state.currentUser.role === 'teacher' ? `
                                    <select onchange="setCurrentUser('teacher', this.value, 1)" 
                                        class="px-4 py-3 border-2 border-blue-600 rounded-lg focus:ring-2 focus:ring-blue-500 font-medium text-blue-900 bg-blue-50">
                                        ${teachersList.map(t => `<option ${state.currentUser.name === t ? 'selected' : ''}>ğŸ‘¨â€ğŸ« ${t}</option>`).join('')}
                                    </select>
                                ` : btn('teacher', 'ğŸ‘¨â€ğŸ«', 'ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…')}
                                ${btn('assistant', 'ğŸ“‹', 'ØµÙØ­Ø© Ø§Ù„ÙˆÙƒÙŠÙ„')}
                                ${btn('counselor', 'ğŸ“¢', 'Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ')}
                                ${btn('principal', 'ğŸ›¡ï¸', 'ØµÙØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±')}
                                <a href="https://nawafoooh.github.io/activity/absent.html" 
                                    class="px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors shadow-md">
                                    ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨
                                </a>
                            </div>
                            <div class="bg-blue-50 px-4 py-2 rounded-lg border border-blue-200">
                                <p class="text-sm text-blue-900">
                                    <span class="font-bold">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</span> ${state.currentUser.name} - ${getRoleLabel(state.currentUser.role)}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMainContent(stats, filtered) {
            return `
                <div class="max-w-7xl mx-auto px-6 py-6">
                    ${renderStats(stats)}
                    ${renderViolationsSection(stats, filtered)}
                    ${renderStudentsUnderWatch()}
                </div>
            `;
        }

        function renderStats({ active, resolved, studentsUnderWatch, today }) {
            return `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-blue-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">âš ï¸</span>
                            <div class="text-3xl font-bold text-blue-600">${active}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">âœ…</span>
                            <div class="text-3xl font-bold text-green-600">${resolved}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-orange-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">ğŸ‘ï¸</span>
                            <div class="text-3xl font-bold text-orange-600">${studentsUnderWatch}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-purple-500">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl">ğŸ“…</span>
                            <div class="text-3xl font-bold text-purple-600">${today}</div>
                        </div>
                        <div class="text-gray-600 font-medium">Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                </div>
            `;
        }

function renderViolationsSection(stats, filtered) {
            const tabClass = tab => `px-5 py-2.5 rounded-lg font-medium transition-all ${state.filters.selectedTab === tab ? 'bg-blue-600 text-white shadow-md' : 'text-gray-600 hover:bg-gray-100'}`;
            const hasFilters = state.filters.searchStudent || state.filters.filterGrade || state.filters.filterSection || state.filters.dateFrom || state.filters.dateTo;
            
            return `
                <div class="bg-white rounded-xl shadow-lg mb-6">
                    <div class="border-b px-6 py-4">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex gap-3">
                                <button onclick="setFilter('selectedTab', 'all')" class="${tabClass('all')}">
                                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª (${state.violations.length})
                                </button>
                                <button onclick="setFilter('selectedTab', 'active')" class="${tabClass('active')}">
                                    Ø§Ù„Ù†Ø´Ø·Ø© (${stats.active})
                                </button>
                                <button onclick="setFilter('selectedTab', 'resolved')" class="${tabClass('resolved')}">
                                    Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø© (${stats.resolved})
                                </button>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="exportToCSV()" class="flex items-center gap-2 px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md">
                                    ğŸ“¥ ØªØµØ¯ÙŠØ± Excel
                                </button>
                                ${state.currentUser.role === 'teacher' ? `
                                    <button onclick="openAddForm()" class="flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md">
                                        â• Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-gray-50 border-b">
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</label>
                                <input type="text" value="${state.filters.searchStudent}" 
                                    onchange="setFilter('searchStudent', this.value)" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“Š Ø§Ù„ØµÙ</label>
                                <select onchange="setFilter('filterGrade', this.value)" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ø§Ù„ÙƒÙ„</option>
                                    ${config.grades.map(g => `<option value="${g}" ${state.filters.filterGrade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ø¹Ø¨Ø©</label>
                                <select onchange="setFilter('filterSection', this.value)" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ø§Ù„ÙƒÙ„</option>
                                    ${config.sections.map(s => `<option value="${s}" ${state.filters.filterSection === s ? 'selected' : ''}>${s}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" value="${state.filters.dateFrom}" 
                                    onchange="setFilter('dateFrom', this.value)" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                <input type="date" value="${state.filters.dateTo}" 
                                    onchange="setFilter('dateTo', this.value)" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        ${hasFilters ? `
                            <button onclick="clearFilters()" class="mt-4 text-sm text-blue-600 hover:text-blue-800 font-medium">
                                Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±
                            </button>
                        ` : ''}
                    </div>
                    
                    <div class="divide-y">
                        ${filtered.map(v => renderViolationItem(v)).join('')}
                    </div>
                    
                    <div class="p-4 bg-gray-50 border-t text-center text-sm text-gray-600">
                        Ø¹Ø±Ø¶ ${filtered.length} Ù…Ù† Ø£ØµÙ„ ${state.violations.length} Ù…Ø®Ø§Ù„ÙØ©
                    </div>
                </div>
            `;
        }

        function renderViolationItem(v) {
            const count = getStudentViolationCount(v.studentName, v.teacherId);
            const isHighRisk = count >= 3;
            
            return `
                <div class="p-6 hover:bg-gray-50 transition-all duration-200 ${isHighRisk && v.status === 'active' ? 'bg-red-50 border-r-4 border-red-500' : ''}">
                    <div class="flex justify-between items-start gap-6">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3 flex-wrap">
                                <h3 class="text-xl font-bold text-gray-900">${v.studentName}</h3>
                                <span class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">${v.grade}</span>
                                <span class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">Ø§Ù„Ø´Ø¹Ø¨Ø© ${v.section}</span>
                                <span class="px-3 py-1 rounded-full text-xs font-bold border-2 ${getDegreeColor(v.violationType)}">
                                    ${getDegreeLabel(v.violationType)}
                                </span>
                                ${isHighRisk && v.status === 'active' ? `
                                    <span class="flex items-center gap-1 bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-md animate-pulse">
                                        âš ï¸ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (${count} Ù…Ø®Ø§Ù„ÙØ§Øª Ù…Ù† ${v.teacherName})
                                    </span>
                                ` : ''}
                                ${v.status === 'resolved' ? `
                                    <span class="flex items-center gap-1 bg-green-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                                        âœ… ØªÙ… Ø§Ù„Ø­Ù„
                                    </span>
                                ` : ''}
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 mb-3">
                                <p class="text-gray-800 mb-2 font-semibold text-lg">${v.violationDetails}</p>
                                ${v.documentation ? `
                                    <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                        <p class="text-sm text-blue-900">
                                            <span class="font-bold">ğŸ“ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ø¹:</span><br>${v.documentation}
                                        </p>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                                <span>ğŸ‘¤ <strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> ${v.teacherName}</span>
                                <span>ğŸ“… <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${v.date}</span>
                                <span>ğŸ• <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${v.time}</span>
                            </div>
                            ${v.status === 'resolved' && v.resolutionReason ? `
                                <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="flex items-start gap-2 mb-2">
                                        <span class="text-2xl">ğŸ†</span>
                                        <div class="flex-1">
                                            <p class="text-sm font-bold text-green-900 mb-1">Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ):</p>
                                            <p class="text-sm text-green-800 mb-2">${v.resolutionReason}</p>
                                            <div class="flex gap-4 text-xs text-green-700">
                                                <span>ØªÙ… Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©: ${v.resolvedBy}</span>
                                                <span>ÙÙŠ: ${new Date(v.resolvedAt).toLocaleString('ar-SA')}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex flex-col gap-2">
                            <button onclick='openDetailsModal(${JSON.stringify(v).replace(/'/g, "\\'")})'
                                class="flex items-center gap-2 bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors whitespace-nowrap">
                                ğŸ‘ï¸ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                            ${v.status === 'active' && canResolveViolation(v) ? `
                                <button onclick="resolveViolation(${v.id})" 
                                    class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-md whitespace-nowrap">
                                    ğŸ† Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

function renderStudentsUnderWatch() {
            if (!['assistant', 'counselor', 'principal'].includes(state.currentUser.role)) return '';
            
            const students = getStudentsByViolationCount().filter(s => s.count >= 3);
            
            return `
                <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 text-red-700">
                        âš ï¸ Ø§Ù„Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (3 Ù…Ø®Ø§Ù„ÙØ§Øª ÙØ£ÙƒØ«Ø±)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${students.length ? students.map((s, i) => {
                            const hasAction = state.studentActions.find(a => a.studentName === s.name && a.actionBy === state.currentUser.role);
                            return `
                                <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between mb-3">
                                        <h3 class="font-bold text-gray-900">${s.name}</h3>
                                        <span class="bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                                            ${s.count} Ù…Ø®Ø§Ù„ÙØ§Øª
                                        </span>
                                    </div>
                                    <div class="text-sm text-gray-600 mb-2">${s.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${s.section}</div>
                                    <div class="text-xs text-gray-500 mb-3">Ø¢Ø®Ø± Ù…Ø®Ø§Ù„ÙØ©: ${s.violations[s.violations.length - 1].date}</div>
                                    ${hasAction ? `
                                        <div class="bg-blue-100 border border-blue-300 rounded p-2 mb-3 text-xs">
                                            <div class="font-bold text-blue-900 mb-1">âœ… ØªÙ… Ø§ØªØ®Ø§Ø° Ø¥Ø¬Ø±Ø§Ø¡</div>
                                            <div class="text-blue-800">${new Date(hasAction.actionDate).toLocaleDateString('ar-SA')}</div>
                                        </div>
                                    ` : ''}
                                    <div class="flex gap-2 mt-3">
                                        <button onclick='openActionModal(${JSON.stringify(s).replace(/'/g, "\\'")})'
                                            class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors">
                                            ${hasAction ? 'ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' : 'ğŸ“‹ Ø§ØªØ®Ø§Ø° Ø¥Ø¬Ø±Ø§Ø¡'}
                                        </button>
                                        <button onclick='printStudentReport(${JSON.stringify(s).replace(/'/g, "\\'")})'
                                            class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 text-sm font-medium transition-colors">
                                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('') : `
                            <div class="col-span-full text-center py-8 text-gray-500">
                                <div class="text-5xl mb-2">âœ…</div>
                                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                        `}
                    </div>
                </div>
                
                ${state.currentUser.role === 'assistant' ? renderAbsenceBlock() : ''}
            `;
        }

        function renderAbsenceBlock() {
            if (state.currentUser.role !== 'assistant') return '';
            
            const today = new Date().toISOString().split('T')[0];
            const todayAbsence = absenceRecords.filter(a => a.date === today && a.period === '1');
            
            const totalAbsentToday = todayAbsence.reduce((sum, a) => sum + a.absentCount, 0);
            const classesWithAbsence = todayAbsence.length;
            const totalStudents = todayAbsence.reduce((sum, a) => sum + a.totalStudents, 0);
            const attendanceRate = totalStudents > 0 ? ((totalStudents - totalAbsentToday) / totalStudents * 100).toFixed(1) : 0;

            let filtered = todayAbsence;
            if (state.filters.filterGrade) filtered = filtered.filter(a => a.grade === state.filters.filterGrade);
            if (state.filters.filterSection) filtered = filtered.filter(a => a.section === state.filters.filterSection);

            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden mt-6">
                    <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-6">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex items-center gap-3">
                                <div class="bg-white bg-opacity-20 backdrop-blur-sm p-3 rounded-lg">
                                    <span class="text-3xl">ğŸ“‹</span>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold">Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
                                    <p class="text-emerald-100 text-sm mt-1">Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ - ${new Date().toLocaleDateString('ar-SA')}</p>
                                </div>
                            </div>
                            <button onclick="printDailyAbsenceReport()" 
                                class="flex items-center gap-2 px-6 py-3 bg-white text-emerald-700 rounded-lg hover:bg-emerald-50 transition-all shadow-lg hover:shadow-xl transform hover:scale-105 font-bold">
                                <span class="text-xl">ğŸ–¨ï¸</span>
                                Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 p-6 bg-gray-50">
                        <div class="bg-white p-4 rounded-lg shadow border-r-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºÙŠØ§Ø¨</p>
                                    <p class="text-2xl font-bold text-blue-600">${totalAbsentToday}</p>
                                </div>
                                <span class="text-3xl">ğŸ‘¥</span>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow border-r-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                                    <p class="text-2xl font-bold text-green-600">${attendanceRate}%</p>
                                </div>
                                <span class="text-3xl">âœ…</span>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow border-r-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
                                    <p class="text-2xl font-bold text-purple-600">${classesWithAbsence}</p>
                                </div>
                                <span class="text-3xl">ğŸ«</span>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow border-r-4 border-orange-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                                    <p class="text-2xl font-bold text-orange-600">${totalStudents}</p>
                                </div>
                                <span class="text-3xl">ğŸ“Š</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        ${filtered.length > 0 ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${filtered.map((record, index) => {
                                    const attendancePercentage = ((record.totalStudents - record.absentCount) / record.totalStudents * 100).toFixed(1);
                                    const statusColor = attendancePercentage >= 90 ? 'green' : attendancePercentage >= 80 ? 'yellow' : 'red';
                                    
                                    return `
                                        <div class="bg-gradient-to-br from-white to-gray-50 border-2 border-gray-200 rounded-xl p-5 hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]">
                                            <div class="flex items-center justify-between mb-4 pb-3 border-b-2 border-gray-200">
                                                <div class="flex items-center gap-3">
                                                    <div class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg font-bold">
                                                        ${record.grade}
                                                    </div>
                                                    <div class="bg-purple-100 text-purple-700 px-3 py-2 rounded-lg font-bold">
                                                        ${record.section}
                                                    </div>
                                                </div>
                                                <button onclick='printClassAbsence(${JSON.stringify(record).replace(/'/g, "\\'")})'
                                                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg transition-colors" title="Ø·Ø¨Ø§Ø¹Ø©">
                                                    ğŸ–¨ï¸
                                                </button>
                                            </div>

                                            <div class="grid grid-cols-2 gap-3 mb-4">
                                                <div class="bg-red-50 border border-red-200 rounded-lg p-3 text-center">
                                                    <p class="text-xs text-red-700 mb-1">Ø§Ù„ØºÙŠØ§Ø¨</p>
                                                    <p class="text-2xl font-bold text-red-600">${record.absentCount}</p>
                                                </div>
                                                <div class="bg-${statusColor}-50 border border-${statusColor}-200 rounded-lg p-3 text-center">
                                                    <p class="text-xs text-${statusColor}-700 mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                                                    <p class="text-2xl font-bold text-${statusColor}-600">${attendancePercentage}%</p>
                                                </div>
                                            </div>

                                            <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4">
                                                <p class="text-sm font-bold text-yellow-900 mb-3 flex items-center gap-2">
                                                    <span>âš ï¸</span>
                                                    Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ† (${record.absentCount})
                                                </p>
                                                ${record.absentCount > 0 ? `
                                                    <div class="space-y-2 max-h-40 overflow-y-auto custom-scrollbar">
                                                        ${record.absentStudents.map((student, i) => `
                                                            <div class="flex items-center gap-2 bg-white border border-yellow-300 rounded-lg px-3 py-2">
                                                                <span class="flex-shrink-0 w-6 h-6 bg-yellow-600 text-white rounded-full flex items-center justify-center text-xs font-bold">
                                                                    ${i + 1}
                                                                </span>
                                                                <span class="text-sm text-gray-800 font-medium">${student}</span>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                ` : `
                                                    <p class="text-center text-green-600 font-medium py-3">
                                                        âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨
                                                    </p>
                                                `}
                                            </div>

                                            <div class="mt-4 pt-3 border-t border-gray-200">
                                                <p class="text-xs text-gray-600">
                                                    <span class="font-bold">Ø§Ù„Ù…Ø¹Ù„Ù…:</span> ${record.teacherName}
                                                </p>
                                                <p class="text-xs text-gray-500 mt-1">
                                                    <span class="font-bold">Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span> ${new Date(record.recordedAt).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}
                                                </p>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-16">
                                <div class="text-6xl mb-4">âœ…</div>
                                <p class="text-xl text-gray-600 font-bold mb-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨ Ù…Ø³Ø¬Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ù„ÙŠÙˆÙ…</p>
                                <p class="text-sm text-gray-500">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„ ØªÙ†ØªØ¸Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

/* ========== Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ========== */
        function renderAddModal() {
            const { studentName, grade, section, violationType, violationDetails, documentation, date, time } = state.newViolation;
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50" onclick="if(event.target===this)closeAddForm()">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                            <h2 class="text-2xl font-bold">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                            <p class="text-blue-100 text-sm mt-1">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                        </div>
                        
                        <div class="p-6 space-y-5">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ <span class="text-red-500">*</span></label>
                                <input type="text" value="${studentName}" 
                                    onchange="state.newViolation.studentName=this.value" 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨...">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ØµÙ <span class="text-red-500">*</span></label>
                                    <select onchange="state.newViolation.grade=this.value" 
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                        ${config.grades.map(g => `<option value="${g}" ${grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø´Ø¹Ø¨Ø© <span class="text-red-500">*</span></label>
                                    <select onchange="state.newViolation.section=this.value" 
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
                                        ${config.sections.map(s => `<option value="${s}" ${section === s ? 'selected' : ''}>${s}</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© <span class="text-red-500">*</span></label>
                                <select onchange="state.newViolation.violationType=this.value;state.newViolation.violationDetails='';render()" 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="first" ${violationType === 'first' ? 'selected' : ''}>Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)</option>
                                    <option value="second" ${violationType === 'second' ? 'selected' : ''}>Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø¯Ø±Ø¬ØªÙŠÙ†)</option>
                                    <option value="third" ${violationType === 'third' ? 'selected' : ''}>Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© <span class="text-red-500">*</span></label>
                                <select onchange="state.newViolation.violationDetails=this.value" 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</option>
                                    ${config.violationTypes[violationType].items.map(item => `
                                        <option value="${item}" ${violationDetails === item ? 'selected' : ''}>${item}</option>
                                    `).join('')}
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ø¹ <span class="text-red-500">*</span></label>
                                <textarea onchange="state.newViolation.documentation=this.value" 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[100px]" 
                                    placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø°...">${documentation}</textarea>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" value="${date}" 
                                        onchange="state.newViolation.date=this.value" 
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙˆÙ‚Øª</label>
                                    <input type="time" value="${time}" 
                                        onchange="state.newViolation.time=this.value" 
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                        
                        <div class="sticky bottom-0 bg-gray-50 p-6 border-t flex gap-3 justify-end">
                            <button onclick="closeAddForm()" 
                                class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-medium">
                                Ø¥Ù„ØºØ§Ø¡
                            </button>
                            <button onclick="if(addViolation())render()" 
                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                                âœ“ Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetailsModal() {
            const v = state.modals.selectedViolation;
            if (!v) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50" onclick="if(event.target===this)closeDetailsModal()">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-t-xl">
                            <h2 class="text-2xl font-bold">ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</h2>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                                <h3 class="font-bold text-xl text-gray-900 mb-2">${v.studentName}</h3>
                                <div class="flex gap-2 flex-wrap">
                                    <span class="px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-sm font-medium">${v.grade}</span>
                                    <span class="px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-sm font-medium">Ø§Ù„Ø´Ø¹Ø¨Ø© ${v.section}</span>
                                    <span class="px-3 py-1 ${getDegreeColor(v.violationType)} rounded-full text-sm font-bold">${getDegreeLabel(v.violationType)}</span>
                                </div>
                            </div>
                            
                            <div class="bg-white border-2 border-gray-200 rounded-lg p-4">
                                <p class="text-sm text-gray-600 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</p>
                                <p class="text-lg font-bold text-gray-900">${v.violationDetails}</p>
                            </div>
                            
                            ${v.documentation ? `
                                <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4">
                                    <p class="text-sm font-bold text-yellow-900 mb-2">ğŸ“ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ø¹:</p>
                                    <p class="text-gray-800">${v.documentation}</p>
                                </div>
                            ` : ''}
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="text-xs text-gray-600 mb-1">ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…</p>
                                    <p class="font-bold text-gray-900">${v.teacherName}</p>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="text-xs text-gray-600 mb-1">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
                                    <p class="font-bold text-gray-900">${v.date}</p>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="text-xs text-gray-600 mb-1">ğŸ• Ø§Ù„ÙˆÙ‚Øª</p>
                                    <p class="font-bold text-gray-900">${v.time}</p>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="text-xs text-gray-600 mb-1">ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø©</p>
                                    <p class="font-bold ${v.status === 'active' ? 'text-orange-600' : 'text-green-600'}">
                                        ${v.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ø­Ù„ÙˆÙ„'}
                                    </p>
                                </div>
                            </div>
                            
                            ${v.status === 'resolved' && v.resolutionReason ? `
                                <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                                    <p class="text-sm font-bold text-green-900 mb-2">ğŸ† Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</p>
                                    <p class="text-gray-800 mb-3">${v.resolutionReason}</p>
                                    <div class="flex gap-4 text-xs text-green-700">
                                        <span>ØªÙ… Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©: ${v.resolvedBy}</span>
                                        <span>ÙÙŠ: ${new Date(v.resolvedAt).toLocaleString('ar-SA')}</span>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="sticky bottom-0 bg-gray-50 p-6 border-t flex gap-3 justify-end">
                            <button onclick="closeDetailsModal()" 
                                class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderActionModal() {
            const student = state.modals.selectedStudent;
            if (!student) return '';
            
            const existingAction = state.studentActions.find(
                a => a.studentName === student.name && a.actionBy === state.currentUser.role
            );
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50" onclick="if(event.target===this)closeActionModal()">
                    <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="sticky top-0 bg-gradient-to-r from-orange-600 to-red-600 text-white p-6 rounded-t-xl">
                            <h2 class="text-2xl font-bold">ğŸ“‹ ${existingAction ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Ø§ØªØ®Ø§Ø°'} Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¬Ø§Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                            <p class="text-orange-100 text-sm mt-1">${student.name} - ${student.grade} Ø§Ù„Ø´Ø¹Ø¨Ø© ${student.section}</p>
                        </div>
                        
                        <div class="p-6 space-y-5">
                            <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                                <h3 class="font-bold text-red-900 mb-3">âš ï¸ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª (${student.count} Ù…Ø®Ø§Ù„ÙØ©)</h3>
                                <div class="space-y-2 max-h-48 overflow-y-auto">
                                    ${student.violations.map((v, i) => `
                                        <div class="bg-white border border-red-300 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="text-sm font-bold text-gray-900">${i + 1}. ${v.violationDetails}</span>
                                                <span class="px-2 py-1 ${getDegreeColor(v.violationType)} rounded-full text-xs font-bold">
                                                    ${getDegreeLabel(v.violationType)}
                                                </span>
                                            </div>
                                            <p class="text-xs text-gray-600">ğŸ“… ${v.date} | ğŸ• ${v.time}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø° <span class="text-red-500">*</span></label>
                                <textarea id="actionDetailsInput" 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 min-h-[150px]" 
                                    placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø° ØªØ¬Ø§Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù…Ø«Ø§Ù„: ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ Ø¥Ø­Ø§Ù„Ø© Ù„Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØŒ Ø§Ù„Ø®...)">${existingAction ? existingAction.actionDetails : ''}</textarea>
                            </div>
                            
                            <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                                <h4 class="font-bold text-blue-900 mb-2">ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:</h4>
                                <ul class="text-sm text-blue-800 space-y-1">
                                    <li>â€¢ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ù†Ø§Ù‚Ø´Ø©</li>
                                    <li>â€¢ Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</li>
                                    <li>â€¢ ÙˆØ¶Ø¹ Ø®Ø·Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ù„ÙˆÙƒÙŠØ©</li>
                                    <li>â€¢ Ø¹Ù‚Ø¯ Ø¬Ù„Ø³Ø© Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© ÙØ±Ø¯ÙŠØ©</li>
                                    <li>â€¢ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³Ù„ÙˆÙƒ</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="sticky bottom-0 bg-gray-50 p-6 border-t flex gap-3 justify-end">
                            <button onclick="closeActionModal()" 
                                class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-medium">
                                Ø¥Ù„ØºØ§Ø¡
                            </button>
                            <button onclick="saveStudentAction()" 
                                class="px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium">
                                âœ“ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

/* ========== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ========== */
        render();
    </script>
</body>
</html>


                
