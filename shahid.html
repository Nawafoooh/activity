import React, { useState, useMemo } from 'react';
import { UserCircle, FileText, Bell, LayoutDashboard, Plus, Search, Filter, Award, AlertCircle, Calendar, Clock, User, BookOpen, CheckCircle, XCircle, Eye, Download } from 'lucide-react';

const BehaviorTrackingSystem = () => {
  // State Management
  const [currentUser, setCurrentUser] = useState({ 
    role: 'teacher', 
    name: 'Ù…Ø¹Ù„Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ',
    id: 1
  });

  const [violations, setViolations] = useState([
    {
      id: 1,
      studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
      grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
      section: '1',
      violationType: 'first',
      violationDetails: 'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
      teacherName: 'Ø¹Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙŠØ¯',
      teacherId: 1,
      date: '2025-10-13',
      time: '08:30',
      documentation: 'ØªØ£Ø®Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù† Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰',
      status: 'active',
      createdAt: '2025-10-13T08:30:00'
    },
    {
      id: 2,
      studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
      grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
      section: '1',
      violationType: 'first',
      violationDetails: 'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
      teacherName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø£Ø­Ù…Ø¯',
      teacherId: 2,
      date: '2025-10-14',
      time: '10:15',
      documentation: 'Ù†Ø§Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©',
      status: 'active',
      createdAt: '2025-10-14T10:15:00'
    },
    {
      id: 3,
      studentName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
      grade: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·',
      section: '1',
      violationType: 'second',
      violationDetails: 'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
      teacherName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø§Ù„Ù…',
      teacherId: 3,
      date: '2025-10-14',
      time: '11:30',
      documentation: 'ØºØ§Ø¨ Ø¹Ù† Ø­ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±',
      status: 'active',
      createdAt: '2025-10-14T11:30:00'
    },
    {
      id: 4,
      studentName: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯',
      grade: 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·',
      section: '3',
      violationType: 'first',
      violationDetails: 'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©',
      teacherName: 'Ø¹Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙŠØ¯',
      teacherId: 1,
      date: '2025-10-14',
      time: '09:00',
      documentation: 'ØªØ­Ø¯Ø« Ù…Ø¹ Ø²Ù…ÙŠÙ„Ù‡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø­',
      status: 'active',
      createdAt: '2025-10-14T09:00:00'
    },
    {
      id: 5,
      studentName: 'Ù…Ø­Ù…Ø¯ Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
      grade: 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·',
      section: '2',
      violationType: 'third',
      violationDetails: 'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
      teacherName: 'ÙÙ‡Ø¯ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ',
      teacherId: 4,
      date: '2025-10-12',
      time: '07:45',
      documentation: 'Ø­Ø¶Ø± Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ',
      status: 'resolved',
      resolvedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
      resolutionReason: 'Ø§Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„',
      resolvedAt: '2025-10-13T12:00:00',
      createdAt: '2025-10-12T07:45:00'
    }
  ]);

  const [showAddForm, setShowAddForm] = useState(false);
  const [showDetailsModal, setShowDetailsModal] = useState(false);
  const [selectedViolation, setSelectedViolation] = useState(null);
  const [filterGrade, setFilterGrade] = useState('');
  const [filterSection, setFilterSection] = useState('');
  const [filterTeacher, setFilterTeacher] = useState('');
  const [searchStudent, setSearchStudent] = useState('');
  const [selectedTab, setSelectedTab] = useState('all');
  const [dateFrom, setDateFrom] = useState('');
  const [dateTo, setDateTo] = useState('');

  // School Information
  const schoolInfo = {
    name: 'Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ',
    principal: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
    assistant: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
    counselor: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
    type: 'Ø¨Ù†ÙŠÙ†'
  };

  // Configuration
  const grades = ['Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·'];
  const sections = ['1', '2', '3', '4', '5', '6'];
  
  const violationTypes = {
    first: {
      label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)',
      items: [
        'Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµØ©',
        'Ø¥Ø¹Ø§Ù‚Ø© Ø³ÙŠØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© (ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø£Ø·Ø¹Ù…Ø© ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª)',
        'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ - Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©',
        'Ø§Ù„Ù†ÙˆÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ',
        'ØªÙƒØ±Ø§Ø± Ø®Ø±ÙˆØ¬ ÙˆØ¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ù‚Ø¨Ù„ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù',
        'Ø§Ù„ØªØ¬Ù‡Ø² Ø£Ù…Ø§Ù… Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'
      ]
    },
    second: {
      label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø¯Ø±Ø¬ØªÙŠÙ†)',
      items: [
        'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ø­ØµØ© Ø£Ùˆ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù†Ù‡Ø§',
        'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ÙØµÙ„ Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
        'Ø¯Ø®ÙˆÙ„ ÙØµÙ„ Ø¢Ø®Ø± Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù†',
        'Ø¥Ø«Ø§Ø±Ø© Ø§Ù„ÙÙˆØ¶Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ'
      ]
    },
    third: {
      label: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)',
      items: [
        'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',
        'Ø¥Ù„Ø­Ø§Ù‚ Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ù…ØªØ¹Ù…Ø¯ Ø¨Ù…Ù…ØªÙ„ÙƒØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª',
        'Ø§Ù„Ø¹Ø¨Ø« Ø¨ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© (Ø§Ù„Ù…Ø¹Ù…Ù„ - Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø§Ø³Ø¨)',
        'Ø§Ù…ØªÙ‡Ø§Ù† Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©'
      ]
    }
  };

  // New Violation Form State
  const [newViolation, setNewViolation] = useState({
    studentName: '',
    grade: '',
    section: '',
    violationType: 'first',
    violationDetails: '',
    documentation: '',
    date: new Date().toISOString().split('T')[0],
    time: new Date().toTimeString().slice(0, 5)
  });

  // Functions
  const getStudentViolationCount = (studentName, status = 'active') => {
    return violations.filter(v => 
      v.studentName === studentName && 
      (status === 'all' || v.status === status)
    ).length;
  };

  const getStudentsByViolationCount = () => {
    const studentMap = {};
    violations.filter(v => v.status === 'active').forEach(v => {
      if (!studentMap[v.studentName]) {
        studentMap[v.studentName] = {
          name: v.studentName,
          grade: v.grade,
          section: v.section,
          count: 0,
          violations: []
        };
      }
      studentMap[v.studentName].count++;
      studentMap[v.studentName].violations.push(v);
    });
    return Object.values(studentMap).sort((a, b) => b.count - a.count);
  };

  const handleAddViolation = () => {
    if (newViolation.studentName.trim() && 
        newViolation.grade && 
        newViolation.section && 
        newViolation.violationDetails) {
      
      const violation = {
        id: Math.max(...violations.map(v => v.id), 0) + 1,
        ...newViolation,
        teacherName: currentUser.name,
        teacherId: currentUser.id,
        status: 'active',
        createdAt: new Date().toISOString()
      };
      
      setViolations([violation, ...violations]);
      
      setNewViolation({
        studentName: '',
        grade: '',
        section: '',
        violationType: 'first',
        violationDetails: '',
        documentation: '',
        date: new Date().toISOString().split('T')[0],
        time: new Date().toTimeString().slice(0, 5)
      });
      
      setShowAddForm(false);
    }
  };

  const handleResolveViolation = (violationId) => {
    const reason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨):');
    
    if (reason && reason.trim()) {
      setViolations(violations.map(v => 
        v.id === violationId ? {
          ...v,
          status: 'resolved',
          resolutionReason: reason.trim(),
          resolvedBy: currentUser.name,
          resolvedAt: new Date().toISOString()
        } : v
      ));
    }
  };

  const canResolveViolation = (violation) => {
    if (currentUser.role === 'principal') return true;
    if (currentUser.role === 'assistant' || currentUser.role === 'counselor') {
      return getStudentViolationCount(violation.studentName) >= 3;
    }
    if (currentUser.role === 'teacher') {
      return violation.teacherId === currentUser.id;
    }
    return false;
  };

  // Filtered Violations
  const filteredViolations = useMemo(() => {
    let filtered = [...violations];

    // Role-based filtering
    if (currentUser.role === 'assistant' || currentUser.role === 'counselor') {
      const studentsWithThreePlus = getStudentsByViolationCount()
        .filter(s => s.count >= 3)
        .map(s => s.name);
      
      filtered = filtered.filter(v => studentsWithThreePlus.includes(v.studentName));
    }

    // Status filter
    if (selectedTab === 'active') {
      filtered = filtered.filter(v => v.status === 'active');
    } else if (selectedTab === 'resolved') {
      filtered = filtered.filter(v => v.status === 'resolved');
    }

    // Search and filters
    if (searchStudent.trim()) {
      filtered = filtered.filter(v => 
        v.studentName.includes(searchStudent.trim())
      );
    }

    if (filterGrade) {
      filtered = filtered.filter(v => v.grade === filterGrade);
    }

    if (filterSection) {
      filtered = filtered.filter(v => v.section === filterSection);
    }

    if (filterTeacher) {
      filtered = filtered.filter(v => v.teacherName === filterTeacher);
    }

    if (dateFrom) {
      filtered = filtered.filter(v => v.date >= dateFrom);
    }

    if (dateTo) {
      filtered = filtered.filter(v => v.date <= dateTo);
    }

    return filtered;
  }, [violations, currentUser, selectedTab, searchStudent, filterGrade, filterSection, filterTeacher, dateFrom, dateTo]);

  // Statistics
  const stats = useMemo(() => {
    const active = violations.filter(v => v.status === 'active').length;
    const resolved = violations.filter(v => v.status === 'resolved').length;
    const studentsUnderWatch = getStudentsByViolationCount()
      .filter(s => s.count >= 3).length;
    const today = violations.filter(v => 
      v.date === new Date().toISOString().split('T')[0]
    ).length;

    return { active, resolved, studentsUnderWatch, today };
  }, [violations]);

  const getDegreeLabel = (type) => {
    const labels = {
      first: 'Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„Ù‰',
      second: 'Ø¯Ø±Ø¬Ø© Ø«Ø§Ù†ÙŠØ©',
      third: 'Ø¯Ø±Ø¬Ø© Ø«Ø§Ù„Ø«Ø©'
    };
    return labels[type] || type;
  };

  const getDegreeColor = (type) => {
    const colors = {
      first: 'bg-green-100 text-green-800 border-green-200',
      second: 'bg-yellow-100 text-yellow-800 border-yellow-200',
      third: 'bg-red-100 text-red-800 border-red-200'
    };
    return colors[type] || 'bg-gray-100 text-gray-800';
  };

  const getRoleLabel = (role) => {
    const labels = {
      teacher: 'Ø§Ù„Ù…Ø¹Ù„Ù…',
      assistant: 'Ø§Ù„ÙˆÙƒÙŠÙ„',
      counselor: 'Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ',
      principal: 'Ø§Ù„Ù…Ø¯ÙŠØ±'
    };
    return labels[role];
  };

  const exportToCSV = () => {
    const headers = ['#', 'Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø´Ø¹Ø¨Ø©', 'Ø§Ù„Ø¯Ø±Ø¬Ø©', 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', 'Ø§Ù„Ù…Ø¹Ù„Ù…', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ø­Ø§Ù„Ø©'];
    const rows = filteredViolations.map((v, i) => [
      i + 1,
      v.studentName,
      v.grade,
      v.section,
      getDegreeLabel(v.violationType),
      v.violationDetails,
      v.teacherName,
      v.date,
      v.time,
      v.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ø­Ù„ÙˆÙ„'
    ]);

    const csvContent = [headers, ...rows]
      .map(row => row.join(','))
      .join('\n');

    const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `Ù…Ø®Ø§Ù„ÙØ§Øª_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
  };

  const uniqueTeachers = [...new Set(violations.map(v => v.teacherName))];

  return (
    <div className="min-h-screen bg-gray-50" dir="rtl">
      {/* Header */}
      <div className="bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white shadow-2xl">
        <div className="max-w-7xl mx-auto px-6 py-8">
          <div className="flex items-center justify-between mb-6">
            <div>
              <h1 className="text-4xl font-bold mb-2 flex items-center gap-3">
                <BookOpen size={40} />
                {schoolInfo.name}
              </h1>
              <p className="text-blue-100 text-lg">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© - {schoolInfo.type}</p>
            </div>
            <div className="text-left bg-blue-800 bg-opacity-50 rounded-lg p-4 backdrop-blur-sm">
              <p className="text-sm text-blue-100 mb-1">
                <User className="inline ml-1" size={14} />
                Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: {schoolInfo.principal}
              </p>
              <p className="text-sm text-blue-100 mb-1">
                <User className="inline ml-1" size={14} />
                Ø§Ù„ÙˆÙƒÙŠÙ„: {schoolInfo.assistant}
              </p>
              <p className="text-sm text-blue-100">
                <User className="inline ml-1" size={14} />
                Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ: {schoolInfo.counselor}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* User Selection Tabs */}
      <div className="bg-white border-b shadow-sm sticky top-0 z-40">
        <div className="max-w-7xl mx-auto px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex gap-2">
              <button
                onClick={() => setCurrentUser({ role: 'teacher', name: 'Ù…Ø¹Ù„Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ', id: 1 })}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-200 ${
                  currentUser.role === 'teacher' 
                    ? 'bg-blue-600 text-white shadow-lg transform scale-105' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                <UserCircle size={20} />
                ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
              </button>
              <button
                onClick={() => setCurrentUser({ role: 'assistant', name: schoolInfo.assistant, id: 2 })}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-200 ${
                  currentUser.role === 'assistant' 
                    ? 'bg-blue-600 text-white shadow-lg transform scale-105' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                <FileText size={20} />
                ØµÙØ­Ø© Ø§Ù„ÙˆÙƒÙŠÙ„
              </button>
              <button
                onClick={() => setCurrentUser({ role: 'counselor', name: schoolInfo.counselor, id: 3 })}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-200 ${
                  currentUser.role === 'counselor' 
                    ? 'bg-blue-600 text-white shadow-lg transform scale-105' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                <Bell size={20} />
                Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ
              </button>
              <button
                onClick={() => setCurrentUser({ role: 'principal', name: schoolInfo.principal, id: 4 })}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-200 ${
                  currentUser.role === 'principal' 
                    ? 'bg-blue-600 text-white shadow-lg transform scale-105' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                <LayoutDashboard size={20} />
                ØµÙØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±
              </button>
            </div>
            <div className="bg-blue-50 px-4 py-2 rounded-lg border border-blue-200">
              <p className="text-sm text-blue-900">
                <span className="font-bold">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</span> {currentUser.name} - {getRoleLabel(currentUser.role)}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="max-w-7xl mx-auto px-6 py-6">
        {/* Statistics Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
          <div className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-blue-500">
            <div className="flex items-center justify-between mb-3">
              <AlertCircle size={32} className="text-blue-600" />
              <div className="text-3xl font-bold text-blue-600">{stats.active}</div>
            </div>
            <div className="text-gray-600 font-medium">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
          </div>
          
          <div className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-green-500">
            <div className="flex items-center justify-between mb-3">
              <CheckCircle size={32} className="text-green-600" />
              <div className="text-3xl font-bold text-green-600">{stats.resolved}</div>
            </div>
            <div className="text-gray-600 font-medium">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</div>
          </div>
          
          <div className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-orange-500">
            <div className="flex items-center justify-between mb-3">
              <Eye size={32} className="text-orange-600" />
              <div className="text-3xl font-bold text-orange-600">{stats.studentsUnderWatch}</div>
            </div>
            <div className="text-gray-600 font-medium">Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</div>
          </div>
          
          <div className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-purple-500">
            <div className="flex items-center justify-between mb-3">
              <Calendar size={32} className="text-purple-600" />
              <div className="text-3xl font-bold text-purple-600">{stats.today}</div>
            </div>
            <div className="text-gray-600 font-medium">Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ÙŠÙˆÙ…</div>
          </div>
        </div>

        {/* Tabs and Actions */}
        <div className="bg-white rounded-xl shadow-lg mb-6">
          <div className="border-b px-6 py-4">
            <div className="flex items-center justify-between">
              <div className="flex gap-3">
                <button
                  onClick={() => setSelectedTab('all')}
                  className={`px-5 py-2.5 rounded-lg font-medium transition-all duration-200 ${
                    selectedTab === 'all' 
                      ? 'bg-blue-600 text-white shadow-md' 
                      : 'text-gray-600 hover:bg-gray-100'
                  }`}
                >
                  Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª ({violations.length})
                </button>
                <button
                  onClick={() => setSelectedTab('active')}
                  className={`px-5 py-2.5 rounded-lg font-medium transition-all duration-200 ${
                    selectedTab === 'active' 
                      ? 'bg-blue-600 text-white shadow-md' 
                      : 'text-gray-600 hover:bg-gray-100'
                  }`}
                >
                  Ø§Ù„Ù†Ø´Ø·Ø© ({stats.active})
                </button>
                <button
                  onClick={() => setSelectedTab('resolved')}
                  className={`px-5 py-2.5 rounded-lg font-medium transition-all duration-200 ${
                    selectedTab === 'resolved' 
                      ? 'bg-blue-600 text-white shadow-md' 
                      : 'text-gray-600 hover:bg-gray-100'
                  }`}
                >
                  Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø© ({stats.resolved})
                </button>
              </div>
              
              <div className="flex gap-3">
                <button
                  onClick={exportToCSV}
                  className="flex items-center gap-2 px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md"
                >
                  <Download size={18} />
                  ØªØµØ¯ÙŠØ± Excel
                </button>
                
                {currentUser.role === 'teacher' && (
                  <button
                    onClick={() => setShowAddForm(true)}
                    className="flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md"
                  >
                    <Plus size={20} />
                    Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
                  </button>
                )}
              </div>
            </div>
          </div>

          {/* Filters */}
          <div className="p-6 bg-gray-50 border-b">
            <div className="grid grid-cols-1 md:grid-cols-6 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1">
                  <Search size={14} />
                  Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…
                </label>
                <input
                  type="text"
                  value={searchStudent}
                  onChange={(e) => setSearchStudent(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨..."
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-1">
                  <Filter size={14} />
                  Ø§Ù„ØµÙ
                </label>
                <select
                  value={filterGrade}
                  onChange={(e) => setFilterGrade(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Ø§Ù„ÙƒÙ„</option>
                  {grades.map(g => <option key={g} value={g}>{g}</option>)}
                </select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ø¹Ø¨Ø©</label>
                <select
                  value={filterSection}
                  onChange={(e) => setFilterSection(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Ø§Ù„ÙƒÙ„</option>
                  {sections.map(s => <option key={s} value={s}>{s}</option>)}
                </select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø¹Ù„Ù…</label>
                <select
                  value={filterTeacher}
                  onChange={(e) => setFilterTeacher(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Ø§Ù„ÙƒÙ„</option>
                  {uniqueTeachers.map(t => <option key={t} value={t}>{t}</option>)}
                </select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                <input
                  type="date"
                  value={dateFrom}
                  onChange={(e) => setDateFrom(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                <input
                  type="date"
                  value={dateTo}
                  onChange={(e) => setDateTo(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>
            
            {(searchStudent || filterGrade || filterSection || filterTeacher || dateFrom || dateTo) && (
              <button
                onClick={() => {
                  setSearchStudent('');
                  setFilterGrade('');
                  setFilterSection('');
                  setFilterTeacher('');
                  setDateFrom('');
                  setDateTo('');
                }}
                className="mt-4 text-sm text-blue-600 hover:text-blue-800 font-medium"
              >
                Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±
              </button>
            )}
          </div>

          {/* Violations List */}
          <div className="divide-y">
            {filteredViolations.length === 0 ? (
              <div className="p-16 text-center">
                <AlertCircle size={64} className="mx-auto text-gray-300 mb-4" />
                <p className="text-xl text-gray-500 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ù„Ù„Ø¹Ø±Ø¶</p>
                <p className="text-sm text-gray-400">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</p>
              </div>
            ) : (
              filteredViolations.map((v) => {
                const violationCount = getStudentViolationCount(v.studentName);
                const isHighPriority = violationCount >= 3;
                
                return (
                  <div 
                    key={v.id} 
                    className={`p-6 hover:bg-gray-50 transition-all duration-200 ${
                      isHighPriority && v.status === 'active' ? 'bg-red-50 border-r-4 border-red-500' : ''
                    }`}
                  >
                    <div className="flex justify-between items-start gap-6">
                      <div className="flex-1">
                        {/* Student Info Header */}
                        <div className="flex items-center gap-3 mb-3 flex-wrap">
                          <h3 className="text-xl font-bold text-gray-900">{v.studentName}</h3>
                          
                          <span className="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">
                            {v.grade}
                          </span>
                          
                          <span className="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">
                            Ø§Ù„Ø´Ø¹Ø¨Ø© {v.section}
                          </span>
                          
                          <span className={`px-3 py-1 rounded-full text-xs font-bold border-2 ${getDegreeColor(v.violationType)}`}>
                            {getDegreeLabel(v.violationType)}
                          </span>
                          
                          {isHighPriority && v.status === 'active' && (
                            <span className="flex items-center gap-1 bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-md animate-pulse">
                              <AlertCircle size={14} />
                              ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ({violationCount} Ù…Ø®Ø§Ù„ÙØ§Øª)
                            </span>
                          )}
                          
                          {v.status === 'resolved' && (
                            <span className="flex items-center gap-1 bg-green-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                              <CheckCircle size={14} />
                              ØªÙ… Ø§Ù„Ø­Ù„
                            </span>
                          )}
                        </div>

                        {/* Violation Details */}
                        <div className="bg-white border border-gray-200 rounded-lg p-4 mb-3">
                          <p className="text-gray-800 mb-2 font-semibold text-lg">
                            {v.violationDetails}
                          </p>
                          
                          {v.documentation && (
                            <div className="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                              <p className="text-sm text-blue-900">
                                <span className="font-bold">ğŸ“ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</span>
                                <br />
                                {v.documentation}
                              </p>
                            </div>
                          )}
                        </div>

                        {/* Meta Information */}
                        <div className="flex flex-wrap gap-4 text-sm text-gray-600">
                          <span className="flex items-center gap-1.5">
                            <User size={16} className="text-blue-600" />
                            <strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> {v.teacherName}
                          </span>
                          <span className="flex items-center gap-1.5">
                            <Calendar size={16} className="text-blue-600" />
                            <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> {v.date}
                          </span>
                          <span className="flex items-center gap-1.5">
                            <Clock size={16} className="text-blue-600" />
                            <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> {v.time}
                          </span>
                        </div>

                        {/* Resolution Info */}
                        {v.status === 'resolved' && v.resolutionReason && (
                          <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div className="flex items-start gap-2 mb-2">
                              <Award size={20} className="text-green-600 mt-0.5" />
                              <div className="flex-1">
                                <p className="text-sm font-bold text-green-900 mb-1">
                                  Ø³Ø¨Ø¨ Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ):
                                </p>
                                <p className="text-sm text-green-800 mb-2">
                                  {v.resolutionReason}
                                </p>
                                <div className="flex gap-4 text-xs text-green-700">
                                  <span>ØªÙ… Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©: {v.resolvedBy}</span>
                                  <span>ÙÙŠ: {new Date(v.resolvedAt).toLocaleString('ar-SA')}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Action Buttons */}
                      <div className="flex flex-col gap-2">
                        <button
                          onClick={() => {
                            setSelectedViolation(v);
                            setShowDetailsModal(true);
                          }}
                          className="flex items-center gap-2 bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors whitespace-nowrap"
                        >
                          <Eye size={16} />
                          Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button>
                        
                        {v.status === 'active' && canResolveViolation(v) && (
                          <button
                            onClick={() => handleResolveViolation(v.id)}
                            className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-md whitespace-nowrap"
                          >
                            <Award size={16} />
                            Ø­Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })
            )}
          </div>

          {/* Pagination Info */}
          {filteredViolations.length > 0 && (
            <div className="p-4 bg-gray-50 border-t text-center text-sm text-gray-600">
              Ø¹Ø±Ø¶ {filteredViolations.length} Ù…Ù† Ø£ØµÙ„ {violations.length} Ù…Ø®Ø§Ù„ÙØ©
            </div>
          )}
        </div>

        {/* Students Under Watch Section */}
        {(currentUser.role === 'assistant' || currentUser.role === 'counselor' || currentUser.role === 'principal') && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold mb-4 flex items-center gap-2 text-red-700">
              <AlertCircle size={28} />
              Ø§Ù„Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (3 Ù…Ø®Ø§Ù„ÙØ§Øª ÙØ£ÙƒØ«Ø±)
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {getStudentsByViolationCount()
                .filter(s => s.count >= 3)
                .map((student, index) => (
                  <div 
                    key={index}
                    className="bg-red-50 border-2 border-red-200 rounded-lg p-4 hover:shadow-lg transition-shadow"
                  >
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="font-bold text-gray-900">{student.name}</h3>
                      <span className="bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                        {student.count} Ù…Ø®Ø§Ù„ÙØ§Øª
                      </span>
                    </div>
                    <div className="text-sm text-gray-600 mb-2">
                      {student.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© {student.section}
                    </div>
                    <div className="text-xs text-gray-500">
                      Ø¢Ø®Ø± Ù…Ø®Ø§Ù„ÙØ©: {student.violations[student.violations.length - 1].date}
                    </div>
                  </div>
                ))}
              
              {getStudentsByViolationCount().filter(s => s.count >= 3).length === 0 && (
                <div className="col-span-full text-center py-8 text-gray-500">
                  <CheckCircle size={48} className="mx-auto text-green-500 mb-2" />
                  <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
              )}
            </div>
          </div>
        )}
      </div>

      {/* Add Violation Modal */}
      {showAddForm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
              <h2 className="text-2xl font-bold flex items-center gap-2">
                <Plus size={28} />
                Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø³Ù„ÙˆÙƒÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
              </h2>
              <p className="text-blue-100 text-sm mt-1">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
            </div>
            
            <div className="p-6 space-y-5">
              {/* Student Name */}
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ <span className="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  value={newViolation.studentName}
                  onChange={(e) => setNewViolation({ ...newViolation, studentName: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„"
                />
              </div>

              {/* Grade and Section */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">
                    Ø§Ù„ØµÙ <span className="text-red-500">*</span>
                  </label>
                  <select
                    value={newViolation.grade}
                    onChange={(e) => setNewViolation({ ...newViolation, grade: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  >
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                    {grades.map(g => <option key={g} value={g}>{g}</option>)}
                  </select>
                </div>
                
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">
                    Ø§Ù„Ø´Ø¹Ø¨Ø© <span className="text-red-500">*</span>
                  </label>
                  <select
                    value={newViolation.section}
                    onChange={(e) => setNewViolation({ ...newViolation, section: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  >
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
                    {sections.map(s => <option key={s} value={s}>{s}</option>)}
                  </select>
                </div>
              </div>

              {/* Violation Type */}
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© <span className="text-red-500">*</span>
                </label>
                <div className="grid grid-cols-3 gap-3">
                  <button
                    type="button"
                    onClick={() => setNewViolation({ ...newViolation, violationType: 'first', violationDetails: '' })}
                    className={`p-4 border-2 rounded-lg font-medium transition-all ${
                      newViolation.violationType === 'first'
                        ? 'border-green-500 bg-green-50 text-green-800'
                        : 'border-gray-300 hover:border-green-300'
                    }`}
                  >
                    <div className="text-lg mb-1">Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„Ù‰</div>
                    <div className="text-xs text-gray-600">(Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)</div>
                  </button>
                  
                  <button
                    type="button"
                    onClick={() => setNewViolation({ ...newViolation, violationType: 'second', violationDetails: '' })}
                    className={`p-4 border-2 rounded-lg font-medium transition-all ${
                      newViolation.violationType === 'second'
                        ? 'border-yellow-500 bg-yellow-50 text-yellow-800'
                        : 'border-gray-300 hover:border-yellow-300'
                    }`}
                  >
                    <div className="text-lg mb-1">Ø¯Ø±Ø¬Ø© Ø«Ø§Ù†ÙŠØ©</div>
                    <div className="text-xs text-gray-600">(Ø¯Ø±Ø¬ØªÙŠÙ†)</div>
                  </button>
                  
                  <button
                    type="button"
                    onClick={() => setNewViolation({ ...newViolation, violationType: 'third', violationDetails: '' })}
                    className={`p-4 border-2 rounded-lg font-medium transition-all ${
                      newViolation.violationType === 'third'
                        ? 'border-red-500 bg-red-50 text-red-800'
                        : 'border-gray-300 hover:border-red-300'
                    }`}
                  >
                    <div className="text-lg mb-1">Ø¯Ø±Ø¬Ø© Ø«Ø§Ù„Ø«Ø©</div>
                    <div className="text-xs text-gray-600">(Ø«Ù„Ø§Ø« Ø¯Ø±Ø¬Ø§Øª)</div>
                  </button>
                </div>
              </div>

              {/* Violation Details */}
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© <span className="text-red-500">*</span>
                </label>
                <select
                  value={newViolation.violationDetails}
                  onChange={(e) => setNewViolation({ ...newViolation, violationDetails: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                >
                  <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</option>
                  {violationTypes[newViolation.violationType].items.map(item => (
                    <option key={item} value={item}>{item}</option>
                  ))}
                </select>
              </div>

              {/* Documentation */}
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                </label>
                <textarea
                  value={newViolation.documentation}
                  onChange={(e) => setNewViolation({ ...newViolation, documentation: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none"
                  rows="4"
                  placeholder="Ø£Ø¶Ù ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©ØŒ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ù…Ø­ÙŠØ·Ø©ØŒ Ø£Ùˆ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©..."
                />
              </div>

              {/* Date and Time */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">
                    Ø§Ù„ØªØ§Ø±ÙŠØ®
                  </label>
                  <input
                    type="date"
                    value={newViolation.date}
                    onChange={(e) => setNewViolation({ ...newViolation, date: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">
                    Ø§Ù„ÙˆÙ‚Øª
                  </label>
                  <input
                    type="time"
                    value={newViolation.time}
                    onChange={(e) => setNewViolation({ ...newViolation, time: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  />
                </div>
              </div>
            </div>

            {/* Modal Actions */}
            <div className="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl flex gap-3 justify-end">
              <button
                onClick={() => {
                  setShowAddForm(false);
                  setNewViolation({
                    studentName: '',
                    grade: '',
                    section: '',
                    violationType: 'first',
                    violationDetails: '',
                    documentation: '',
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toTimeString().slice(0, 5)
                  });
                }}
                className="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium"
              >
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button
                onClick={handleAddViolation}
                disabled={!newViolation.studentName.trim() || !newViolation.grade || !newViolation.section || !newViolation.violationDetails}
                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed"
              >
                Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Details Modal */}
      {showDetailsModal && selectedViolation && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
              <h2 className="text-2xl font-bold flex items-center gap-2">
                <Eye size={28} />
                ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
              </h2>
            </div>
            
            <div className="p-6 space-y-4">
              <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                <h3 className="font-bold text-lg text-gray-900 mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <span className="text-gray-600">Ø§Ù„Ø§Ø³Ù…:</span>
                    <span className="font-bold mr-2">{selectedViolation.studentName}</span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ø§Ù„ØµÙ:</span>
                    <span className="font-bold mr-2">{selectedViolation.grade}</span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ø§Ù„Ø´Ø¹Ø¨Ø©:</span>
                    <span className="font-bold mr-2">{selectedViolation.section}</span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª:</span>
                    <span className="font-bold mr-2">{getStudentViolationCount(selectedViolation.studentName)}</span>
                  </div>
                </div>
              </div>

              <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                <h3 className="font-bold text-lg text-gray-900 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</h3>
                <div className="space-y-2 text-sm">
                  <div className="flex items-center gap-2">
                    <span className={`px-3 py-1 rounded-full text-xs font-bold ${getDegreeColor(selectedViolation.violationType)}`}>
                      {getDegreeLabel(selectedViolation.violationType)}
                    </span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</span>
                    <p className="font-bold mt-1">{selectedViolation.violationDetails}</p>
                  </div>
                  {selectedViolation.documentation && (
                    <div>
                      <span className="text-gray-600">Ø§Ù„ØªÙˆØ«ÙŠÙ‚:</span>
                      <p className="mt-1 text-gray-800">{selectedViolation.documentation}</p>
                    </div>
                  )}
                </div>
              </div>

              <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                <h3 className="font-bold text-lg text-gray-900 mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <span className="text-gray-600">Ø§Ù„Ù…Ø¹Ù„Ù…:</span>
                    <span className="font-bold mr-2">{selectedViolation.teacherName}</span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                    <span className="font-bold mr-2">{selectedViolation.date}</span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ø§Ù„ÙˆÙ‚Øª:</span>
                    <span className="font-bold mr-2">{selectedViolation.time}</span>
                  </div>
                  <div>
                    <span className="text-gray-600">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                    <span className={`font-bold mr-2 ${selectedViolation.status === 'active' ? 'text-orange-600' : 'text-green-600'}`}>
                      {selectedViolation.status === 'active' ? 'Ù†Ø´Ø·Ø©' : 'Ù…Ø­Ù„ÙˆÙ„Ø©'}
                    </span>
                  </div>
                </div>
              </div>

              {selectedViolation.status === 'resolved' && selectedViolation.resolutionReason && (
                <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                  <h3 className="font-bold text-lg text-green-900 mb-3 flex items-center gap-2">
                    <Award size={20} />
                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ù„
                  </h3>
                  <div className="space-y-2 text-sm">
                    <div>
                      <span className="text-green-700">Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ:</span>
                      <p className="font-bold mt-1 text-green-900">{selectedViolation.resolutionReason}</p>
                    </div>
                    <div className="grid grid-cols-2 gap-3 mt-3">
                      <div>
                        <span className="text-green-700">ØªÙ… Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©:</span>
                        <span className="font-bold mr-2 text-green-900">{selectedViolation.resolvedBy}</span>
                      </div>
                      <div>
                        <span className="text-green-700">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ù„:</span>
                        <span className="font-bold mr-2 text-green-900">
                          {new Date(selectedViolation.resolvedAt).toLocaleDateString('ar-SA')}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>

            <div className="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl">
              <button
                onClick={() => {
                  setShowDetailsModal(false);
                  setSelectedViolation(null);
                }}
                className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
              >
                Ø¥ØºÙ„Ø§Ù‚
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default BehaviorTrackingSystem;    
