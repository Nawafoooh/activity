<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>برامج النشاط الطلابي - متوسطة المنذر بن عمرو الأنصاري</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 50%, #e6f3ff 100%);
            min-height: 100vh;
            color: #2c3e50;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #2c6470 0%, #4a90a4 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }
        
        .header h1 {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }
        
        .school-info {
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 15px;
            color: #b8dce6;
            position: relative;
            z-index: 1;
        }
        
        .management-info {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .activities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0;
            margin: 40px 20px;
        }
        
        .activity-card {
            background: linear-gradient(135deg, #4a90a4, #2c6470);
            color: white;
            padding: 40px 20px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .activity-card:nth-child(odd) {
            background: linear-gradient(135deg, #5ba3b8, #4a90a4);
        }
        
        .activity-card:nth-child(even) {
            background: linear-gradient(135deg, #3d7485, #2c6470);
        }
        
        .activity-card:nth-child(3n) {
            background: linear-gradient(135deg, #6bb6c9, #5ba3b8);
        }
        
        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: all 0.6s ease;
        }
        
        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .activity-card:hover::before {
            left: 100%;
        }
        
        .form-section {
            background: linear-gradient(135deg, #f8fbfc, #ffffff);
            padding: 40px 20px;
            border-top: 3px solid #4a90a4;
            box-shadow: 0 -2px 10px rgba(74, 144, 164, 0.05);
        }
        
        .form-title {
            text-align: center;
            font-size: 1.6em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #e8f4f8, #f0f8ff);
            border-radius: 10px;
            border-left: 4px solid #4a90a4;
            box-shadow: 0 2px 8px rgba(74, 144, 164, 0.1);
        }

        .tab-navigation {
            display: flex;
            background: linear-gradient(135deg, #e8f4f8, #f0f8ff);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(74, 144, 164, 0.1);
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #2c6470;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4a90a4, #2c6470);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(74, 144, 164, 0.1);
        }

        .hidden {
            display: none !important;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 30px;
            border: none;
            width: 60%;
            max-width: 500px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease-in;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover,
        .close:focus {
            color: #2c6470;
        }

        .report-options {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .report-option {
            background: linear-gradient(135deg, #4a90a4, #2c6470);
            color: white;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .report-option:hover {
            background: linear-gradient(135deg, #357a8a, #1e4f56);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 164, 0.4);
        }

        .modal h2 {
            text-align: center;
            color: #2c6470;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e8f4f8;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.95em;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4a90a4;
            box-shadow: 0 0 0 3px rgba(74, 144, 164, 0.1);
        }
        
        .large-field {
            grid-column: 1 / -1;
        }
        
        .large-field textarea {
            min-height: 100px;
            padding: 12px;
            border: 2px solid #e8f4f8;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            background: white;
        }
        
        .large-field textarea:focus {
            outline: none;
            border-color: #4a90a4;
            box-shadow: 0 0 0 3px rgba(74, 144, 164, 0.1);
        }
        
        .action-buttons {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #4a90a4, #357a8a);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            margin: 0 10px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #357a8a, #2c6470);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 144, 164, 0.3);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .btn.secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .footer {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            text-align: center;
            padding: 25px;
            margin-top: auto;
        }
        
        .footer p {
            margin: 5px 0;
            opacity: 0.9;
        }
        
        .footer .copyright {
            font-size: 0.9em;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .footer .developer {
            color: #74b9ff;
            font-weight: 500;
        }

        .stats-dashboard {
            background: linear-gradient(135deg, #f8fbfc, #ffffff);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 5px 15px rgba(74, 144, 164, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4a90a4, #2c6470);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .backup-controls {
            background: linear-gradient(135deg, #e8f4f8, #f0f8ff);
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }

        .backup-btn {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .backup-btn:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: translateY(-2px);
        }

        .restore-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .restore-btn:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }
        
        @media (max-width: 768px) {
            .activities-grid {
                grid-template-columns: 1fr;
                margin: 20px 10px;
            }
            
            .activity-card {
                padding: 30px 15px;
                font-size: 1em;
            }
            
            .header h1 {
                font-size: 1.6em;
            }
            
            .form-section {
                padding: 30px 15px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: fit-content;
            }

            .modal-content {
                width: 90%;
                margin: 20% auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s ease-out;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .loading {
            position: relative;
            overflow: hidden;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .form-validation-error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
        }

        .validation-message {
            color: #e74c3c;
            font-size: 0.85em;
            margin-top: 5px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4a90a4, #2c6470);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header fade-in">
            <h1>برامج النشاط الطلابي</h1>
            <div class="school-info">متوسطة المنذر بن عمرو الأنصاري</div>
            <div class="management-info">رائد النشاط: عبدالله الحربي</div>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats-dashboard fade-in">
            <h3 style="color: #2c6470; margin-bottom: 15px; text-align: center;">لوحة الإحصائيات</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-activities">7</div>
                    <div class="stat-label">مجالات الأنشطة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="reports-generated">0</div>
                    <div class="stat-label">التقارير المنشأة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="forms-completed">0</div>
                    <div class="stat-label">النماذج المكتملة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-sessions">1</div>
                    <div class="stat-label">الجلسات النشطة</div>
                </div>
            </div>
        </div>

        <!-- Backup Controls -->
        <div class="backup-controls">
            <h4 style="color: #2c6470; margin-bottom: 15px;">إدارة البيانات</h4>
            <button class="backup-btn" onclick="backupData()">📁 نسخ احتياطي للبيانات</button>
            <button class="backup-btn restore-btn" onclick="document.getElementById('restore-file').click()">📂 استرداد البيانات</button>
            <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="restoreData(this)">
            <button class="backup-btn" onclick="exportAllData()">📊 تصدير جميع البيانات</button>
        </div>
        
        <!-- Activities Grid -->
        <div class="activities-grid">
            <div class="activity-card slide-in-right loading" onclick="openActivity('مجال الرياضة والصحة')">
                مجال الرياضة والصحة
            </div>
            
            <div class="activity-card slide-in-left loading" onclick="openActivity('مجال المواطنة والحياة')">
                مجال المواطنة والحياة
            </div>
            
            <div class="activity-card slide-in-right loading" onclick="openActivity('مجال الثقافة والفنون')">
                مجال الثقافة والفنون
            </div>
            
            <div class="activity-card slide-in-left loading" onclick="openActivity('مجال النشاط الكشفي')">
                مجال النشاط الكشفي
            </div>
            
            <div class="activity-card slide-in-right loading" onclick="openActivity('مجال العلوم والتقنية')">
                مجال العلوم والتقنية
            </div>
            
            <div class="activity-card slide-in-left loading" onclick="openActivity('مجال النشاط الاجتماعي')">
                مجال النشاط الاجتماعي
            </div>
            
            <div class="activity-card slide-in-right loading" onclick="openActivity('مجال الأيام والمناسبات')">
                مجال الأيام والمناسبات
            </div>
            
            <div class="activity-card slide-in-left loading" onclick="openFinalReport()">
                التقرير النهائي للأنشطة
            </div>
        </div>
        
        <!-- Form Section -->
        <div class="form-section fade-in">
            <!-- Tab Navigation for Final Reports -->
            <div class="tab-navigation hidden" id="report-tabs">
                <button class="tab-btn active" onclick="switchTab('daily')">التقرير اليومي</button>
                <button class="tab-btn" onclick="switchTab('weekly')">التقرير الأسبوعي</button>
                <button class="tab-btn" onclick="switchTab('monthly')">التقرير الشهري</button>
            </div>

            <div class="form-title" id="form-title">مجال الرياضة والصحة</div>
            
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="form-progress"></div>
            </div>
            
            <!-- Activity Form -->
            <form class="form-grid" id="activity-form">
                <div class="form-group">
                    <label for="education-dept">إدارة التعليم</label>
                    <input type="text" id="education-dept" placeholder="أدخل إدارة التعليم">
                    <div class="validation-message" id="education-dept-error">هذا الحقل مطلوب</div>
                </div>
                
                <div class="form-group">
                    <label for="school-name">اسم المدرسة</label>
                    <input type="text" id="school-name" value="متوسطة المنذر بن عمرو الأنصاري" readonly>
                </div>
                
                <div class="form-group">
                    <label for="teacher-name">اسم المعلم</label>
                    <input type="text" id="teacher-name" placeholder="اسم المعلم">
                    <div class="validation-message" id="teacher-name-error">هذا الحقل مطلوب</div>
                </div>
                
                <div class="form-group">
                    <label for="specialization">التخصص</label>
                    <input type="text" id="specialization" placeholder="التخصص">
                </div>
                
                <div class="form-group">
                    <label for="semester">الفصل الدراسي</label>
                    <select id="semester">
                        <option value="">اختر الفصل الدراسي</option>
                        <option value="first">الفصل الدراسي الأول</option>
                        <option value="second">الفصل الدراسي الثاني</option>
                        <option value="third">الفصل الدراسي الثالث</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="grade">الصف</label>
                    <select id="grade">
                        <option value="">اختر الصف</option>
                        <option value="first">الأول متوسط</option>
                        <option value="second">الثاني متوسط</option>
                        <option value="third">الثالث متوسط</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="date">التاريخ</label>
                    <input type="date" id="date">
                </div>
                
                <div class="form-group">
                    <label for="day">اليوم</label>
                    <input type="text" id="day" placeholder="اليوم" readonly>
                </div>
                
                <div class="form-group">
                    <label for="period">الحصة</label>
                    <select id="period">
                        <option value="">اختر الحصة</option>
                        <option value="1">الحصة الأولى</option>
                        <option value="2">الحصة الثانية</option>
                        <option value="3">الحصة الثالثة</option>
                        <option value="4">الحصة الرابعة</option>
                        <option value="5">الحصة الخامسة</option>
                        <option value="6">الحصة السادسة</option>
                        <option value="7">الحصة السابعة</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="attendance">الغياب</label>
                    <input type="number" id="attendance" placeholder="عدد الطلاب الغائبين" min="0">
                </div>
                
                <div class="form-group">
                    <label for="presence">الحضور</label>
                    <input type="number" id="presence" placeholder="عدد الطلاب الحاضرين" min="0">
                </div>
                
                <div class="form-group">
                    <label for="venue">مكان التنفيذ</label>
                    <input type="text" id="venue" placeholder="مكان تنفيذ النشاط">
                </div>
                
                <div class="form-group">
                    <label for="program-name">اسم البرنامج</label>
                    <input type="text" id="program-name" placeholder="اسم البرنامج/النشاط">
                    <div class="validation-message" id="program-name-error">هذا الحقل مطلوب</div>
                </div>
                
                <div class="form-group large-field">
                    <label for="program-objectives">أهداف البرنامج</label>
                    <textarea id="program-objectives" placeholder="اكتب أهداف البرنامج والنتائج المتوقعة..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="program-impact">الأثر الإيجابي للبرنامج</label>
                    <textarea id="program-impact" placeholder="اكتب الأثر الإيجابي والفوائد المحققة من البرنامج على الطلاب والمجتمع المدرسي..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="evidence">الشواهد</label>
                    <textarea id="evidence" placeholder="اكتب وصف الشواهد والأدلة على نجاح البرنامج..."></textarea>
                </div>
            </form>
            
            <!-- Daily Report Form -->
            <form class="form-grid hidden" id="daily-report-form">
                <div class="form-group">
                    <label for="daily-education-dept">إدارة التعليم</label>
                    <input type="text" id="daily-education-dept" placeholder="أدخل إدارة التعليم">
                </div>
                
                <div class="form-group">
                    <label for="daily-school-name">اسم المدرسة</label>
                    <input type="text" id="daily-school-name" value="متوسطة المنذر بن عمرو الأنصاري" readonly>
                </div>
                
                <div class="form-group">
                    <label for="daily-teacher-name">اسم المعلم</label>
                    <input type="text" id="daily-teacher-name" placeholder="اسم المعلم">
                </div>
                
                <div class="form-group">
                    <label for="daily-specialization">التخصص</label>
                    <input type="text" id="daily-specialization" placeholder="التخصص">
                </div>
                
                <div class="form-group">
                    <label for="daily-semester">الفصل الدراسي</label>
                    <select id="daily-semester">
                        <option value="">اختر الفصل الدراسي</option>
                        <option value="first">الفصل الدراسي الأول</option>
                        <option value="second">الفصل الدراسي الثاني</option>
                        <option value="third">الفصل الدراسي الثالث</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="daily-grade">الصف</label>
                    <select id="daily-grade">
                        <option value="">اختر الصف</option>
                        <option value="first">الأول متوسط</option>
                        <option value="second">الثاني متوسط</option>
                        <option value="third">الثالث متوسط</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="daily-date">التاريخ</label>
                    <input type="date" id="daily-date">
                </div>
                
                <div class="form-group">
                    <label for="daily-period">الحصة</label>
                    <select id="daily-period">
                        <option value="">اختر الحصة</option>
                        <option value="1">الحصة الأولى</option>
                        <option value="2">الحصة الثانية</option>
                        <option value="3">الحصة الثالثة</option>
                        <option value="4">الحصة الرابعة</option>
                        <option value="5">الحصة الخامسة</option>
                        <option value="6">الحصة السادسة</option>
                        <option value="7">الحصة السابعة</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="daily-unit">الوحدة الدراسية</label>
                    <input type="text" id="daily-unit" placeholder="الوحدة الدراسية">
                </div>
                
                <div class="form-group">
                    <label for="daily-lesson-title">عنوان الدرس</label>
                    <input type="text" id="daily-lesson-title" placeholder="عنوان الدرس">
                </div>
                
                <div class="form-group large-field">
                    <label for="daily-objectives">أهداف الدرس</label>
                    <textarea id="daily-objectives" placeholder="اكتب أهداف الدرس..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="daily-achievement-percentage">نسبة تحقق أهداف الدرس</label>
                    <textarea id="daily-achievement-percentage" placeholder="اكتب نسبة تحقق أهداف الدرس..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="daily-student-interaction">ملاحظات حول تفاعل الطلب</label>
                    <textarea id="daily-student-interaction" placeholder="اكتب ملاحظات حول تفاعل الطلب..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="daily-challenges">التحديات الصفية</label>
                    <textarea id="daily-challenges" placeholder="اكتب التحديات الصفية..."></textarea>
                </div>
            </form>
            
            <!-- Weekly Report Form -->
            <form class="form-grid hidden" id="weekly-report-form">
                <div class="form-group">
                    <label for="weekly-education-dept">إدارة التعليم</label>
                    <input type="text" id="weekly-education-dept" placeholder="أدخل إدارة التعليم">
                </div>
                
                <div class="form-group">
                    <label for="weekly-school-name">اسم المدرسة</label>
                    <input type="text" id="weekly-school-name" value="متوسطة المنذر بن عمرو الأنصاري" readonly>
                </div>
                
                <div class="form-group">
                    <label for="weekly-teacher-name">اسم المعلم</label>
                    <input type="text" id="weekly-teacher-name" placeholder="اسم المعلم">
                </div>
                
                <div class="form-group">
                    <label for="weekly-specialization">التخصص</label>
                    <input type="text" id="weekly-specialization" placeholder="التخصص">
                </div>
                
                <div class="form-group">
                    <label for="weekly-semester">الفصل الدراسي</label>
                    <select id="weekly-semester">
                        <option value="">اختر الفصل الدراسي</option>
                        <option value="first">الفصل الدراسي الأول</option>
                        <option value="second">الفصل الدراسي الثاني</option>
                        <option value="third">الفصل الدراسي الثالث</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="weekly-grade">الصف</label>
                    <select id="weekly-grade">
                        <option value="">اختر الصف</option>
                        <option value="first">الأول متوسط</option>
                        <option value="second">الثاني متوسط</option>
                        <option value="third">الثالث متوسط</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="weekly-date">التاريخ</label>
                    <input type="date" id="weekly-date">
                </div>
                
                <div class="form-group">
                    <label for="weekly-week">الأسبوع</label>
                    <input type="text" id="weekly-week" placeholder="الأسبوع">
                </div>
                
                <div class="form-group">
                    <label for="weekly-lessons-taught">أهم الدروس المنفذة</label>
                    <input type="text" id="weekly-lessons-taught" placeholder="أهم الدروس المنفذة">
                </div>
                
                <div class="form-group large-field">
                    <label for="weekly-strength-points">أبرز نقاط القوة لدى الطلب</label>
                    <textarea id="weekly-strength-points" placeholder="اكتب أبرز نقاط القوة لدى الطلب..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="weekly-weakness-points">أبرز نقاط الضعف لدى الطلب</label>
                    <textarea id="weekly-weakness-points" placeholder="اكتب أبرز نقاط الضعف لدى الطلب..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="weekly-educational-challenges">أبرز التحديات التعليمية</label>
                    <textarea id="weekly-educational-challenges" placeholder="اكتب أبرز التحديات التعليمية..."></textarea>
                </div>
            </form>
            
            <!-- Monthly Report Form -->
            <form class="form-grid hidden" id="monthly-report-form">
                <div class="form-group">
                    <label for="monthly-education-dept">إدارة التعليم</label>
                    <input type="text" id="monthly-education-dept" placeholder="أدخل إدارة التعليم">
                </div>
                
                <div class="form-group">
                    <label for="monthly-school-name">اسم المدرسة</label>
                    <input type="text" id="monthly-school-name" value="متوسطة المنذر بن عمرو الأنصاري" readonly>
                </div>
                
                <div class="form-group">
                    <label for="monthly-teacher-name">اسم المعلم</label>
                    <input type="text" id="monthly-teacher-name" placeholder="اسم المعلم">
                </div>
                
                <div class="form-group">
                    <label for="monthly-specialization">التخصص</label>
                    <input type="text" id="monthly-specialization" placeholder="التخصص">
                </div>
                
                <div class="form-group">
                    <label for="monthly-semester">الفصل الدراسي</label>
                    <select id="monthly-semester">
                        <option value="">اختر الفصل الدراسي</option>
                        <option value="first">الفصل الدراسي الأول</option>
                        <option value="second">الفصل الدراسي الثاني</option>
                        <option value="third">الفصل الدراسي الثالث</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="monthly-grade">الصف</label>
                    <select id="monthly-grade">
                        <option value="">اختر الصف</option>
                        <option value="first">الأول متوسط</option>
                        <option value="second">الثاني متوسط</option>
                        <option value="third">الثالث متوسط</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="monthly-date">التاريخ</label>
                    <input type="date" id="monthly-date">
                </div>
                
                <div class="form-group">
                    <label for="monthly-month">الشهر</label>
                    <input type="text" id="monthly-month" placeholder="الشهر">
                </div>
                
                <div class="form-group">
                    <label for="monthly-completion-rate">نسبة إنجاز الخطة</label>
                    <input type="text" id="monthly-completion-rate" placeholder="نسبة إنجاز الخطة">
                </div>
                
                <div class="form-group large-field">
                    <label for="monthly-improved-issues">القضايا المستحدثة التي تحتاج متابعة</label>
                    <textarea id="monthly-improved-issues" placeholder="اكتب القضايا المستحدثة التي تحتاج متابعة..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="monthly-treatment-plans">خطط المعالجة المقترحة</label>
                    <textarea id="monthly-treatment-plans" placeholder="اكتب خطط المعالجة المقترحة..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="monthly-outstanding-students">الطلاب المتميزون</label>
                    <textarea id="monthly-outstanding-students" placeholder="اكتب الطلاب المتميزون..."></textarea>
                </div>
                
                <div class="form-group large-field">
                    <label for="monthly-final-plan">الخطة الإثرائية للطلاب المتميزين</label>
                    <textarea id="monthly-final-plan" placeholder="اكتب الخطة الإثرائية للطلاب المتميزين..."></textarea>
                </div>
            </form>
            
            <div class="action-buttons">
                <button class="btn" onclick="generatePDF()">
                    📄 تحميل ملف PDF
                </button>
                <button class="btn secondary" onclick="clearForm()">
                    🗑️ مسح النموذج
                </button>
                <button class="btn secondary" onclick="exportToExcel()">
                    📊 تصدير إلى Excel
                </button>
                <button class="btn secondary" onclick="saveFormData()">
                    💾 حفظ البيانات
                </button>
                <button class="btn secondary" onclick="validateForm()">
                    ✅ التحقق من البيانات
                </button>
            </div>
        </div>
        
        <!-- Report Selection Modal -->
        <div id="reportModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeReportModal()">&times;</span>
                <h2>اختر نوع التقرير</h2>
                <div class="report-options">
                    <button class="report-option" onclick="selectReportType('daily')">
                        📊 التقرير اليومي
                    </button>
                    <button class="report-option" onclick="selectReportType('weekly')">
                        📈 التقرير الأسبوعي
                    </button>
                    <button class="report-option" onclick="selectReportType('monthly')">
                        📋 التقرير الشهري
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer fade-in">
            <p>متوسطة المنذر بن عمرو الأنصاري - برامج النشاط الطلابي</p>
            <p>رائد النشاط: عبدالله الحربي</p>
            <div class="copyright">
                <p>⚠️ حقوق النسخ محفوظة</p>
                <p>إعداد وتنفيذ: <span class="developer">Nawaf AlSubhi</span></p>
            </div>
        </div>
    </div>
    
    <script>
        let currentReportType = 'activity';
        let stats = {
            reportsGenerated: 0,
            formsCompleted: 0,
            activeSessions: 1
        };
        
        // Field mappings for all report types
        const fieldMappings = {
            'activity': {
                order: [
                    'education-dept', 'school-name', 'teacher-name', 'specialization', 'semester', 'grade',
                    'date', 'day', 'period', 'attendance', 'presence', 'venue', 'program-name',
                    'program-objectives', 'program-impact', 'evidence'
                ],
                labels: {
                    'education-dept': 'إدارة التعليم',
                    'school-name': 'اسم المدرسة',
                    'semester': 'الفصل الدراسي',
                    'specialization': 'التخصص', 
                    'teacher-name': 'اسم المعلم',
                    'grade': 'الصف',
                    'date': 'التاريخ',
                    'day': 'اليوم',
                    'period': 'الحصة',
                    'attendance': 'الغياب',
                    'presence': 'الحضور',
                    'venue': 'مكان التنفيذ',
                    'program-name': 'اسم البرنامج',
                    'program-objectives': 'أهداف البرنامج',
                    'program-impact': 'الأثر الإيجابي للبرنامج',
                    'evidence': 'الشواهد'
                }
            },
            'daily': {
                order: [
                    'daily-education-dept', 'daily-school-name', 'daily-teacher-name', 'daily-specialization',
                    'daily-semester', 'daily-grade', 'daily-date', 'daily-period', 'daily-unit', 'daily-lesson-title',
                    'daily-objectives', 'daily-achievement-percentage', 'daily-student-interaction', 'daily-challenges'
                ],
                labels: {
                    'daily-education-dept': 'إدارة التعليم',
                    'daily-school-name': 'اسم المدرسة',
                    'daily-teacher-name': 'اسم المعلم',
                    'daily-specialization': 'التخصص',
                    'daily-semester': 'الفصل الدراسي',
                    'daily-grade': 'الصف',
                    'daily-date': 'التاريخ',
                    'daily-period': 'الحصة',
                    'daily-unit': 'الوحدة الدراسية',
                    'daily-lesson-title': 'عنوان الدرس',
                    'daily-objectives': 'أهداف الدرس',
                    'daily-achievement-percentage': 'نسبة تحقق أهداف الدرس',
                    'daily-student-interaction': 'ملاحظات حول تفاعل الطلب',
                    'daily-challenges': 'التحديات الصفية'
                }
            },
            'weekly': {
                order: [
                    'weekly-education-dept', 'weekly-school-name', 'weekly-teacher-name', 'weekly-specialization',
                    'weekly-semester', 'weekly-grade', 'weekly-date', 'weekly-week', 'weekly-lessons-taught',
                    'weekly-strength-points', 'weekly-weakness-points', 'weekly-educational-challenges'
                ],
                labels: {
                    'weekly-education-dept': 'إدارة التعليم',
                    'weekly-school-name': 'اسم المدرسة',
                    'weekly-teacher-name': 'اسم المعلم',
                    'weekly-specialization': 'التخصص',
                    'weekly-semester': 'الفصل الدراسي',
                    'weekly-grade': 'الصف',
                    'weekly-date': 'التاريخ',
                    'weekly-week': 'الأسبوع',
                    'weekly-lessons-taught': 'أهم الدروس المنفذة',
                    'weekly-strength-points': 'أبرز نقاط القوة لدى الطلب',
                    'weekly-weakness-points': 'أبرز نقاط الضعف لدى الطلب',
                    'weekly-educational-challenges': 'أبرز التحديات التعليمية'
                }
            },
            'monthly': {
                order: [
                    'monthly-education-dept', 'monthly-school-name', 'monthly-teacher-name', 'monthly-specialization',
                    'monthly-semester', 'monthly-grade', 'monthly-date', 'monthly-month', 'monthly-completion-rate',
                    'monthly-improved-issues', 'monthly-treatment-plans', 'monthly-outstanding-students', 'monthly-final-plan'
                ],
                labels: {
                    'monthly-education-dept': 'إدارة التعليم',
                    'monthly-school-name': 'اسم المدرسة',
                    'monthly-teacher-name': 'اسم المعلم',
                    'monthly-specialization': 'التخصص',
                    'monthly-semester': 'الفصل الدراسي',
                    'monthly-grade': 'الصف',
                    'monthly-date': 'التاريخ',
                    'monthly-month': 'الشهر',
                    'monthly-completion-rate': 'نسبة إنجاز الخطة',
                    'monthly-improved-issues': 'القضايا المستحدثة التي تحتاج متابعة',
                    'monthly-treatment-plans': 'خطط المعالجة المقترحة',
                    'monthly-outstanding-students': 'الطلاب المتميزون',
                    'monthly-final-plan': 'الخطة الإثرائية للطلاب المتميزين'
                }
            }
        };
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            initializeDateFields(today);
            loadSavedData();
            updateStats();
            
            setTimeout(() => {
                document.querySelectorAll('.loading').forEach(el => {
                    el.classList.remove('loading');
                });
            }, 2000);

            // Add form progress tracking
            addFormProgressTracking();
        });
        
        function initializeDateFields(date) {
            const dateInputs = ['date', 'daily-date', 'weekly-date', 'monthly-date'];
            const days = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            
            dateInputs.forEach(inputId => {
                const dateInput = document.getElementById(inputId);
                if (dateInput) {
                    dateInput.value = date.toISOString().split('T')[0];
                    
                    dateInput.addEventListener('change', function() {
                        const selectedDate = new Date(this.value);
                        const dayInputId = inputId.replace('date', 'day');
                        const dayInput = document.getElementById(dayInputId);
                        if (dayInput) {
                            dayInput.value = days[selectedDate.getDay()];
                        }
                    });
                }
            });
            
            const dayInput = document.getElementById('day');
            if (dayInput) {
                dayInput.value = days[date.getDay()];
            }
        }

        // Form Progress Tracking
        function addFormProgressTracking() {
            const forms = ['activity-form', 'daily-report-form', 'weekly-report-form', 'monthly-report-form'];
            
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    const inputs = form.querySelectorAll('input:not([readonly]), select, textarea');
                    inputs.forEach(input => {
                        input.addEventListener('input', updateFormProgress);
                        input.addEventListener('change', updateFormProgress);
                    });
                }
            });
        }

        function updateFormProgress() {
            const currentForm = getCurrentActiveForm();
            if (!currentForm) return;

            const inputs = currentForm.querySelectorAll('input:not([readonly]), select, textarea');
            const filledInputs = Array.from(inputs).filter(input => input.value.trim() !== '');
            const progress = (filledInputs.length / inputs.length) * 100;

            const progressFill = document.getElementById('form-progress');
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }

            if (progress === 100) {
                stats.formsCompleted++;
                updateStats();
                showNotification('تم إكمال النموذج بنجاح!', 'success');
            }
        }

        function getCurrentActiveForm() {
            const forms = ['activity-form', 'daily-report-form', 'weekly-report-form', 'monthly-report-form'];
            return forms.map(id => document.getElementById(id)).find(form => !form.classList.contains('hidden'));
        }

        // Enhanced Statistics Functions
        function updateStats() {
            document.getElementById('reports-generated').textContent = stats.reportsGenerated;
            document.getElementById('forms-completed').textContent = stats.formsCompleted;
            document.getElementById('active-sessions').textContent = stats.activeSessions;
        }

        // Data Management Functions
        function saveFormData() {
            const currentMapping = fieldMappings[currentReportType];
            const formData = getCurrentFormData(currentMapping.order);
            
            const savedData = {
                reportType: currentReportType,
                data: formData,
                timestamp: new Date().toISOString(),
                formTitle: document.getElementById('form-title').textContent
            };

            const allSavedData = JSON.parse(localStorage.getItem('studentActivityData') || '[]');
            allSavedData.push(savedData);
            localStorage.setItem('studentActivityData', JSON.stringify(allSavedData));
            
            showNotification('تم حفظ البيانات بنجاح!', 'success');
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('studentActivityData');
            if (savedData) {
                const data = JSON.parse(savedData);
                stats.formsCompleted = data.length;
                updateStats();
            }
        }

        function backupData() {
            const allData = {
                forms: JSON.parse(localStorage.getItem('studentActivityData') || '[]'),
                stats: stats,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `student_activity_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('تم إنشاء النسخة الاحتياطية بنجاح!', 'success');
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.forms) {
                        localStorage.setItem('studentActivityData', JSON.stringify(data.forms));
                    }
                    if (data.stats) {
                        stats = { ...stats, ...data.stats };
                        updateStats();
                    }
                    
                    showNotification('تم استرداد البيانات بنجاح!', 'success');
                    
                } catch (error) {
                    showNotification('خطأ في قراءة ملف النسخة الاحتياطية', 'error');
                }
            };
            reader.readAsText(file);
        }

        function exportAllData() {
            const allData = JSON.parse(localStorage.getItem('studentActivityData') || '[]');
            
            if (allData.length === 0) {
                showNotification('لا توجد بيانات للتصدير', 'warning');
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            csvContent += "نوع التقرير,عنوان النموذج,التاريخ,البيانات\n";

            allData.forEach(item => {
                const dataStr = Object.entries(item.data)
                    .map(([key, value]) => `${key}: ${value}`)
                    .join('; ');
                
                csvContent += `"${item.reportType}","${item.formTitle}","${new Date(item.timestamp).toLocaleDateString('ar-SA')}","${dataStr}"\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `all_student_activity_data_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('تم تصدير جميع البيانات بنجاح!', 'success');
        }

        // Form Validation
        function validateForm() {
            const currentForm = getCurrentActiveForm();
            if (!currentForm) return false;

            const requiredFields = [
                'education-dept', 'teacher-name', 'program-name',
                'daily-teacher-name', 'weekly-teacher-name', 'monthly-teacher-name'
            ];

            let isValid = true;
            let errors = [];

            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.offsetParent !== null) { // Check if field is visible
                    const errorElement = document.getElementById(fieldId + '-error');
                    
                    if (!field.value.trim()) {
                        field.classList.add('form-validation-error');
                        if (errorElement) {
                            errorElement.style.display = 'block';
                        }
                        isValid = false;
                        errors.push(fieldMappings[currentReportType]?.labels[fieldId] || fieldId);
                    } else {
                        field.classList.remove('form-validation-error');
                        if (errorElement) {
                            errorElement.style.display = 'none';
                        }
                    }
                }
            });

            if (isValid) {
                showNotification('تم التحقق من النموذج بنجاح! جميع الحقول المطلوبة مكتملة.', 'success');
            } else {
                showNotification(`يرجى إكمال الحقول التالية: ${errors.join(', ')}`, 'error');
            }

            return isValid;
        }
        
        function openFinalReport() {
            const modal = document.getElementById('reportModal');
            modal.style.display = 'block';
        }
        
        function closeReportModal() {
            const modal = document.getElementById('reportModal');
            modal.style.display = 'none';
        }
        
        function selectReportType(reportType) {
            currentReportType = reportType;
            closeReportModal();
            
            // Hide all forms and tabs
            document.getElementById('activity-form').classList.add('hidden');
            document.getElementById('daily-report-form').classList.add('hidden');
            document.getElementById('weekly-report-form').classList.add('hidden');
            document.getElementById('monthly-report-form').classList.add('hidden');
            document.getElementById('report-tabs').classList.add('hidden');
            
            // Show appropriate form and update title
            const formTitle = document.getElementById('form-title');
            
            if (reportType === 'daily') {
                document.getElementById('daily-report-form').classList.remove('hidden');
                document.getElementById('report-tabs').classList.remove('hidden');
                formTitle.textContent = 'التقرير اليومي';
            } else if (reportType === 'weekly') {
                document.getElementById('weekly-report-form').classList.remove('hidden');
                document.getElementById('report-tabs').classList.remove('hidden');
                formTitle.textContent = 'التقرير الأسبوعي';
            } else if (reportType === 'monthly') {
                document.getElementById('monthly-report-form').classList.remove('hidden');
                document.getElementById('report-tabs').classList.remove('hidden');
                formTitle.textContent = 'التقرير الشهري';
            }
            
            // Update tab active state
            updateTabActiveState(reportType);
            
            // Scroll to form
            document.querySelector('.form-section').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            const reportNames = {
                'daily': 'التقرير اليومي',
                'weekly': 'التقرير الأسبوعي',
                'monthly': 'التقرير الشهري'
            };
            
            showNotification(`تم تحديد ${reportNames[reportType]}`, 'success');
        }
        
        function switchTab(tabType) {
            currentReportType = tabType;
            
            // Hide all forms
            document.getElementById('daily-report-form').classList.add('hidden');
            document.getElementById('weekly-report-form').classList.add('hidden');
            document.getElementById('monthly-report-form').classList.add('hidden');
            
            // Show selected form
            document.getElementById(`${tabType}-report-form`).classList.remove('hidden');
            
            // Update form title
            const formTitle = document.getElementById('form-title');
            const titles = {
                'daily': 'التقرير اليومي',
                'weekly': 'التقرير الأسبوعي',
                'monthly': 'التقرير الشهري'
            };
            formTitle.textContent = titles[tabType];
            
            // Update tab active state
            updateTabActiveState(tabType);
            
            // Reset progress bar
            updateFormProgress();
        }
        
        function updateTabActiveState(activeTab) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected tab
            const tabMapping = {
                'daily': 0,
                'weekly': 1,
                'monthly': 2
            };
            
            const tabButtons = document.querySelectorAll('.tab-btn');
            if (tabButtons[tabMapping[activeTab]]) {
                tabButtons[tabMapping[activeTab]].classList.add('active');
            }
        }
        
        function openActivity(activityName) {
            currentReportType = 'activity';
            
            // Hide all report forms and tabs
            document.getElementById('daily-report-form').classList.add('hidden');
            document.getElementById('weekly-report-form').classList.add('hidden');
            document.getElementById('monthly-report-form').classList.add('hidden');
            document.getElementById('report-tabs').classList.add('hidden');
            
            // Show activity form
            document.getElementById('activity-form').classList.remove('hidden');
            
            const formTitle = document.getElementById('form-title');
            formTitle.textContent = activityName;
            
            formTitle.style.animation = 'none';
            setTimeout(() => {
                formTitle.style.animation = 'fadeIn 0.5s ease-in';
            }, 10);
            
            document.querySelector('.form-section').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            // Reset progress bar
            updateFormProgress();
            
            showNotification(`تم تحديد ${activityName}`, 'success');
        }
        
        function clearForm() {
            if (confirm('هل أنت متأكد من مسح جميع البيانات؟')) {
                let targetForm;
                
                if (currentReportType === 'daily') {
                    targetForm = document.getElementById('daily-report-form');
                } else if (currentReportType === 'weekly') {
                    targetForm = document.getElementById('weekly-report-form');
                } else if (currentReportType === 'monthly') {
                    targetForm = document.getElementById('monthly-report-form');
                } else {
                    targetForm = document.getElementById('activity-form');
                }
                
                targetForm.querySelectorAll('input:not([readonly]), select, textarea').forEach(input => {
                    input.value = '';
                    input.classList.remove('form-validation-error');
                });
                
                // Hide validation messages
                targetForm.querySelectorAll('.validation-message').forEach(msg => {
                    msg.style.display = 'none';
                });
                
                // Reset progress bar
                updateFormProgress();
                
                showNotification('تم مسح النموذج بنجاح!', 'success');
            }
        }

        // Helper functions for data collection
        function getCurrentFormData(fieldOrder) {
            const formData = {};
            fieldOrder.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    formData[fieldId] = element.value || '';
                }
            });
            return formData;
        }

        // Advanced PDF generation functionality
        function generatePDF() {
            if (!validateForm()) {
                showNotification('يرجى إكمال الحقول المطلوبة قبل إنشاء التقرير', 'warning');
                return;
            }

            showNotification('جاري إنشاء ملف PDF...', 'info');
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // Get current form data and configuration
                const currentMapping = fieldMappings[currentReportType];
                const formData = getCurrentFormData(currentMapping.order);
                
                // Check if form has data
                const hasData = Object.values(formData).some(value => value.trim() !== '');
                if (!hasData) {
                    showNotification('يرجى تعبئة بعض الحقول قبل إنشاء التقرير', 'warning');
                    return;
                }
                
                // Create PDF sections
                createPDFHeader(doc);
                const reportTitle = document.getElementById('form-title').textContent;
                createPDFTitle(doc, reportTitle);
                let currentY = createPDFContent(doc, formData, currentMapping);
                createPDFFooter(doc, currentY);
                
                // Save file
                const fileName = generateFileName(reportTitle);
                doc.save(fileName);
                
                // Update statistics
                stats.reportsGenerated++;
                updateStats();
                
                showNotification('تم تحميل ملف PDF بنجاح!', 'success');
                
            } catch (error) {
                console.error('خطأ في إنشاء PDF:', error);
                showNotification('حدث خطأ في إنشاء ملف PDF. يرجى المحاولة مرة أخرى.', 'error');
            }
        }

        function createPDFHeader(doc) {
            // Header background
            doc.setFillColor(44, 100, 112);
            doc.rect(0, 0, 210, 45, 'F');
            
            // Decorative elements
            doc.setFillColor(255, 255, 255, 0.1);
            for (let i = 0; i < 10; i++) {
                doc.circle(20 + i * 15, 15, 2, 'F');
                doc.circle(30 + i * 15, 30, 1.5, 'F');
            }
            
            // Header text
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text('Kingdom of Saudi Arabia', 105, 15, { align: 'center' });
            doc.text('المملكة العربية السعودية', 105, 25, { align: 'center' });
            
            doc.setFontSize(14);
            doc.text('Ministry of Education', 105, 35, { align: 'center' });
            doc.text('وزارة التعليم', 105, 42, { align: 'center' });
        }

        function createPDFTitle(doc, reportTitle) {
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(44, 100, 112);
            doc.setFontSize(18);
            
            doc.text('Student Activities Program', 105, 60, { align: 'center' });
            doc.text('برنامج الأنشطة الطلابية', 105, 70, { align: 'center' });
            
            doc.setFontSize(16);
            doc.setTextColor(74, 144, 164);
            
            const englishTitle = translateReportTitle(reportTitle);
            doc.text(englishTitle, 105, 85, { align: 'center' });
            
            // Decorative line
            doc.setDrawColor(74, 144, 164);
            doc.setLineWidth(1);
            doc.line(30, 95, 180, 95);
            
            doc.setFillColor(74, 144, 164);
            doc.circle(25, 95, 2, 'F');
            doc.circle(185, 95, 2, 'F');
        }

        function createPDFContent(doc, formData, mapping) {
            let yPosition = 110;
            
            yPosition = addSchoolInfo(doc, formData, mapping, yPosition);
            yPosition = addBasicData(doc, formData, mapping, yPosition);
            yPosition = addDetailedContent(doc, formData, mapping, yPosition);
            
            return yPosition;
        }

        function addSchoolInfo(doc, formData, mapping, startY) {
            let yPosition = startY;
            
            doc.setDrawColor(74, 144, 164);
            doc.setLineWidth(0.5);
            doc.rect(20, yPosition - 5, 170, 25);
            
            doc.setFillColor(248, 251, 252);
            doc.rect(20, yPosition - 5, 170, 25, 'F');
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(44, 100, 112);
            doc.text('School Information', 25, yPosition + 3);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.setTextColor(46, 62, 80);
            
            doc.text('School: Al-Mundhir bin Amr Al-Ansari Middle School', 25, yPosition + 10);
            doc.text('Activity Coordinator: Abdullah Al-Harbi', 25, yPosition + 16);
            
            return yPosition + 35;
        }

        function addBasicData(doc, formData, mapping, startY) {
            let yPosition = startY;
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(44, 100, 112);
            doc.text('Basic Information', 25, yPosition);
            
            yPosition += 10;
            
            const basicFields = getBasicFields(mapping.order);
            const tableData = [];
            
            basicFields.forEach(fieldId => {
                if (formData[fieldId]) {
                    const label = translateFieldLabel(mapping.labels[fieldId]);
                    const value = formatFieldValue(fieldId, formData[fieldId]);
                    tableData.push([label, value]);
                }
            });
            
            yPosition = drawTable(doc, tableData, 25, yPosition, 160);
            
            return yPosition + 10;
        }

        function addDetailedContent(doc, formData, mapping, startY) {
            let yPosition = startY;
            
            const detailedFields = getDetailedFields(mapping.order);
            
            detailedFields.forEach(fieldId => {
                if (formData[fieldId] && formData[fieldId].trim()) {
                    if (yPosition > 240) {
                        doc.addPage();
                        yPosition = 30;
                    }
                    
                    yPosition = addDetailedField(doc, fieldId, formData[fieldId], mapping.labels, yPosition);
                }
            });
            
            return yPosition;
        }

        function addDetailedField(doc, fieldId, value, labels, startY) {
            let yPosition = startY;
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.setTextColor(44, 100, 112);
            
            const englishLabel = translateFieldLabel(labels[fieldId]);
            doc.text(englishLabel + ':', 25, yPosition);
            
            yPosition += 8;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.setTextColor(46, 62, 80);
            
            const processedContent = processArabicContent(value);
            const lines = doc.splitTextToSize(processedContent, 160);
            
            const contentHeight = lines.length * 5 + 6;
            doc.setDrawColor(230, 244, 248);
            doc.setFillColor(248, 251, 252);
            doc.rect(25, yPosition - 2, 160, contentHeight, 'FD');
            
            doc.text(lines, 30, yPosition + 3);
            
            return yPosition + contentHeight + 8;
        }

        function drawTable(doc, data, x, y, width) {
            const rowHeight = 8;
            const colWidth = width / 2;
            
            doc.setDrawColor(74, 144, 164);
            doc.setLineWidth(0.3);
            
            data.forEach((row, index) => {
                const currentY = y + (index * rowHeight);
                
                if (index % 2 === 0) {
                    doc.setFillColor(248, 251, 252);
                    doc.rect(x, currentY, width, rowHeight, 'F');
                }
                
                doc.rect(x, currentY, colWidth, rowHeight);
                doc.rect(x + colWidth, currentY, colWidth, rowHeight);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(44, 100, 112);
                doc.text(row[0], x + 3, currentY + 5);
                
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(46, 62, 80);
                doc.text(row[1], x + colWidth + 3, currentY + 5);
            });
            
            return y + (data.length * rowHeight);
        }

        function createPDFFooter(doc, startY) {
            const pageHeight = 297;
            let yPosition = Math.max(startY + 20, pageHeight - 60);
            
            doc.setDrawColor(74, 144, 164);
            doc.setLineWidth(0.5);
            doc.line(25, yPosition, 185, yPosition);
            
            yPosition += 15;
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.setTextColor(44, 100, 112);
            
            doc.text('Activity Coordinator', 60, yPosition);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text('Abdullah Al-Harbi', 60, yPosition + 6);
            doc.line(30, yPosition + 10, 90, yPosition + 10);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.text('School Principal', 150, yPosition);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text('Signature', 150, yPosition + 6);
            doc.line(120, yPosition + 10, 180, yPosition + 10);
            
            yPosition += 25;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            
            const currentDate = new Date().toLocaleDateString('en-US');
            doc.text('Al-Mundhir bin Amr Al-Ansari Middle School', 105, yPosition, { align: 'center' });
            doc.text(`Generated on: ${currentDate}`, 105, yPosition + 5, { align: 'center' });
        }

        // Translation helper functions
        function translateReportTitle(arabicTitle) {
            const translations = {
                'مجال الرياضة والصحة': 'Sports and Health Field',
                'مجال المواطنة والحياة': 'Citizenship and Life Field',
                'مجال الثقافة والفنون': 'Culture and Arts Field',
                'مجال النشاط الكشفي': 'Scout Activity Field',
                'مجال العلوم والتقنية': 'Science and Technology Field',
                'مجال النشاط الاجتماعي': 'Social Activity Field',
                'مجال الأيام والمناسبات': 'Events and Occasions Field',
                'التقرير اليومي': 'Daily Report',
                'التقرير الأسبوعي': 'Weekly Report',
                'التقرير الشهري': 'Monthly Report'
            };
            return translations[arabicTitle] || 'Activity Report';
        }

        function translateFieldLabel(arabicLabel) {
            const translations = {
                'إدارة التعليم': 'Education Department',
                'اسم المدرسة': 'School Name',
                'اسم المعلم': 'Teacher Name',
                'التخصص': 'Specialization',
                'الفصل الدراسي': 'Semester',
                'الصف': 'Grade',
                'التاريخ': 'Date',
                'اليوم': 'Day',
                'الحصة': 'Period',
                'الغياب': 'Absent Students',
                'الحضور': 'Present Students',
                'مكان التنفيذ': 'Venue',
                'اسم البرنامج': 'Program Name',
                'أهداف البرنامج': 'Program Objectives',
                'الأثر الإيجابي للبرنامج': 'Program Impact',
                'الشواهد': 'Evidence',
                'الوحدة الدراسية': 'Study Unit',
                'عنوان الدرس': 'Lesson Title',
                'أهداف الدرس': 'Lesson Objectives',
                'نسبة تحقق أهداف الدرس': 'Achievement Percentage',
                'ملاحظات حول تفاعل الطلب': 'Student Interaction Notes',
                'التحديات الصفية': 'Classroom Challenges',
                'الأسبوع': 'Week',
                'أهم الدروس المنفذة': 'Key Lessons Implemented',
                'أبرز نقاط القوة لدى الطلب': 'Student Strengths',
                'أبرز نقاط الضعف لدى الطلب': 'Student Weaknesses',
                'أبرز التحديات التعليمية': 'Educational Challenges',
                'الشهر': 'Month',
                'نسبة إنجاز الخطة': 'Plan Completion Rate',
                'القضايا المستحدثة التي تحتاج متابعة': 'New Issues Requiring Follow-up',
                'خطط المعالجة المقترحة': 'Proposed Treatment Plans',
                'الطلاب المتميزون': 'Outstanding Students',
                'الخطة الإثرائية للطلاب المتميزين': 'Enrichment Plan for Outstanding Students'
            };
            return translations[arabicLabel] || arabicLabel;
        }

        function formatFieldValue(fieldId, value) {
            if (fieldId.includes('semester')) {
                const semesterTranslations = {
                    'first': 'First Semester',
                    'second': 'Second Semester',
                    'third': 'Third Semester'
                };
                return semesterTranslations[value] || value;
            }
            
            if (fieldId.includes('grade')) {
                const gradeTranslations = {
                    'first': '1st Middle Grade',
                    'second': '2nd Middle Grade',
                    'third': '3rd Middle Grade'
                };
                return gradeTranslations[value] || value;
            }
            
            if (fieldId.includes('period')) {
                return `Period ${value}`;
            }
            
            return value;
        }

        function processArabicContent(arabicText) {
            if (arabicText.length > 100) {
                return `[Arabic content available - ${arabicText.length} characters]\n\nContent summary: ${arabicText.substring(0, 100)}...`;
            }
            
            return arabicText.replace(/[\u0600-\u06FF]/g, '?') || '[Arabic text content]';
        }

        function getBasicFields(allFields) {
            return allFields.filter(field => 
                !field.includes('objectives') && 
                !field.includes('impact') && 
                !field.includes('evidence') &&
                !field.includes('challenges') &&
                !field.includes('interaction') &&
                !field.includes('achievement') &&
                !field.includes('strength') &&
                !field.includes('weakness') &&
                !field.includes('issues') &&
                !field.includes('plans') &&
                !field.includes('students')
            );
        }

        function getDetailedFields(allFields) {
            return allFields.filter(field => 
                field.includes('objectives') || 
                field.includes('impact') || 
                field.includes('evidence') ||
                field.includes('challenges') ||
                field.includes('interaction') ||
                field.includes('achievement') ||
                field.includes('strength') ||
                field.includes('weakness') ||
                field.includes('issues') ||
                field.includes('plans') ||
                field.includes('students')
            );
        }

        function generateFileName(reportTitle) {
            const date = new Date();
            const dateStr = date.toISOString().split('T')[0];
            const timeStr = date.toTimeString().split(' ')[0].replace(/:/g, '-');
            const cleanTitle = reportTitle.replace(/[^\w\s]/gi, '').replace(/\s+/g, '_');
            return `${cleanTitle}_${dateStr}_${timeStr}.pdf`;
        }
        
        // Export to Excel functionality
        function exportToExcel() {
            if (!validateForm()) {
                showNotification('يرجى إكمال الحقول المطلوبة قبل التصدير', 'warning');
                return;
            }

            showNotification('جاري تحضير ملف Excel...', 'info');
            
            const currentMapping = fieldMappings[currentReportType];
            const formData = getCurrentFormData(currentMapping.order);
            
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            
            csvContent += "الحقل,القيمة\n";
            
            currentMapping.order.forEach(fieldId => {
                if (formData[fieldId]) {
                    const label = currentMapping.labels[fieldId];
                    const value = formData[fieldId].replace(/,/g, '،');
                    csvContent += `"${label}","${value}"\n`;
                }
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            
            const reportTitle = document.getElementById('form-title').textContent;
            const fileName = `${reportTitle.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
            link.setAttribute("download", fileName);
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('تم تصدير البيانات بنجاح!', 'success');
        }
        
        // Notification system
        function showNotification(message, type) {
            const colors = {
                'success': '#27ae60',
                'error': '#e74c3c',
                'warning': '#f39c12',
                'info': '#3498db'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 500;
                max-width: 300px;
                animation: slideInRight 0.3s ease-out;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Event listeners and interactions
        window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target == modal) {
                closeReportModal();
            }
        }

        document.addEventListener('input', function(event) {
            if (event.target.matches('input, select, textarea')) {
                // Remove validation error styling when user starts typing
                event.target.classList.remove('form-validation-error');
                const errorElement = document.getElementById(event.target.id + '-error');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
                
                // Update form progress
                updateFormProgress();
                
                const autoSaveData = {
                    field: event.target.id,
                    value: event.target.value,
                    reportType: currentReportType,
                    timestamp: Date.now()
                };
            }
        });
        
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                generatePDF();
            }
            
            if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                event.preventDefault();
                clearForm();
            }
            
            if (event.key === 'Escape') {
                closeReportModal();
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 5px 15px rgba(74, 144, 164, 0.2)';
                });
                
                field.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
        });

        document.addEventListener('scroll', function() {
            const header = document.querySelector('.header');
            if (window.scrollY > 100) {
                header.style.transform = 'translateY(-5px)';
                header.style.boxShadow = '0 5px 20px rgba(0,0,0,0.1)';
            } else {
                header.style.transform = 'translateY(0)';
                header.style.boxShadow = 'none';
            }
        });

        document.addEventListener('contextmenu', function(event) {
            if (event.target.matches('input, textarea, select')) {
                event.preventDefault();
                
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: fixed;
                    top: ${event.clientY}px;
                    left: ${event.clientX}px;
                    background: white;
                    border: 1px solid #ddd;
                    border-radius: 5px;
                    padding: 5px 0;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    z-index: 1000;
                `;
                
                const clearOption = document.createElement('div');
                clearOption.textContent = 'مسح الحقل';
                clearOption.style.cssText = `
                    padding: 8px 15px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                clearOption.addEventListener('click', function() {
                    event.target.value = '';
                    event.target.classList.remove('form-validation-error');
                    const errorElement = document.getElementById(event.target.id + '-error');
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                    updateFormProgress();
                    document.body.removeChild(menu);
                });
                
                const copyOption = document.createElement('div');
                copyOption.textContent = 'نسخ النص';
                copyOption.style.cssText = `
                    padding: 8px 15px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                copyOption.addEventListener('click', function() {
                    navigator.clipboard.writeText(event.target.value);
                    showNotification('تم نسخ النص', 'success');
                    document.body.removeChild(menu);
                });
                
                menu.appendChild(clearOption);
                if (event.target.value) {
                    menu.appendChild(copyOption);
                }
                document.body.appendChild(menu);
                
                document.addEventListener('click', function() {
                    if (document.body.contains(menu)) {
                        document.body.removeChild(menu);
                    }
                }, { once: true });
            }
        });

        // Auto-save functionality
        function enableAutoSave() {
            setInterval(() => {
                const currentMapping = fieldMappings[currentReportType];
                const formData = getCurrentFormData(currentMapping.order);
                
                const hasData = Object.values(formData).some(value => value.trim() !== '');
                if (hasData) {
                    const autoSaveData = {
                        reportType: currentReportType,
                        data: formData,
                        timestamp: new Date().toISOString(),
                        isAutoSave: true
                    };
                    
                    localStorage.setItem('autoSaveData', JSON.stringify(autoSaveData));
                }
            }, 30000); // Auto-save every 30 seconds
        }

        function loadAutoSaveData() {
            const autoSaveData = localStorage.getItem('autoSaveData');
            if (autoSaveData) {
                const data = JSON.parse(autoSaveData);
                const timeDiff = new Date() - new Date(data.timestamp);
                
                // If auto-save is less than 1 hour old
                if (timeDiff < 3600000) {
                    if (confirm('تم العثور على بيانات محفوظة تلقائياً. هل تريد استردادها؟')) {
                        currentReportType = data.reportType;
                        
                        // Load the appropriate form
                        if (data.reportType !== 'activity') {
                            selectReportType(data.reportType);
                        }
                        
                        // Fill the form data
                        Object.entries(data.data).forEach(([fieldId, value]) => {
                            const field = document.getElementById(fieldId);
                            if (field) {
                                field.value = value;
                            }
                        });
                        
                        updateFormProgress();
                        showNotification('تم استرداد البيانات المحفوظة تلقائياً', 'success');
                    }
                }
            }
        }

        // Initialize auto-save when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                loadAutoSaveData();
                enableAutoSave();
            }, 1000);
        });

        // Print functionality
        function printForm() {
            const currentForm = getCurrentActiveForm();
            if (!currentForm) return;

            const printWindow = window.open('', '_blank');
            const reportTitle = document.getElementById('form-title').textContent;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <title>${reportTitle}</title>
                    <style>
                        body { font-family: 'Tajawal', Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #4a90a4; padding-bottom: 20px; margin-bottom: 30px; }
                        .form-group { margin-bottom: 15px; page-break-inside: avoid; }
                        .form-group label { font-weight: bold; color: #2c6470; }
                        .form-group input, .form-group select, .form-group textarea { 
                            border: 1px solid #ddd; padding: 8px; width: 100%; margin-top: 5px; 
                        }
                        .footer { margin-top: 40px; border-top: 1px solid #ddd; padding-top: 20px; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>متوسطة المنذر بن عمرو الأنصاري</h1>
                        <h2>${reportTitle}</h2>
                        <p>التاريخ: ${new Date().toLocaleDateString('ar-SA')}</p>
                    </div>
                    ${currentForm.innerHTML}
                    <div class="footer">
                        <p>رائد النشاط: عبدالله الحربي</p>
                        <p>التوقيع: ________________</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 1000);
        }

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Existing shortcuts
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                generatePDF();
            }
            
            if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                event.preventDefault();
                clearForm();
            }
            
            if (event.key === 'Escape') {
                closeReportModal();
            }

            // New shortcuts
            if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
                event.preventDefault();
                printForm();
            }

            if ((event.ctrlKey || event.metaKey) && event.key === 'e') {
                event.preventDefault();
                exportToExcel();
            }

            if ((event.ctrlKey || event.metaKey) && event.key === 'b') {
                event.preventDefault();
                backupData();
            }

            if ((event.ctrlKey || event.metaKey) && event.key === 'v' && event.shiftKey) {
                event.preventDefault();
                validateForm();
            }
        });

        // Field auto-completion suggestions
        const suggestionData = {
            'education-dept': ['إدارة تعليم الرياض', 'إدارة تعليم جدة', 'إدارة تعليم الدمام', 'إدارة تعليم مكة'],
            'teacher-name': ['أحمد محمد', 'فاطمة العلي', 'محمد السعد', 'نورا الأحمد'],
            'specialization': ['رياضيات', 'علوم', 'لغة عربية', 'لغة إنجليزية', 'اجتماعيات', 'تربية بدنية'],
            'venue': ['المسرح المدرسي', 'الصالة الرياضية', 'المكتبة', 'المختبر', 'الفناء', 'قاعة الحاسوب']
        };

        function setupAutoComplete() {
            Object.keys(suggestionData).forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', function() {
                        showSuggestions(this, suggestionData[fieldId]);
                    });
                }
            });
        }

        function showSuggestions(input, suggestions) {
            const value = input.value.toLowerCase();
            const filteredSuggestions = suggestions.filter(suggestion => 
                suggestion.toLowerCase().includes(value)
            );

            // Remove existing suggestions
            const existingSuggestions = document.querySelector('.suggestions-list');
            if (existingSuggestions) {
                existingSuggestions.remove();
            }

            if (filteredSuggestions.length > 0 && value.length > 1) {
                const suggestionsList = document.createElement('div');
                suggestionsList.className = 'suggestions-list';
                suggestionsList.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: white;
                    border: 1px solid #ddd;
                    border-top: none;
                    border-radius: 0 0 6px 6px;
                    max-height: 150px;
                    overflow-y: auto;
                    z-index: 100;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                `;

                filteredSuggestions.forEach(suggestion => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.textContent = suggestion;
                    suggestionItem.style.cssText = `
                        padding: 8px 12px;
                        cursor: pointer;
                        border-bottom: 1px solid #f0f0f0;
                    `;
                    
                    suggestionItem.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = '#f8f9fa';
                    });
                    
                    suggestionItem.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'white';
                    });
                    
                    suggestionItem.addEventListener('click', function() {
                        input.value = suggestion;
                        suggestionsList.remove();
                        updateFormProgress();
                    });
                    
                    suggestionsList.appendChild(suggestionItem);
                });

                input.parentNode.style.position = 'relative';
                input.parentNode.appendChild(suggestionsList);

                // Remove suggestions when clicking elsewhere
                document.addEventListener('click', function(event) {
                    if (!input.contains(event.target) && !suggestionsList.contains(event.target)) {
                        suggestionsList.remove();
                    }
                }, { once: true });
            }
        }

        // Initialize auto-complete
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(setupAutoComplete, 500);
        });

        // Add help tooltips
        function addHelpTooltips() {
            const helpTexts = {
                'program-objectives': 'اكتب الأهداف التعليمية والتربوية المراد تحقيقها من البرنامج',
                'program-impact': 'صف التأثير الإيجابي المتوقع على الطلاب والمجتمع المدرسي',
                'evidence': 'اذكر الأدلة والشواهد التي تثبت نجاح البرنامج مثل الصور والمشاركات',
                'daily-objectives': 'حدد الأهداف التعليمية الواضحة والقابلة للقياس للدرس',
                'weekly-strength-points': 'اذكر المهارات والقدرات التي يتميز بها الطلاب',
                'monthly-completion-rate': 'احسب النسبة المئوية لإنجاز الخطة الدراسية'
            };

            Object.keys(helpTexts).forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    const helpIcon = document.createElement('span');
                    helpIcon.innerHTML = ' ❓';
                    helpIcon.style.cssText = `
                        cursor: help;
                        color: #4a90a4;
                        font-size: 0.9em;
                        margin-right: 5px;
                    `;
                    helpIcon.title = helpTexts[fieldId];
                    
                    field.parentNode.querySelector('label').appendChild(helpIcon);
                }
            });
        }

        // Initialize help tooltips
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(addHelpTooltips, 600);
        });

        // Enhanced notification system with action buttons
        function showAdvancedNotification(message, type, actions = []) {
            const colors = {
                'success': '#27ae60',
                'error': '#e74c3c',
                'warning': '#f39c12',
                'info': '#3498db'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 500;
                max-width: 350px;
                animation: slideInRight 0.3s ease-out;
            `;
            
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.marginBottom = actions.length > 0 ? '10px' : '0';
            notification.appendChild(messageDiv);
            
            if (actions.length > 0) {
                const actionsDiv = document.createElement('div');
                actionsDiv.style.cssText = `
                    display: flex;
                    gap: 10px;
                    margin-top: 10px;
                `;
                
                actions.forEach(action => {
                    const actionBtn = document.createElement('button');
                    actionBtn.textContent = action.text;
                    actionBtn.style.cssText = `
                        background: rgba(255,255,255,0.2);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 5px 10px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 0.85em;
                    `;
                    actionBtn.onclick = () => {
                        action.callback();
                        notification.remove();
                    };
                    actionsDiv.appendChild(actionBtn);
                });
                
                notification.appendChild(actionsDiv);
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>
