<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام متابعة مؤشرات التقويم المدرسي</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.plugin.arabic.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            font-size: 14px;
        }
        
        .header {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 1.5rem;
        }
        
        .header h5, .header h6 {
            font-size: 0.9rem;
        }
        
        .domain-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .domain-header {
            background: linear-gradient(45deg, #2c5530, #4a7c59);
            color: white;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .progress-indicator {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .table-container {
            padding: 0;
            overflow-x: auto;
        }
        
        .custom-table {
            margin: 0;
            font-size: 0.8rem;
            min-width: 800px;
        }
        
        .custom-table th {
            background-color: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #495057;
            padding: 10px 8px;
            font-size: 0.75rem;
            white-space: nowrap;
        }
        
        .custom-table td {
            padding: 8px 6px;
            border-top: 1px solid #dee2e6;
            vertical-align: middle;
        }
        
        .custom-table input, .custom-table select {
            font-size: 0.75rem;
            padding: 4px 6px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .status-complete {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-incomplete {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .btn-view-docs {
            padding: 4px 8px;
            font-size: 0.7rem;
            border-radius: 10px;
        }
        
        .btn-export {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            margin: 15px;
            font-size: 0.9rem;
        }
        
        .modal-header {
            background: linear-gradient(45deg, #2c5530, #4a7c59);
            color: white;
        }
        
        .documents-section {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .document-item {
            background: white;
            padding: 6px 10px;
            border-radius: 4px;
            margin-bottom: 4px;
            border-right: 3px solid #28a745;
            font-size: 0.85rem;
        }
        
        .comments-section {
            margin-top: 15px;
        }
        
        .progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
        }
        
        .school-info {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .info-field {
            margin-bottom: 12px;
        }
        
        .info-field label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 4px;
            display: block;
            font-size: 0.9rem;
        }
        
        .info-field input {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px;
            width: 100%;
            font-size: 0.9rem;
        }
        
        .footer {
            background-color: #2c5530;
            color: white;
            padding: 12px 0;
            margin-top: 30px;
            position: relative;
            bottom: 0;
            width: 100%;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .header {
                padding: 10px 0;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .header h5, .header h6 {
                font-size: 0.8rem;
            }
            
            .header p {
                font-size: 0.75rem;
            }
            
            .domain-card {
                margin-bottom: 15px;
                border-radius: 8px;
            }
            
            .domain-header {
                padding: 12px;
                font-size: 1rem;
            }
            
            .school-info {
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .school-info h4 {
                font-size: 1.1rem;
            }
            
            .custom-table {
                font-size: 0.7rem;
                min-width: 700px;
            }
            
            .custom-table th {
                padding: 8px 4px;
                font-size: 0.65rem;
            }
            
            .custom-table td {
                padding: 6px 4px;
            }
            
            .custom-table input, .custom-table select {
                font-size: 0.65rem;
                padding: 3px 4px;
            }
            
            .btn-view-docs {
                padding: 3px 6px;
                font-size: 0.6rem;
            }
            
            .btn-export {
                padding: 6px 15px;
                font-size: 0.8rem;
                margin: 10px;
            }
            
            .modal-dialog {
                margin: 10px;
            }
            
            .document-item {
                padding: 5px 8px;
                font-size: 0.8rem;
            }
            
            .form-range {
                width: 40px !important;
            }
            
            .progress-indicator {
                height: 4px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .header h1 {
                font-size: 1rem;
            }
            
            .domain-header {
                font-size: 0.9rem;
                padding: 10px;
            }
            
            .custom-table {
                min-width: 600px;
                font-size: 0.65rem;
            }
            
            .custom-table th, .custom-table td {
                padding: 4px 2px;
            }
            
            .btn-export {
                width: 90%;
                margin: 10px 5%;
            }
            
            .school-info .row {
                --bs-gutter-x: 0.5rem;
            }
            
            .modal-dialog {
                margin: 5px;
            }
        }
        
        /* Landscape mode adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 8px 0;
                margin-bottom: 10px;
            }
            
            .domain-card {
                margin-bottom: 10px;
            }
            
            .school-info {
                padding: 10px;
                margin-bottom: 10px;
            }
        }
        
        /* Print styles for better PDF generation */
        @media print {
            .btn-export {
                display: none;
            }
            
            .footer {
                margin-top: 20px;
                padding: 8px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <div class="text-center">
                <h6 class="mb-1">المملكة العربية السعودية</h6>
                <h5 class="mb-1">وزارة التعليم</h5>
                <h6 class="mb-3">مكتب قطاع أحد والعوالي</h6>
                <h1><i class="fas fa-school"></i> نظام متابعة مؤشرات التقويم المدرسي</h1>
                <p class="mb-0">وفقاً للدليل الإسترشادي لأخصائي التقويم المدرسي - هيئة تقويم التعليم والتدريب</p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- School Information -->
        <div class="school-info">
            <h4><i class="fas fa-info-circle"></i> معلومات المدرسة</h4>
            <div class="row">
                <div class="col-md-4">
                    <div class="info-field">
                        <label>اسم المدرسة:</label>
                        <input type="text" id="schoolName" placeholder="أدخل اسم المدرسة" value="متوسطة المنذر بن عمرو الأنصاري">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-field">
                        <label>اسم المدير:</label>
                        <input type="text" id="principalName" placeholder="أدخل اسم المدير" value="خالد سعود المطيري">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-field">
                        <label>تاريخ التقرير:</label>
                        <input type="date" id="reportDate">
                    </div>
                </div>
            </div>
        </div>

        <!-- Domain 1: School Management -->
        <div class="domain-card">
            <div class="domain-header">
                <i class="fas fa-cogs"></i> مجال الإدارة المدرسية
                <div class="progress-indicator">
                    <div class="progress-bar" id="progress-1" style="width: 0%"></div>
                </div>
                <small id="progress-text-1">نسبة الإنجاز: 0%</small>
            </div>
            <div class="table-container">
                <table class="table custom-table">
                    <thead>
                        <tr>
                            <th width="15%">المؤشر</th>
                            <th width="20%">المسؤول</th>
                            <th width="15%">تاريخ المتابعة</th>
                            <th width="15%">الحالة</th>
                            <th width="10%">نسبة الإنجاز</th>
                            <th width="15%">الوثائق</th>
                            <th width="10%">الملاحظات</th>
                        </tr>
                    </thead>
                    <tbody id="domain-1-body">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="text-center">
                <button class="btn btn-primary btn-export" onclick="exportToPDF(1)">
                    <i class="fas fa-download"></i> تصدير تقرير PDF
                </button>
            </div>
        </div>

        <!-- Domain 2: Teaching and Learning -->
        <div class="domain-card">
            <div class="domain-header">
                <i class="fas fa-chalkboard-teacher"></i> مجال التعليم والتعلم
                <div class="progress-indicator">
                    <div class="progress-bar" id="progress-2" style="width: 0%"></div>
                </div>
                <small id="progress-text-2">نسبة الإنجاز: 0%</small>
            </div>
            <div class="table-container">
                <table class="table custom-table">
                    <thead>
                        <tr>
                            <th width="15%">المؤشر</th>
                            <th width="20%">المسؤول</th>
                            <th width="15%">تاريخ المتابعة</th>
                            <th width="15%">الحالة</th>
                            <th width="10%">نسبة الإنجاز</th>
                            <th width="15%">الوثائق</th>
                            <th width="10%">الملاحظات</th>
                        </tr>
                    </thead>
                    <tbody id="domain-2-body">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="text-center">
                <button class="btn btn-primary btn-export" onclick="exportToPDF(2)">
                    <i class="fas fa-download"></i> تصدير تقرير PDF
                </button>
            </div>
        </div>

        <!-- Domain 3: Learning Outcomes -->
        <div class="domain-card">
            <div class="domain-header">
                <i class="fas fa-graduation-cap"></i> مجال نواتج التعلم
                <div class="progress-indicator">
                    <div class="progress-bar" id="progress-3" style="width: 0%"></div>
                </div>
                <small id="progress-text-3">نسبة الإنجاز: 0%</small>
            </div>
            <div class="table-container">
                <table class="table custom-table">
                    <thead>
                        <tr>
                            <th width="15%">المؤشر</th>
                            <th width="20%">المسؤول</th>
                            <th width="15%">تاريخ المتابعة</th>
                            <th width="15%">الحالة</th>
                            <th width="10%">نسبة الإنجاز</th>
                            <th width="15%">الوثائق</th>
                            <th width="10%">الملاحظات</th>
                        </tr>
                    </thead>
                    <tbody id="domain-3-body">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="text-center">
                <button class="btn btn-primary btn-export" onclick="exportToPDF(3)">
                    <i class="fas fa-download"></i> تصدير تقرير PDF
                </button>
            </div>
        </div>

        <!-- Domain 4: School Environment -->
        <div class="domain-card">
            <div class="domain-header">
                <i class="fas fa-shield-alt"></i> مجال البيئة المدرسية
                <div class="progress-indicator">
                    <div class="progress-bar" id="progress-4" style="width: 0%"></div>
                </div>
                <small id="progress-text-4">نسبة الإنجاز: 0%</small>
            </div>
            <div class="table-container">
                <table class="table custom-table">
                    <thead>
                        <tr>
                            <th width="15%">المؤشر</th>
                            <th width="20%">المسؤول</th>
                            <th width="15%">تاريخ المتابعة</th>
                            <th width="15%">الحالة</th>
                            <th width="10%">نسبة الإنجاز</th>
                            <th width="15%">الوثائق</th>
                            <th width="10%">الملاحظات</th>
                        </tr>
                    </thead>
                    <tbody id="domain-4-body">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="text-center">
                <button class="btn btn-primary btn-export" onclick="exportToPDF(4)">
                    <i class="fas fa-download"></i> تصدير تقرير PDF
                </button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="text-center">
                <p class="mb-0">
                    نُراقب • نُقيم • نُطور
                </p>
                <small class="text-light">تنفيذ: نواف الصبحي</small>
            </div>
        </div>
    </footer>

    <!-- Documents Modal -->
    <div class="modal fade" id="documentsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">الوثائق والسجلات المطلوبة</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="documents-section">
                        <h6><i class="fas fa-file-alt"></i> الوثائق المطلوبة:</h6>
                        <div id="requiredDocuments">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="comments-section">
                        <h6><i class="fas fa-comments"></i> مرئيات وملاحظات المسؤول:</h6>
                        <textarea class="form-control" id="modalComments" rows="4" placeholder="أضف ملاحظاتك هنا..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-success" onclick="saveComments()">حفظ الملاحظات</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data structure for indicators
        const indicatorsData = {
            1: { // School Management
                title: "مجال الإدارة المدرسية",
                indicators: [
                    {
                        code: "1-1-1-1",
                        title: "تضع المدرسة خطة تشغيلية مكتملة العناصر",
                        documents: ["سجل الخطة التشغيلية", "سجل برامج الخطة التشغيلية", "سجل اللجان المدرسية", "سجل التكليفات"]
                    },
                    {
                        code: "1-1-1-2", 
                        title: "تتابع المدرسة تنفيذ خطتها وتطورها",
                        documents: ["سجل الخطة التشغيلية (قسم المتابعة والتقويم)", "سجل برامج النشاط", "سجل برامج الإرشاد", "سجل اللجنة الإدارية", "سجل توثيق البرامج", "سجل تطوير وتحسين الخطة التشغيلية"]
                    },
                    {
                        code: "1-2-1-1",
                        title: "تعزز المدرسة القيم الإسلامية والهوية الوطنية",
                        documents: ["سجل لجنة التوجيه والإرشاد", "سجل التوجيه والإرشاد", "سجل الأنشطة والبرامج"]
                    },
                    {
                        code: "1-2-1-2",
                        title: "تلتزم المدرسة بقيم مهنة التعليم وأخلاقياتها",
                        documents: ["سجل الاجتماعات", "سجل التبليغات", "سجل البرامج والأنشطة", "نشرات", "خطة متابعة السلوك الوظيفي", "سجل التحفيز والتكريم", "سجل المخالفات", "سجل حصر الغياب والتأخر", "سجل استئذان الموظفين"]
                    },
                    {
                        code: "1-2-1-3",
                        title: "توفر المدرسة مناخًا آمنًا للتعلم والنمو",
                        documents: ["سجل البرامج الوقائية والعلاجية", "سجل التوجيه والإرشاد", "سجل مجالس الحوار الطلابي", "سجل المخالفات السلوكية", "سجل الحالات الطارئة"]
                    },
                    {
                        code: "1-2-1-4",
                        title: "تنشر المدرسة قواعد السلوك والمواظبة",
                        documents: ["سجل التوجيه والإرشاد", "سجل الانضباط المدرسي", "سجل التوقيع على قواعد السلوك والمواظبة", "سجل الحالات الطارئة", "سجل المخالفات السلوكية", "سجل البرامج الوقائية والعلاجية", "سجل تعزيز السلوك الإيجابي"]
                    },
                    {
                        code: "1-2-1-5",
                        title: "توفر المدرسة برامج وأنشطة تربوية داعمة للسلوك الإيجابي",
                        documents: ["سجل تعزيز السلوك الإيجابي", "سجل لجنة التوجيه والإرشاد", "سجل التوجيه والإرشاد", "سجل المخالفات السلوكية"]
                    },
                    {
                        code: "1-2-1-6",
                        title: "توفر المدرسة برامج وأنشطة إثرائية لتطوير مواهب المتعلمين",
                        documents: ["سجل الأنشطة الإثرائية", "سجل الأنشطة والبرامج", "سجل لجنة التوجيه والإرشاد", "سجل الموهوبين", "سجل لجنة التميز", "سجل المسابقات"]
                    },
                    {
                        code: "1-3-1-1",
                        title: "تعزز المدرسة العمل التعاوني والعلاقات الإيجابية",
                        documents: ["سجل الخطة التشغيلية", "سجل البرامج والأنشطة", "سجل النمو المهني"]
                    },
                    {
                        code: "1-3-1-2",
                        title: "تعزز المدرسة مشاركة الأسرة في تعلم أبنائها",
                        documents: ["سجل استطلاع الرأي والاستبانات", "سجل التواصل مع أولياء الأمور", "ملف البرامج والأنشطة", "سجل التوجيه والإرشاد", "سجل مجالس أولياء الأمور"]
                    },
                    {
                        code: "1-3-1-3",
                        title: "تعزز المدرسة الشراكة المجتمعية لدعم التعلم",
                        documents: ["سجل الخطة التشغيلية", "سجل البرامج والأنشطة", "سجل الشراكة المجتمعية", "سجل التوجيه والإرشاد"]
                    },
                    {
                        code: "1-4-1-1",
                        title: "توفر المدرسة كادرًا تعليميًا مكتملًا ومؤهلًا",
                        documents: ["سجل أحوال الموظفين", "سجل التكاليف", "سجل اللجنة الإدارية", "سجل توزيع الأنصبة", "الجدول المدرسي", "بيانات الكادر التعليمي من نظام نور"]
                    },
                    {
                        code: "1-4-1-2",
                        title: "توفر المدرسة كادرًا إداريًا مكتملًا ومؤهلًا",
                        documents: ["سجل أحوال الموظفين", "سجل التكاليف", "سجل اللجنة الإدارية", "بيانات الكادر الإداري من نظام نور", "سجل الوصف الوظيفي"]
                    },
                    {
                        code: "1-4-1-3",
                        title: "تظهر المدرسة ثباتًا واستدامة مالية",
                        documents: ["سجل الخطة المالية", "سجل الموازنة المالية", "سجل فريق الصندوق المدرسي", "سجل السياسات المالية", "سجل تحصيل الرسوم", "استمارة الرسوم الدراسية", "الموقع الإلكتروني للمدرسة"]
                    },
                    {
                        code: "1-4-1-4",
                        title: "تشجع المدرسة منسوبيها للحصول على الرخصة المهنية",
                        documents: ["سجل الرخصة المهنية", "سجل النمو المهني"]
                    },
                    {
                        code: "1-4-1-5",
                        title: "تدعم المدرسة التطوير المهني لمنسوبيها",
                        documents: ["سجل النمو المهني"]
                    },
                    {
                        code: "1-4-1-6",
                        title: "تطبق المدرسة التقويم الذاتي المبني على المعايير",
                        documents: ["سجل لجنة التميز", "سجل التقويم الذاتي"]
                    },
                    {
                        code: "1-4-1-7",
                        title: "تنفذ المدرسة خطة للتحسين بناءً على نتائج التقويم",
                        documents: ["سجل تطوير وتحسين الخطة التشغيلية", "سجل اللجنة الإدارية"]
                    }
                ]
            },
            2: { // Teaching and Learning
                title: "مجال التعليم والتعلم",
                indicators: [
                    {
                        code: "2-1-1-2",
                        title: "تدعم المدرسة تنفيذ المناهج لتحقيق نواتج التعلم",
                        documents: ["عينة من ملفات إنجاز المعلمين", "عينة من الأنشطة الصفية", "عينة من خطة توزيع المناهج", "ملف متابعة تنفيذ المنهج"]
                    },
                    {
                        code: "2-1-1-6",
                        title: "تنمي المدرسة المهارات القرائية والعددية الأساسية",
                        documents: ["سجل الأنشطة الإثرائية", "سجل الأنشطة العلاجية", "سجل المسابقات", "نتائج الاختبارات الوطنية", "سجل تحدي القراءة", "سجل سد الفجوة (للرياضيات)"]
                    },
                    {
                        code: "2-1-1-7",
                        title: "تنمي المدرسة مهارات التفكير العليا لدى المتعلمين",
                        documents: ["عينة من الأنشطة الصفية الخاصة بالمتعلمين"]
                    },
                    {
                        code: "2-2-1-1",
                        title: "تقيم المدرسة أداء المتعلمين باستخدام أساليب متنوعة",
                        documents: ["عينة من الأنشطة الصفية الخاصة بالمتعلمين", "سجل تحضير الدروس", "سجل النمو المهني"]
                    },
                    {
                        code: "2-2-1-2",
                        title: "تحلل المدرسة نتائج التقويم وتوظفها في تحسين التعلم",
                        documents: ["سجل تحليل النتائج (لمختلف التخصصات)", "سجل الأنشطة العلاجية", "سجل الأنشطة الإثرائية"]
                    },
                    {
                        code: "2-2-1-3",
                        title: "تقدم المدرسة التغذية الراجعة للمتعلمين بانتظام",
                        documents: ["سجل متابعة أداء المتعلمين", "سجل إنجاز المتعلمين / الكتب"]
                    }
                ]
            },
            3: { // Learning Outcomes
                title: "مجال نواتج التعلم",
                indicators: [
                    {
                        code: "3-2-1-4",
                        title: "يشارك المتعلمون في الأنشطة المجتمعية والأعمال التطوعية",
                        documents: ["سجل العمل التطوعي", "سجل التوجيه والإرشاد"]
                    },
                    {
                        code: "3-2-1-5",
                        title: "يلتزم المتعلمون بقواعد السلوك والانضباط المدرسي",
                        documents: ["سجل المخالفات السلوكية", "سجل الانضباط المدرسي", "سجل التوجيه والإرشاد", "سجل التكريم"]
                    }
                ]
            },
            4: { // School Environment
                title: "مجال البيئة المدرسية",
                indicators: [
                    {
                        code: "4-2-1-1",
                        title: "تتوافر متطلبات الأمن والسلامة في جميع مرافق المدرسة",
                        documents: ["سجل لجنة الأمن والسلامة", "شهادة الأمن والسلامة من الدفاع المدني (سارية)", "سجل الموجه الصحي", "الشهادات الصحية للعاملين سارية المفعول"]
                    },
                    {
                        code: "4-2-1-2",
                        title: "تعمل المدرسة على صيانة جميع مرافق المبنى بانتظام",
                        documents: ["سجل الصيانة الدورية", "سجل لجنة الأمن والسلامة"]
                    }
                ]
            }
        };

        // Initialize data structure for tracking
        let trackingData = {};
        let currentModalIndicator = null;

        // Initialize the application
        function initializeApp() {
            loadData();
            populateTables();
            updateProgress();
            setCurrentDate();
        }

        // Set current date
        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportDate').value = today;
        }

        // Load data from memory
        function loadData() {
            // Initialize tracking data for all indicators
            for (let domainId in indicatorsData) {
                if (!trackingData[domainId]) {
                    trackingData[domainId] = {};
                }
                
                indicatorsData[domainId].indicators.forEach(indicator => {
                    if (!trackingData[domainId][indicator.code]) {
                        trackingData[domainId][indicator.code] = {
                            responsible: '',
                            followupDate: '',
                            status: 'incomplete',
                            progress: 0,
                            comments: ''
                        };
                    }
                });
            }
        }

        // Save data to memory (no localStorage used)
        function saveData() {
            // Data is stored in memory only
            console.log('Data saved to memory');
        }

        // Populate tables with indicators
        function populateTables() {
            for (let domainId in indicatorsData) {
                const tbody = document.getElementById(`domain-${domainId}-body`);
                tbody.innerHTML = '';
                
                indicatorsData[domainId].indicators.forEach(indicator => {
                    const data = trackingData[domainId][indicator.code];
                    const row = createIndicatorRow(domainId, indicator, data);
                    tbody.appendChild(row);
                });
            }
        }

        // Create table row for indicator
        function createIndicatorRow(domainId, indicator, data) {
            const row = document.createElement('tr');
            
            const progressColor = data.progress >= 100 ? '#28a745' : data.progress >= 50 ? '#ffc107' : '#dc3545';
            
            row.innerHTML = `
                <td>
                    <strong>${indicator.code}</strong><br>
                    <small class="text-muted">${indicator.title}</small>
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${data.responsible}" 
                           onchange="updateIndicatorData('${domainId}', '${indicator.code}', 'responsible', this.value)">
                </td>
                <td>
                    <input type="date" class="form-control form-control-sm" 
                           value="${data.followupDate}" 
                           onchange="updateIndicatorData('${domainId}', '${indicator.code}', 'followupDate', this.value)">
                </td>
                <td>
                    <select class="form-select form-select-sm" 
                            onchange="updateIndicatorData('${domainId}', '${indicator.code}', 'status', this.value)">
                        <option value="incomplete" ${data.status === 'incomplete' ? 'selected' : ''}>❌ غير مكتمل</option>
                        <option value="complete" ${data.status === 'complete' ? 'selected' : ''}>✅ مكتمل</option>
                    </select>
                </td>
                <td>
                    <div class="d-flex align-items-center">
                        <input type="range" class="form-range me-2" min="0" max="100" 
                               value="${data.progress}" 
                               onchange="updateIndicatorData('${domainId}', '${indicator.code}', 'progress', this.value)"
                               style="width: 60px;">
                        <span class="badge" style="background-color: ${progressColor}; color: white; font-size: 0.8rem;">
                            ${data.progress}%
                        </span>
                    </div>
                </td>
                <td>
                    <button class="btn btn-outline-primary btn-view-docs" 
                            onclick="showDocuments('${domainId}', '${indicator.code}')">
                        <i class="fas fa-eye"></i> عرض
                    </button>
                </td>
                <td>
                    <button class="btn btn-outline-info btn-sm" 
                            onclick="showComments('${domainId}', '${indicator.code}')"
                            title="${data.comments || 'لا توجد ملاحظات'}">
                        <i class="fas fa-comment"></i>
                    </button>
                </td>
            `;
            
            return row;
        }

        // Update indicator data
        function updateIndicatorData(domainId, indicatorCode, field, value) {
            trackingData[domainId][indicatorCode][field] = value;
            
            // Auto-update status based on progress
            if (field === 'progress') {
                const progress = parseInt(value);
                trackingData[domainId][indicatorCode].status = progress >= 100 ? 'complete' : 'incomplete';
                populateTables();
            }
            
            updateProgress();
            saveData();
        }

        // Update progress indicators
        function updateProgress() {
            for (let domainId in indicatorsData) {
                const indicators = indicatorsData[domainId].indicators;
                let totalProgress = 0;
                
                indicators.forEach(indicator => {
                    const data = trackingData[domainId][indicator.code];
                    totalProgress += parseInt(data.progress || 0);
                });
                
                const averageProgress = Math.round(totalProgress / indicators.length);
                
                const progressBar = document.getElementById(`progress-${domainId}`);
                const progressText = document.getElementById(`progress-text-${domainId}`);
                
                if (progressBar && progressText) {
                    progressBar.style.width = `${averageProgress}%`;
                    progressText.textContent = `نسبة الإنجاز: ${averageProgress}%`;
                }
            }
        }

        // Show documents modal
        function showDocuments(domainId, indicatorCode) {
            const indicator = indicatorsData[domainId].indicators.find(ind => ind.code === indicatorCode);
            currentModalIndicator = {domainId, indicatorCode};
            
            document.getElementById('modalTitle').textContent = `الوثائق المطلوبة - المؤشر ${indicatorCode}`;
            
            const documentsContainer = document.getElementById('requiredDocuments');
            documentsContainer.innerHTML = '';
            
            indicator.documents.forEach(doc => {
                const docElement = document.createElement('div');
                docElement.className = 'document-item';
                docElement.innerHTML = `<i class="fas fa-file-alt me-2"></i>${doc}`;
                documentsContainer.appendChild(docElement);
            });
            
            // Load existing comments
            const comments = trackingData[domainId][indicatorCode].comments || '';
            document.getElementById('modalComments').value = comments;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('documentsModal'));
            modal.show();
        }

        // Show comments
        function showComments(domainId, indicatorCode) {
            showDocuments(domainId, indicatorCode);
        }

        // Save comments from modal
        function saveComments() {
            if (currentModalIndicator) {
                const comments = document.getElementById('modalComments').value;
                const {domainId, indicatorCode} = currentModalIndicator;
                
                trackingData[domainId][indicatorCode].comments = comments;
                saveData();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('documentsModal'));
                modal.hide();
                
                // Show success message
                showToast('تم حفظ الملاحظات بنجاح', 'success');
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-check-circle me-2"></i>
                    ${message}
                    <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }

        // Export to PDF with enhanced Arabic support and better formatting
        function exportToPDF(domainId) {
            const { jsPDF } = window.jspdf;
            
            try {
                // Create PDF with enhanced settings
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4',
                    compress: true
                });
                
                // Get school info
                const schoolName = document.getElementById('schoolName').value || 'متوسطة المنذر بن عمرو الأنصاري';
                const principalName = document.getElementById('principalName').value || 'خالد سعود المطيري';
                const reportDate = document.getElementById('reportDate').value || new Date().toISOString().split('T')[0];
                
                // Convert date to Arabic format
                const dateObj = new Date(reportDate);
                const arabicDate = `${dateObj.getDate().toString().padStart(2, '0')}/${(dateObj.getMonth() + 1).toString().padStart(2, '0')}/${dateObj.getFullYear()}`;
                
                let yPosition = 25;
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                
                // Enhanced header design
                doc.setFillColor(44, 85, 48);
                doc.rect(0, 0, pageWidth, 50, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text('المملكة العربية السعودية', pageWidth/2, yPosition, { align: 'center' });
                
                yPosition += 6;
                doc.setFontSize(16);
                doc.text('وزارة التعليم', pageWidth/2, yPosition, { align: 'center' });
                
                yPosition += 6;
                doc.setFontSize(12);
                doc.text('مكتب قطاع أحد والعوالي', pageWidth/2, yPosition, { align: 'center' });
                
                yPosition += 10;
                doc.setFontSize(18);
                doc.text('تقرير متابعة مؤشرات التقويم المدرسي', pageWidth/2, yPosition, { align: 'center' });
                
                // Reset colors and position
                doc.setTextColor(0, 0, 0);
                yPosition = 65;
                
                // School information with enhanced design
                doc.setFillColor(248, 249, 250);
                doc.setDrawColor(44, 85, 48);
                doc.setLineWidth(0.5);
                doc.roundedRect(15, yPosition, pageWidth - 30, 25, 3, 3, 'FD');
                
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(44, 85, 48);
                doc.text('معلومات المدرسة', 20, yPosition + 7);
                
                doc.setFont("helvetica", "normal");
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.text(`اسم المدرسة: ${schoolName}`, 20, yPosition + 14);
                doc.text(`مدير المدرسة: ${principalName}`, 20, yPosition + 20);
                doc.text(`تاريخ التقرير: ${arabicDate}`, pageWidth - 80, yPosition + 14);
                doc.text(`تاريخ الإنشاء: ${new Date().toLocaleDateString('ar-SA')}`, pageWidth - 80, yPosition + 20);
                
                yPosition += 35;
                
                // Domain title with enhanced styling
                const domainTitle = indicatorsData[domainId].title;
                doc.setFillColor(44, 85, 48);
                doc.roundedRect(15, yPosition, pageWidth - 30, 12, 2, 2, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text(domainTitle, pageWidth/2, yPosition + 8, { align: 'center' });
                
                yPosition += 20;
                
                // Enhanced table with better Arabic support
                const tableHeaders = ['النسبة %', 'الحالة', 'تاريخ المتابعة', 'المسؤول', 'وصف المؤشر', 'رقم المؤشر'];
                const tableData = [];
                
                indicatorsData[domainId].indicators.forEach((indicator, index) => {
                    const data = trackingData[domainId][indicator.code];
                    const statusText = data.status === 'complete' ? 'مكتمل ✓' : 'غير مكتمل ✗';
                    const progressText = `${data.progress}%`;
                    const followupDateText = data.followupDate ? new Date(data.followupDate).toLocaleDateString('ar-SA') : '-';
                    
                    // Wrap long text for better display
                    const wrappedTitle = indicator.title.length > 50 ? 
                        indicator.title.substring(0, 47) + '...' : indicator.title;
                    
                    tableData.push([
                        progressText,
                        statusText,
                        followupDateText,
                        data.responsible || '-',
                        wrappedTitle,
                        indicator.code
                    ]);
                });
                
                // Create enhanced table
                doc.autoTable({
                    head: [tableHeaders],
                    body: tableData,
                    startY: yPosition,
                    theme: 'grid',
                    styles: {
                        font: 'helvetica',
                        fontSize: 8,
                        cellPadding: 3,
                        textColor: [0, 0, 0],
                        lineColor: [200, 200, 200],
                        lineWidth: 0.1,
                        halign: 'center',
                        valign: 'middle'
                    },
                    headStyles: {
                        fillColor: [44, 85, 48],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold',
                        fontSize: 9,
                        halign: 'center'
                    },
                    bodyStyles: {
                        fillColor: [255, 255, 255],
                        alternateRowStyles: { fillColor: [248, 249, 250] }
                    },
                    columnStyles: {
                        0: { halign: 'center', cellWidth: 18 }, // النسبة
                        1: { halign: 'center', cellWidth: 22 }, // الحالة
                        2: { halign: 'center', cellWidth: 25 }, // التاريخ
                        3: { halign: 'center', cellWidth: 30 }, // المسؤول
                        4: { halign: 'right', cellWidth: 75 },  // الوصف
                        5: { halign: 'center', cellWidth: 20 }  // الرقم
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Add page border
                        doc.setDrawColor(44, 85, 48);
                        doc.setLineWidth(0.5);
                        doc.rect(10, 10, pageWidth - 20, pageHeight - 20);
                    }
                });
                
                // Calculate comprehensive statistics
                let totalProgress = 0;
                let completedCount = 0;
                let inProgressCount = 0;
                
                indicatorsData[domainId].indicators.forEach(indicator => {
                    const data = trackingData[domainId][indicator.code];
                    const progress = parseInt(data.progress || 0);
                    totalProgress += progress;
                    
                    if (data.status === 'complete') {
                        completedCount++;
                    } else if (progress > 0) {
                        inProgressCount++;
                    }
                });
                
                const averageProgress = Math.round(totalProgress / indicatorsData[domainId].indicators.length);
                const totalIndicators = indicatorsData[domainId].indicators.length;
                const pendingCount = totalIndicators - completedCount - inProgressCount;
                
                // Enhanced summary section
                const finalY = doc.lastAutoTable.finalY + 15;
                
                // Summary box with gradient effect
                doc.setFillColor(248, 249, 250);
                doc.setDrawColor(44, 85, 48);
                doc.setLineWidth(1);
                doc.roundedRect(15, finalY, pageWidth - 30, 35, 3, 3, 'FD');
                
                // Summary title
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(44, 85, 48);
                doc.text('ملخص إحصائي شامل', 20, finalY + 8);
                
                // Statistics in two columns
                doc.setFont("helvetica", "normal");
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                
                // Right column
                doc.text(`إجمالي المؤشرات: ${totalIndicators}`, 20, finalY + 16);
                doc.text(`المؤشرات المكتملة: ${completedCount}`, 20, finalY + 22);
                doc.text(`المؤشرات قيد التنفيذ: ${inProgressCount}`, 20, finalY + 28);
                
                // Left column
                doc.text(`النسبة الإجمالية: ${averageProgress}%`, pageWidth/2 + 10, finalY + 16);
                doc.text(`المؤشرات المتبقية: ${pendingCount}`, pageWidth/2 + 10, finalY + 22);
                
                // Progress bar visualization
                const barY = finalY + 30;
                const barWidth = 100;
                const barHeight = 4;
                const barX = (pageWidth - barWidth) / 2;
                
                // Background bar
                doc.setFillColor(220, 220, 220);
                doc.rect(barX, barY, barWidth, barHeight, 'F');
                
                // Progress bar
                doc.setFillColor(40, 167, 69);
                doc.rect(barX, barY, (barWidth * averageProgress) / 100, barHeight, 'F');
                
                doc.setFontSize(8);
                doc.text(`${averageProgress}%`, barX + barWidth/2, barY + 2.5, { align: 'center' });
                
                // Enhanced footer with professional styling
                const footerY = pageHeight - 25;
                doc.setFillColor(44, 85, 48);
                doc.rect(0, footerY, pageWidth, 25, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont("helvetica", "bold");
                doc.text('نُراقب • نُقيم • نُطور', pageWidth/2, footerY + 8, { align: 'center' });
                
                doc.setFontSize(8);
                doc.setFont("helvetica", "normal");
                doc.text('تم إنشاء هذا التقرير بواسطة نظام متابعة مؤشرات التقويم المدرسي', pageWidth/2, footerY + 14, { align: 'center' });
                doc.text('تنفيذ: نواف الصبحي', pageWidth/2, footerY + 19, { align: 'center' });
                
                // Add page numbers for multiple pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setTextColor(128, 128, 128);
                    doc.setFontSize(8);
                    doc.text(`صفحة ${i} من ${pageCount}`, pageWidth - 20, pageHeight - 10, { align: 'right' });
                }
                
                // Generate filename with timestamp
                const timestamp = new Date().getTime();
                const fileName = `تقرير_${domainTitle.replace(/\s+/g, '_')}_${arabicDate.replace(/\//g, '-')}_${timestamp}.pdf`;
                
                // Save PDF
                doc.save(fileName);
                
                showToast('تم تصدير التقرير بنجاح! جودة عالية ومحسن للطباعة', 'success');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                showToast('حدث خطأ في تصدير التقرير. يرجى المحاولة مرة أخرى.', 'danger');
            }
        }الد سعود المطيري';
            const reportDate = document.getElementById('reportDate').value || new Date().toISOString().split('T')[0];
            
            // Convert date to Arabic format
            const dateObj = new Date(reportDate);
            const arabicDate = `${dateObj.getDate()}/${dateObj.getMonth() + 1}/${dateObj.getFullYear()}`;
            
            let yPosition = 30;
            
            // Add header with logo area
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            
            // Header in center
            doc.text('المملكة العربية السعودية', 105, yPosition, { align: 'center' });
            yPosition += 7;
            doc.setFontSize(14);
            doc.text('وزارة التعليم', 105, yPosition, { align: 'center' });
            yPosition += 7;
            doc.setFontSize(11);
            doc.text('مكتب قطاع أحد والعوالي', 105, yPosition, { align: 'center' });
            yPosition += 15;
            
            // Report title
            doc.setFontSize(16);
            doc.setFont("helvetica", "bold");
            doc.text('تقرير متابعة مؤشرات التقويم المدرسي', 105, yPosition, { align: 'center' });
            yPosition += 15;
            
            // School information box
            doc.setDrawColor(50, 85, 48);
            doc.setLineWidth(0.5);
            doc.rect(20, yPosition - 5, 170, 25);
            
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text('اسم المدرسة: ' + schoolName, 25, yPosition + 3);
            doc.text('مدير المدرسة: ' + principalName, 25, yPosition + 10);
            doc.text('تاريخ التقرير: ' + arabicDate, 25, yPosition + 17);
            
            yPosition += 35;
            
            // Domain title
            const domainTitle = indicatorsData[domainId].title;
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(50, 85, 48);
            doc.text(domainTitle, 105, yPosition, { align: 'center' });
            yPosition += 15;
            
            // Prepare table data
            const tableHeaders = ['النسبة', 'الحالة', 'تاريخ المتابعة', 'المسؤول', 'وصف المؤشر', 'رقم المؤشر'];
            const tableData = [];
            
            indicatorsData[domainId].indicators.forEach(indicator => {
                const data = trackingData[domainId][indicator.code];
                const statusText = data.status === 'complete' ? '✅ مكتمل' : '❌ غير مكتمل';
                const progressText = data.progress + '%';
                
                tableData.push([
                    progressText,
                    statusText,
                    data.followupDate || '-',
                    data.responsible || '-',
                    indicator.title,
                    indicator.code
                ]);
            });
            
            // Create table with Arabic support
            doc.autoTable({
                head: [tableHeaders],
                body: tableData,
                startY: yPosition,
                styles: {
                    font: 'helvetica',
                    fontSize: 9,
                    cellPadding: 3,
                    textColor: [0, 0, 0],
                    lineColor: [128, 128, 128],
                    lineWidth: 0.1
                },
                headStyles: {
                    fillColor: [50, 85, 48],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    halign: 'center'
                },
                bodyStyles: {
                    fillColor: [245, 245, 245],
                    halign: 'center'
                },
                alternateRowStyles: {
                    fillColor: [255, 255, 255]
                },
                columnStyles: {
                    0: { halign: 'center', cellWidth: 20 }, // النسبة
                    1: { halign: 'center', cellWidth: 25 }, // الحالة
                    2: { halign: 'center', cellWidth: 25 }, // التاريخ
                    3: { halign: 'center', cellWidth: 30 }, // المسؤول
                    4: { halign: 'right', cellWidth: 70 },  // الوصف
                    5: { halign: 'center', cellWidth: 20 }  // الرقم
                },
                margin: { left: 10, right: 10 }
            });
            
            // Calculate overall progress
            let totalProgress = 0;
            let completedCount = 0;
            indicatorsData[domainId].indicators.forEach(indicator => {
                const data = trackingData[domainId][indicator.code];
                totalProgress += parseInt(data.progress || 0);
                if (data.status === 'complete') completedCount++;
            });
            const averageProgress = Math.round(totalProgress / indicatorsData[domainId].indicators.length);
            const totalIndicators = indicatorsData[domainId].indicators.length;
            
            // Add summary section
            const finalY = doc.lastAutoTable.finalY + 15;
            
            // Summary box
            doc.setDrawColor(50, 85, 48);
            doc.setFillColor(248, 249, 250);
            doc.rect(20, finalY, 170, 25, 'FD');
            
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(50, 85, 48);
            doc.text('ملخص الإنجاز', 25, finalY + 7);
            
            doc.setFont("helvetica", "normal");
            doc.setTextColor(0, 0, 0);
            doc.text(`إجمالي المؤشرات: ${totalIndicators}`, 25, finalY + 14);
            doc.text(`المؤشرات المكتملة: ${completedCount}`, 25, finalY + 21);
            doc.text(`النسبة الإجمالية: ${averageProgress}%`, 120, finalY + 14);
            doc.text(`المؤشرات المتبقية: ${totalIndicators - completedCount}`, 120, finalY + 21);
            
            // Add footer
            const pageHeight = doc.internal.pageSize.height;
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text('تم إنشاء هذا التقرير بواسطة نظام متابعة مؤشرات التقويم المدرسي', 105, pageHeight - 20, { align: 'center' });
            doc.text('نُراقب • نُقيم • نُطور', 105, pageHeight - 15, { align: 'center' });
            doc.text('تنفيذ: نواف الصبحي', 105, pageHeight - 10, { align: 'center' });
            doc.text(`تاريخ الطباعة: ${new Date().toLocaleDateString('ar-SA')}`, 105, pageHeight - 5, { align: 'center' });
            
            // Add page numbers if multiple pages
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text(`صفحة ${i} من ${pageCount}`, 190, pageHeight - 2, { align: 'right' });
            }
            
            // Save PDF with Arabic filename
            const fileName = `تقرير_${domainTitle.replace(/\s+/g, '_')}_${arabicDate.replace(/\//g, '-')}.pdf`;
            doc.save(fileName);
            
            showToast('تم تصدير التقرير بنجاح بصيغة PDF', 'success');
        }

        // Auto-save when school info changes
        document.getElementById('schoolName').addEventListener('change', saveData);
        document.getElementById('principalName').addEventListener('change', saveData);
        document.getElementById('reportDate').addEventListener('change', saveData);

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // Add mobile-specific touch enhancements
        if ('ontouchstart' in window) {
            // Add touch-friendly hover effects for mobile
            document.addEventListener('touchstart', function() {}, true);
            
            // Improve table scrolling on mobile
            const tables = document.querySelectorAll('.table-container');
            tables.forEach(table => {
                table.style.webkitOverflowScrolling = 'touch';
            });
        }

        // Handle orientation change for mobile devices
        window.addEventListener('orientationchange', function() {
            setTimeout(function() {
                updateProgress();
            }, 100);
        });

        // Add keyboard shortcuts for desktop
        document.addEventListener('keydown', function(e) {
            // Ctrl+P for printing/PDF export
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                showToast('اختر المجال المطلوب وانقر على "تصدير تقرير PDF"', 'info');
            }
        });

        // Enhance modal for mobile
        document.getElementById('documentsModal').addEventListener('shown.bs.modal', function() {
            // Ensure modal is properly positioned on mobile
            if (window.innerWidth <= 768) {
                this.style.paddingRight = '0';
            }
        });

        // Add swipe gesture for mobile navigation (basic implementation)
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 100;
            const swipeDistance = touchEndX - touchStartX;
            
            if (Math.abs(swipeDistance) > swipeThreshold) {
                // Add subtle feedback for swipe gestures
                if (swipeDistance > 0) {
                    // Right swipe - could add navigation features
                } else {
                    // Left swipe - could add navigation features
                }
            }
        }

        // Performance optimization for mobile
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Debounced progress update for better mobile performance
        const debouncedUpdateProgress = debounce(updateProgress, 300);

        // Enhanced error handling for PDF generation
        window.addEventListener('error', function(e) {
            if (e.message.includes('jsPDF') || e.message.includes('PDF')) {
                showToast('تعذر تحميل مكتبة PDF. يرجى التحقق من الاتصال بالإنترنت.', 'warning');
            }
        });

        // Add print styles detection
        window.matchMedia('print').addListener(function(mql) {
            if (mql.matches) {
                // Hide unnecessary elements when printing
                document.querySelectorAll('.btn-export').forEach(btn => {
                    btn.style.display = 'none';
                });
            } else {
                // Restore elements after printing
                document.querySelectorAll('.btn-export').forEach(btn => {
                    btn.style.display = 'inline-block';
                });
            }
        });
    </script>
</body>
</html>
