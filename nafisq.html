<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ù†ØµØ© Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ³ | Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</title>

  <!-- ======  Ø§Ù„Ø£Ù†Ù…Ø§Ø·  ====== -->
  <style>
    /* ---------- RESET & BASE ---------- */
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;color:#333;-webkit-user-select:none;-moz-user-select:none;
      -ms-user-select:none;user-select:none;
    }

    /* ---------- HEADER ---------- */
    .header{
      background:linear-gradient(45deg,#1e3c72,#2a5298);
      color:white;padding:20px;text-align:center;position:relative;
      box-shadow:0 4px 20px rgba(0,0,0,.3);
    }
    .connection-indicator,.sync-indicator{
      position:absolute;top:15px;display:flex;align-items:center;gap:8px;
      font-size:14px;padding:5px 12px;border-radius:20px;background:rgba(255,255,255,.1);
    }
    .connection-indicator.online{background:rgba(39,174,96,.2);color:#2ecc71}
    .connection-indicator.offline{background:rgba(231,76,60,.2);color:#e74c3c}
    .sync-indicator.updated{background:rgba(39,174,96,.2);color:#2ecc71}
    .connection-dot{width:8px;height:8px;border-radius:50%;background:currentColor;animation:pulse 2s infinite}

    /* ---------- LOGO ---------- */
    .logo{display:flex;align-items:center;justify-content:center;gap:15px;margin-bottom:10px}
    .logo-icon{width:60px;height:60px;background:#4CAF50;border-radius:50%;display:flex;
               align-items:center;justify-content:center;font-size:24px;font-weight:bold}

    /* ---------- CONTAINER & CARDS ---------- */
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:white;border-radius:15px;padding:25px;margin-bottom:20px;
         box-shadow:0 8px 32px rgba(0,0,0,.1);transition:transform .3s ease}
    .card:hover{transform:translateY(-2px)}
    .section-title{font-size:22px;font-weight:bold;margin-bottom:20px;color:#2c3e50;
                  text-align:center;padding-bottom:10px;border-bottom:3px solid #3498db}

    /* ---------- FORMS ---------- */
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
    .form-group{display:flex;flex-direction:column}
    .form-group label{margin-bottom:5px;font-weight:bold;color:#555}
    .form-group input,.form-group select{padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px;transition:border-color .3s ease}
    .form-group input:focus,.form-group select:focus{outline:none;border-color:#3498db}

    /* ---------- BUTTONS ---------- */
    .btn{background:linear-gradient(45deg,#3498db,#2980b9);color:white;border:none;
        padding:15px 30px;border-radius:25px;font-size:16px;cursor:pointer;transition:all .3s ease;
        text-align:center;display:block;margin:10px auto}
    .btn:hover{background:linear-gradient(45deg,#2980b9,#1f5f99);transform:translateY(-2px)}
    .btn-secondary{background:linear-gradient(45deg,#95a5a6,#7f8c8d)}

    /* ---------- TEST CARDS ---------- */
    .test-sections{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:20px}
    .test-card{background:linear-gradient(135deg,#74b9ff,#0984e3);color:white;border-radius:15px;
              padding:25px;text-align:center;cursor:pointer;transition:all .3s ease}
    .test-card:hover{transform:scale(1.05)}
    .test-card.weekly{background:linear-gradient(135deg,#fd79a8,#e84393)}

    /* ---------- QUESTION AREA ---------- */
    .question-container{display:none;text-align:center}
    .question{font-size:18px;margin-bottom:25px;padding:20px;background:#f8f9fa;border-radius:10px}
    .question-image{max-width:100%;height:auto;border-radius:10px;margin:15px 0}
    .options{display:grid;gap:15px;margin-bottom:25px}
    .option{padding:15px;background:#e8f4fd;border:2px solid #ddd;border-radius:10px;cursor:pointer;transition:all .3s ease;text-align:right}
    .option:hover{background:#d1ecf1;border-color:#3498db}
    .option.selected{background:#3498db;color:white;border-color:#2980b9}
    .option.correct{background:#27ae60;color:white;border-color:#229954}
    .option.wrong{background:#e74c3c;color:white;border-color:#c0392b}

    /* ---------- PROGRESS & NAVIGATION ---------- */
    .progress{width:100%;height:20px;background:#ecf0f1;border-radius:10px;margin-bottom:20px;overflow:hidden}
    .progress-bar{height:100%;background:linear-gradient(90deg,#27ae60,#2ecc71);width:0%;transition:width .5s ease}
    .nav-buttons{display:flex;justify-content:space-between;margin:20px 0}
    .nav-btn{background:#95a5a6;color:white;border:none;padding:10px 20px;border-radius:15px;cursor:pointer}
    .nav-btn:disabled{opacity:.5;cursor:not-allowed}

    /* ---------- NOTIFICATIONS ---------- */
    .notification{position:fixed;top:20px;right:20px;background:linear-gradient(45deg,#27ae60,#2ecc71);
                 color:white;padding:15px 25px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.2);
                 z-index:10000;font-weight:bold;max-width:300px;animation:slideIn .3s ease}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}

    /* ---------- FOOTER & RESPONSIVE ---------- */
    .footer{text-align:center;padding:30px 20px;background:rgba(255,255,255,.1);color:white;margin-top:40px;border-radius:15px}
    @media (max-width:768px){.form-grid{grid-template-columns:1fr}.test-sections{grid-template-columns:1fr}.nav-buttons{flex-direction:column;gap:10px}}
  </style>
</head>
<body>
  <!-- ========== HEADER ========== -->
  <header class="header">
    <div class="connection-indicator offline" id="connectionStatus">
      <div class="connection-dot"></div><span>ØºÙŠØ± Ù…ØªØµÙ„</span>
    </div>
    <div class="sync-indicator" id="syncStatus">
      <div class="connection-dot"></div><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>

    <div class="logo">
      <div class="logo-icon">Ù†Ø§ÙØ³</div>
      <div class="school-info">
        <h1>Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</h1>
        <p>Ù…ÙƒØªØ¨ Ù‚Ø·Ø§Ø¹ Ø£Ø­Ø¯ ÙˆØ§Ù„Ø¹ÙˆØ§Ù„ÙŠ</p>
        <p>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ</p>
      </div>
    </div>
  </header>

  <!-- ========== MAIN CONTAINER ========== -->
  <div class="container">
    <!-- ---- Registration Card ---- -->
    <section class="card" id="studentForm">
      <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø®Ø§Øµ</h2>
      <div class="form-grid">
        <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label><input type="text" id="firstName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„"></div>
        <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ø£Ø¨</label><input type="text" id="fatherName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø¨"></div>
        <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯</label><input type="text" id="grandFatherName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯"></div>
        <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</label><input type="text" id="familyName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©"></div>
        <div class="form-group"><label>Ø§Ù„ØµÙ</label>
          <select id="grade">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
            <option value="Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·">Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option>
            <option value="Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·">Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option>
            <option value="Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·">Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option>
          </select>
        </div>
        <div class="form-group"><label>Ø§Ù„Ø´Ø¹Ø¨Ø©</label>
          <select id="section">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
            <option value="1">1</option><option value="2">2</option><option value="3">3</option>
            <option value="4">4</option><option value="5">5</option><option value="6">6</option>
          </select>
        </div>
      </div>
      <button class="btn" onclick="registerStudent()">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø®Ø§Øµ</button>
      <button class="btn btn-secondary" onclick="showLoginForm()">Ù„Ø¯ÙŠ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹</button>
    </section>

    <!-- ---- Code Display ---- -->
    <section class="card" id="studentCodeDisplay" style="display:none;">
      <h2 class="section-title">ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø¬Ø§Ø­</h2>
      <div style="text-align:center;padding:30px;">
        <div style="background:linear-gradient(135deg,#27ae60,#2ecc71);color:white;padding:25px;border-radius:15px;margin-bottom:20px;">
          <h3>Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ Ù‡Ùˆ:</h3>
          <div id="generatedCode" style="font-size:32px;font-weight:bold;letter-spacing:3px;background:rgba(255,255,255,.2);padding:15px;border-radius:10px;"></div>
        </div>
        <div style="background:#fff3cd;color:#856404;padding:20px;border-radius:10px;margin-bottom:20px;text-align:right;">
          <h4>âš ï¸ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ù‡Ù…Ø©:</h4>
          <ul style="text-align:right;margin-right:20px;">
            <li>Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†</li>
            <li>Ø³ØªØ­ØªØ§Ø¬Ù‡ Ù„Ø¯Ø®ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</li>
            <li>Ù„Ø§ ØªØ´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</li>
            <li>ÙÙŠ Ø­Ø§Ù„Ø© Ù†Ø³ÙŠØ§Ù†Ù‡ØŒ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…</li>
            <li>ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
          </ul>
        </div>
        <button class="btn" onclick="proceedToLogin()">Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
      </div>
    </section>

    <!-- ---- Login Form ---- -->
    <section class="card" id="loginForm" style="display:none;">
      <h2 class="section-title">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
      <div class="form-grid" style="grid-template-columns:1fr;">
        <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" id="loginFullName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ Ø³Ø¬Ù„ØªÙ‡ Ø³Ø§Ø¨Ù‚Ø§Ù‹"></div>
        <div class="form-group"><label>Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ</label><input type="text" id="studentCode" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ (6 Ø£Ø±Ù‚Ø§Ù…)" maxlength="6" style="text-align:center;font-size:18px;letter-spacing:2px;"></div>
        <div class="form-group"><label style="display:flex;align-items:center;gap:10px;"><input type="checkbox" id="developerMode" style="width:auto;"> Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¹Ù„Ù… (Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)</label></div>
      </div>
      <button class="btn" onclick="loginStudent()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
      <button class="btn btn-secondary" onclick="backToRegistration()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„</button>
    </section>

    <!-- ---- Test Selection ---- -->
    <section class="card" id="testSelection" style="display:none;">
      <h2 class="section-title">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
      <div style="background:#fff3cd;color:#856404;padding:15px;border-radius:10px;margin-bottom:20px;text-align:center;border-right:4px solid #f39c12;">
        <h4>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</h4>
        <p><strong>ÙŠÙØ³Ù…Ø­ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ÙƒÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·!</strong></p>
        <p>ÙÙƒØ± Ø¬ÙŠØ¯Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
      </div>
      <div class="test-sections">
        <div class="test-card" onclick="confirmAndStartTest('daily')">
          <h3>ğŸŒŸ Ø³Ø¤Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…</h3>
          <p id="dailyQuestionCount">ØªØ­Ù…ÙŠÙ„...</p>
          <p><strong>Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© - Ø§Ù„Ø¹Ù„ÙˆÙ…</strong></p>
          <div style="background:rgba(255,255,255,.2);padding:10px;border-radius:8px;margin-top:15px;"><small>â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: 15-20 Ø¯Ù‚ÙŠÙ‚Ø©</small></div>
        </div>
        <div class="test-card weekly" onclick="confirmAndStartTest('weekly')">
          <h3>ğŸ† Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
          <p id="weeklyQuestionCount">ØªØ­Ù…ÙŠÙ„...</p>
          <p><strong>Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†Ø§ÙØ³ÙŠ Ø£Ø³Ø¨ÙˆØ¹ÙŠ</strong></p>
          <div style="background:rgba(255,255,255,.2);padding:10px;border-radius:8px;margin-top:15px;"><small>â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: 60-90 Ø¯Ù‚ÙŠÙ‚Ø©</small></div>
        </div>
      </div>
      <div style="background:#e8f5e8;color:#27ae60;padding:15px;border-radius:10px;margin-top:20px;text-align:center;border-right:4px solid #27ae60;">
        <p><strong>ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù†Ø¬Ø§Ø­:</strong></p>
        <ul style="text-align:right;margin:10px 20px;">
          <li>Ø§Ù‚Ø±Ø£ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ù†Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</li>
          <li>Ù„Ø§ ØªØªØ³Ø±Ø¹ ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</li>
          <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</li>
          <li>Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ù‡Ø§Ø¯Ø¦ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
        </ul>
      </div>
    </section>

    <!-- ---- Question Area ---- -->
    <section class="card question-container" id="questionArea" style="display:none;">
      <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
      <div class="nav-buttons">
        <button class="nav-btn" id="prevBtn" onclick="previousQuestion()" disabled>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <span id="questionNumber">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 7</span>
        <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
      <div class="question" id="questionText"><p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ³!</p></div>
      <div class="options" id="optionsContainer"></div>
      <div class="score-display" id="scoreDisplay" style="display:none;">
        <p>Ø¯Ø±Ø¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="finalScore">0</span> Ù…Ù† <span id="totalQuestions">7</span></p>
        <p>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©: <span id="percentage">0%</span></p>
      </div>
      <button class="btn" id="submitBtn" onclick="submitAnswer()" style="display:none;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
      <button class="btn" id="finishBtn" onclick="handleFinishTest()" style="display:none;">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
      <button class="btn" id="homeBtn" onclick="goHome()" style="display:none;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </section>

    <!-- ---- Leaderboard ---- -->
    <section class="card" id="leaderboardCard" style="display:none;">
      <h2 class="section-title">ğŸ… Ù…Ø±ØªØ¨Ø© Ø§Ù„Ø´Ø±Ù</h2>
      <div id="leaderboard"></div>
    </section>
  </div>

  <!-- ========== FOOTER ========== -->
  <footer class="footer">
    <p><strong>Ø¥Ø´Ø±Ø§Ù ÙˆØªÙ†ÙÙŠØ°: Ø§Ù„Ø£Ø³ØªØ§Ø° Ù†ÙˆØ§Ù Ø§Ù„ØµØ¨Ø­ÙŠ</strong></p>
    <p>Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ - Ù…ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹ÙˆØ§Ù„ÙŠ</p>
    <p style="margin-top:10px;font-size:12px;opacity:.8;">
      ğŸ”’ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù…ÙŠØ© ÙˆÙ…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© | âš¡ Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„
    </p>
  </footer>

  <!-- ========== FIREBASE & SYNC ========== -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCaobeGSq0ra52WWNHIUgVZyoTg_NME5DY",
      authDomain: "nafis-exam.firebaseapp.com",
      projectId: "nafis-exam",
      storageBucket: "nafis-exam.firebasestorage.app",
      messagingSenderId: "985354903005",
      appId: "1:985354903005:web:d0d028d80d47bd30392a34",
      measurementId: "G-MME7J94SRN"
    };

    /* -------------- Sync Manager -------------- */
    class SyncManager {
      constructor() {
        this.lastUpdate = localStorage.getItem('nafisLastUpdate') || '0';
        this.notificationCooldown = 5000;
        this.lastNotification = 0;
        this.isInitialized = false;
        this.init();
      }

      init() {
        this.loadQuestions();
        this.setupStorageListener();
        this.setupBroadcastListener();
        this.setupMessageListener();
        this.setupPeriodicCheck();
        this.updateUI();
        this.isInitialized = true;
        console.log('Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø¬Ø§Ù‡Ø²');
      }

      loadQuestions() {
        const adminDaily = localStorage.getItem('adminDailyQuestions');
        const adminWeekly = localStorage.getItem('adminWeeklyQuestions');
        const mainDaily = localStorage.getItem('nafisMainDailyQuestions');
        const mainWeekly = localStorage.getItem('nafisMainWeeklyQuestions');

        if (adminDaily) {
          try { window.dailyQuestions = JSON.parse(adminDaily); localStorage.setItem('nafisMainDailyQuestions', adminDaily); } catch {}
        } else if (mainDaily) {
          try { window.dailyQuestions = JSON.parse(mainDaily); } catch {}
        }
        if (adminWeekly) {
          try { window.weeklyQuestions = JSON.parse(adminWeekly); localStorage.setItem('nafisMainWeeklyQuestions', adminWeekly); } catch {}
        } else if (mainWeekly) {
          try { window.weeklyQuestions = JSON.parse(mainWeekly); } catch {}
        }

        if (!window.dailyQuestions) window.dailyQuestions = [];
        if (!window.weeklyQuestions) window.weeklyQuestions = [];
      }

      setupStorageListener() {
        window.addEventListener('storage', e => {
          if (e.key && (e.key.includes('nafisMain') || e.key.includes('admin') || e.key.includes('nafisLast'))) {
            this.handleUpdate('storage_event');
          }
        });
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¯ÙˆØ±ÙŠØ©
        let lastAdminDaily = localStorage.getItem('adminDailyQuestions');
        let lastAdminWeekly = localStorage.getItem('adminWeeklyQuestions');
        let lastUpdate = localStorage.getItem('nafisLastUpdate') || '0';
        setInterval(() => {
          const currAdminDaily = localStorage.getItem('adminDailyQuestions');
          const currAdminWeekly = localStorage.getItem('adminWeeklyQuestions');
          const currUpdate = localStorage.getItem('nafisLastUpdate') || '0';
          if (currAdminDaily !== lastAdminDaily || currAdminWeekly !== lastAdminWeekly || currUpdate !== lastUpdate) {
            lastAdminDaily = currAdminDaily; lastAdminWeekly = currAdminWeekly; lastUpdate = currUpdate;
            this.handleUpdate('direct_monitoring');
          }
        }, 2000);
      }

      setupBroadcastListener() {
        if (typeof BroadcastChannel === 'undefined') return;
        const ch1 = new BroadcastChannel('nafis-teacher-updates');
        const ch2 = new BroadcastChannel('nafis-updates');
        ch1.onmessage = e => { if (e.data.type === 'QUESTIONS_UPDATED') this.handleUpdate('broadcast_channel'); };
        ch2.onmessage = e => { if (e.data.type === 'QUESTIONS_UPDATED') this.handleUpdate('update_channel'); };
      }

      setupMessageListener() {
        window.addEventListener('message', e => {
          if (e.data && ['NAFIS_UPDATE_DAILY','NAFIS_UPDATE_WEEKLY','NAFIS_FORCE_REFRESH','QUESTIONS_UPDATED'].includes(e.data.type)) {
            this.handleUpdate('window_message');
          }
        });
      }

      setupPeriodicCheck() {
        setInterval(() => { if (this.isInitialized) this.reloadQuestions(); }, 10000);
      }

      reloadQuestions() {
        const oldDailyCount = window.dailyQuestions.length;
        const oldWeeklyCount = window.weeklyQuestions.length;
        this.loadQuestions();
        const newDailyCount = window.dailyQuestions.length;
        const newWeeklyCount = window.weeklyQuestions.length;
        this.updateUI();
        if (newDailyCount !== oldDailyCount || newWeeklyCount !== oldWeeklyCount) {
          if (Date.now() - this.lastNotification > this.notificationCooldown) {
            this.showNotification(newDailyCount, newWeeklyCount);
            this.lastNotification = Date.now();
          }
        }
      }

      handleUpdate(source) {
        if (!this.isInitialized) return;
        this.reloadQuestions();
        console.log(`ØªØ­Ø¯ÙŠØ« Ù…Ù† ${source}: ÙŠÙˆÙ…ÙŠ ${window.dailyQuestions.length}, Ø£Ø³Ø¨ÙˆØ¹ÙŠ ${window.weeklyQuestions.length}`);
      }

      updateUI() {
        const dailyCount = window.dailyQuestions.length;
        const weeklyCount = window.weeklyQuestions.length;
        const dailyEl = document.getElementById('dailyQuestionCount');
        const weeklyEl = document.getElementById('weeklyQuestionCount');
        const syncEl = document.getElementById('syncStatus');
        if (dailyEl) dailyEl.textContent = dailyCount ? `${dailyCount} Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø«Ù„Ø§Ø«` : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙŠÙˆÙ…ÙŠØ© Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹';
        if (weeklyEl) weeklyEl.textContent = weeklyCount ? `${weeklyCount} Ø³Ø¤Ø§Ù„ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯` : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹';
        if (syncEl) { syncEl.className = 'sync-indicator updated'; syncEl.innerHTML = '<div class="connection-dot"></div><span>Ù…Ø­Ø¯Ø«</span>'; }
      }

      showNotification(dailyCount, weeklyCount) {
        document.querySelectorAll('.notification').forEach(n => n.remove());
        const n = document.createElement('div');
        n.className = 'notification';
        n.innerHTML = `<div style="display:flex;align-items:center;gap:10px;"><span style="font-size:20px;">âœ…</span><div><strong>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¦Ù„Ø©!</strong><br><small>ÙŠÙˆÙ…ÙŠ: ${dailyCount} | Ø£Ø³Ø¨ÙˆØ¹ÙŠ: ${weeklyCount}</small></div></div>`;
        document.body.appendChild(n);
        setTimeout(() => { n.style.animation = 'slideOut .3s ease'; setTimeout(() => n.remove(), 300); }, 4000);
      }
    }

    /* -------------- Firebase Live Listener (Fixed Spread Operator) -------------- */
    try {
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      let fbTimeout = null;
      onSnapshot(collection(db, 'questions'), snap => {
        if (fbTimeout) clearTimeout(fbTimeout);
        fbTimeout = setTimeout(() => {
          const questions = [];
          snap.forEach(doc => questions.push({ id: doc.id, ...doc.data() })); // âœ… Fixed Spread
          const daily = questions.filter(q => q.type === 'daily');
          const weekly = questions.filter(q => q.type === 'weekly');
          if (daily.length) localStorage.setItem('nafisMainDailyQuestions', JSON.stringify(daily));
          if (weekly.length) localStorage.setItem('nafisMainWeeklyQuestions', JSON.stringify(weekly));
          localStorage.setItem('nafisLastUpdate', Date.now().toString());
          if (window.syncManager && window.syncManager.isInitialized) window.syncManager.handleUpdate('firebase');
        }, 1000);
      });
      window.updateConnectionStatus(true);
    } catch (err) {
      console.error('Firebase Error:', err);
      window.updateConnectionStatus(false);
    }

    /* -------------- Global Variables & Core Functions -------------- */
    let currentStudent = {}, currentTest = {}, currentQuestionIndex = 0, userAnswers = [], score = 0, testType = '', questionStartTime = 0, questionTimes = [], studentDatabase = JSON.parse(localStorage.getItem('nafisStudentDB') || '{}');

    /* -------------- Essential UI Functions -------------- */
    function updateConnectionStatus(isOnline) {
      const indicator = document.getElementById('connectionStatus');
      indicator.className = 'connection-indicator ' + (isOnline ? 'online' : 'offline');
      indicator.innerHTML = '<div class="connection-dot"></div><span>' + (isOnline ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„') + '</span>';
    }
    function showLoginForm() {
      document.getElementById('studentForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }
    function backToRegistration() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('studentForm').style.display = 'block';
      ['firstName','fatherName','grandFatherName','familyName','grade','section','loginFullName','studentCode'].forEach(id => document.getElementById(id).value = '');
    }
    function registerStudent() {
      const firstName = document.getElementById('firstName').value.trim();
      const fatherName = document.getElementById('fatherName').value.trim();
      const grandFatherName = document.getElementById('grandFatherName').value.trim();
      const familyName = document.getElementById('familyName').value.trim();
      const grade = document.getElementById('grade').value;
      const section = document.getElementById('section').value;
      if (!firstName || !fatherName || !grandFatherName || !familyName || !grade || !section) return alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
      const fullName = `${firstName} ${fatherName} ${grandFatherName} ${familyName}`;
      const studentKey = `${fullName}_${grade}_${section}`;
      if (studentDatabase[studentKey]) return alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹! Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ Ù‡Ùˆ: ' + studentDatabase[studentKey].code);
      const studentCode = (Math.floor(Math.random() * 900000) + 100000).toString();
      const studentData = { fullName, firstName, fatherName, grandFatherName, familyName, grade, section, code: studentCode, registrationDate: new Date().toISOString() };
      studentDatabase[studentKey] = studentData;
      localStorage.setItem('nafisStudentDB', JSON.stringify(studentDatabase));
      document.getElementById('generatedCode').textContent = studentCode;
      document.getElementById('studentForm').style.display = 'none';
      document.getElementById('studentCodeDisplay').style.display = 'block';
    }
    function proceedToLogin() {
      document.getElementById('studentCodeDisplay').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }
    function loginStudent() {
      const fullName = document.getElementById('loginFullName').value.trim();
      const code = document.getElementById('studentCode').value.trim();
      const isDeveloperMode = document.getElementById('developerMode').checked;
      if (!fullName || !code) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø®Ø§Øµ');
      if (code.length !== 6 || !/^\d{6}$/.test(code)) return alert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø®Ø§Øµ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·');
      if (isDeveloperMode) {
        const developerPassword = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø·ÙˆØ±:');
        if (developerPassword !== 'nafis2024dev') return alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø·ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
        currentStudent = { fullName: fullName + ' (Ù…Ø·ÙˆØ±)', grade: 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·', section: '1', code: code, isDeveloper: true };
      } else {
        const student = Object.values(studentDatabase).find(s => s.fullName.toLowerCase() === fullName.toLowerCase() && s.code === code);
        if (!student) return alert('Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø®Ø§Øµ ØºÙŠØ± ØµØ­ÙŠØ­!');
        const existingResults = JSON.parse(localStorage.getItem('nafisResults') || '[]');
        const hasCompletedDaily = existingResults.some(r => r.studentName === student.fullName && r.testType === 'daily');
        const hasCompletedWeekly = existingResults.some(r => r.studentName === student.fullName && r.testType === 'weekly');
        if (hasCompletedDaily && hasCompletedWeekly) return alert('Ù„Ù‚Ø¯ Ø£Ø¬Ø±ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
        currentStudent = student;
      }
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('testSelection').style.display = 'block';
    }
    function confirmAndStartTest(type) {
      const testName = type === 'daily' ? 'Ø³Ø¤Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…' : 'Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹';
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± "${testName}"ØŸ\n\nØªØ°ÙƒØ±: ÙŠÙØ³Ù…Ø­ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ÙƒÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·!`)) startTest(type);
    }
    function startTest(type) {
      if (!currentStudent.isDeveloper) {
        const existingResults = JSON.parse(localStorage.getItem('nafisResults') || '[]');
        if (existingResults.some(r => r.studentName === currentStudent.fullName && r.testType === type)) return alert('Ù„Ù‚Ø¯ Ø£Ø¬Ø±ÙŠØª Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
      }
      testType = type;
      currentQuestionIndex = 0; userAnswers = []; score = 0; questionTimes = [];
      currentTest = { questions: type === 'daily' ? window.dailyQuestions : window.weeklyQuestions, title: type === 'daily' ? 'Ø³Ø¤Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…' : 'Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹' };
      if (!currentTest.questions || currentTest.questions.length === 0) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù….');
      document.getElementById('testSelection').style.display = 'none';
      document.getElementById('questionArea').style.display = 'block';
      showQuestion();
    }
    function showQuestion() {
      const q = currentTest.questions[currentQuestionIndex];
      const total = currentTest.questions.length;
      questionStartTime = Date.now();
      document.getElementById('questionNumber').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestionIndex + 1} Ù…Ù† ${total} - ${q.subject}`;
      let html = `<p><strong>${q.subject}:</strong> ${q.question}</p>`;
      if (q.image) html += `<img src="${q.image}" class="question-image" alt="ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„">`;
      document.getElementById('questionText').innerHTML = html;
      document.getElementById('optionsContainer').innerHTML = q.options.map((opt, i) =>
        `<div class="option" onclick="selectOption(${i})">${opt}</div>`).join('');
      document.getElementById('progressBar').style.width = `${((currentQuestionIndex + 1) / total) * 100}%`;
      document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
      document.getElementById('nextBtn').style.display = 'none';
      document.getElementById('finishBtn').style.display = currentQuestionIndex === total - 1 ? 'inline-block' : 'none';
      document.getElementById('submitBtn').style.display = 'none';
    }
    function selectOption(i) {
      document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
      document.querySelectorAll('.option')[i].classList.add('selected');
      userAnswers[currentQuestionIndex] = i;
      document.getElementById('submitBtn').style.display = 'block';
    }
    function submitAnswer() {
      const q = currentTest.questions[currentQuestionIndex];
      const userAnswer = userAnswers[currentQuestionIndex];
      const timeSpent = Math.round((Date.now() - questionStartTime) / 1000);
      questionTimes[currentQuestionIndex] = timeSpent;
      document.querySelectorAll('.option').forEach((opt, idx) => {
        opt.classList.remove('selected');
        if (idx === q.correct) opt.classList.add('correct');
        else if (idx === userAnswer && idx !== q.correct) opt.classList.add('wrong');
        opt.style.pointerEvents = 'none';
      });
      if (userAnswer === q.correct) score++;
      document.getElementById('questionText').insertAdjacentHTML('beforeend',
        `<div style="margin-top:15px;padding:15px;background:#e8f5e8;border-radius:8px;">
           <strong>Ø§Ù„ØªÙØ³ÙŠØ±:</strong> ${q.explanation}<br><small style="color:#666;">Ø§Ù„ÙˆÙ‚Øª: ${timeSpent} Ø«Ø§Ù†ÙŠØ©</small>
         </div>`);
      document.getElementById('submitBtn').style.display = 'none';
      if (currentQuestionIndex < currentTest.questions.length - 1) document.getElementById('nextBtn').style.display = 'inline-block';
    }
    function nextQuestion() { if (currentQuestionIndex < currentTest.questions.length - 1) { currentQuestionIndex++; showQuestion(); } }
    function previousQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; showQuestion(); } }
    function handleFinishTest() { if (userAnswers[currentQuestionIndex] !== undefined) { submitAnswer(); setTimeout(() => finishTest(), 1500); } else alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹'); }
    function finishTest() {
      const total = currentTest.questions.length;
      const percentage = Math.round((score / total) * 100);
      const totalTime = questionTimes.reduce((a, b) => a + (b || 0), 0);
      document.getElementById('finalScore').textContent = score;
      document.getElementById('totalQuestions').textContent = total;
      document.getElementById('percentage').textContent = percentage + '%';
      document.getElementById('scoreDisplay').style.display = 'block';
      saveResult();
      ['optionsContainer','questionText','.nav-buttons','submitBtn','finishBtn'].forEach(sel => { const el = document.querySelector(sel); if (el) el.style.display = 'none'; });
      document.getElementById('homeBtn').style.display = 'block';
      showLeaderboard();
    }
    function saveResult() {
      const results = JSON.parse(localStorage.getItem('nafisResults') || '[]');
      const result = {
        studentName: currentStudent.fullName, grade: currentStudent.grade, section: currentStudent.section,
        testType, score, totalQuestions: currentTest.questions.length,
        percentage: Math.round((score / currentTest.questions.length) * 100),
        totalTime: questionTimes.reduce((a, b) => a + (b || 0), 0),
        date: new Date().toLocaleDateString('ar-SA'), timestamp: Date.now()
      };
      results.push(result);
      localStorage.setItem('nafisResults', JSON.stringify(results));
    }
    function showLeaderboard() {
      const results = JSON.parse(localStorage.getItem('nafisResults') || '[]');
      const filtered = results.filter(r => r.testType === testType).sort((a, b) => b.percentage - a.percentage || a.totalTime - b.totalTime).slice(0, 10);
      const html = filtered.map((r, i) => {
        const isMe = r.studentName === currentStudent.fullName;
        const style = isMe ? 'background:#fff5f5;border:2px solid #e74c3c;' : '';
        return `<div style="display:flex;justify-content:space-between;align-items:center;padding:15px;margin:10px 0;background:#f8f9fa;border-radius:10px;${style}">
                  <div><strong>${i + 1}. ${r.studentName}</strong>${isMe ? '<span style="color:#e74c3c;"> (Ø£Ù†Øª)</span>' : ''}<br><small>${r.grade} - Ø´Ø¹Ø¨Ø© ${r.section}</small></div>
                  <div style="text-align:left;"><strong>${r.percentage}%</strong><br><small>${r.totalTime}Ø«</small></div>
                </div>`;
      }).join('');
      document.getElementById('leaderboard').innerHTML = html || '<p style="text-align:center;color:#666;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
      document.getElementById('leaderboardCard').style.display = 'block';
    }
    function goHome() {
      currentStudent = {}; currentTest = {}; currentQuestionIndex = 0; userAnswers = []; score = 0; testType = ''; questionTimes = [];
      ['questionArea','leaderboardCard','testSelection','studentCodeDisplay','loginForm'].forEach(id => document.getElementById(id).style.display = 'none');
      document.getElementById('studentForm').style.display = 'block';
      ['firstName','fatherName','grandFatherName','familyName','grade','section','loginFullName','studentCode'].forEach(id => document.getElementById(id).value = '');
      ['optionsContainer','questionText','.nav-buttons','submitBtn','finishBtn'].forEach(sel => { const el = document.querySelector(sel); if (el) el.style.display = 'block'; });
      document.getElementById('scoreDisplay').style.display = 'none';
      document.getElementById('progressBar').style.width = '0%';
    }

    /* -------------- Initialize App -------------- */
    window.dailyQuestions = [];
    window.weeklyQuestions = [];
    window.syncManager = new SyncManager();
    document.addEventListener('DOMContentLoaded', () => {
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØµØ© Ù†Ø§ÙØ³ Ø¨Ù†Ø¬Ø§Ø­');
      updateConnectionStatus(navigator.onLine);
      setTimeout(() => { if (window.syncManager) window.syncManager.updateUI(); }, 2000);
    });
    window.addEventListener('online', () => updateConnectionStatus(true));
    window.addEventListener('offline', () => updateConnectionStatus(false));

    /* -------------- Anti-Cheat -------------- */
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && [67, 65, 86, 83, 85].includes(e.keyCode)) e.preventDefault();
      if (e.keyCode === 123) e.preventDefault();
    });
  </script>
</body>
</html>
