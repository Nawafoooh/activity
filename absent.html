html += '</div><div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl flex gap-3 justify-end"><button type="button" onclick="closeEditModal()" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium">Ø¥Ù„ØºØ§Ø¡</button><button type="button" onclick="saveEditedAttendance()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-lg">âœ“ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button></div></div></div>';
            
            return html;
        }

        render();
    </script>
</body>
</html><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        const teachersList = [
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø·Ø± Ø¨Ù† Ù…ØµÙ„Ø­ Ø§Ù„Ø¹Ù…Ø±ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù…Ø§Ø±ÙŠ Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ',
            'Ù…ÙˆÙÙ‚ Ù…Ø±Ø²ÙˆÙ‚ Ø³ÙˆÙŠØ±Ø­ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙˆØ§Ø² Ø²Ø§ÙŠØ¯ Ù„Ø§ÙÙŠ Ø§Ù„Ù…Ù‡ÙŠÙ…Ø²ÙŠ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ',
            'ÙÙŠØµÙ„ Ø¹Ø·Ø§Ù„Ù„Ù‡ Ø­ÙˆÙŠÙ…Ø¯ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ',
            'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹ÙŠØ§Ø¯ Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ù…ÙˆØ¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø³Ø§ÙŠØ± ÙÙŠØµÙ„ Ø³Ø¹Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¶ÙŠÙ„Ù‡ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ù†Ø§ÙØ¹ Ø´Ø¹ÙˆÙŠ Ù†Ø§ÙØ¹ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ø§Ø³Ø§Ù…Ù‡ Ù…Ù†ÙˆØ± Ù…Ø´Ø¹Ù„ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¹ÙŠØ§Ø¯ Ø¹Ù„ÙŠØ«Ù‡ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙØ®Ø±ÙŠ Ø§Ù„ØªØ±ÙƒÙŠ',
            'Ø£Ø­Ù…Ø¯ Ø­Ø§Ù…Ø¯ Ù‡Ù„Ø§Ù„ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ù…ÙŠØ§Ù† Ø¹Ù„ÙŠ Ù†Ù…ÙŠØ§Ù† Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ØµÙ„Ø§Ø­ ØµØ§Ù„Ø­ Ø§Ù„Ø±Ø­ÙŠÙ„Ù‰',
            'Ù…Ø´Ø¹Ù„ Ø¨Ù† Ù‡Ù„ÙŠÙ„ Ø¨Ù† ØºØ§Ù„Ø¨ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ù„ÙŠ Ù…ØªØ¹Ø¨ Ù†Ø§ØµØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø³ÙŠÙ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù†Ø¹Ù… Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø¹Ø§Ø±Ø¶ÙŠ',
            'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø°Ø¹Ø§Ø± Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø¹ÙˆÙÙŠ',
            'ÙØ¤Ø§Ø¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ù…Ø§Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ',
            'Ø­Ù…Ø²Ø© ØµØ¯Ù‚Ø© Ø­Ù…Ø²Ø© Ø§Ø³Ù„Ø§Ù…',
            'Ø³Ù„Ù…Ø§Ù† ØµØ§Ù„Ø­ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ',
            'Ø¹Ø¨ÙŠØ¯ Ø¨Ù† Ø¯Ø®ÙŠÙ„ Ø¨Ù† Ø¯ÙˆÙŠÙ‡ÙŠØ³ Ø§Ù„Ø¹ÙŠØ§Ø¶ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…ÙÙ„Ø­ Ù†ÙˆÙŠØ¹Ù… Ø§Ù„Ø±ÙˆÙŠØ«ÙŠ',
            'ÙÙŠØµÙ„ Ø¹ÙˆØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ Ø³Ù„Ù…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„ Ø¨Ø­Ø±Ø§Ù† Ø§Ù„Ù‚Ø±Ù†ÙŠ',
            'ÙƒØ§ØªØ¨ Ù…ÙÙ„Ø­ Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯Ù‰',
            'Ø­Ø¨ÙŠØ¨ Ø¹Ù„ÙŠ Ù†Ø¹ÙŠØ³ Ø§Ù„Ø¹Ù…Ø±ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø§ÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
            'Ø³Ù„Ø·Ø§Ù† Ø¹ÙˆÙŠØ¶ Ù…Ø¹ÙŠØ¶ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ù…Ø¹ÙŠØ¶ Ù…Ø¹Ù„Ø§ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† ØºÙ„Ø§Ø¨ Ø§Ù„Ù…Ø®Ù„ÙÙŠ',
            'Ø³Ø¹Ø¯ Ø·Ø§Ù„Ø¹ Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù†Ø§Ù‡Ø± Ù…Ø´Ø¹Ù„ Ø¹ÙˆÙŠØ¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
            'Ù…ÙˆØ³Ù‰ ØºØ§Ø²ÙŠ Ø³ÙØ± Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ù…ÙˆØ³Ù‰ Ù…Ø³Ø¹ÙˆØ¯ Ø¹Ø§ÙŠØ¶ Ø§Ù„Ø­ÙŠØ³ÙˆÙ†ÙŠ',
            'Ù†ÙˆØ§Ù Ù…Ù†ØµÙˆØ± Ø¹ÙˆØ§Ø¯ Ø§Ù„ØµØ¨Ø­ÙŠ',
            'Ø¨Ø¯Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø´Ø§Ø¦Ø¯ Ø§Ù„Ø³Ø­ÙŠÙ…ÙŠ',
            'ÙÙ‡Ø¯ Ø¹ÙˆÙŠØ¶ Ø¹ÙˆØ¶ Ø§Ù„Ø´Ø§Ù…Ø§Ù†ÙŠ Ø§Ù„Ø­Ø±Ø¨ÙŠ',
            'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø§ÙŠØ¯ Ø®Ø¶Ø±Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ',
            'Ø£Ø­Ù…Ø¯ Ù…Ø·Ø± Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ'
        ];

        const classCapacities = {
            'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·': {'1': 30, '2': 31, '3': 31, '4': 30, '5': 30, '6': 30},
            'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·': {'1': 29, '2': 27, '3': 27, '4': 26, '5': 27, '6': 26},
            'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·': {'1': 3, '2': 29, '3': 30, '4': 30, '5': 30, '6': 30}
        };

        let state = {
            currentUser: { 
                name: teachersList[0]
            },
            attendance: [],
            filters: {
                filterGrade: '',
                filterSection: '',
                filterPeriod: '',
                dateFrom: '',
                dateTo: ''
            },
            modals: {
                showAttendanceModal: false,
                showEditModal: false,
                editingAttendance: null
            },
            newAttendance: {
                grade: '',
                section: '',
                period: '1',
                date: new Date().toISOString().split('T')[0],
                absentCount: 0,
                absentStudents: []
            }
        };

        const config = {
            schoolInfo: {
                name: 'Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ',
                principal: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
                assistant: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ',
                counselor: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
                type: 'Ø¨Ù†ÙŠÙ†'
            },
            grades: ['Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·', 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·'],
            sections: ['1', '2', '3', '4', '5', '6'],
            periods: ['1', '2', '3', '4', '5', '6', '7']
        };

        function getFirstPeriodAttendance(grade, section, date) {
            return state.attendance.find(a => 
                a.grade === grade && 
                a.section === section && 
                a.date === date && 
                a.period === '1'
            );
        }

        function isAttendanceRecorded(grade, section, period, date) {
            return state.attendance.some(a => 
                a.grade === grade && 
                a.section === section && 
                a.period === period && 
                a.date === date
            );
        }

        function getFilteredAttendance() {
            let filtered = [...state.attendance];

            if (state.filters.filterGrade) {
                filtered = filtered.filter(a => a.grade === state.filters.filterGrade);
            }

            if (state.filters.filterSection) {
                filtered = filtered.filter(a => a.section === state.filters.filterSection);
            }

            if (state.filters.filterPeriod) {
                filtered = filtered.filter(a => a.period === state.filters.filterPeriod);
            }

            if (state.filters.dateFrom) {
                filtered = filtered.filter(a => a.date >= state.filters.dateFrom);
            }

            if (state.filters.dateTo) {
                filtered = filtered.filter(a => a.date <= state.filters.dateTo);
            }

            return filtered;
        }

        function getStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = state.attendance.filter(a => a.date === today);
            
            const totalAbsent = todayAttendance.reduce((sum, a) => sum + a.absentCount, 0);
            const totalRecords = state.attendance.length;
            const classesRecorded = new Set(state.attendance.map(a => `${a.grade}-${a.section}`)).size;

            return {
                totalRecords,
                todayRecords: todayAttendance.length,
                totalAbsent,
                classesRecorded
            };
        }

        function setFilter(key, value) {
            state.filters[key] = value;
            render();
        }

        function clearFilters() {
            state.filters = {
                filterGrade: '',
                filterSection: '',
                filterPeriod: '',
                dateFrom: '',
                dateTo: ''
            };
            render();
        }

        function openAttendanceModal() {
            state.modals.showAttendanceModal = true;
            state.newAttendance = {
                grade: '',
                section: '',
                period: '1',
                date: new Date().toISOString().split('T')[0],
                absentCount: 0,
                absentStudents: []
            };
            render();
        }

        function closeAttendanceModal() {
            state.modals.showAttendanceModal = false;
            render();
        }

        function openEditModal(attendanceData) {
            state.modals.showEditModal = true;
            state.modals.editingAttendance = JSON.parse(JSON.stringify(attendanceData));
            if (!state.modals.editingAttendance.absentStudents) {
                state.modals.editingAttendance.absentStudents = [];
            }
            render();
        }

        function closeEditModal() {
            state.modals.showEditModal = false;
            state.modals.editingAttendance = null;
            render();
        }

        function addAbsentStudent() {
            const studentName = document.getElementById('newStudentNameInput')?.value.trim();
            if (studentName) {
                state.newAttendance.absentStudents.push(studentName);
                state.newAttendance.absentCount = state.newAttendance.absentStudents.length;
                document.getElementById('newStudentNameInput').value = '';
                render();
            }
        }

        function removeAbsentStudent(index) {
            state.newAttendance.absentStudents.splice(index, 1);
            state.newAttendance.absentCount = state.newAttendance.absentStudents.length;
            render();
        }

        function updateStudentName(index, newName) {
            if (newName.trim()) {
                state.modals.editingAttendance.absentStudents[index] = newName.trim();
            }
        }

        function addStudentToEdit() {
            const studentName = document.getElementById('editStudentNameInput')?.value.trim();
            if (studentName) {
                state.modals.editingAttendance.absentStudents.push(studentName);
                state.modals.editingAttendance.absentCount = state.modals.editingAttendance.absentStudents.length;
                document.getElementById('editStudentNameInput').value = '';
                render();
            }
        }

        function removeStudentFromEdit(index) {
            state.modals.editingAttendance.absentStudents.splice(index, 1);
            state.modals.editingAttendance.absentCount = state.modals.editingAttendance.absentStudents.length;
            render();
        }

        function saveEditedAttendance() {
            const index = state.attendance.findIndex(att => att.id === state.modals.editingAttendance.id);
            if (index !== -1) {
                state.attendance[index] = state.modals.editingAttendance;
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
                closeEditModal();
            }
        }

        function openEditModalSafe(attendanceId) {
            const attendance = state.attendance.find(a => a.id === attendanceId);
            if (attendance) {
                openEditModal(attendance);
            }
        }

        function saveAttendance() {
            const grade = state.newAttendance.grade;
            const section = state.newAttendance.section;
            const period = state.newAttendance.period;
            const date = state.newAttendance.date;
            const absentCount = state.newAttendance.absentStudents.length;
            const absentStudents = [...state.newAttendance.absentStudents];

            if (!grade || !section) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø©');
                return;
            }

            if (period === '1') {
                const existing = isAttendanceRecorded(grade, section, period, date);
                if (existing) {
                    if (!confirm('âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø³Ø¨Ù‚Ø§Ù‹. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŸ')) {
                        return;
                    }
                    state.attendance = state.attendance.filter(a => 
                        !(a.grade === grade && a.section === section && a.period === period && a.date === date)
                    );
                }

                const attendance = {
                    id: Math.max(...state.attendance.map(a => a.id || 0), 0) + 1,
                    grade: grade,
                    section: section,
                    period: period,
                    date: date,
                    absentCount: absentCount,
                    absentStudents: absentStudents,
                    totalStudents: classCapacities[grade][section],
                    teacherName: state.currentUser.name,
                    recordedAt: new Date().toISOString(),
                    isFirstPeriod: true
                };

                state.attendance.push(attendance);
                alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ù†Ø¬Ø§Ø­!');
                closeAttendanceModal();
            } else {
                const firstPeriod = getFirstPeriodAttendance(grade, section, date);
                
                if (!firstPeriod) {
                    alert('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£ÙˆÙ„Ø§Ù‹!');
                    return;
                }

                const existing = isAttendanceRecorded(grade, section, period, date);
                if (existing) {
                    if (!confirm('âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø­ØµØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŸ')) {
                        return;
                    }
                    state.attendance = state.attendance.filter(a => 
                        !(a.grade === grade && a.section === section && a.period === period && a.date === date)
                    );
                }

                const copiedStudents = [...firstPeriod.absentStudents];
                const allStudents = [...new Set([...copiedStudents, ...absentStudents])];
                const additionalAbsent = allStudents.length - copiedStudents.length;

                const attendance = {
                    id: Math.max(...state.attendance.map(a => a.id || 0), 0) + 1,
                    grade: grade,
                    section: section,
                    period: period,
                    date: date,
                    absentCount: allStudents.length,
                    absentStudents: allStudents,
                    totalStudents: classCapacities[grade][section],
                    teacherName: state.currentUser.name,
                    recordedAt: new Date().toISOString(),
                    isFirstPeriod: false,
                    copiedFromFirstPeriod: copiedStudents.length,
                    additionalAbsent: additionalAbsent
                };

                state.attendance.push(attendance);
                
                if (additionalAbsent > 0) {
                    alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© ' + period + ' Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“‹ Ù…Ù„Ø®Øµ:\nâ€¢ Ù…Ù†Ø³ÙˆØ® Ù…Ù† Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: ' + copiedStudents.length + '\nâ€¢ Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©: ' + additionalAbsent + '\nâ€¢ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ' + allStudents.length);
                } else {
                    alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© ' + period + ' Ø¨Ù†Ø¬Ø§Ø­!');
                }
                
                closeAttendanceModal();
            }
        }

        function exportToCSV() {
            const filtered = getFilteredAttendance();
            const headers = ['#', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø´Ø¹Ø¨Ø©', 'Ø§Ù„Ø­ØµØ©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨', 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±', 'Ø§Ù„Ù…Ø¹Ù„Ù…'];
            const rows = filtered.map((a, i) => {
                const attendanceRate = ((a.totalStudents - a.absentCount) / a.totalStudents * 100).toFixed(1);
                return [
                    i + 1,
                    a.grade,
                    a.section,
                    'Ø§Ù„Ø­ØµØ© ' + a.period,
                    a.date,
                    a.absentCount,
                    a.totalStudents,
                    attendanceRate + '%',
                    a.teacherName
                ];
            });

            const csvContent = [headers, ...rows]
                .map(row => row.join(','))
                .join('\n');

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Ø³Ø¬Ù„_Ø§Ù„ØºÙŠØ§Ø¨_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }

        function render() {
            const app = document.getElementById('app');
            const stats = getStats();
            const filtered = getFilteredAttendance();
            
            app.innerHTML = renderHeader() + renderUserBar() + renderMainContent(stats, filtered) + (state.modals.showAttendanceModal ? renderAttendanceModal() : '') + (state.modals.showEditModal ? renderEditModal() : '');
        }

        function renderHeader() {
            return '<div class="bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white shadow-2xl"><div class="max-w-7xl mx-auto px-6 py-8"><div class="flex items-center justify-between mb-6"><div><h1 class="text-4xl font-bold mb-2">ğŸ“‹ ' + config.schoolInfo.name + '</h1><p class="text-blue-100 text-lg">Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ - ' + config.schoolInfo.type + '</p></div><div class="text-left bg-blue-800 bg-opacity-50 rounded-lg p-4 backdrop-blur-sm"><p class="text-sm text-blue-100 mb-1">ğŸ‘¤ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ' + config.schoolInfo.principal + '</p><p class="text-sm text-blue-100 mb-1">ğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ' + config.schoolInfo.assistant + '</p><p class="text-sm text-blue-100">ğŸ‘¤ Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ: ' + config.schoolInfo.counselor + '</p></div></div></div></div>';
        }

        function renderUserBar() {
            let html = '<div class="bg-white border-b shadow-sm sticky top-0 z-40"><div class="max-w-7xl mx-auto px-6 py-4"><div class="flex items-center justify-between flex-wrap gap-4"><div class="flex items-center gap-4"><select onchange="state.currentUser.name = this.value; render();" class="px-4 py-3 border-2 border-blue-600 rounded-lg focus:ring-2 focus:ring-blue-500 font-medium text-blue-900 bg-blue-50">';
            
            teachersList.forEach(teacher => {
                html += '<option value="' + teacher + '" ' + (state.currentUser.name === teacher ? 'selected' : '') + '>ğŸ‘¨â€ğŸ« ' + teacher + '</option>';
            });
            
            html += '</select><a href="https://nawafoooh.github.io/activity/shahid.html" class="px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">â† Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></div><div class="bg-blue-50 px-4 py-2 rounded-lg border border-blue-200"><p class="text-sm text-blue-900"><span class="font-bold">Ø§Ù„Ù…Ø¹Ù„Ù…:</span> ' + state.currentUser.name + '</p></div></div></div></div>';
            
            return html;
        }

        function renderMainContent(stats, filtered) {
            return '<div class="max-w-7xl mx-auto px-6 py-6">' + renderStats(stats) + renderAttendanceSection(filtered) + '</div>';
        }

        function renderStats(stats) {
            return '<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"><div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-blue-500"><div class="flex items-center justify-between mb-3"><span class="text-4xl">ğŸ“</span><div class="text-3xl font-bold text-blue-600">' + stats.totalRecords + '</div></div><div class="text-gray-600 font-medium">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div></div><div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-green-500"><div class="flex items-center justify-between mb-3"><span class="text-4xl">ğŸ“…</span><div class="text-3xl font-bold text-green-600">' + stats.todayRecords + '</div></div><div class="text-gray-600 font-medium">Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div></div><div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-red-500"><div class="flex items-center justify-between mb-3"><span class="text-4xl">ğŸ‘¥</span><div class="text-3xl font-bold text-red-600">' + stats.totalAbsent + '</div></div><div class="text-gray-600 font-medium">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ÙŠÙˆÙ…</div></div><div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-t-4 border-purple-500"><div class="flex items-center justify-between mb-3"><span class="text-4xl">ğŸ«</span><div class="text-3xl font-bold text-purple-600">' + stats.classesRecorded + '</div></div><div class="text-gray-600 font-medium">Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div></div></div>';
        }

        function renderAttendanceSection(filtered) {
            let html = '<div class="bg-white rounded-xl shadow-lg mb-6"><div class="border-b px-6 py-4"><div class="flex items-center justify-between flex-wrap gap-4"><h2 class="text-2xl font-bold text-gray-900">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØºÙŠØ§Ø¨</h2><div class="flex gap-3">';
            
            if (state.attendance.length > 0) {
                html += '<button onclick="exportToCSV()" class="flex items-center gap-2 px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>';
            }
            
            html += '<button onclick="openAttendanceModal()" class="flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md">â• ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ§Ø¨ Ø¬Ø¯ÙŠØ¯</button></div></div></div>';
            html += renderFilters();
            html += renderAttendanceList(filtered);
            html += '</div>';
            
            return html;
        }

        function renderFilters() {
            const hasFilters = state.filters.filterGrade || state.filters.filterSection || state.filters.filterPeriod || state.filters.dateFrom || state.filters.dateTo;
            
            let html = '<div class="p-6 bg-gray-50 border-b"><div class="grid grid-cols-1 md:grid-cols-5 gap-4">';
            
            html += '<div><label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“Š Ø§Ù„ØµÙ</label><select onchange="setFilter(\'filterGrade\', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><option value="">Ø§Ù„ÙƒÙ„</option>';
            config.grades.forEach(g => {
                html += '<option value="' + g + '" ' + (state.filters.filterGrade === g ? 'selected' : '') + '>' + g + '</option>';
            });
            html += '</select></div>';
            
            html += '<div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø´Ø¹Ø¨Ø©</label><select onchange="setFilter(\'filterSection\', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><option value="">Ø§Ù„ÙƒÙ„</option>';
            config.sections.forEach(s => {
                html += '<option value="' + s + '" ' + (state.filters.filterSection === s ? 'selected' : '') + '>' + s + '</option>';
            });
            html += '</select></div>';
            
            html += '<div><label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø­ØµØ©</label><select onchange="setFilter(\'filterPeriod\', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><option value="">Ø§Ù„ÙƒÙ„</option>';
            config.periods.forEach(p => {
                html += '<option value="' + p + '" ' + (state.filters.filterPeriod === p ? 'selected' : '') + '>Ø§Ù„Ø­ØµØ© ' + p + '</option>';
            });
            html += '</select></div>';
            
            html += '<div><label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label><input type="date" value="' + state.filters.dateFrom + '" onchange="setFilter(\'dateFrom\', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></div>';
            
            html += '<div><label class="block text-sm font-medium text-gray-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label><input type="date" value="' + state.filters.dateTo + '" onchange="setFilter(\'dateTo\', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></div>';
            
            html += '</div>';
            
            if (hasFilters) {
                html += '<button onclick="clearFilters()" class="mt-4 text-sm text-blue-600 hover:text-blue-800 font-medium">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±</button>';
            }
            
            html += '</div>';
            
            return html;
        }

        function renderAttendanceList(filtered) {
            if (filtered.length === 0) {
                return '<div class="p-16 text-center"><div class="text-6xl mb-4">ğŸ“‹</div><p class="text-xl text-gray-500 mb-2">Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ ØºÙŠØ§Ø¨ Ø¨Ø¹Ø¯</p><p class="text-sm text-gray-400">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</p></div>';
            }
            
            let html = '<div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">#</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø§Ù„ØµÙ</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø§Ù„Ø´Ø¹Ø¨Ø©</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø§Ù„Ø­ØµØ©</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ†</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø§Ù„Ù…Ø¹Ù„Ù…</th><th class="px-4 py-3 text-right text-sm font-bold text-gray-700">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody class="divide-y">';
            
            filtered.forEach((a, index) => {
                const attendanceRate = ((a.totalStudents - a.absentCount) / a.totalStudents * 100).toFixed(1);
                const isAdditional = a.additionalAbsent && a.additionalAbsent > 0;
                
                let studentsNames = '';
                if (a.absentStudents && a.absentStudents.length > 0) {
                    if (a.absentStudents.length <= 3) {
                        studentsNames = '<div class="text-sm">';
                        a.absentStudents.forEach((s, i) => {
                            studentsNames += (i + 1) + '. ' + s + '<br>';
                        });
                        studentsNames += '</div>';
                    } else {
                        studentsNames = '<div class="text-sm">';
                        for (let i = 0; i < 3; i++) {
                            studentsNames += (i + 1) + '. ' + a.absentStudents[i] + '<br>';
                        }
                        studentsNames += '<div class="text-blue-600 font-bold mt-1">... Ùˆ ' + (a.absentStudents.length - 3) + ' Ø·Ø§Ù„Ø¨ Ø¢Ø®Ø±</div></div>';
                    }
                } else {
                    studentsNames = '<span class="text-gray-400 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡</span>';
                }
                
                html += '<tr class="hover:bg-gray-50 ' + (isAdditional ? 'bg-red-50' : '') + '">';
                html += '<td class="px-4 py-3 text-sm">' + (index + 1) + '</td>';
                html += '<td class="px-4 py-3 text-sm font-medium">' + a.grade + '</td>';
                html += '<td class="px-4 py-3 text-sm">' + a.section + '</td>';
                html += '<td class="px-4 py-3 text-sm">';
                html += '<span class="px-3 py-1 rounded-full text-xs font-bold ' + (a.period === '1' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800') + '">Ø§Ù„Ø­ØµØ© ' + a.period + '</span>';
                
                if (isAdditional) {
                    html += '<span class="mr-2 px-2 py-1 rounded-full text-xs font-bold bg-red-600 text-white">+' + a.additionalAbsent + ' Ø¬Ø¯ÙŠØ¯</span>';
                }
                
                html += '</td>';
                html += '<td class="px-4 py-3 text-sm">' + a.date + '</td>';
                html += '<td class="px-4 py-3 text-sm font-bold ' + (a.absentCount > 0 ? 'text-red-600' : 'text-green-600') + '">' + a.absentCount + '</td>';
                html += '<td class="px-4 py-3 text-sm max-w-xs"><div class="bg-yellow-50 border border-yellow-200 rounded p-2">' + studentsNames + '</div></td>';
                html += '<td class="px-4 py-3 text-sm">' + a.totalStudents + '</td>';
                html += '<td class="px-4 py-3 text-sm"><span class="px-3 py-1 rounded-full text-xs font-bold ' + (attendanceRate >= 90 ? 'bg-green-100 text-green-800' : attendanceRate >= 75 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800') + '">' + attendanceRate + '%</span></td>';
                html += '<td class="px-4 py-3 text-sm">' + a.teacherName + '</td>';
                html += '<td class="px-4 py-3 text-sm"><button onclick="openEditModalSafe(' + a.id + ')" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs font-medium whitespace-nowrap">âœï¸ Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„</button></td>';
                html += '</tr>';
            });
            });
            
            html += '</tbody></table></div><div class="p-4 bg-gray-50 border-t text-center text-sm text-gray-600">Ø¹Ø±Ø¶ ' + filtered.length + ' Ø³Ø¬Ù„</div>';
            
            return html;
        }

        function renderAttendanceModal() {
            const grade = state.newAttendance.grade;
            const section = state.newAttendance.section;
            const period = state.newAttendance.period;
            const date = state.newAttendance.date;
            const totalStudents = grade && section ? classCapacities[grade][section] : 0;
            const firstPeriod = period !== '1' && grade && section ? getFirstPeriodAttendance(grade, section, date) : null;
            
            let html = '<div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50" onclick="if(event.target === this) closeAttendanceModal()"><div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><div class="sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl"><h2 class="text-2xl font-bold flex items-center gap-2">ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨</h2><p class="text-blue-100 text-sm mt-1">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p></div><div class="p-6 space-y-5"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ØµÙ <span class="text-red-500">*</span></label><select id="attendanceGradeSelect" onchange="state.newAttendance.grade = this.value; render();" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
            
            config.grades.forEach(g => {
                html += '<option value="' + g + '" ' + (grade === g ? 'selected' : '') + '>' + g + '</option>';
            });
            
            html += '</select></div><div><label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø´Ø¹Ø¨Ø© <span class="text-red-500">*</span></label><select id="attendanceSectionSelect" onchange="state.newAttendance.section = this.value; render();" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>';
            
            config.sections.forEach(s => {
                html += '<option value="' + s + '" ' + (section === s ? 'selected' : '') + '>' + s + '</option>';
            });
            
            html += '</select></div></div>';
            
            if (grade && section) {
                html += '<div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4"><p class="text-sm font-bold text-blue-900">ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ ' + grade + ' - Ø§Ù„Ø´Ø¹Ø¨Ø© ' + section + ': <span class="text-lg">' + totalStudents + ' Ø·Ø§Ù„Ø¨</span></p></div>';
            }
            
            html += '<div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø­ØµØ© <span class="text-red-500">*</span></label><select id="attendancePeriodSelect" onchange="state.newAttendance.period = this.value; render();" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">';
            
            config.periods.forEach(p => {
                html += '<option value="' + p + '" ' + (period === p ? 'selected' : '') + '>Ø§Ù„Ø­ØµØ© ' + p + '</option>';
            });
            
            html += '</select></div><div><label class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" value="' + date + '" onchange="state.newAttendance.date = this.value; render();" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></div></div>';
            
            if (period !== '1' && firstPeriod) {
                html += '<div class="bg-green-50 border-2 border-green-300 rounded-lg p-4"><p class="text-sm font-bold text-green-900 mb-2">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</p><p class="text-sm text-green-800">Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨ ÙÙŠ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: <span class="font-bold">' + firstPeriod.absentCount + '</span></p><p class="text-xs text-green-700 mt-2">ğŸ’¡ Ø³ÙŠØªÙ… Ù†Ø³Ø® Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨ Ù…Ù† Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØºÙŠØ§Ø¨ Ø¥Ø¶Ø§ÙÙŠ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±.</p></div>';
            } else if (period !== '1' && grade && section) {
                html += '<div class="bg-red-50 border-2 border-red-300 rounded-lg p-4"><p class="text-sm font-bold text-red-900">âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£ÙˆÙ„Ø§Ù‹!</p><p class="text-xs text-red-700 mt-1">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø®Ø±Ù‰ Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰.</p></div>';
            }
            
            if (period === '1' || (period !== '1' && firstPeriod)) {
                html += '<div><label class="block text-sm font-bold text-gray-700 mb-2">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ†</label><div class="space-y-2 mb-3">';
                
                if (state.newAttendance.absentStudents.length > 0) {
                    state.newAttendance.absentStudents.forEach((student, index) => {
                        html += '<div class="flex items-center gap-2 bg-gray-50 p-2 rounded"><span class="flex-1">' + (index + 1) + '. ' + student + '</span><button onclick="removeAbsentStudent(' + index + ')" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-xs">Ø­Ø°Ù</button></div>';
                    });
                } else {
                    html += '<p class="text-gray-500 text-sm text-center py-4">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ø§Ù„Ø¨ ØºØ§Ø¦Ø¨</p>';
                }
                
                html += '</div><div class="flex gap-2"><input type="text" id="newStudentNameInput" class="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨" onkeypress="if(event.key===\'Enter\'){addAbsentStudent()}"><button onclick="addAbsentStudent()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">â• Ø¥Ø¶Ø§ÙØ©</button></div><p class="text-xs text-gray-600 mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ†: <span class="font-bold">' + state.newAttendance.absentStudents.length + '</span></p></div>';
            }
            
            const isDisabled = !grade || !section || (period !== '1' && !firstPeriod);
            
            html += '</div><div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl flex gap-3 justify-end"><button type="button" onclick="closeAttendanceModal()" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium">Ø¥Ù„ØºØ§Ø¡</button><button type="button" onclick="saveAttendance()" ' + (isDisabled ? 'disabled' : '') + ' class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg ' + (isDisabled ? 'opacity-50 cursor-not-allowed' : '') + '">âœ“ Ø­ÙØ¸ Ø§Ù„ØºÙŠØ§Ø¨</button></div></div></div>';
            
            return html;
        }

        render();
    </script>
</body>
</html>
